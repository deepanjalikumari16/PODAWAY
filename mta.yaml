ID: podway
_schema-version: '3.1'
parameters:
  enable-parallel-deployments: true
version: 0.0.1
modules:
  - name: podway-web-approuter
    type: approuter.nodejs
    path: podway-approuter
    properties:
      TENANT_HOST_PATTERN: ^(.*)-podway-web-router.${default-domain}
    parameters:
      disk-quota: 256M
      memory: 256M
      routes:
       - route: uat-podway-web-router.${default-domain}
    requires:
      - name: portal_destination_podway
      - name: staging-podway-uaa
      - name: podway_html5_repo_runtime
      - name: portal_resources_podway
        group: destinations
        properties:
          name: EXPO_PODWAY_API
          url: 'https://uat-podway-api.cfapps.eu10.hana.ondemand.com/'
          forwardAuthToken: true
  - name: podway_ui_deployer
    type: com.sap.application.content
    path: .
    requires:
      - name: podway_html5_repo_host
        parameters:
           content-target: true
    build-parameters:
      build-result: resources
      requires:
        - name: MAACDE
          artifacts:
            - MAACDE-content.zip
          target-path: resources/
        - name: Manage_FAQ
          artifacts:
            - Manage_FAQ-content.zip
          target-path: resources/
        - name: MAFA
          artifacts:
            -  MAFA-content.zip
          target-path: resources/          
        - name: Assignment_List
          artifacts:
            - Assignment_List-content.zip
          target-path: resources/          
        - name: MAAD
          artifacts:
            - MAAD-content.zip
          target-path: resources/          
        - name: Manage_Event_Info
          artifacts:
            - Manage_Event_Info-content.zip
          target-path: resources/          
        - name: MAVET
          artifacts:
            - MAVET-content.zip
          target-path: resources/          
        - name: ManageVisitor
          artifacts:
            - ManageVisitor-content.zip
          target-path: resources/          
        - name: Dashboard
          artifacts:
            - Dashboard-content.zip
          target-path: resources/          
        - name: VisitorJourney
          artifacts:
            - VisitorJourney-content.zip
          target-path: resources/          
        - name: MDM_Data
          artifacts:
            - MDM_Data-content.zip
          target-path: resources/     
        - name: Groups
          artifacts:
            - Groups-content.zip
          target-path: resources/
        - name: Notifications
          artifacts:
            - Notifications-content.zip
          target-path: resources/       
  - name: MAACDE
    type: html5
    path: MAACDE
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []

  - name: MAFA
    type: html5
    path: MAFA
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []

  - name: Manage_FAQ
    type: html5
    path: Manage_FAQ
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []

  - name: Assignment_List
    type: html5
    path: Assignment_List
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []

  - name: MAAD
    type: html5
    path: MAAD
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []
  
  - name: Manage_Event_Info
    type: html5
    path: Manage_Event_Info
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []
    
  - name: MAVET
    type: html5
    path: MAVET
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []
 
  - name: ManageVisitor
    type: html5
    path: ManageVisitor
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []
  
  - name: Dashboard
    type: html5
    path: Dashboard
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []

  - name: VisitorJourney
    type: html5
    path: VisitorJourney
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []
    
  - name: MDM_Data
    type: html5
    path: MDM_Data
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []

  - name: Groups
    type: html5
    path: Groups
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []

  - name: Notifications
    type: html5
    path: Notifications
    build-parameters:
      builder: custom
      commands:
       - npm run build
      supported-platforms: []

  - name: launchpad
    type: com.sap.application.content
    path: launchpad
    requires:
      - name: portal_resources_podway
        parameters:
          content-target: true
          service-key:
            config:
              content-endpoint: developer
            name: content-deploy-key
      - name: podway_html5_repo_host
      - name: staging-podway-uaa
    parameters:
      config:
        TENANT_HOST_PATTERN: ^(.*)-podway-web-router.${default-domain}
    deployed-after:
      - podway_ui_deployer
      
resources:
  - name: portal_destination_podway
    parameters:
      service-plan: lite
      service: destination
    type: org.cloudfoundry.managed-service
  - name: podway_html5_repo_runtime
    parameters:
      service-plan: app-runtime
      service: html5-apps-repo
    type: org.cloudfoundry.managed-service
  - name: podway_html5_repo_host
    parameters:
      service-plan: app-host
      path: ./app-host.json
      service: html5-apps-repo
    type: org.cloudfoundry.managed-service
  - name: staging-podway-uaa
    parameters:
      service-plan: application
      service: xsuaa
      service-name: uat-podway-uaa
    type: org.cloudfoundry.existing-service    
  - name: portal_resources_podway
    parameters:
      service-plan: standard
      service: portal
    type: org.cloudfoundry.managed-service
build-parameters:
  before-all:
  - builder: custom
    commands:
    - npm install
