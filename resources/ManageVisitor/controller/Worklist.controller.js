sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,s,r){"use strict";return e.extend("com.coil.podway.ManageVisitor.controller.Worklist",{formatter:i,onInit:function(){var e,i,s=this.byId("table");i=s.getBusyIndicatorDelay();this._aTableSearchState=[];e=new t({worklistTableTitle:this.getResourceBundle().getText("worklistTableTitle"),saveAsTileTitle:this.getResourceBundle().getText("saveAsTileTitle",this.getResourceBundle().getText("worklistViewTitle")),shareOnJamTitle:this.getResourceBundle().getText("worklistTitle"),shareSendEmailSubject:this.getResourceBundle().getText("shareSendEmailWorklistSubject"),shareSendEmailMessage:this.getResourceBundle().getText("shareSendEmailWorklistMessage",[location.href]),tableNoDataText:this.getResourceBundle().getText("tableNoDataText"),tableBusyDelay:0});this.setModel(e,"worklistView");s.attachEventOnce("updateFinished",function(){e.setProperty("/tableBusyDelay",i)});this.addHistoryEntry({title:this.getResourceBundle().getText("worklistViewTitle"),icon:"sap-icon://table-view",intent:"#PODiumVisitorManagement-display"},true);this.getRouter().getRoute("worklist").attachPatternMatched(this._onHomeMatched,this);this._setSearchField()},_onHomeMatched:function(){this.getModel().metadataLoaded().then(this._getViewData.bind(this,false,false))},onUpdateFinished:function(e){var t,i=e.getSource(),s=e.getParameter("total");if(s&&i.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("worklistTableTitleCount",[s])}else{t=this.getResourceBundle().getText("worklistTableTitle")}this.getModel("worklistView").setProperty("/worklistTableTitle",t)},onPress:function(e){this._showObject(e.getSource())},onShareInJamPress:function(){var e=this.getModel("worklistView"),t=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:location.href,share:e.getProperty("/shareOnJamTitle")}}});t.open()},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=[];var i=e.getSource().getBasicSearchValue();var s={};if(i&&i.length>0){s["Query"]=i}if(e.getParameter("selectionSet")){this._addFilterBarItems(t,s)}this._getViewData(t,s)}},onRefresh:function(){var e=this.byId("table");e.getBinding("items").refresh()},_addFilterBarItems:function(e,t){var i=this.getView().byId("filterbar");i.getFilterGroupItems().forEach(function(i){if(i.getName()==="Mobile"&&i.getControl().getValue().length>1){t["Mobile"]=i.getControl().getValue()}if(i.getControl().getSelectedKey())switch(i.getName()){case"Country":e.push(new s("Country",r.EQ,i.getControl().getSelectedItem().getText()));break;case"Category":t["ConditionId"]=i.getControl().getSelectedKey();break;case"Things":t["PlaceId"]=i.getControl().getSelectedKey();break}})},_setSearchField:function(e){var t=this.getView().byId("filterbar").getBasicSearch();var i;if(!t){i=new sap.m.SearchField({showSearchButton:false})}else{t=null}this.getView().byId("filterbar").setBasicSearch(i);i.attachBrowserEvent("keyup",function(e){if(e.which===13){this.getView().byId("filterbar").fireSearch()}}.bind(this))},_getViewData:function(e,t){this.getModel("worklistView").setProperty("/btableBusy",true);var i=[new s("IsArchived",r.EQ,false),new s("RoleId",r.EQ,"3")],a={$expand:"UserPreference/UserAccessibilityList/AccessiblityItem"};if(e){i=i.concat(e)}if(t&&Object.keys(t).length){Object.assign(a,t)}debugger;this.getModel().read("/UserSet",{filters:[new s({filters:i,bAnd:true,and:true})],urlParameters:a,success:this._setView.bind(this)})},_setView:function(e){this.getModel("worklistView").setProperty("/btableBusy",false);this.getModel("worklistView").setProperty("/aUserSet",e.results);this.oColumnListTemplate=this.oColumnListTemplate?this.oColumnListTemplate.clone():this.getView().byId("table").getItems()[0];this.getView().byId("table").bindItems({templateShareable:false,path:"worklistView>/aUserSet",model:"worklistView",template:this._getTableTemplate()})},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBindingContext("worklistView").getProperty("Id")})},_applySearch:function(e){var t=this.byId("table"),i=this.getModel("worklistView");t.getBinding("items").filter(e,"Application");if(e.length!==0){i.setProperty("/tableNoDataText",this.getResourceBundle().getText("worklistNoDataWithSearchText"))}},_getTableTemplate:function(){var e=new sap.m.ColumnListItem({type:"Navigation",press:this["onPress"].bind(this)});e.addCell(new sap.m.Text({text:"{worklistView>FirstName} {worklistView>LastName}"}));e.addCell(new sap.m.Text({text:{parts:[{path:"worklistView>UserPreference/UserAccessibilityList/results"},{path:"i18n>Two"}],formatter:this.AccessibiltyItems}}));e.addCell(new sap.m.Text({text:{parts:[{path:"worklistView>UserPreference/UserAccessibilityList/results"},{path:"i18n>One"}],formatter:this.AccessibiltyItems}}));e.addCell(new sap.m.Text({text:{parts:[{path:"worklistView>EmergencyDialCode"},{path:"worklistView>EmergencyMobile"}],formatter:i.EmergencyNumber}}));e.addCell(new sap.m.Text({text:"{worklistView>Country}"}));e.addCell(new sap.m.Text({text:{parts:[{path:"worklistView>UserPreference/UserAccessibilityList/results"},{path:"i18n>Three"}],formatter:this.AccessibiltyItems}}));e.addCell(new sap.m.Button({type:"Transparent",icon:"sap-icon://locate-me",press:this.onNavigate.bind(this)}));return e}})});