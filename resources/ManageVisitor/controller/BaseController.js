sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/UIComponent","sap/m/library","sap/ui/core/Fragment"],function(e,t,o,i){"use strict";var n=o.URLHelper;return e.extend("com.coil.podway.ManageVisitor.controller.BaseController",{getRouter:function(){return t.getRouterFor(this)},getModel:function(e){return this.getView().getModel(e)},setModel:function(e,t){return this.getView().setModel(e,t)},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},onShareEmailPress:function(){var e=this.getModel("objectView")||this.getModel("worklistView");n.triggerEmail(null,e.getProperty("/shareSendEmailSubject"),e.getProperty("/shareSendEmailMessage"))},AccessibiltyItems:function(e,t){if(!e||!e.length){return""}return e.filter(function(e){if(e.AccessiblityItem==null){return false}return e.AccessiblityItem.AccessibilityId===+t}).map(function(e){return e.AccessiblityItem.Title}).join(",")},getPodLocation:function(e){var t=this.getModel("worklistView")?"worklistView":"objectView",o=e.getBindingContext(t);return{lat:o.getProperty("Latitude")?o.getProperty("Latitude"):"24.962762",lng:o.getProperty("Longitude")?o.getProperty("Longitude"):"55.147110"}},onNavigate:function(e){if(!this.getModel("appView").getProperty("/bHEREMapsLibLoaded"))this.loadHERELibs();var t=this,o=this.getPodLocation(e.getSource());i.load({id:t.getView().getId(),type:"HTML",name:"com.coil.podway.ManageVisitor.dialog.HEREMaps",controller:t}).then(function(e){var i=new H.service.Platform({apikey:"BbN_bDCaLx6-5GZou8CHRvPWpf9CoDtVbMK4w-OTAxM"});var n=i.createDefaultLayers();var r=new H.Map(document.getElementById("map"),n.vector.normal.map,{zoom:15,center:{lng:+t.getModel("appView").getProperty("/EventLocation/lng"),lat:+t.getModel("appView").getProperty("/EventLocation/lat")}});var a=new H.mapevents.Behavior(new H.mapevents.MapEvents(r));var s=H.ui.UI.createDefault(r,n);var l={Expo:t.getModel("appView").getProperty("/EventLocation/lat").concat(",",t.getModel("appView").getProperty("/EventLocation/lng")),Pod:o.lat.toString().concat(",",o.lng)};t.calcRoute(i,r,l);t.getView().addDependent(e);e.open()}.bind(this))},onCloseMaps:function(){this.getView().byId("MapDialog").close();this.getView().byId("MapDialog").destroy()},addRouteShapeToMap:function(e,t){var o=new H.geo.LineString;var i=e.shape;var n;i.forEach(function(e){var t=e.split(",");o.pushLatLngAlt(t[0],t[1])});n=new H.map.Polyline(o,{style:{lineWidth:4,strokeColor:"rgba(0, 128, 255, 0.7)"}});t.addObject(n);t.getViewModel().setLookAtData({bounds:n.getBoundingBox()})},calcRoute:function(e,t,o){var i=this;var n=e.getRoutingService();var r={mode:"shortest;pedestrian",representation:"display",routeattributes:"waypoints,summary,shape,legs",maneuverattributes:"direction,action",waypoint0:o.Expo,waypoint1:o.Pod};function a(e){try{var o=e.response.route[0];i.addRouteShapeToMap(o,t);i.addManueversToMap(o,t)}catch(e){sap.m.MessageToast.show("Could not found route.");console.log(e)}}n.calculateRoute(r,a.bind(i),a)},addManueversToMap:function(e,t){var o='<svg width="18" height="18" '+'xmlns="http://www.w3.org/2000/svg">'+'<circle cx="8" cy="8" r="8" '+'fill="#1b468d" stroke="white" stroke-width="1"  />'+"</svg>",i=new H.map.Icon(o,{anchor:{x:8,y:8}}),n=new H.map.Group,r,a;var s;for(r=0;r<e.leg.length;r+=1){for(a=0;a<e.leg[r].maneuver.length;a+=1){s=e.leg[r].maneuver[a];var l=new H.map.Marker({lat:s.position.latitude,lng:s.position.longitude},{icon:i});l.instruction=s.instruction;n.addObject(l)}}n.addEventListener("tap",function(e){t.setCenter(e.target.getGeometry());openBubble(e.target.getGeometry(),e.target.instruction)},false);t.addObject(n)},addDraggableMarker:function(e,t,o){var i=new H.map.Marker({lng:+o.lng,lat:+o.lat},{volatility:false});e.addObject(i)},loadHERELibs:function(){this.getModel("appView").setProperty("/bHEREMapsLibLoaded",true);jQuery.sap.require("com.coil.podway.ManageVisitor.libs.mapsjs-core");jQuery.sap.require("com.coil.podway.ManageVisitor.libs.mapsjs-service");jQuery.sap.require("com.coil.podway.ManageVisitor.libs.mapsjs-ui");jQuery.sap.require("com.coil.podway.ManageVisitor.libs.mapsjs-mapevents")},addHistoryEntry:function(){var e=[];return function(t,o){if(o){e=[]}var i=e.some(function(e){return e.intent===t.intent});if(!i){e.push(t);this.getOwnerComponent().getService("ShellUIService").then(function(t){t.setHierarchy(e)})}}}()})});