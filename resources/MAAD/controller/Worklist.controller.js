sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment"],function(e,t,i,l,o,s){"use strict";return e.extend("com.coil.podway.MAAD.controller.Worklist",{formatter:i,onInit:function(){var e,i,l=this.byId("table"),o=this.byId("table1"),s=this.byId("table2"),r=this.byId("table3");i=l.getBusyIndicatorDelay();this._aTableSearchState=[];e=new t({worklistTableTitle:this.getResourceBundle().getText("worklistTableTitle"),saveAsTileTitle:this.getResourceBundle().getText("saveAsTileTitle",this.getResourceBundle().getText("worklistViewTitle")),shareOnJamTitle:this.getResourceBundle().getText("worklistTitle"),shareSendEmailSubject:this.getResourceBundle().getText("shareSendEmailWorklistSubject"),shareSendEmailMessage:this.getResourceBundle().getText("shareSendEmailWorklistMessage",[location.href]),tableNoDataText:this.getResourceBundle().getText("tableNoDataText"),tableBusyDelay:0,bShowVolunteer:false});this.setModel(e,"worklistView");var a=this;l.attachEventOnce("updateFinished",function(){e.setProperty("/tableBusyDelay",i)});o.attachEventOnce("updateFinished1",function(){e.setProperty("/tableBusyDelay",i)});s.attachEventOnce("updateFinished2",function(){e.setProperty("/tableBusyDelay",i)});r.attachEventOnce("updateFinished3",function(){e.setProperty("/tableBusyDelay",i)});this.addHistoryEntry({title:this.getResourceBundle().getText("worklistViewTitle"),icon:"sap-icon://table-view",intent:"#ManageAdmin-display"},true)},onUpdateFinished:function(e){var t,i,l=e.getSource(),o=e.getParameter("total");if(o&&l.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("worklistAdminTabTitleCount",[o]);if(this.getModel("worklistView").getProperty("/selectId")==="1"){t=this.getResourceBundle().getText("worklistAdminTabTitleCount",[o])}if(this.getModel("worklistView").getProperty("/selectId")==="2"){t=this.getResourceBundle().getText("worklistManagerTabTitleCount",[o])}if(this.getModel("worklistView").getProperty("/selectId")==="3"){t=this.getResourceBundle().getText("worklistPodTabTitleCount",[o])}if(this.getModel("worklistView").getProperty("/selectId")==="4"){t=null}}else{if(this.getModel("worklistView").getProperty("/selectId")==="1"){i=this.getResourceBundle().getText("tableNoDataText");t=this.getResourceBundle().getText("worklistTableTitleAdmin")}if(this.getModel("worklistView").getProperty("/selectId")==="2"){i=this.getResourceBundle().getText("tableNoManagerText");t=this.getResourceBundle().getText("worklistTableTitleManager")}if(this.getModel("worklistView").getProperty("/selectId")==="3"){i=this.getResourceBundle().getText("tableNoPodText");t=this.getResourceBundle().getText("worklistTableTitlePod")}if(this.getModel("worklistView").getProperty("/selectId")==="4"){i=this.getResourceBundle().getText("tableNoVolText")}}this.getModel("worklistView").setProperty("/worklistTableTitle",t);this.getModel("worklistView").setProperty("/tableNoDataText",i)},onUpdateFinished1:function(e){var t,i=e.getSource(),l=e.getParameter("total");if(l&&i.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("allCount",[l])}else{t=this.getResourceBundle().getText("all")}this.getModel("worklistView").setProperty("/all",t)},onUpdateFinished2:function(e){var t,i=e.getSource(),l=e.getParameter("total");if(l&&i.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("availableCount",[l])}else{t=this.getResourceBundle().getText("available")}this.getModel("worklistView").setProperty("/available",t)},onUpdateFinished3:function(e){var t,i=e.getSource(),l=e.getParameter("total");if(l&&i.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("unavailableCount",[l])}else{t=this.getResourceBundle().getText("unavailable")}this.getModel("worklistView").setProperty("/unavailable",t)},onEdit:function(e){this._showObject(e.getSource())},onChange:function(e){var t=e.getSource().getSelectedKey();var i=null;this.getModel("appView").setProperty("/selectedRoleId",t);this.getModel("worklistView").setProperty("/selectId",t);if(+t!==4){this.getModel("worklistView").setProperty("/bShowVolunteer",false);this.bindAdminTeamManagerVolunteerTable(i,t)}else{this.getModel("worklistView").setProperty("/bShowVolunteer",true);this.bindVolunteerTable(i,t)}},onAfterRendering:function(){var e=this;this.getOwnerComponent().getModel().metadataLoaded().then(function(){var t=e.getModel();var i=e.getModel("worklistView");t.callFunction("/GetLoggedInUser",{method:"GET",success:function(t){i.setProperty("/loggedUserId",t.results[0].Id);i.setProperty("/loggedRoleId",t.results[0].RoleId);e.getModel("appView").setProperty("/loggedUserId",t.results[0].Id);e.getModel("appView").setProperty("/loggedRoleId",t.results[0].RoleId);if(t.results[0].RoleId===1){e.bindAdminTeamManagerVolunteerTable.call(e)}if(t.results[0].RoleId===2){this.getModel("worklistView").setProperty("/bShowVolunteer",true);e.bindVolunteerbyTeamManagerTable.call(e)}}.bind(e)})})},bindAdminTeamManagerVolunteerTable:function(e,t){var i="/UserSet";if(e){var l={Query:e}}var o=new sap.ui.model.Sorter("Id",false);if(!t){t="1"}if(t==="1"||t==="2"){this._adminTemplate=this._adminTemplate?this._adminTemplate:this.getView().byId("AdminTeam");t=parseInt(t);var s=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("IsArchived",sap.ui.model.FilterOperator.EQ,false),new sap.ui.model.Filter("RoleId",sap.ui.model.FilterOperator.EQ,t)],and:true});if(e){this.bindTable("table",i,this._adminTemplate,s,o,l)}else{this.bindTable("table",i,this._adminTemplate,s,o)}}if(t==="4"){this.bindVolunteerTable(e,t)}},bindTable:function(e,t,i,l,o,s,r){var a={path:t,template:i.clone(),parameters:{}};if(!!l){a.filters=l}if(!!s){a.parameters.custom=s}if(!!r){a.parameters.expand=r}if(!!o){a.sorter=o}this.getView().byId(e).bindItems(a)},bindVolunteerTable:function(e,t){var i="/UserSet";var l=new sap.ui.model.Sorter("Id",false);if(!t){t="4"}var o={Query:e};var s="Manager, Specialities";this._VolAllTemplate=this._VolAllTemplate?this._VolAllTemplate:this.getView().byId("VolAll");var r=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("IsArchived",sap.ui.model.FilterOperator.EQ,false),new sap.ui.model.Filter("RoleId",sap.ui.model.FilterOperator.EQ,t)],and:true});this.bindTable("table1",i,this._VolAllTemplate,r,l,o,s);this._VolAvlblTemplate=this._VolAvlblTemplate?this._VolAvlblTemplate:this.getView().byId("VolAvlbl");var a=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("IsArchived",sap.ui.model.FilterOperator.EQ,false),new sap.ui.model.Filter("RoleId",sap.ui.model.FilterOperator.EQ,t),new sap.ui.model.Filter("IsAvailable",sap.ui.model.FilterOperator.EQ,true)],and:true});this.bindTable("table2",i,this._VolAvlblTemplate,a,l,o,s);var n={Query:e};var d="VolunteerAssignment/PODVisitor, Manager, VolunteerAssignment/PODConditions, VolunteerAssignment/ServiceType/IncidentType, Specialities";this._VolUnavlTemplate=this._VolUnavlTemplate?this._VolUnavlTemplate:this.getView().byId("VolUnavl");var g=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("IsArchived",sap.ui.model.FilterOperator.EQ,false),new sap.ui.model.Filter("RoleId",sap.ui.model.FilterOperator.EQ,t),new sap.ui.model.Filter("IsAvailable",sap.ui.model.FilterOperator.EQ,false)],and:true});this.bindTable("table3",i,this._VolUnavlTemplate,g,l,n,d)},bindVolunteerbyTeamManagerTable:function(e,t){var i=this.getModel("worklistView");var l=i.getProperty("/loggedUserId");this.getModel("appView").setProperty("/selectedRoleId",4);this.getModel("worklistView").setProperty("/selectId",4);var o="/UserSet";var s=new sap.ui.model.Sorter("Id",false);var r={Query:e};var a="Manager, Specialities";if(!t){t="4"}this._VolAllTemplate=this._VolAllTemplate?this._VolAllTemplate:this.getView().byId("VolAll");var n=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("IsArchived",sap.ui.model.FilterOperator.EQ,false),new sap.ui.model.Filter("RoleId",sap.ui.model.FilterOperator.EQ,t),new sap.ui.model.Filter("ManagerId",sap.ui.model.FilterOperator.EQ,l)],and:true});this.bindTable("table1",o,this._VolAllTemplate,n,s,r,a);this._VolAvlblTemplate=this._VolAvlblTemplate?this._VolAvlblTemplate:this.getView().byId("VolAvlbl");var d=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("IsArchived",sap.ui.model.FilterOperator.EQ,false),new sap.ui.model.Filter("RoleId",sap.ui.model.FilterOperator.EQ,t),new sap.ui.model.Filter("ManagerId",sap.ui.model.FilterOperator.EQ,l),new sap.ui.model.Filter("IsAvailable",sap.ui.model.FilterOperator.EQ,true)],and:true});this.bindTable("table2",o,this._VolAvlblTemplate,d,s,r,a);var g={Query:e};var h="VolunteerAssignment/PODVisitor, Manager, VolunteerAssignment/PODConditions, VolunteerAssignment/ServiceType/IncidentType, Specialities";this._VolUnavlTemplate=this._VolUnavlTemplate?this._VolUnavlTemplate:this.getView().byId("VolUnavl");var u=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("IsArchived",sap.ui.model.FilterOperator.EQ,false),new sap.ui.model.Filter("RoleId",sap.ui.model.FilterOperator.EQ,t),new sap.ui.model.Filter("ManagerId",sap.ui.model.FilterOperator.EQ,l),new sap.ui.model.Filter("IsAvailable",sap.ui.model.FilterOperator.EQ,false)],and:true});this.bindTable("table3",o,this._VolUnavlTemplate,u,s,g,h)},onMessage:function(e){var t=this.getView();var i=e.getSource().getBindingContext().getPath();var l=this.getModel().getData(i);this.getModel("worklistView").setProperty("/userId",l.Id);this.getModel("worklistView").setProperty("/message",null);if(!this.byId("messageDialog")){s.load({id:t.getId(),name:"com.coil.podway.MAAD.view.MessageDialog",controller:this}).then(function(e){t.addDependent(e);e.bindElement({path:i,model:"worklistView"});e.open()})}else{this.byId("messageDialog").open()}},send:function(){var e=this.getModel("worklistView").getProperty("/message");if(e===null||e===""){this.showToast.call(this,"MSG_ENTER_MESSAGE")}else{var t=e.length;if(t>500){this.showToast.call(this,"MSG_EXCEEDED_LENGTH")}else{var i=this;var l=i.getModel();l.create("/UserMessageSet",{ReceiverId:this.getModel("worklistView").getProperty("/userId"),Message:this.getModel("worklistView").getProperty("/message")},{success:function(e){i.showToast.call(i,"MSG_SUCCESS_MESSAGE");i.byId("messageDialog").close();l.refresh(true)}})}}},closeMessageDialog:function(){this.byId("messageDialog").close()},onComment:function(e){var t=this.getView();var i=e.getSource().getBindingContext().getPath();var l=this.getModel().getData(i);this.getModel("worklistView").setProperty("/userId",l.Id);var o=e.getSource().getBindingContext().getObject();this.getModel("worklistView").setProperty("/comments",o.Comments);if(!this.byId("commentDialog")){s.load({id:t.getId(),name:"com.coil.podway.MAAD.view.CommentDialog",controller:this}).then(function(e){t.addDependent(e);e.bindElement({path:i,model:"worklistView"});e.open()})}else{this.byId("commentDialog").open()}},closeCommentDialog:function(){this.byId("commentDialog").close()},comment:function(){var e=this.getModel("worklistView").getProperty("/comments");if(e===null||e===""){this.showToast.call(this,"MSG_ENTER_COMMENT")}else{var t=e.length;if(t>500){this.showToast.call(this,"MSG_EXCEEDED_LENGTH")}else{var i=this;var l=i.getModel();l.callFunction("/CommentUser",{method:"GET",urlParameters:{UserId:this.getModel("worklistView").getProperty("/userId"),Comments:this.getModel("worklistView").getProperty("/comments")},success:function(e){i.showToast.call(i,"MSG_SUCCESS_COMMENT");i.byId("commentDialog").close();l.refresh(true)}})}}},onPodCategory:function(e){var t=e.getSource().getBindingContext().getPath(),i=e.getSource();if(!this._oPopover){s.load({name:"com.coil.podway.MAAD.view.PODCategoryDialog",controller:this}).then(function(e){this._oPopover=e;this.getView().addDependent(this._oPopover);this._oPopover.bindElement(t);this._oPopover.openBy(i)}.bind(this))}else{this._oPopover.openBy(i);this._oPopover.bindElement(t)}},onSpeciality:function(e){var t=e.getSource().getBindingContext().getPath(),i=e.getSource();if(!this._oPopover){s.load({name:"com.coil.podway.MAAD.view.SpecialityDialog",controller:this}).then(function(e){this._oPopover=e;this.getView().addDependent(this._oPopover);this._oPopover.bindElement(t);this._oPopover.openBy(i)}.bind(this))}else{this._oPopover.openBy(i);this._oPopover.bindElement(t)}},onPress:function(e){this._showObject(e.getSource())},onShareInJamPress:function(){var e=this.getModel("worklistView"),t=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:location.href,share:e.getProperty("/shareOnJamTitle")}}});t.open()},onAdd:function(e){this.getRouter().navTo("createObject")},onRefreshView:function(){var e=this.getModel();e.refresh(true)},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=e.getParameter("query").toLowerCase();var i=this.getModel("appView").getProperty("/selectedRoleId");if(!i){if(this.getModel("worklistView").getProperty("/loggedRoleId")===1){i="1"}else{i="4"}}if(t&&t.length>0){if(i==="1"||i==="2"){this.bindAdminTeamManagerVolunteerTable(t,i)}else{if(this.getModel("worklistView").getProperty("/loggedRoleId")===2){this.bindVolunteerbyTeamManagerTable(t,i)}else{this.bindVolunteerTable(t,i)}}}else{if(i==="1"||i==="2"){this.bindAdminTeamManagerVolunteerTable(t,i)}else{if(this.getModel("worklistView").getProperty("/loggedRoleId")===2){this.bindVolunteerbyTeamManagerTable(t,i)}else{this.bindVolunteerTable(t,i)}}}}},onRefresh:function(){var e=this.byId("table");var t=this.byId("table1");var i=this.byId("table2");var l=this.byId("table3");if(this.getModel("appView").getProperty("/selectedRoleId")==="4"){t.getBinding("items").refresh();i.getBinding("items").refresh();l.getBinding("items").refresh()}e.getBinding("items").refresh()},onDelete:function(e){var t=e.getSource().getBindingContext().getPath();function i(){var e=this.getModel().getData(t);this.getModel().update(t,{FirstName:e.FirstName,LastName:e.LastName,Email:e.Email,Username:e.Username,PhotoURL:e.PhotoURL,Address:e.Address,City:e.City,State:e.State,Zip:e.Zip,Country:e.Country,DialCode:e.DialCode,Mobile:e.Mobile,EmergencyDialCode:e.EmergencyDialCode,EmergencyMobile:e.EmergencyMobile,RoleId:e.RoleId,IsArchived:true},{success:this.showToast.bind(this,"MSG_SUCCESS_ADM_REMOVE")})}this.showWarning("MSG_CONFIRM_DELETE",i)},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBindingContext().getProperty("Id")})},_applySearch:function(e){var t=this.byId("table"),i=this.byId("table1"),l=this.byId("table2"),o=this.byId("table3"),s=this.getModel("worklistView");t.getBinding("items").filter(e,"Application");if(this.getModel("appView").getProperty("/selectedRoleId")==="4"){i.getBinding("items").filter(e);l.getBinding("items").filter(e);o.getBinding("items").filter(e)}if(e.length!==0){s.setProperty("/tableNoDataText",this.getResourceBundle().getText("worklistNoDataWithSearchText"))}}})});