/**
 * The code below uses open source software. Please visit the URL below for an overview of the licenses:
 * http://js.api.here.com/v3/3.1.21.3/HERE_NOTICE
 */
(function(){var n,aa=[];function ba(t){return function(){return aa[t].apply(this,arguments)}}function ca(t,e){return aa[t]=e}var da="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,i){t!=Array.prototype&&t!=Object.prototype&&(t[e]=i.value)},fa="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ha(t,e){if(e){var i=fa;t=t.split(".");for(var r=0;r<t.length-1;r++){var n=t[r];n in i||(i[n]={});i=i[n]}t=t[t.length-1];r=i[t];e=e(r);e!=r&&null!=e&&da(i,t,{configurable:!0,writable:!0,value:e})}}function ia(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}function ja(){ja=function(){};fa.Symbol||(fa.Symbol=ka)}function la(t,e){this.a=t;da(this,"description",{configurable:!0,writable:!0,value:e})}la.prototype.toString=function(){return this.a};var ka=function(){function t(i){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new la("jscomp_symbol_"+(i||"")+"_"+e++,i)}var e=0;return t}();function ma(){ja();var t=fa.Symbol.iterator;t||(t=fa.Symbol.iterator=fa.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[t]&&da(Array.prototype,t,{configurable:!0,writable:!0,value:function(){return na(ia(this))}});ma=function(){}}function na(t){ma();t={next:t};t[fa.Symbol.iterator]=function(){return this};return t}function oa(t,e){ma();t instanceof String&&(t+="");var i=0,r={next:function(){if(i<t.length){var n=i++;return{value:e(n,t[n]),done:!1}}r.next=function(){return{done:!0,value:void 0}};return r.next()}};r[Symbol.iterator]=function(){return r};return r}ha("Array.prototype.keys",function(t){return t?t:function(){return oa(this,function(t){return t})}});var pa;if("function"==typeof Object.setPrototypeOf)pa=Object.setPrototypeOf;else{var qa;t:{var ra={Lg:!0},sa={};try{sa.__proto__=ra;qa=sa.Lg;break t}catch(t){}qa=!1}pa=qa?function(t,e){t.__proto__=e;if(t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var ta=pa;ha("Object.setPrototypeOf",function(t){return t||ta});function va(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:ia(t)}}ha("Promise",function(t){function e(t){this.A=0;this.b=void 0;this.a=[];var e=this.c();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function i(){this.a=null}function r(t){return t instanceof e?t:new e(function(e){e(t)})}if(t)return t;i.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var n=fa.setTimeout;i.prototype.c=function(t){n(t,0)};i.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var i=t[e];t[e]=null;try{i()}catch(t){this.f(t)}}}this.a=null};i.prototype.f=function(t){this.c(function(){throw t})};e.prototype.c=function(){function t(t){return function(r){i||(i=!0,t.call(e,r))}}var e=this,i=!1;return{resolve:t(this.o),reject:t(this.f)}};e.prototype.o=function(t){if(t===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.aa(t);else{t:switch(typeof t){case"object":var i=null!=t;break t;case"function":i=!0;break t;default:i=!1}i?this.m(t):this.g(t)}};e.prototype.m=function(t){var e=void 0;try{e=t.then}catch(t){this.f(t);return}"function"==typeof e?this.s(e,t):this.g(t)};e.prototype.f=function(t){this.i(2,t)};e.prototype.g=function(t){this.i(1,t)};e.prototype.i=function(t,e){if(0!=this.A)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.A);this.A=t;this.b=e;this.j()};e.prototype.j=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)o.b(this.a[t]);this.a=null}};var o=new i;e.prototype.aa=function(t){var e=this.c();t.Df(e.resolve,e.reject)};e.prototype.s=function(t,e){var i=this.c();try{t.call(e,i.resolve,i.reject)}catch(t){i.reject(t)}};e.prototype.then=function(t,i){function r(t,e){return"function"==typeof t?function(e){try{n(t(e))}catch(t){o(t)}}:e}var n,o,a=new e(function(t,e){n=t;o=e});this.Df(r(t,n),r(i,o));return a};e.prototype.catch=function(t){return this.then(void 0,t)};e.prototype.Df=function(t,e){function i(){switch(r.A){case 1:t(r.b);break;case 2:e(r.b);break;default:throw Error("Unexpected state: "+r.A)}}var r=this;null==this.a?o.b(i):this.a.push(i)};e.resolve=r;e.reject=function(t){return new e(function(e,i){i(t)})};e.race=function(t){return new e(function(e,i){for(var n=va(t),o=n.next();!o.done;o=n.next())r(o.value).Df(e,i)})};e.all=function(t){var i=va(t),n=i.next();return n.done?r([]):new e(function(t,e){function o(e){return function(i){a[e]=i;s--;0==s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,r(n.value).Df(o(a.length-1),e),n=i.next()}while(!n.done)})};return e});ha("Array.prototype.fill",function(t){return t?t:function(t,e,i){var r=this.length||0;0>e&&(e=Math.max(0,r+e));if(null==i||i>r)i=r;i=Number(i);0>i&&(i=Math.max(0,r+i));for(e=Number(e||0);e<i;e++)this[e]=t;return this}});ha("Math.log2",function(t){return t?t:function(t){return Math.log(t)/Math.LN2}});var wa="function"==typeof Object.assign?Object.assign:function(t,e){for(var i=1;i<arguments.length;i++){var r=arguments[i];if(r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t};ha("Object.assign",function(t){return t||wa});var xa=this||self;function ya(t,e,i){t=t.split(".");i=i||xa;t[0]in i||"undefined"==typeof i.execScript||i.execScript("var "+t[0]);for(var r;t.length&&(r=t.shift());)t.length||void 0===e?i[r]&&i[r]!==Object.prototype[r]?i=i[r]:i=i[r]={}:i[r]=e}function za(){}function Aa(t){var e=typeof t;if("object"==e)if(t){if(t instanceof Array)return"array";if(t instanceof Object)return e;var i=Object.prototype.toString.call(t);if("[object Window]"==i)return"object";if("[object Array]"==i||"number"==typeof t.length&&"undefined"!=typeof t.splice&&"undefined"!=typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==i||"undefined"!=typeof t.call&&"undefined"!=typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==e&&"undefined"==typeof t.call)return"object";return e}function Ba(t){var e=Aa(t);return"array"==e||"object"==e&&"number"==typeof t.length}function Ca(t){return"function"==Aa(t)}function Da(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Ea="closure_uid_"+(1e9*Math.random()>>>0),Fa=0;function Ga(t,e,i){return t.call.apply(t.bind,arguments)}function Ha(t,e,i){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(i,r);return t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function Ia(t,e,i){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ia=Ga:Ia=Ha;return Ia.apply(null,arguments)}function Ja(t,e){var i=Array.prototype.slice.call(arguments,1);return function(){var e=i.slice();e.push.apply(e,arguments);return t.apply(this,e)}}function t(t,e){ya(t,e,void 0)}function u(t,e){function i(){}i.prototype=e.prototype;t.l=e.prototype;t.prototype=new i;t.prototype.constructor=t;t.$o=function(t,i,r){for(var n=Array(arguments.length-2),o=2;o<arguments.length;o++)n[o-2]=arguments[o];return e.prototype[i].apply(t,n)}}function Ka(t){if(Error.captureStackTrace)Error.captureStackTrace(this,Ka);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}u(Ka,Error);Ka.prototype.name="CustomError";function La(t,e){this.c=t;this.f=e;this.b=0;this.a=null}La.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next;t.next=null}else t=this.c();return t};La.prototype.put=function(t){this.f(t);100>this.b&&(this.b++,t.next=this.a,this.a=t)};function Ma(){this.b=this.a=null}var Oa=new La(function(){return new Na},function(t){t.reset()});Ma.prototype.add=function(t,e){var i=Oa.get();i.set(t,e);this.b?this.b.next=i:this.a=i;this.b=i};Ma.prototype.remove=function(){var t=null;this.a&&(t=this.a,this.a=this.a.next,this.a||(this.b=null),t.next=null);return t};function Na(){this.next=this.b=this.a=null}Na.prototype.set=function(t,e){this.a=t;this.b=e;this.next=null};Na.prototype.reset=function(){this.next=this.b=this.a=null};var Pa=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Qa(t,e){return-1!=t.indexOf(e)}function Ra(t,e){return t<e?-1:t>e?1:0}function Sa(t,e){for(var i in t)if(e.call(void 0,t[i],i,t))return!0;return!1}function Ta(t){for(var e in t)return!1;return!0}function Ua(t){var e={},i;for(i in t)e[i]=t[i];return e}var Va="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Wa(t,e){for(var i,r,n=1;n<arguments.length;n++){r=arguments[n];for(i in r)t[i]=r[i];for(var o=0;o<Va.length;o++)i=Va[o],Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}}var Xa;t:{var Ya=xa.navigator;if(Ya){var Za=Ya.userAgent;if(Za){Xa=Za;break t}}Xa=""}function $a(t){return Qa(Xa,t)}var ab=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"===typeof t)return"string"!==typeof e||1!=e.length?-1:t.indexOf(e,0);for(var i=0;i<t.length;i++)if(i in t&&t[i]===e)return i;return-1};function bb(t,e){this.b=t===cb&&e||"";this.a=db}var db={},cb={},eb=new bb(cb,"");function fb(t,e){this.b=t===gb&&e||"";this.a=hb}fb.prototype.xc=function(){return 1};var hb={},gb={};function ib(){this.b="";this.c=jb;this.a=null}ib.prototype.xc=function(){return this.a};function kb(){var t=lb;if(t instanceof ib&&t.constructor===ib&&t.c===jb)return t.b;Aa(t);return"type_error:SafeHtml"}var jb={};function mb(t){var e=new ib;e.b=t;e.a=0;return e}mb("<!DOCTYPE html>");var lb=mb("");mb("<br>");function nb(t){var e=new fb(gb,eb instanceof bb&&eb.constructor===bb&&eb.a===db?eb.b:"type_error:Const");e instanceof fb&&e.constructor===fb&&e.a===hb?e=e.b:(Aa(e),e="type_error:TrustedResourceUrl");t.src=e.toString()}function ob(t){ob[" "](t);return t}ob[" "]=za;function pb(t,e){var i=qb;return Object.prototype.hasOwnProperty.call(i,t)?i[t]:i[t]=e(t)}var rb=$a("Opera"),tb=$a("Trident")||$a("MSIE"),ub=$a("Edge"),vb=$a("Gecko")&&!(Qa(Xa.toLowerCase(),"webkit")&&!$a("Edge"))&&!($a("Trident")||$a("MSIE"))&&!$a("Edge"),wb=Qa(Xa.toLowerCase(),"webkit")&&!$a("Edge");function xb(){var t=xa.document;return t?t.documentMode:void 0}var yb;t:{var zb="",Ab=function(){var t=Xa;if(vb)return/rv:([^\);]+)(\)|;)/.exec(t);if(ub)return/Edge\/([\d\.]+)/.exec(t);if(tb)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(wb)return/WebKit\/(\S+)/.exec(t);if(rb)return/(?:Version)[ \/]?(\S+)/.exec(t)}();Ab&&(zb=Ab?Ab[1]:"");if(tb){var Bb=xb();if(null!=Bb&&Bb>parseFloat(zb)){yb=String(Bb);break t}}yb=zb}var qb={};function Cb(t){return pb(t,function(){for(var e=0,i=Pa(String(yb)).split("."),r=Pa(String(t)).split("."),n=Math.max(i.length,r.length),o=0;0==e&&o<n;o++){var a=i[o]||"",s=r[o]||"";do{a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""];s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""];if(0==a[0].length&&0==s[0].length)break;e=0==a[1].length?0:parseInt(a[1],10);var l=0==s[1].length?0:parseInt(s[1],10);e=Ra(e,l)||Ra(0==a[2].length,0==s[2].length)||Ra(a[2],s[2]);a=a[3];s=s[3]}while(0==e)}return 0<=e})}var Db;Db=xa.document&&tb?xb():void 0;!vb&&!tb||tb&&9<=Number(Db)||vb&&Cb("1.9.1");tb&&Cb("9");function Eb(t){var e=document;t=String(t);"application/xhtml+xml"===e.contentType&&(t=t.toLowerCase());return e.createElement(t)}function Fb(t){xa.setTimeout(function(){throw t},0)}var Gb;function Hb(){var t=xa.MessageChannel;"undefined"===typeof t&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!$a("Presto")&&(t=function(){var t=Eb("IFRAME");t.style.display="none";nb(t);document.documentElement.appendChild(t);var e=t.contentWindow;t=e.document;t.open();t.write(kb());t.close();var i="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=Ia(function(t){if(("*"==r||t.origin==r)&&t.data==i)this.port1.onmessage()},this);e.addEventListener("message",t,!1);this.port1={};this.port2={postMessage:function(){e.postMessage(i,r)}}});if("undefined"!==typeof t&&!$a("Trident")&&!$a("MSIE")){var e=new t,i={},r=i;e.port1.onmessage=function(){if(void 0!==i.next){i=i.next;var t=i.oj;i.oj=null;t()}};return function(t){r.next={oj:t};r=r.next;e.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in Eb("SCRIPT")?function(t){var e=Eb("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null;e.parentNode.removeChild(e);e=null;t();t=null};document.documentElement.appendChild(e)}:function(t){xa.setTimeout(t,0)}}function Ib(t,e){Jb||Kb();Lb||(Jb(),Lb=!0);Mb.add(t,e)}var Jb;function Kb(){if(xa.Promise&&xa.Promise.resolve){var t=xa.Promise.resolve(void 0);Jb=function(){t.then(Nb)}}else Jb=function(){var t=Nb;!Ca(xa.setImmediate)||xa.Window&&xa.Window.prototype&&!$a("Edge")&&xa.Window.prototype.setImmediate==xa.setImmediate?(Gb||(Gb=Hb()),Gb(t)):xa.setImmediate(t)}}var Lb=!1,Mb=new Ma;function Nb(){for(var t;t=Mb.remove();){try{t.a.call(t.b)}catch(t){Fb(t)}Oa.put(t)}Lb=!1}function Ob(t){this.A=Qb;this.i=void 0;this.c=this.a=this.b=null;this.f=this.g=!1;if(t!=za)try{var e=this;t.call(void 0,function(t){Rb(e,Sb,t)},function(t){Rb(e,Tb,t)})}catch(t){Rb(this,Tb,t)}}var Qb=0,Sb=2,Tb=3;function Ub(){this.next=this.c=this.b=this.f=this.a=null;this.g=!1}Ub.prototype.reset=function(){this.c=this.b=this.f=this.a=null;this.g=!1};var Vb=new La(function(){return new Ub},function(t){t.reset()});function Wb(t,e,i){var r=Vb.get();r.f=t;r.b=e;r.c=i;return r}function Xb(t){if(t instanceof Ob)return t;var e=new Ob(za);Rb(e,Sb,t);return e}function Yb(t){return new Ob(function(e,i){i(t)})}function Zb(){var t,e,i=new Ob(function(i,r){t=i;e=r});return new $b(i,t,e)}Ob.prototype.then=function(t,e,i){return bc(this,Ca(t)?t:null,Ca(e)?e:null,i)};Ob.prototype.$goog_Thenable=!0;Ob.prototype.cancel=function(t){if(this.A==Qb){var e=new cc(t);Ib(function(){dc(this,e)},this)}};function dc(t,e){if(t.A==Qb)if(t.b){var i=t.b;if(i.a){for(var r=0,n=null,o=null,a=i.a;a&&(a.g||(r++,a.a==t&&(n=a),!(n&&1<r)));a=a.next)n||(o=a);n&&(i.A==Qb&&1==r?dc(i,e):(o?(r=o,r.next==i.c&&(i.c=r),r.next=r.next.next):ec(i),fc(i,n,Tb,e)))}t.b=null}else Rb(t,Tb,e)}function gc(t,e){t.a||t.A!=Sb&&t.A!=Tb||hc(t);t.c?t.c.next=e:t.a=e;t.c=e}function bc(t,e,i,r){var n=Wb(null,null,null);n.a=new Ob(function(t,o){n.f=e?function(i){try{var n=e.call(r,i);t(n)}catch(t){o(t)}}:t;n.b=i?function(e){try{var n=i.call(r,e);void 0===n&&e instanceof cc?o(e):t(n)}catch(t){o(t)}}:o});n.a.b=t;gc(t,n);return n.a}Ob.prototype.m=function(t){this.A=Qb;Rb(this,Sb,t)};Ob.prototype.o=function(t){this.A=Qb;Rb(this,Tb,t)};function Rb(t,e,i){if(t.A==Qb){t===i&&(e=Tb,i=new TypeError("Promise cannot resolve to itself"));t.A=1;t:{var r=i,n=t.m,o=t.o;if(r instanceof Ob){gc(r,Wb(n||za,o||null,t));var a=!0}else{if(r)try{var s=!!r.$goog_Thenable}catch(t){s=!1}else s=!1;if(s)r.then(n,o,t),a=!0;else{if(Da(r))try{var l=r.then;if(Ca(l)){ic(r,l,n,o,t);a=!0;break t}}catch(e){o.call(t,e);a=!0;break t}a=!1}}}a||(t.i=i,t.A=e,t.b=null,hc(t),e!=Tb||i instanceof cc||jc(t,i))}}function ic(t,e,i,r,n){function o(t){s||(s=!0,r.call(n,t))}function a(t){s||(s=!0,i.call(n,t))}var s=!1;try{e.call(t,a,o)}catch(t){o(t)}}function hc(t){t.g||(t.g=!0,Ib(t.j,t))}function ec(t){var e=null;t.a&&(e=t.a,t.a=e.next,e.next=null);t.a||(t.c=null);return e}Ob.prototype.j=function(){for(var t;t=ec(this);)fc(this,t,this.A,this.i);this.g=!1};function fc(t,e,i,r){if(i==Tb&&e.b&&!e.g)for(;t&&t.f;t=t.b)t.f=!1;if(e.a)e.a.b=null,kc(e,i,r);else try{e.g?e.f.call(e.c):kc(e,i,r)}catch(t){lc.call(null,t)}Vb.put(e)}function kc(t,e,i){e==Sb?t.f.call(t.c,i):t.b&&t.b.call(t.c,i)}function jc(t,e){t.f=!0;Ib(function(){t.f&&lc.call(null,e)})}var lc=Fb;function cc(t){Ka.call(this,t)}u(cc,Ka);cc.prototype.name="cancel";function $b(t,e,i){this.ri=t;this.resolve=e;this.reject=i}var x=this;function mc(){return Object.create(y,void 0)}var A=Ia,nc=String,oc=x.Object.freeze||function(t){return t};function pc(t){for(var e=Object.keys(t),i=e.length,r;i--;)r=t[e[i]],Da(r)&&pc(r);return oc(t)}function qc(t){var e=Aa(t);if("object"==e||"array"==e){if(Ca(t.clone))return t.clone();e="array"==e?[]:{};for(var i in t)t.hasOwnProperty(i)&&(e[i]=qc(t[i]));return e}return t}var B=self.eval("undefined"),y=self.eval("null");function rc(t,e){return nc(t).split(e!==B?e:" ")}var sc="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(t,e,i,r,n){if(!(e=t instanceof e)&&i)throw new D(i,r,tc(n)?n:t);return e}function uc(t,e){if(!0===(C(t,e)&&t.constructor===e))throw new TypeError("Illegal constructor "+vc(e))}function wc(t,e,i,r,n){if(!(e=xc(t)===e)&&i)throw new D(i,r,tc(n)?n:t);return e}function yc(t,e,i,r){return wc(t,"Array",e,i,r)}t("H.lang.isArray",yc);function tc(t){return t!==B}function zc(t){return"string"===typeof t}t("H.lang.isString",zc);var Ac=parseInt,Bc=parseFloat,E=isNaN;function Cc(t){return t===+t}t("H.lang.isNumber",Cc);t("H.lang.isInteger",Number.isInteger?Number.isInteger:function(t){return"number"===typeof t&&0===t%1});function Dc(t){return!E(+t)}function xc(t){var e=Object[sc[0]][sc[6]].call(t).match(/^\[object (\w+)\]$/);return e?e[1]:typeof t}var Ec=[];function Fc(t){0>Ec.indexOf(t)&&Ec.push(t)}Fc(Ec);function vc(t,e,i,r){var n="",o=2>arguments.length,a;o&&(e={H:x.H},i="",r=Ec.slice());Gc(e,!0,function(e,o){try{if(a=e[o],o=Hc(e,a),!(Da(a)&&a.window===a&&a.self===a||Da(a)&&0<a.nodeType&&Ca(a.cloneNode))&&Da(a)){if(a===t)return n=i+"."+o,!0;if(0>r.indexOf(a)&&(r.push(a),n=vc(t,a,i+"."+o,r)))return!0}}catch(t){}});o&&(n=n?n.substr(1).replace("."+sc[0]+".","#"):"~"+(Ca(t)?Ic(t)+"()":xc(t)));return n}function Hc(t,e){var i=[];Gc(t,!1,function(t,r){t[r]===e&&i.push(r)});return i.sort(Jc)[0]}function Jc(t,e){return e.length-t.length}var Kc=Object[sc[0]][sc[2]];function Gc(t,e,i){var r;if(t){for(n in t)if((!e||Kc.call(t,n))&&i(t,n,!0))return;for(r=sc.length;r--;){var n=sc[r];if((!e||Kc.call(t,n))&&i(t,n,!1))break}}}function Ic(t){return(t=/^\s*function ([^\( ]+)/.exec(t))?t[1]:"anonymous"}function Lc(t,e,i){i[e]="#"+e}var Mc=!!x.__karma__;function Nc(){throw Error("unimplemented method")}function Oc(t,e){e=e||{};"status"in e&&(this.status=+e.status);"statusText"in e&&(this.statusText=e.statusText);this.ok=200<=this.status&&300>this.status;this.bodyUsed=!1;t?"string"===typeof t?this.c=t:ArrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||t.buffer)?this.a=t.buffer||t:Blob.prototype.isPrototypeOf(t)&&(this.b=t):this.c=""}t("H.net.Response",Oc);Oc.prototype.type="default";Oc.prototype.type=Oc.prototype.type;Oc.prototype.status=200;Oc.prototype.status=Oc.prototype.status;Oc.prototype.statusText="OK";Oc.prototype.statusText=Oc.prototype.statusText;function Pc(t){if(t.bodyUsed)return Yb(new TypeError("Already read"));t.bodyUsed=!0}Oc.error=function(){Oc.a||(Oc.a=new Oc(null,{status:0,statusText:""}),Oc.a.type="error");return Oc.a};Oc.error=Oc.error;Oc.prototype.text=function(){var t=Pc(this);if(!t)if(this.c)t=Xb(this.c);else if(this.a){t=new Uint8Array(this.a);var e=t.length,i=Array(e),r;for(r=0;r<e;r++)i[r]=String.fromCharCode(t[r]);t=Xb(i.join(""))}else this.b?t=Qc(this.b):t=Yb("Unsupported response body");return t};Oc.prototype.json=function(){return this.text().then(x.JSON.parse)};Oc.prototype.blob=function(){var t,e=Pc(this);e||(this.b?t=this.b:this.a&&(t=new Blob([this.a],{type:"application/octet-stream"})));return e||Xb(t)};Oc.prototype.arrayBuffer=function(){return this.a?Pc(this)||Xb(this.a.slice(0)):this.blob().then(Oc.b)};Oc.b=function(t){var e=new FileReader;e.readAsArrayBuffer(t);return new Ob(function(t,i){e.onload=function(){t(e.result)};e.onerror=function(){i(e.error)}})};function Qc(t){var e=new FileReader;e.readAsText(t);return new Ob(function(t,i){e.onload=function(){t(e.result)};e.onerror=function(){i(e.error)}})}!Mc&&x.Response&&x.Response.error&&(Oc=x.Response,Fc(Oc.prototype));function Rc(t,e,i){function r(){var t=A(u.a,u),e=+l.timeout||0;Tc?(Uc(u,"timeout",t),n.timeout=e):e&&(u.c=setTimeout(function(){n.abort();u.a({type:"timeout"})},e));Uc(u,"error",t);Uc(u,"load",t);n.send(l.data)}var n,o,a,s=i&&i.headers||{},l={},u=this;if(!Ca(e))throw new D(Rc,1,"function required");Wa(s,Vc.headers,s);Wa(l,Vc,i||{});l.headers=s;this.b=e;this.va=n=new XMLHttpRequest;e=l.method;try{n.open(e,t,!0);for(o in s)s.hasOwnProperty(o)&&(a=s[o])&&n.setRequestHeader(o,a);n.withCredentials=!!l.withCredentials;r()}catch(t){this.a({type:"cors"})}}t("H.net.Xhr",Rc);var Vc={method:"GET",headers:{},data:null},Wc="withCredentials"in new XMLHttpRequest,Tc="timeout"in new XMLHttpRequest;function Uc(t,e,i){Wc?t.va.addEventListener(e,i):t.va["on"+e]=i}function Xc(t,e,i){Wc?t.va.removeEventListener(e,i):t.va["on"+e]=null}Rc.prototype.abort=function(){this.va&&(this.va.abort(),this.va&&this.a({type:"abort"}))};Rc.prototype.abort=Rc.prototype.abort;Rc.prototype.a=function(t){var e=t.type;t=this.va;var i,r;this.c&&clearTimeout(this.c);"load"===e?t instanceof XMLHttpRequest&&200!==t.status&&(i="network"):i=4===t.readyState&&0===t.status&&"error"==e?"cors":"error"!=e?e:"network";e=this.a;Xc(this,"timeout",e);Xc(this,"error",e);Xc(this,"load",e);0===t.status||i&&"network"!==i?r=Oc.error():r=new Oc(t.responseText,t);i=this.b;delete this.a;delete this.b;delete this.va;i(r)};function Yc(t,e){var i=[];t&&i.push(vc(t));1<arguments.length&&i.push(""+e);i=Error(i.join(" "));Object.setPrototypeOf(i,Yc.prototype);return i}u(Yc,Error);t("H.lang.IllegalOperationError",Yc);Yc.prototype.name="IllegalOperationError";var Zc,$c,bd;function D(t,e,i){var r=arguments.length;e=e!==B?+e:e;if(e!==B){var n=(n=/^.*?\(([^\)]+)/.exec((""+t).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")))?rc(n[1].replace(/\s+/g,""),","):[];n.forEach(Lc);n=n[e]||"#"+e}var o=t?vc(t):"";r=2<r?nc(i):"";if(n||r)o+=" (Argument "+(n||"")+(r?" "+r:"")+")";r=Error(o);Object.setPrototypeOf(r,D.prototype);return r}u(D,Error);t("H.lang.InvalidArgumentError",D);D.prototype.name="InvalidArgumentError";function cd(){if(!zc("STATIC_DB"))throw new D(this.constructor,0);this.g=x.indexedDB||x.So||x.ho||x.io;if(!this.g)throw new Yc(this.constructor,"This browser does not support IndexedDB");this.a=[];this.c=[];this.li=A(this.li,this)}var dd,ed;n=cd.prototype;n.put=function(t,e,i,r){if(!zc(t)&&!Cc(t))throw new D(this.put,0);if(!fd(e))throw new D(this.put,1);gd(this,function(n){hd(n.put(e,t),i,r)},r)};n.get=function(t,e,i){var r;if(!zc(t)&&!Cc(t))throw new D(this.get,0);if(!Ca(e))throw new D(this.get,1);gd(this,function(n){r=n.get(t);hd(r,e,i)},i);return{cancel:function(){r&&(r.onsuccess=id)}}};n.remove=function(t,e,i){if(!zc(t)&&!Cc(t))throw new D(this.remove,0);gd(this,function(r){hd(r["delete"](t),e,i)},i)};n.clear=function(t,e){gd(this,function(i){hd(i.clear(),t,e)},e)};n.li=function(){var t=this.b.result;t.objectStoreNames.contains("data")||t.createObjectStore("data")};function jd(t,e,i){if(t.b)t.a?(t.a.push(e),i&&t.c.push(i)):t.f?i&&i(t.f):e(t.b.result);else{t.b=t.g.open(kd+"STATIC_DB",1);t.b.onupgradeneeded=t.li;var r=t.b.onerror=function(){clearTimeout(t.i);t.f=this.error;t.c.forEach(function(e){e(t.f)});t.a=t.c=null};t.i=setTimeout(function(){r.call({error:Error("DbOpenTimeoutError")})},500);t.b.onsuccess=function(){clearTimeout(t.i);t.a?(t.a.forEach(function(t){t(this.result)},this),t.a=t.c=null):(t.b=t.f=null,t.a=[],t.c=[])};t.a.push(e);i&&t.c.push(i)}}function gd(t,e,i){jd(t,function(t){t=t.transaction(["data"],"readwrite");e(t.objectStore("data"))},i)}function hd(t,e,i){e&&(t.onsuccess=function(){e(this.result)});i&&(t.onerror=function(){i(this.error)})}function fd(t){var e=Object.prototype.toString.call(t);return"[object Blob]"===e||"[object ArrayBuffer]"===e||zc(t)||Da(t)}function ld(){dd||(dd=new cd);return dd}t("H.util.IndexedDBStorage.getInstance",ld);var kd="H_";function md(){if(!tc(ed))if("file:"===window.location.protocol&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&128<=window.location.href.length)ed=!1;else{var t=x.indexedDB||x.So||x.ho||x.io;var e=kd+"TEST_DB";try{var i=t&&t.open(e,1)}catch(t){}ed=!!i&&null===i.onupgradeneeded;i&&t.deleteDatabase&&t.deleteDatabase(e)}return ed}t("H.util.IndexedDBStorage.isSupported",md);function nd(){0!=od&&(pd[this[Ea]||(this[Ea]=++Fa)]=this);this.Fd=this.Fd;this.rb=this.rb}var od=0,pd={};nd.prototype.Fd=!1;nd.prototype.C=function(){if(!this.Fd&&(this.Fd=!0,this.u(),0!=od)){var t=this[Ea]||(this[Ea]=++Fa);if(0!=od&&this.rb&&0<this.rb.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete pd[t]}};nd.prototype.wb=function(t,e){this.Fd?void 0!==e?t.call(e):t():(this.rb||(this.rb=[]),this.rb.push(void 0!==e?Ia(t,e):t))};nd.prototype.u=function(){if(this.rb)for(;this.rb.length;)this.rb.shift()()};function qd(t){t&&"function"==typeof t.C&&t.C()}function rd(t,e){this.type=t;this.currentTarget=this.target=e;this.f=this.a=!1;this.Sk=!0}rd.prototype.stopPropagation=function(){this.a=!0};rd.prototype.preventDefault=function(){this.f=!0;this.Sk=!1};t("H.util.Event",rd);rd.prototype.stopPropagation=rd.prototype.stopPropagation;rd.prototype.stopPropagation=rd.prototype.stopPropagation;rd.prototype.CAPTURING_PHASE=1;rd.prototype.CAPTURING_PHASE=rd.prototype.CAPTURING_PHASE;rd.prototype.AT_TARGET=2;rd.prototype.AT_TARGET=rd.prototype.AT_TARGET;rd.prototype.BUBBLING_PHASE=3;rd.prototype.BUBBLING_PHASE=rd.prototype.BUBBLING_PHASE;rd.prototype.eventPhase=0;rd.prototype.eventPhase=rd.prototype.eventPhase;function sd(t,e,i){sd.l.constructor.call(this,t,i);this.data=e}u(sd,rd);t("H.util.DataEvent",sd);function td(t,e,i){td.l.constructor.call(this,t,i);this.message=e}u(td,rd);t("H.util.ErrorEvent",td);var ud=Math,vd=ud.min,wd=ud.max,xd=ud.round,yd=ud.floor,zd=ud.ceil,Ad=ud.abs,Bd=ud.log,Cd=ud.sqrt,Dd=ud.pow,Ed=ud.exp,Fd=ud.sin,Gd=ud.asin,Hd=ud.cos,Id=ud.tan,Jd=ud.atan,Kd=ud.atan2,Ld=ud.LN2,Md=ud.PI,Nd=Md/2,Od=Md/4,Pd=2*Md,Qd=3*Md,Rd=Md/180,Sd=180/Md,Td=1/0,Ud=Dd(-2,53),Vd=Vd||function(t){return Bd(t)/Ld};function Wd(t,e){var i;return 0>(i=t%e)===0>e?i:i+e}function Xd(t,e,i){e-=i=i||0;t-=i;return t-yd(t/e)*e+i}t("H.math.normalize",Xd);function Yd(t,e,i){return t>i?i:t<e?e:t}t("H.math.clamp",Yd);function Zd(t,e,i,r){r||(r=0);return e<i?t>=e-r&&t<=i+r:t>=i-r&&t<=e+r}function $d(t,e,i,r,n,o){return Cd(Dd((t-n)*(r-o)-(e-o)*(i-n),2)/(Dd(i-n,2)+Dd(r-o,2)))}var ae={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};t("H.math.CoverType",ae);function be(t,e,i,r,n,o){var a=i.length,s=a,l=i[0],u=0,c=0,h=0;r=r/2||0;var f=o||2;o=f*(n?0:1)+1;for(var p=f-2;1!=u&&s>o;){s-=p;var d=i[--s];f=i[--s];var y=i[s?s-p-1:(a+(s-p-1))%a];var g=i[s?s-p-2:(a+(s-p-2))%a];if(f>=t-r&&f<=t+r&&d>=e-r&&d<=e+r||g>=t-r&&g<=t+r&&y>=e-r&&y<=e+r)u=1;else if(!u&&f===t)g===t&&(d<e&&y>e||d>e&&y<e)||(l<=t&&g>t||l>=t&&g<t)&&(d>=e?++c:++h),u=Zd(e,d,y,r)&&$d(t,e,f,d,g,y)<=r?2:0;else if(!u&&Zd(t,f,g,r)){if(f<t&&g>t||f>t&&g<t)l=d+(t-f)/(g-f)*(y-d),c+=l>e,h+=l<e;u=Zd(e,d,y,r)&&$d(t,e,f,d,g,y)<=r?2:0}l=f}!u&&n&&0!==h&&0!==c%2&&(u=3);return u}function ce(t,e){return be(t.x,t.y,e,0,!0)!==ae.NONE}t("H.math.isPointInsidePolygon",ce);function de(t){for(var e=t.length,i=new Float64Array(2*e),r=e&&tc(t[0].x);e--;){var n=t[e],o=e<<1;i[o]=r?n.x:n[0];i[o+1]=r?n.y:n[1]}return i}t("H.math.flatten",de);function ee(t,e,i){this.type=t;this.data=e;this.c=Zb();this.resolve=A(this.resolve,this);this.reject=A(this.reject,this);this.priority=fe;i!==B&&(this.priority=i);this.th().add(this)}var fe=1,ge={Wo:0,Zo:fe,Vo:2};n=ee.prototype;n.then=function(t,e,i){return this.c.ri.then(t,e,i)};n.resolve=function(t){this.fe=3;this.c.resolve(t)};n.reject=function(t){this.fe=5;this.c.reject(t)};n.fe=0;n.cancel=function(){this.c.ri.cancel();3>this.fe&&(this.we(),this.th().remove(this),this.fe=4)};function he(t){var e;this.a={};for(e in ge)this.a[ge[e]]=[];this.vg=t;this.vg.addEventListener("allocatable",A(this.b,this))}t("H.util.JobManager",he);var ie=Object.keys(ge).map(function(t){return ge[t]}).sort().reverse();he.prototype.add=function(t){C(t,ee,this.add,0);this.a[t.priority].push(t);this.b()};he.prototype.contains=function(t){return-1<this.a[t.priority].indexOf(t)};he.prototype.remove=function(t){var e=t.priority;t=this.a[e].indexOf(t);return-1<t?(this.a[e].splice(t,1),!0):!1};he.prototype.b=function(){ie.forEach(function(t){this.a[t]=this.a[t].filter(function(t){var e;if((e=this.vg.Qg(t))!==y){var i=A(this.vg.eh,this.vg,e,t);t.then(i,i);t.fe=t.Dj(e)?1:5}else return!0},this)},this)};function je(t,e,i){var r=[],n=arguments.length;t&&r.push(vc(t));1<n&&(n=2<n&&yc(i)?" out of ["+i[0]+"..."+i[1]+"]":"",r.push("("+e+n+")"));r=Error(r.join(" "));Object.setPrototypeOf(r,je.prototype);return r}u(je,Error);t("H.lang.OutOfRangeError",je);je.prototype.name="OutOfRangeError";var ke="closure_listenable_"+(1e6*Math.random()|0);function le(t){return!(!t||!t[ke])}var me=0;function ne(t,e,i,r,n){this.listener=t;this.proxy=null;this.src=e;this.type=i;this.capture=!!r;this.Zf=n;this.key=++me;this.he=this.Cf=!1}function oe(t){t.he=!0;t.listener=null;t.proxy=null;t.src=null;t.Zf=null}function pe(t){this.src=t;this.a={};this.b=0}pe.prototype.add=function(t,e,i,r,n){var o=t.toString();t=this.a[o];t||(t=this.a[o]=[],this.b++);var a=qe(t,e,r,n);-1<a?(e=t[a],i||(e.Cf=!1)):(e=new ne(e,this.src,o,!!r,n),e.Cf=i,t.push(e));return e};pe.prototype.remove=function(t,e,i,r){t=t.toString();if(!(t in this.a))return!1;var n=this.a[t];e=qe(n,e,i,r);return-1<e?(oe(n[e]),Array.prototype.splice.call(n,e,1),0==n.length&&(delete this.a[t],this.b--),!0):!1};function re(t,e){var i=e.type;if(!(i in t.a))return!1;var r=t.a[i],n=ab(r,e),o;(o=0<=n)&&Array.prototype.splice.call(r,n,1);o&&(oe(e),0==t.a[i].length&&(delete t.a[i],t.b--));return o}pe.prototype.ra=function(t){t=t&&t.toString();var e=0,i;for(i in this.a)if(!t||i==t){for(var r=this.a[i],n=0;n<r.length;n++)++e,oe(r[n]);delete this.a[i];this.b--}return e};function se(t,e){var i=void 0!==e,r=i?e.toString():"";return Sa(t.a,function(t){for(var e=0;e<t.length;++e)if(!i||t[e].type==r)return!0;return!1})}function qe(t,e,i,r){for(var n=0;n<t.length;++n){var o=t[n];if(!o.he&&o.listener==e&&o.capture==!!i&&o.Zf==r)return n}return-1}var te=!tb||9<=Number(Db),ue=tb&&!Cb("9");!wb||Cb("528");vb&&Cb("1.9b")||tb&&Cb("8")||rb&&Cb("9.5")||wb&&Cb("528");vb&&!Cb("8")||tb&&Cb("9");var ve=function(){if(!xa.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{xa.addEventListener("test",za,e),xa.removeEventListener("test",za,e)}catch(t){}return t}();function we(t,e){rd.call(this,t?t.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.pointerId=0;this.pointerType="";this.b=null;if(t){var i=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;this.target=t.target||t.srcElement;this.currentTarget=e;if(e=t.relatedTarget){if(vb){t:{try{ob(e.nodeName);var n=!0;break t}catch(t){}n=!1}n||(e=null)}}else"mouseover"==i?e=t.fromElement:"mouseout"==i&&(e=t.toElement);this.relatedTarget=e;r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0);this.button=t.button;this.key=t.key||"";this.ctrlKey=t.ctrlKey;this.altKey=t.altKey;this.shiftKey=t.shiftKey;this.metaKey=t.metaKey;this.pointerId=t.pointerId||0;this.pointerType="string"===typeof t.pointerType?t.pointerType:xe[t.pointerType]||"";this.b=t;t.defaultPrevented&&this.preventDefault()}}u(we,rd);var xe={2:"touch",3:"pen",4:"mouse"};we.prototype.stopPropagation=function(){we.l.stopPropagation.call(this);this.b.stopPropagation?this.b.stopPropagation():this.b.cancelBubble=!0};we.prototype.preventDefault=function(){we.l.preventDefault.call(this);var t=this.b;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ue)try{if(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)t.keyCode=-1}catch(t){}};var ye="closure_lm_"+(1e6*Math.random()|0),ze={},Ae=0;function Be(t,e,i,r,n){if(r&&r.once)return Ce(t,e,i,r,n);if("array"==Aa(e)){for(var o=0;o<e.length;o++)Be(t,e[o],i,r,n);return null}i=De(i);return le(t)?t.aa.add(String(e),i,!1,Da(r)?!!r.capture:!!r,n):Ee(t,e,i,!1,r,n)}function Ee(t,e,i,r,n,o){if(!e)throw Error("Invalid event type");var a=Da(n)?!!n.capture:!!n,s=Fe(t);s||(t[ye]=s=new pe(t));i=s.add(e,i,r,a,o);if(i.proxy)return i;r=Ge();i.proxy=r;r.src=t;r.listener=i;if(t.addEventListener)ve||(n=a),void 0===n&&(n=!1),t.addEventListener(e.toString(),r,n);else if(t.attachEvent)t.attachEvent(He(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");Ae++;return i}function Ge(){var t=Je,e=te?function(i){return t.call(e.src,e.listener,i)}:function(i){i=t.call(e.src,e.listener,i);if(!i)return i};return e}function Ce(t,e,i,r,n){if("array"==Aa(e)){for(var o=0;o<e.length;o++)Ce(t,e[o],i,r,n);return null}i=De(i);return le(t)?t.aa.add(String(e),i,!0,Da(r)?!!r.capture:!!r,n):Ee(t,e,i,!0,r,n)}function Ke(t,e,i,r,n){if("array"==Aa(e)){for(var o=0;o<e.length;o++)Ke(t,e[o],i,r,n);return null}r=Da(r)?!!r.capture:!!r;i=De(i);if(le(t))return t.aa.remove(String(e),i,r,n);if(!t)return!1;if(t=Fe(t))if(e=t.a[e.toString()],t=-1,e&&(t=qe(e,i,r,n)),i=-1<t?e[t]:null)return Le(i);return!1}function Le(t){if("number"===typeof t||!t||t.he)return!1;var e=t.src;if(le(e))return re(e.aa,t);var i=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(i,r,t.capture):e.detachEvent?e.detachEvent(He(i),r):e.addListener&&e.removeListener&&e.removeListener(r);Ae--;(i=Fe(e))?(re(i,t),0==i.b&&(i.src=null,e[ye]=null)):oe(t);return!0}function He(t){return t in ze?ze[t]:ze[t]="on"+t}function Me(t,e,i,r){var n=!0;if(t=Fe(t))if(e=t.a[e.toString()])for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==i&&!o.he&&(o=Ne(o,r),n=n&&!1!==o)}return n}function Ne(t,e){var i=t.listener,r=t.Zf||t.src;t.Cf&&Le(t);return i.call(r,e)}function Je(t,e){if(t.he)return!0;if(!te){if(!e)t:{e=["window","event"];for(var i=xa,r=0;r<e.length;r++)if(i=i[e[r]],null==i){e=null;break t}e=i}r=e;e=new we(r,this);i=!0;if(!(0>r.keyCode||void 0!=r.returnValue)){t:{var n=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){n=!0}if(n||void 0==r.returnValue)r.returnValue=!0}r=[];for(n=e.currentTarget;n;n=n.parentNode)r.push(n);t=t.type;for(n=r.length-1;!e.a&&0<=n;n--){e.currentTarget=r[n];var o=Me(r[n],t,!0,e);i=i&&o}for(n=0;!e.a&&n<r.length;n++)e.currentTarget=r[n],o=Me(r[n],t,!1,e),i=i&&o}return i}return Ne(t,new we(e,this))}function Fe(t){t=t[ye];return t instanceof pe?t:null}var Oe="__closure_events_fn_"+(1e9*Math.random()>>>0);function De(t){if(Ca(t))return t;t[Oe]||(t[Oe]=function(e){return t.handleEvent(e)});return t[Oe]}function F(){nd.call(this);this.aa=new pe(this);this.Cn=this;this.ah=null}u(F,nd);F.prototype[ke]=!0;n=F.prototype;n.ic=function(){return this.ah};n.ja=function(t){this.ah=t};n.addEventListener=function(t,e,i,r){Be(this,t,e,i,r)};n.removeEventListener=function(t,e,i,r){Ke(this,t,e,i,r)};n.dispatchEvent=function(t){var e,i=this.ic();if(i)for(e=[];i;i=i.ic())e.push(i);i=this.Cn;var r=t.type||t;if("string"===typeof t)t=new rd(t,i);else if(t instanceof rd)t.target=t.target||i;else{var n=t;t=new rd(r,i);Wa(t,n)}n=!0;if(e)for(var o=e.length-1;!t.a&&0<=o;o--){var a=t.currentTarget=e[o];n=a.md(r,!0,t)&&n}t.a||(a=t.currentTarget=i,n=a.md(r,!0,t)&&n,t.a||(n=a.md(r,!1,t)&&n));if(e)for(o=0;!t.a&&o<e.length;o++)a=t.currentTarget=e[o],n=a.md(r,!1,t)&&n;return n};n.u=function(){F.l.u.call(this);this.aa&&this.aa.ra(void 0);this.ah=null};n.md=function(t,e,i){t=this.aa.a[String(t)];if(!t)return!0;t=t.concat();for(var r=!0,n=0;n<t.length;++n){var o=t[n];if(o&&!o.he&&o.capture==e){var a=o.listener,s=o.Zf||o.src;o.Cf&&re(this.aa,o);r=!1!==a.call(s,i)&&r}}return r&&0!=i.Sk};t("H.util.EventTarget",F);F.prototype.ja=F.prototype.ja;F.prototype.setParentEventTarget=F.prototype.ja;F.prototype.ic=F.prototype.ic;F.prototype.getParentEventTarget=F.prototype.ic;F.prototype.addEventListener=F.prototype.addEventListener;F.prototype.addEventListener=F.prototype.addEventListener;F.prototype.removeEventListener=F.prototype.removeEventListener;F.prototype.removeEventListener=F.prototype.removeEventListener;F.prototype.dispatchEvent=F.prototype.dispatchEvent;F.prototype.dispatchEvent=F.prototype.dispatchEvent;F.prototype.C=F.prototype.C;F.prototype.dispose=F.prototype.C;F.prototype.wb=F.prototype.wb;F.prototype.addOnDisposeCallback=F.prototype.wb;F.prototype.Ln=F.prototype.md;F.prototype.md=function(t,e,i){var r,n,o=!0;var a=i[i.currentTarget===i.target?"AT_TARGET":e?"CAPTURING_PHASE":(r=!0,"BUBBLING_PHASE")];if(!r||"pointerenter"!==(n=i.type)&&"pointerleave"!==n)i.eventPhase=a,o=F.prototype.Ln.apply(this,arguments),r&&this.ic&&null===this.ic()&&delete i.eventPhase;return o};function Pe(t){t=t||{};var e=t.callback;this.a=t.label;Ca(e)&&(this.callback=e);this.b=!!t.disabled;Pe.l.constructor.call(this)}u(Pe,F);t("H.util.ContextItem",Pe);Pe.prototype.Ne=function(){return this.a};Pe.prototype.getLabel=Pe.prototype.Ne;Pe.prototype.Pc=function(t){this.a!==t&&(this.a=t,this.dispatchEvent("update"));return this};Pe.prototype.setLabel=Pe.prototype.Pc;Pe.prototype.lc=function(){return this.b};Pe.prototype.isDisabled=Pe.prototype.lc;Pe.prototype.Ca=function(t){t^this.b&&(this.b=t,this.dispatchEvent("update"));return this};Pe.prototype.setDisabled=Pe.prototype.Ca;var Qe=new Pe;Pe.SEPARATOR=Qe;function Re(){if(x.document){var t=document.createElement("canvas");t.width=t.height=1;return t.getContext("2d")}return null}function Se(){return window.devicePixelRatio||1}t("H.util.getPixelRatio",Se);var Te=/^rgba\(([^,]+),([^,]+),([^,]+),([^)]+)\)$/;function Ue(t){var e=Ve[t],i=x.RegExp;e||(x.Uint8ClampedArray||(x.Uint8ClampedArray=function(t){return t instanceof Number?Array(t):t.map(function(t){return Yd(xd(t),0,255)})}),"none"===t?e=new Uint8ClampedArray([0,0,0,0]):(We.fillStyle="black",We.fillStyle=t,Te.test(We.fillStyle)?e=new Uint8ClampedArray([i.$1,i.$2,i.$3,255*i.$4]):(We.clearRect(0,0,1,1),We.fillRect(0,0,1,1),e=We.getImageData(0,0,1,1).data)),Ve[t]=e);return e}function Xe(t){return"none"!==t&&0<Ue(t)[3]}var Ve=mc(),Ye=!!x.VBArray;t("H.util.eval",function(a){return eval(a)});function Ze(t,e){return t!==B?t:e}function $e(t){return/^<svg/.test(t)?"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(t):t}t("H.util.provide",function(t){var e=xa.$jscomp;if(e&&("function"!=typeof e.om?0:e.om()))throw Error("goog.provide cannot be used within a module.");ya(t,void 0)});function af(t){this.nc=0<t?ud.round(t):0}af.prototype.next=function(t){if(9007199254740992===this.nc)throw new je(t,this.nc,[0,9007199254740991]);return this.nc++};var bf=new af,cf=A(bf.next,bf);function df(){return!0}function ef(){return!1}function id(){}var ff=oc([]),gf=oc({});function hf(t){return"CANVAS"===t.tagName?[t]:t.getElementsByTagName("CANVAS")}function jf(t,e,i){var r;e=t.ownerDocument===e?t.cloneNode(!0):e.importNode(t,!0);if(i)for(t=hf(t),i=hf(e),r=i.length;r--;)i[r].getContext("2d").drawImage(t[r],0,0);return e}var We=Re(),kf=Re();function lf(t){var e=t.complete,i=0<t.naturalWidth;if(e&&!i&&Ye)try{kf.drawImage(t,0,0),i=!0}catch(t){}return e&&i}var mf=x.BlobBuilder||x.WebKitBlobBuilder||x.MozBlobBuilder;function nf(t,e){e=e||"";if(mf){var i=new mf;i.append(t);t=i.getBlob(e)}else t=new Blob([t],{type:e});return t}var of=x.navigator;$c=/Edge\/\d+/.test(of.appVersion);bd=/(A|a)ndroid/.test(of.appVersion);function pf(){var t=pf.a;t||(t=this,pf.a=t,Fc(pf.a),F.call(t),qf(this));return t}u(pf,F);pf.prototype.u=function(){pf.l.u.call(this);qf(this)};function qf(t){t.g=10;t.i=6;t.a=mc();t.b=mc();t.c=0}pf.prototype.Qg=function(t){t=t.type;var e=this.a[t]||0;if(this.c<this.g&&e<this.i){var i=++this.f;this.c++;this.a[t]=e+1;this.b[i+""]=t;return i}return y};pf.prototype.eh=function(t){var e=this.b[t];if(!tc(e)||!this.a[e])throw new Yc(this.eh,"Unknown requestId");this.c--;this.a[e]--;this.a[e]||delete this.a[e];delete this.b[t];this.dispatchEvent("allocatable")};pf.prototype.f=-1;function rf(t,e,i,r){if(!this.b[t])throw new D(rf,0,"Mime type is not supported");this.g=t;t=r?Ua(r):{};"crossOrigin"in t||(t.crossOrigin="anonymous");this.a=t;sf.href=e.toString();ee.call(this,sf.protocol+"//"+sf.hostname,e,i)}u(rf,ee);rf.prototype.Dj=function(){this.f=this.b[this.g].call(this);return!0};rf.prototype.we=function(){this.f&&(this.f.abort(),this.f=null)};rf.prototype.b={"application/json":function(){var t=this,e=tf(this.a),i=e.headers;e.headers=i=i?Ua(i):{};i.Accept="application/json";return new Rc(this.data,function(e){200<=e.status&&300>e.status?t.resolve(e.json()):t.reject(e)},e)},"text/plain":function(){var t=this;return new Rc(this.data,function(e){200<=e.status&&300>e.status?t.resolve(e.text()):t.reject(e)},tf(this.a))},image:function(){var t=x.document.createElement("img"),e=this,i=this.data;t.onload=A(this.resolve,this,t);t.onerror=function(){e.reject(Oc.error())};t.crossOrigin=this.a.crossOrigin;t.src=i;return{abort:function(){t.onerror=t.onload=null;Ye&&lf(t)||t.removeAttribute("src")}}}};(function(){try{var t=new XMLHttpRequest;t.open("get","/",!0)}catch(e){t={}}"response"in t&&(rf.prototype.b.arraybuffer=function(){var t=new XMLHttpRequest,e=this,i=this.a,r=i.headers,n;t.open("GET",this.data);uf(t,i);t.responseType="arraybuffer";if(r)for(n in r)t.setRequestHeader(n,r[n]);t.onerror=t.ontimeout=function(){e.reject(Oc.error())};t.onload=function(){e.resolve(new Oc(t.response))};t.send();return t})})();var vf=new he(new pf);rf.prototype.th=function(){return vf};var sf=x.document.createElement("a");function tf(t){var e=Ua(t);delete e.crossOrigin;uf(e,t);return e}function uf(t,e){t.withCredentials="use-credentials"===e.crossOrigin}function I(t,e){this.x=+t;this.y=+e}t("H.math.Point",I);I.prototype.set=I;I.prototype.set=I.prototype.set;I.prototype.clone=function(t){t?(t.x=this.x,t.y=this.y):t=new I(this.x,this.y);return t};I.prototype.clone=I.prototype.clone;I.prototype.add=function(t){this.x+=t.x;this.y+=t.y;return this};I.prototype.add=I.prototype.add;I.prototype.sub=function(t){this.x-=t.x;this.y-=t.y;return this};I.prototype.sub=I.prototype.sub;I.prototype.scale=function(t,e){this.x*=t;this.y*=void 0===e?t:e;return this};I.prototype.scale=I.prototype.scale;I.prototype.round=function(){this.x=xd(this.x);this.y=xd(this.y);return this};I.prototype.round=I.prototype.round;I.prototype.floor=function(){this.x=yd(this.x);this.y=yd(this.y);return this};I.prototype.floor=I.prototype.floor;I.prototype.ceil=function(){this.x=zd(this.x);this.y=zd(this.y);return this};I.prototype.ceil=I.prototype.ceil;I.prototype.na=function(t){return!(!t||this.x!==t.x||this.y!==t.y)};I.prototype.equals=I.prototype.na;I.prototype.Lj=function(t,e){var i=e.x-t.x,r=e.y-t.y,n=t;if(i||r){var o=((this.x-t.x)*i+(this.y-t.y)*r)/(i*i+r*r);0>=o?n=t:1<=o?n=e:n=new I(t.x+o*i,t.y+o*r)}return n};I.prototype.getNearest=I.prototype.Lj;I.prototype.Ya=function(t){return Cd(Dd(this.x-t.x,2)+Dd(this.y-t.y,2))};I.prototype.distance=I.prototype.Ya;function wf(t){if(!t)throw Error("invalid argument");return t instanceof I?t:new I(t.x,t.y)}I.fromIPoint=wf;function xf(t){var e=yf[t];if(!e)if(t in zf)e=yf[t]=t;else{e=Af.length;var i="",r=t.charAt(0).toUpperCase()+t.substr(1),n="",o=!1;Bf&&(n=Bf+r,o=n in zf);for(;e--&&!o;)i=Af[e],n=i+r,o=n in zf;o&&(Bf=i);if(e=o?n:null)yf[t]=e;else throw Error("Could not find any variant of CSS property ["+t+"]")}return e}t("H.dom.cssPrefixer.prefix",xf);var Af=["O","Ms","ms","Moz","Webkit"],yf={},Bf="",zf=document.createElement("span").style;function Cf(t,e,i,r){if(!t||!e||!i)throw new D(Cf,null,"Must specify name, version and revision parameter");this.name=t;this.version=e;this.revision=i;r&&Wa(this,r)}t("H.util.BuildInfo",Cf);Cf.prototype.toString=function(){var t,e=[];for(t in this)zc(this[t])&&e.push(this[t]);return e.join(";")};var Df={};function Ef(t,e,i,r){if(!t)throw new D(Ef,1,"Must specify a name parameter");return Df[t]||(Df[t]=new Cf(t,e,i,r))}Cf.get=Ef;function Ff(){Ff.l.constructor.call(this);this.a=Gf(this);this.f=mc();this.c=A(this.c,this);this.a.addEventListener("message",this.c);this.b={}}u(Ff,F);Ff.prototype.u=function(){this.a.terminate()};Ff.prototype.i=function(t){var e=t.type,i=!!this.f[e],r=t.data,n=Hf++,o=r&&r.Po?r.Po:B,a=!0;i?(this.b[n]=t,If(this,e,n,r&&r.message,o)):(t.reject(new D(this.i,0,"processor_not_found")),a=!1);return a};Ff.prototype.c=function(t){t=t.data;var e=this.b[t.taskId],i=t.taskId,r=t.data,n=this;if(2===t.type)new rf("arraybuffer",r).then(function(t){return t.arrayBuffer()}).then(function(t){n.a.postMessage(["3",i,[t]],[t])},function(){n.a.postMessage(["3",i,[null,"ERROR"]])});else{if(e){switch(t.type){case 1:e.resolve(r);break;case 0:e.reject(r)}delete this.b[i]}this.dispatchEvent(new rd(this.g.IDLE))}};var Hf=0;function Jf(t,e,i){var r=Hf++,n;t.b[r]=n=Zb();If(t,e,r,i);return n.ri}function If(t,e,i,r,n){r===B||Ba(r)||(r=[r]);try{t.a.postMessage([e,i,r],n)}catch(e){t=t.b[i],t.reject(e.message)}}Ff.prototype.g={IDLE:"idle",aj:"error"};Ff.prototype.j=function(t,e){var i=this.m||(this.m=new rd(this.g.aj));i.data=e;delete this.f[t];this.dispatchEvent(i)};function Gf(a){var b=x.H.__bootstrap__;b=Ca(b)?(""+b).replace(/^[^{]+{((.|[\r\n])+?)}\s*$/,"$1"):""+b;if(x.Worker&&x.URL)try{var c=new x.Worker(x.URL.createObjectURL(nf(b,"application/javascript")))}catch(t){}c||(a=new Kf(a),function(){eval("var self = arguments[0];"+b)}(a),c=new Lf(a));return c}function Lf(t){F.call(this);this.a=t}u(Lf,F);Lf.prototype.postMessage=function(t){x.setTimeout(A(this.b,this,t),0)};Lf.prototype.b=function(t){var e=new rd("message");e.data=t;this.a.dispatchEvent(e)};Lf.prototype.terminate=function(){this.a.C();this.C()};function Kf(a){F.call(this);this.a=a;this.addEventListener=A(this.addEventListener,this);this.removeEventListener=A(this.removeEventListener,this);this.postMessage=A(this.postMessage,this);this.eval=A(eval,this)}u(Kf,F);Kf.prototype.postMessage=function(t){var e=new rd("message");e.data=t;x.setTimeout(A(this.a.c,this.a,e),0)};function Mf(){var t=Of;t||(t=Of=this,F.call(t),Pf(this));return t}var Of;u(Mf,F);Mf.prototype.u=function(){Mf.l.u.call(this);Pf(this)};function Pf(t){var e=t.b,i;if(e)for(i=e.length;i--;)e[i].C();t.b=[];Fc(t.b);t.c=mc();t.f=mc()}Mf.prototype.Qg=function(t){var e;t=t.type;if(e=this.f[t]){var i=this.b;var r=i[0];r||(r=i[0]=new Ff,this.wb(Ja(qd,r)),Ta(this.c)||(i=x.Object.keys(this.c),Jf(r,"0",i)));i=r;i.f[t]||(i.f[t]=e,Jf(i,"1",[t,Ca(e)?e+"":e]).then(id,A(i.j,i,t)))}else throw new Yc(this.Qg,'Unknown type "'+t+'"');return r};Mf.prototype.eh=function(){};Mf.prototype.a=function(t,e){var i=this.f,r=i[t];if(r){if(e!==r)throw new Yc(this.a,'Type "'+t+'" is already registered')}else i[t]=e};function Qf(t,e,i){ee.call(this,t,e,i)}var Rf;u(Qf,ee);Qf.prototype.th=function(){Rf||(Rf=new he(new Mf));return Rf};Qf.prototype.we=function(){};Qf.prototype.Dj=function(t){return t.i(this)};function Sf(t,e,i){var r=Yd(+t,-90,90);if(e&&E(r))throw new D(e,i,t);return r}function Tf(t,e,i){var r=+t;if(-180>r||180<r)r=Wd(r+180,360)-180;if(e&&E(r))throw new D(e,i,t);return r}function Uf(t,e,i){var r;if(t!==B&&E(r=+t)&&e)throw new D(e,i,t);return r}function Vf(t,e){return 0!==(0>t^0>e)&&180<Ad(e-t)}t("H.geo.isDBC",Vf);function Wf(){uc(this,Wf)}t("H.geo.AbstractGeometry",Wf);Wf.prototype.getBoundingBox=Wf.prototype.F;Wf.prototype.equals=Wf.prototype.na;Wf.prototype.qb="";Wf.prototype.Mb="";Wf.prototype.toString=function(){return this.Sc([this.qb.toUpperCase()," "]).join("")};Wf.prototype.toString=Wf.prototype.toString;Wf.prototype.Rc=function(){return{type:this.Mb,coordinates:this.hd()}};Wf.prototype.toGeoJSON=Wf.prototype.Rc;Wf.prototype.W=function(){return{type:this.qb,coordinates:this.wc(),boundingBox:this.F().W()}};Wf.prototype.forWorkerMessage=Wf.prototype.W;function Xf(t,e,i){this.lat=Sf(t,Xf,0);this.lng=Tf(e,Xf,1);i!==B&&(this.alt=Uf(i,Xf,2))}u(Xf,Wf);t("H.geo.Point",Xf);Xf.prototype.na=function(t){return this===t||!!t&&this.lat===t.lat&&this.lng===t.lng&&(this.alt||0)===(t.alt||0)};Xf.prototype.equals=Xf.prototype.na;Xf.prototype.Ya=function(t){if(this===t||this.lat===t.lat&&this.lng===t.lng)t=0;else{var e=this.lat*Rd;var i=t.lat*Rd;t=12742001.58*Gd(vd(1,Cd(Dd(Fd((e-i)/2),2)+Hd(e)*Hd(i)*Dd(Fd((this.lng*Rd-t.lng*Rd)/2),2))))}return t};Xf.prototype.distance=Xf.prototype.Ya;Xf.prototype.Eg=function(t,e,i){if(i){if(e/=6371000.79){t*=Rd;var r=Rd*this.lat;var n=Fd(r);var o=Fd(e);var a=Hd(e);var s=Rd*this.lng;var l=Hd(r);r=Gd(l*Hd(t)*o+n*a);t=Kd(Fd(t)*l*o,a-n*Fd(r));t=(s+t+Md)%(2*Md)-Md;l=t*Sd}return e?new Xf(r*Sd,(l+540)%360-180):this}t=(t%360+360)%360;if(0===(t+90)%180)return r=this.lng+e/(6371000.79*Pd*Hd(this.lat*Rd))*(270===t?-360:360),new Xf(this.lat,(r+540)%360-180);if(e/=6371000.79){t*=Rd;s=this.lat*Rd;n=this.lng*Rd;o=s+e*Hd(t);a=o-s;r=Bd(Id(o/2+Od)/Id(s/2+Od));r=E(a/r)?Hd(s):a/r;var u=e*Fd(t)/r;Ad(o)>Nd&&(o=0<o?Md-o:-(Md+o))}return e?new Xf(o*Sd,((n+u+Qd+(Ad(s+a)>Nd?Md:0))%Pd-Md)*Sd):this};Xf.prototype.walk=Xf.prototype.Eg;Xf.prototype.F=function(){return new K(this.lat,this.lng,this.lat,this.lng)};Xf.prototype.getBoundingBox=Xf.prototype.F;function Yf(t,e,i){var r=Da(t)&&!(E(t.lat=Sf(t.lat))||E(t.lng=Tf(t.lng))||t.alt!==B&&E(t.alt=Uf(t.alt)));if(!r&&e)throw new D(e,i,t);return r}Xf.validate=Yf;function Zf(t){if(!t)throw new D(Zf,0,t);return new Xf(t.lat,t.lng,t.alt)}Xf.fromIPoint=Zf;n=Xf.prototype;n.qb="Point";n.Sc=function(t){t.push("(",this.lng," ",this.lat,")");return t};n.Mb="Point";n.hd=function(){return[this.lng,this.lat,this.alt||0]};n.wc=function(){return[this.lat,this.lng,this.alt||0]};function K(t,e,i,r){$f(this,Sf(t,K,0),Tf(e,K,1),Sf(i,K,2),Tf(r,K,3))}u(K,Wf);t("H.geo.Rect",K);K.prototype.qb="Polygon";K.prototype.Sc=function(t){var e=this.ka,i=this.ca,r=this.ma,n=this.ga;t.push("(","(",i," ",e,",",n," ",e,",",n," ",r,",",i," ",r,",",i," ",e,")",")");return t};K.prototype.na=function(t){return this===t||!!t&&this.ka===t.ka&&this.ca===t.ca&&this.ma===t.ma&&this.ga===t.ga};K.prototype.equals=K.prototype.na;K.prototype.clone=function(){return new K(this.ka,this.ca,this.ma,this.ga)};K.prototype.clone=K.prototype.clone;function $f(t,e,i,r,n){t.ca=i;t.ga=n;e<r&&(i=e,e=r,r=i);t.ka=e;t.ma=r;t.c=t.a=t.b=null;return t}K.prototype.Rb=function(){this.c||(this.c=new Xf(this.ka,this.ca));return this.c};K.prototype.getTopLeft=K.prototype.Rb;K.prototype.Ob=function(){this.a||(this.a=new Xf(this.ma,this.ga));return this.a};K.prototype.getBottomRight=K.prototype.Ob;K.prototype.pn=function(){return this.ka};K.prototype.getTop=K.prototype.pn;K.prototype.im=function(){return this.ma};K.prototype.getBottom=K.prototype.im;K.prototype.Lm=function(){return this.ca};K.prototype.getLeft=K.prototype.Lm;K.prototype.gn=function(){return this.ga};K.prototype.getRight=K.prototype.gn;K.prototype.lb=function(){this.b||(this.b=new Xf(this.ma+(this.ka-this.ma)/2,ag(this.ca,this.Eb())));return this.b};K.prototype.getCenter=K.prototype.lb;K.prototype.Eb=function(){return bg(this.ca,this.ga)};K.prototype.getWidth=K.prototype.Eb;K.prototype.Td=function(){return this.ka-this.ma};K.prototype.getHeight=K.prototype.Td;K.prototype.Fb=function(){return this.ca>this.ga};K.prototype.isCDB=K.prototype.Fb;K.prototype.bg=function(){return!this.Eb()&&!this.Td()};K.prototype.isEmpty=K.prototype.bg;K.prototype.F=function(){return new K(this.ka,this.ca,this.ma,this.ga)};K.prototype.getBoundingBox=K.prototype.F;K.prototype.Hf=function(t,e,i){var r=this.lb();i||(t=Sf(t,this.Hf,0),e=Tf(e,this.Hf,1));e=this.dd(t,e,i);t=e.lb();return t.lat===r.lat&&t.lng===r.lng&&this.Td()===e.Td()&&this.Eb()===e.Eb()};K.prototype.containsLatLng=K.prototype.Hf;K.prototype.Ld=function(t,e){e||Yf(t,this.Ld,0);return this.Hf(t.lat,t.lng,e)};K.prototype.containsPoint=K.prototype.Ld;K.prototype.Yg=function(t,e){var i=this.lb();if(!e&&!C(t,K))throw new D(this.Yg,0,t);e=this.mc(t,e);t=e.lb();return t.lat===i.lat&&t.lng===i.lng&&this.Td()===e.Td()&&this.Eb()===e.Eb()};K.prototype.containsRect=K.prototype.Yg;K.prototype.dd=function(t,e,i,r){if(!i){if(E(t=Sf(t)))throw new D(this.dd,0,t);if(E(e=Tf(e)))throw new D(this.dd,1,e)}return cg(this.ka,this.ca,this.ma,this.ga,t,e,t,e,r)};K.prototype.mergeLatLng=K.prototype.dd;K.prototype.vk=function(t,e,i){e||Yf(t,this.vk,0);return this.dd(t.lat,t.lng,e,i)};K.prototype.mergePoint=K.prototype.vk;K.prototype.mc=function(t,e,i){if(!e&&!C(t,K))throw new D(this.mc,0,t);return cg(this.ka,this.ca,this.ma,this.ga,t.ka,t.ca,t.ma,t.ga,i)};K.prototype.mergeRect=K.prototype.mc;K.prototype.Hc=function(t,e,i,r,n,o){n||(t=Sf(t,this.Hc,0),e=Tf(e,this.Hc,1),i=Sf(i,this.Hc,2),r=Tf(r,this.Hc,3));return cg(this.ka,this.ca,this.ma,this.ga,t,e,i,r,o)};K.prototype.mergeTopLeftBottomRight=K.prototype.Hc;K.prototype.td=function(t,e){var i=this.ca<=this.ga,r=t.ca<=t.ga,n=this.ca<t.ga,o=t.ca<this.ga;if(!e&&!C(t,K))throw new D(this.td,0,t);return this.ma<=t.ka&&t.ma<=this.ka&&(!i&&(!r||n||o)||!r&&(n||o)||n&&o)};K.prototype.intersects=K.prototype.td;function bg(t,e){t=e-t;return t+(0>t?360:0)}function ag(t,e){t+=e/2;return t-(180<t?360:0)}function cg(t,e,i,r,n,o,a,s,l){i=vd(i,a);t=wd(t,n);n=bg(e,r);var u=ag(e,n);a=bg(o,s);var c=ag(o,a)-u;c+=0>c-1e-6?360:0;if(180>c-1e-6){u=e;var h=s}else c=360-c,u=o,h=r;c=c+n/2+a/2;360<=c+5e-7?(u=-180,h=180):c-5e-7<n?(u=e,h=r):c-5e-7<a&&(u=o,h=s);return l?$f(l,t,u,i,h):new K(t,u,i,h)}K.merge=cg;function dg(t,e,i){i||(Yf(t,dg,0),Yf(e,dg,1));return new K(t.lat,t.lng,e.lat,e.lng)}K.fromPoints=dg;function eg(t,e){var i=1,r=t.length,n=null;if(!Ba(t))throw new D(eg,0,t);if(0<r){var o=t[0];for(n=dg(o,o,e);i<r;i++)o=t[i],n.dd(o.lat,o.lng,e,n)}return n}K.coverPoints=eg;function fg(t,e){var i=3,r=t.length,n;if(!(e||t&&null!=t.length))throw new D(fg,0,t);if(0<r)for(n=new K(t[0],t[1],t[0],t[1]);i<r;i+=3)n.dd(t[i],t[i+1],e,n);return n}K.coverLatLngAlts=fg;function gg(t,e){var i=1,r=t.length,n;if(e&&(!t||null==t.length))throw new D(gg,0,t);if(0<r)for(n=new K(t[0].ka,t[0].ca,t[0].ma,t[0].ga);i<r;i++)n.mc(t[i],e,n);return n}K.coverRects=gg;K.prototype.Rk=function(t,e){var i=this.ca,r=this.ka,n=this.ga,o=this.ma,a=this.lb().lng;Yf(t,this.Rk,0);var s=t.lat-o-(r-o)/2;var l=t.lng-a;l=180<l||-180>l?-(a+t.lng):l;t=i+(0>l?2*l:0);t=-180>t?360+t:t;n+=0<l?2*l:0;n=180<n?n-360:n;r=0<s?r+2*s:r;90<=r&&(r=90);o=0>s?o+2*s:o;-90>=o&&(o=-90);return e?$f(e,r,t,o,n):new K(r,t,o,n)};K.prototype.resizeToCenter=K.prototype.Rk;K.prototype.Mb="Polygon";K.prototype.hd=function(){return[[this.ca,this.ka,0],[this.ga,this.ka,0],[this.ga,this.ma,0],[this.ca,this.ma,0],[this.ca,this.ka,0]]};K.prototype.W=function(){return this.wc()};K.prototype.wc=function(){return[this.ka,this.ca,this.ma,this.ga]};function hg(t,e,i,r,n,o){uc(this,hg);this.c=t||10;this.b=this.a=null;this.f=r||0;this.g=n||0;this.i=e||1;this.j=i||1;this.o=!!o;this.flush()}function ig(t){var e=t.b;if(t.o&&!e){var i=t.head;if(i.entries||i[0]||i[1]||i[2]||i[3])e=[i],e=jg([e,e,e,e],[i[6],i[7],i[4],i[5]]),t.b=e}return e}function jg(t,e){var i,r,n,o,a=0;for(i=3;0<=i;i--){var s=i+4;var l=0<i%3;var u=[];var c=e[i];var h=t[i];for(r=h.length;r--;){var f=h[r];if(n=f.entries)for(o=n.length;o--;){var p=n[o].pd(i);if(l?p>c:p<c)c=p}for(o=4;o--;)(n=f[o])&&(l?n[s]>c:n[s]<c)&&u.push(n)}a+=u.length;e[i]=c;t[i]=u}a&&(e=jg(t,e));return e}function kg(t,e,i){var r,n;if(t.o&&(r=t.b))for(n=3;0<=n;n--){var o=e.pd(n);if(n%3?o>=r[n]:o<=r[n])if(i)r[n]=o;else{t.b=null;break}}}hg.prototype.remove=function(t){var e,i,r,n=!1;t&&(e=t.node)&&e.b===this&&(i=e.entries)&&0<=(r=i.indexOf(t))&&(i.splice(r,1),this.m(e),kg(this,t,!1),n=!0);return n};hg.prototype.flush=function(){var t=new lg(null,NaN,this.f-this.i,this.g-this.j,this.f+this.i,this.g+this.j);t.b=this;this.head=this.a=t;this.b=null};function mg(t,e){var i=t.head,r;if(e){var n=e;if(n!==i)for(i=n;n=n.parent;)if(n.entries||1<n.a)i=n}else for(;!i.entries&&2>(r=i.a);)if(r)i=n;else break;t.head=i}hg.prototype.$a=function(t,e,i,r,n,o){var a=[],s=this.head,l=this.a;t<=s[5]&&e<=s[6]&&(n?i>=s[7]:i>s[7])&&(o?r>=s[4]:r>s[4])&&ng(this,s,a,t,e,i,r,o||r>=l[6],n||i>=l[5]);return a};function ng(t,e,i,r,n,o,a,s,l){var u=e.entries,c=e[7],h=e[4],f=e[5],p=e[6],d=e[8],y=e[9],g;if(u){var v=u.length;if(n>h||r>c||a<p||o<f)for(;v--;){c=u[v];h=c.pd(3);f=c.pd(0);p=c.pd(1);var _=c.pd(2);_>=n&&p>=r&&(f<a||s&&f==a)&&(h<o||l&&h==o)&&i.push(c)}else for(;v--;)i.push(u[v])}if(o>d||l&&o==d)n<y&&(g=e[1])&&ng(t,g,i,r,n,o,a,s,l),(a>y||s&&a==y)&&(g=e[3])&&ng(t,g,i,r,n,o,a,s,l);r<d&&(n<y&&(g=e[0])&&ng(t,g,i,r,n,o,a,s,l),(a>y||s&&a==y)&&(g=e[2])&&ng(t,g,i,r,n,o,a,s,l))}hg.prototype.Tc=ba(1);var og=0;function lg(t,e,i,r,n,o){this.c=e;t&&(this.parent=t,this.b=t.b,e&1?(i=t[8],n=t[5]):(i=t[7],n=t[8]),e&2?(r=t[9],o=t[6]):(r=t[4],o=t[9]));this[7]=i;this[5]=n;this[8]=(i+n)/2;this[4]=r;this[6]=o;this[9]=(r+o)/2}lg.prototype.a=0;function pg(t,e){return t[e]||(++t.a,t[e]=new lg(t,e))}lg.prototype.removeChild=function(t){var e=t.c;this[e]===t&&(delete this[e],delete t.parent,--this.a)};lg.prototype.Tc=ba(0);function qg(t,e){(t.entries||(t.entries=[])).push(e);e.node=t}function rg(t,e,i,r,n){var o=t[5],a=t[6];return t[7]<=e&&t[4]<=i&&(o>r||o===r&&o===t.b.a[5])&&(a>n||a===n&&a===t.b.a[6])}function sg(t,e,i,r,n,o){sg.l.constructor.apply(this,arguments)}u(sg,hg);sg.prototype.m=function(t){for(var e,i,r=this.head;t;){if(!(e=t.entries)||!e.length)if(e&&delete t.entries,!t.a&&(i=t.parent)){i.removeChild(t);r===t&&(r=i);t=i;continue}t=y}this.head!==r&&(this.head=r,mg(this))};function tg(t,e,i,r,n){if(rg(t.a,e,i,r,n))return ug(t,t.a,e,i,r,n,t.c);throw Error("Coordinates out of bounds")}sg.prototype.Ec=function(t,e){return tg(this,t,e,t,e)};function ug(t,e,i,r,n,o,a){var s=e[8],l=e[9],u,c;a&&(n<s||(u=i>=s))&&(o<l||(c=r>=l))?i=ug(t,pg(e,u|c<<1),i,r,n,o,a-1):(qg(e,i=new vg(i,r,n,o)),kg(t,i,!0),mg(t,e));return i}function vg(t,e,i,r){this.id=og++;this[0]=e;this[1]=i;this[2]=r;this[3]=t}vg.prototype.pd=function(t){return this[t]};function wg(t){this.f=new sg(+t||10,180,90,0,0,!0);this.c=[];this.g=!1;this.a=this.b=this.R=null}t("H.geo.QuadTree",wg);n=wg.prototype;n.Sh=0;n.$c=function(){return this.Sh};n.Fb=function(){return this.g};n.F=function(){var t,e;if(!this.R){var i=[];!this.b&&(t=ig(this.f))&&(this.b=new K(-t[0],t[3],-t[2],t[1]));(e=this.b)&&i.push(e);var r,n,o;if(!this.a&&(o=(n=this.c).length)){t=90;var a=360;var s=-90;for(r=0;o--;){var l=n[o];t=vd(t,l[0]);a=vd(a,l[3]);s=wd(s,l[2]);r=wd(r,l[1])}this.a=new K(-t,a,-s,r-360)}(e=this.a)&&i.push(e);if(e=i[0])i[1]&&(e=e.mc(i[1],!0)),this.R=e}return this.R};function xg(t,e,i,r,n,o){o?(o=new vg(n,-e,i+360,-r),t.c.push(o),t.g=!0,t.a&&t.a.Hc(e,i,r,n,!0,t.a)):(o=tg(t.f,i,-e,n,-r),t.b&&t.b.Hc(e,i,r,n,!0,t.b));++t.Sh;t.R=null;return o}n.Ec=function(t){var e=t.lng;t=t.lat;return xg(this,t,e,t,e,!1)};n.Zj=function(t){var e=t.Rb(),i=t.Ob();return(t=t.Fb())?xg(this,e.lat,i.lng,i.lat,e.lng,t):xg(this,e.lat,e.lng,i.lat,i.lng,t)};wg.prototype.insertBoundingBox=wg.prototype.Zj;wg.prototype.remove=function(t){var e;if(t.node){var i=this.f.remove(t);this.b=null}else if(t=(e=this.c).indexOf(t),i=0<=t)e.splice(t,1),this.g=0<e.length,this.a=null;i&&(--this.Sh,this.R=null);return i};wg.prototype.remove=wg.prototype.remove;function yg(t,e,i,r,n,o,a){t=t.c;var s=t.length,l=[],u;if(s){var c=i+360;for(u=n+360;s--;){var h=t[s];zg(h,e,i,r,n,o,a)?l.push(h):zg(h,e,c,r,u,o,a)&&l.push(h)}}return l}function zg(t,e,i,r,n,o,a){var s=t[3],l=t[0],u=t[1];t=t[2];return(o?l<=r:l<r)&&(a?s<=n:s<n)&&t>=e&&u>=i}function Ag(t,e){var i,r,n;if(i=e.length){var o=t.length;for(r={};o--;)r[t[o].id]=1;for(;i--;)(n=e[i]).id in r||t.push(n)}}wg.prototype.ag=function(t,e,i){var r=this.f,n=t.Rb(),o=t.Ob(),a=-n.lat;n=n.lng;var s=-o.lat;o=o.lng;!e&&a===s||!i&&n===o?t=[]:t.Fb()?(t=r.$a(-180,a,o,s,i,e),Ag(t,r.$a(n,a,180,s,!1,e)),Ag(t,yg(this,a,o,s,n+360,e,i))):(t=r.$a(n,a,o,s,i,e),Ag(t,yg(this,a,n,s,o,e,i)));return t};wg.prototype.intersectBoundingBox=wg.prototype.ag;function Bg(t){return x.H.gl.flexpolyline.encode(t)}t("H.util.flexiblePolyline.encode",Bg);function Cg(t){return x.H.gl.flexpolyline.decode(t)}t("H.util.flexiblePolyline.decode",Cg);function L(t){L.l.constructor.call(this);t&&Dg(t,L,0);this.X=t||[];this.a=Eg(this,0,this.X.length)}u(L,Wf);t("H.geo.LineString",L);function Eg(t,e,i){t=t.X;var r=0;e=wd(e,0);i=vd(i,t.length);i-=2;for(e+=1;e<i;)r+=Vf(t[e],t[e+=3]);return r}L.prototype.vi=function(t,e,i){Fg(this,t,e,i,this.vi)};L.prototype.pushLatLngAlt=L.prototype.vi;function Fg(t,e,i,r,n){var o=t.X.length;e=Sf(e,n);i=Tf(i,n);t.X.push(Sf(e,n),Tf(i,n),r===B?0:Uf(r,n));o&&(t.a+=Vf(t.X[o-2],i));delete t.R;delete t.b}L.prototype.uf=function(t,e,i){i&&Dg(i,this.uf,2);void 0===e&&(e=this.X.length);e&&(this.a-=Eg(this,t-3,t+e+3));var r=i?this.X.splice.apply(this.X,[t,e].concat(i)):this.X.splice(t,e);i&&(this.a+=Eg(this,t-3,t+i.length+3));e&&!i&&(this.a+=Eg(this,t-3,t-3));delete this.R;delete this.b;return r};L.prototype.spliceLatLngAlts=L.prototype.uf;L.prototype.$j=function(t,e,i,r){this.uf(t,0,[e,i,r])};L.prototype.insertLatLngAlt=L.prototype.$j;L.prototype.Nk=function(t){this.uf(t,3)};L.prototype.removeLatLngAlt=L.prototype.Nk;L.prototype.xd=function(t){Fg(this,t.lat,t.lng,t.alt,this.xd)};L.prototype.pushPoint=L.prototype.xd;L.prototype.Ec=function(t,e){this.$j(3*t,e.lat,e.lng,e.alt)};L.prototype.insertPoint=L.prototype.Ec;L.prototype.ff=function(t){this.Nk(3*t)};L.prototype.removePoint=L.prototype.ff;L.prototype.Ee=function(t,e){var i=this.X,r=3*t;t=i[r];var n=i[r+1];i=i[r+2];e&&(e.lat=t,e.lng=n,e.alt=i);return e||new Xf(t,n,i)};L.prototype.extractPoint=L.prototype.Ee;L.prototype.Xl=function(t,e,i){var r=this.X;e=e||0;i=Ze(i,r.length/3);for(var n=3*e;e<i;)t(r[n++],r[n++],r[n++],e++)};L.prototype.eachLatLngAlt=L.prototype.Xl;L.isDBC=Vf;L.prototype.qh=function(t){var e=this.a;t&&(t=this.X,e+=Vf(t[t.length-2],t[1]));return e};L.prototype.getDBCs=L.prototype.qh;L.prototype.Oe=function(){return this.X.length/3};L.prototype.getPointCount=L.prototype.Oe;L.prototype.Jm=function(){return this.X};L.prototype.getLatLngAltArray=L.prototype.Jm;L.prototype.R=y;L.prototype.F=function(){var t;if(!(t=this.R)){t=this.X;var e=t.length,i=3,r,n,o=y;if(3<=e){var a=r=t[0];var s=n=t[1];for(o=new K(a,s,r,n);i<e;i+=3){a=t[i-3];s=t[i-2];r=t[i];n=t[i+1];if(s>n&&180<n-s||s<n&&-180>s-n||n<s&&180>Ad(n-s)){var l=s;s=n;n=l}a<r&&(l=a,a=r,r=l);cg(o.ka,o.ca,o.ma,o.ga,a,s,r,n,o)}}t=this.R=o}return t};L.prototype.getBoundingBox=L.prototype.F;L.prototype.An=function(){return this.R!==y};L.prototype.hasBoundingBox=L.prototype.An;function Dg(t,e,i){for(var r=t.length,n=!(r%3),o;n&&r;)n=!(E(t[--r]=Uf((o=t[r])===B?0:o))||E(t[--r]=Tf(t[r]))||E(t[--r]=Sf(t[r])));if(!n&&e)throw new D(e,i,t)}function Gg(t){var e=new L,i=0,r=t.length;if(r%2)throw new D(Gg,0,t);for(;i<r;)Fg(e,t[i++],t[i++],0,Gg);return e}L.fromLatLngArray=Gg;L.prototype.na=function(t){var e=this===t,i;if(!e&&(e=C(t,L))){var r=this.X;t=t.X;for(e=(i=r.length)===t.length;e&&i--;)e=r[i]==t[i]}return e};L.prototype.equals=L.prototype.na;function Hg(t,e){return t.a-e.a}function Ig(t,e){var i=t.X,r=-2,n=[],o;var a=t.b;if(!a){a=t.b=new wg;var s=0;var l=t.X;var u=l.length;for(o=0;o<u;o+=3){var c=l[o];var h=l[o+1];if(o){if(p<h){var f=p;var p=h}else f=h;if(y<c)var d=c;else{d=y;var y=c}f=xg(a,d,f,y,p,180<p-f);f.a=s++}y=c;p=h}}a=a.ag(e).sort(Hg);l=a.length;for(e=0;e<l;e++){s=a[e];s=s.a;u=3*s;if(s>r+1){var g=[i[u],i[u+1]];n.push(g)}r=s;g.push(i[u+3],i[u+4])}if(t.a){i=[];r=n.length;for(e=0;e<r;e++)if(g=n[e],a=g.length){l=[];for(t=0;t<a;t+=2)s=g[t],u=g[t+1],l.push(s,u),o=g[t-1],t&&Vf(u,o)&&(i.push(l),l=[],o+=0>o?360:-360,l.push(g[t-2],o,s,u));i.push(l)}n=i}return n}n=L.prototype;n.qb="LineString";n.Sc=function(t,e){var i=this.X,r=i.length,n;if(r){t.push("(");for(n=0;n<r;n+=3)n&&t.push(","),t.push(i[n+1]," ",i[n]);e&&(i[0]!==i[r-3]||i[1]!==i[r-2])&&t.push(",",i[1]," ",i[0]);t.push(")")}else t.push("EMPTY");return t};n.Mb="LineString";n.hd=function(){var t=[],e=this.X,i=e.length,r;for(r=0;r<i;r+=3)t.push([e[r+1],e[r],e[r+2]]);return t};n.wc=function(){var t=this.X,e;if(this.F().Fb()){t=t.slice();var i=1;for(e=t.length;i<e;i+=3)0>t[i]&&(t[i]+=360)}return t};n.No=function(t){t=void 0===t?5:t;for(var e=this.X,i=e.length,r=[],n=0;n<i;n+=3)r.push([e[n],e[n+1],e[n+2]]);return Bg({polyline:r,precision:t,thirdDim:2,thirdDimPrecision:t})};L.prototype.toFlexiblePolyline=L.prototype.No;function Jg(t){var e=Cg(t);t=e.polyline;var i=e.thirdDim;e=2===i||3===i;i=0===i;if(!t)throw new D(Jg,0,"data");if(e||i){i=t.length;var r=Array(3*i);for(var n=0,o=0;n<i;n++){var a=t[n];r[o++]=a[0];r[o++]=a[1];r[o++]=e?a[2]:0}}if(!r)throw new D(Jg,0,"only ABSENT, ALTITUDE or ELEVATION are supported as type of the 3rd dimension");return new L(r)}L.fromFlexiblePolyline=Jg;function Kg(t){Kg.l.constructor.call(this);void 0!==t&&(this.data=t)}u(Kg,F);t("H.map.Feature",Kg);Kg.prototype.getData=function(){return this.data};Kg.prototype.getData=Kg.prototype.getData;Kg.prototype.u=function(){Kg.l.u.call(this);delete this.data};function Lg(){}t("H.map.provider.Invalidations",Lg);Lg.MARK_INITIAL=Ud;Lg.prototype.update=function(t,e){e!==Mg.NONE&&(this.a=t,e&Mg.SPATIAL&&(this.f=t),e&Mg.VISUAL&&(this.g=t),e&Mg.ADD&&(this.b=t),e&Mg.REMOVE&&(this.c=t),e&Mg.Z_ORDER&&(this.j=t),e&Mg.VOLATILITY&&(this.i=t))};Lg.prototype.update=Lg.prototype.update;Lg.prototype.Pm=function(){return this.a};Lg.prototype.getMark=Lg.prototype.Pm;Lg.prototype.a=Ud;Lg.prototype.Fn=function(t){return this.a>t};Lg.prototype.isAny=Lg.prototype.Fn;Lg.prototype.g=Ud;Lg.prototype.ce=function(t){return this.g>t};Lg.prototype.isVisual=Lg.prototype.ce;Lg.prototype.f=Ud;Lg.prototype.Lh=function(t){return this.f>t};Lg.prototype.isSpatial=Lg.prototype.Lh;Lg.prototype.b=Ud;Lg.prototype.ak=function(t){return this.b>t};Lg.prototype.isAdd=Lg.prototype.ak;Lg.prototype.c=Ud;Lg.prototype.cg=function(t){return this.c>t};Lg.prototype.isRemove=Lg.prototype.cg;Lg.prototype.j=Ud;Lg.prototype.Mh=function(t){return this.j>t};Lg.prototype.isZOrder=Lg.prototype.Mh;Lg.prototype.i=Ud;Lg.prototype.Kn=function(t){return this.i>t};Lg.prototype.isVolatility=Lg.prototype.Kn;var Mg={NONE:0,VISUAL:1,SPATIAL:2,ADD:4,REMOVE:8,Z_ORDER:16,VOLATILITY:32};Lg.Flag=Mg;function Ng(t,e,i){Ng.l.constructor.call(this,t);this.oldValue=i;this.newValue=e}u(Ng,rd);t("H.util.ChangeEvent",Ng);function M(t){uc(this,M);M.l.constructor.call(this,t?t.data:B);this.K=Og.next();if(t){var e="min";Cc(t[e])&&(this.v=t[e]);e="max";Cc(t[e])&&(this.s=t[e]);e="visibility";e in t&&(this.c=!!t[e]);e="volatility";e in t&&(this.B=!!t[e]);e="zIndex";e in t&&(this.o=+t[e]||0);e="provider";e in t&&!C(t[e],N)&&(this.a=t[e],this.ua(Mg.ADD))}}u(M,Kg);t("H.map.Object",M);var Og=new af(1),Pg={ANY:31,OVERLAY:1,SPATIAL:2,MARKER:4,DOM_MARKER:8,GROUP:16};M.Type=Pg;M.prototype.fb=function(){return this.K};M.prototype.getId=M.prototype.fb;M.prototype.Ki=function(t){if(!Cc(t)&&!zc(t))throw new D(this.Ki,0,"id must be a number or a string");this.m=t;return this};M.prototype.setRemoteId=M.prototype.Ki;M.prototype.fn=function(){return this.m};M.prototype.getRemoteId=M.prototype.fn;M.prototype.v=-1/0;M.prototype.s=1/0;M.prototype.Qm=function(){return this.s};M.prototype.getMax=M.prototype.Qm;M.prototype.Sm=function(){return this.v};M.prototype.getMin=M.prototype.Sm;M.prototype.c=!0;M.prototype.ub=function(t){var e=this.c;(t=!!t)^e&&(this.c=t,this.invalidate(Mg.VISUAL));return this};M.prototype.setVisibility=M.prototype.ub;M.prototype.Cc=function(t){for(var e=this,i;(i=e.c)&&t&&(e=e.Va););return i};M.prototype.getVisibility=M.prototype.Cc;M.prototype.B=!1;M.prototype.Yf=function(t){for(var e=this,i;!(i=e.B)&&t&&(e=e.Va););return i};M.prototype.getVolatility=M.prototype.Yf;M.prototype.il=function(t){var e=this.B;e^t&&(this.B=!e,this.invalidate(Mg.VOLATILITY));return this};M.prototype.setVolatility=M.prototype.il;M.prototype.o=B;M.prototype.Sj=function(){return this.o};M.prototype.getZIndex=M.prototype.Sj;M.prototype.rf=function(t){t!==this.o&&(this.jf(),this.o=t,this.invalidate(Mg.Z_ORDER));return this};M.prototype.setZIndex=M.prototype.rf;M.prototype.D=B;M.prototype.bd=function(){var t=this.D,e,i;if(!t){var r=(e=this.o)!==B;(t=this.Va)?(t=t.bd().slice(),t[0]|=r):t=[r|0];t.push(e||0,0>(i=this.Ni)?this.K:i);this.D=t}return t};M.prototype.getZInfo=M.prototype.bd;M.prototype.jf=function(){this.D=B};function Qg(t,e,i){var r,n;if(!i||t[0]|e[0]){var o=t.length;var a=e.length;var s=vd(o,a);var l=1;for(n=1+i;l<s;l+=n)if(r=t[l]-e[l])return r}return i?0:o-a}M.compareZInfo=Qg;function Rg(t,e){return t.pj(e)}M.compareZOrder=Rg;M.prototype.pj=function(t){return this.Fg-t.Fg||Qg(this.bd(),t.bd(),!1)};M.prototype.compareZOrder=M.prototype.pj;n=M.prototype;n.previousSibling=y;n.nextSibling=y;n.Ni=-1;n.Va=y;n.Vm=function(){return this.Va};M.prototype.getParentGroup=M.prototype.Vm;M.prototype.jc=function(){for(var t=this,e;e=t.Va;)t=e;return t};M.prototype.getRootGroup=M.prototype.jc;M.prototype.contains=function(t){return this===t};M.prototype.contains=M.prototype.contains;M.prototype.ja=function(t){if(this.Va)throw new Yc(this.ja,"Not allowed for a child of a group");M.l.ja.call(this,t)};M.prototype.setParentEventTarget=M.prototype.ja;M.prototype.a=y;M.prototype.pa=function(){return this.a};M.prototype.getProvider=M.prototype.pa;M.prototype.me=function(t,e){var i=this.a,r;if(r=i!==t){if(e&&(i&&!C(i,N)||t&&!C(t,N)))throw new Yc(e,"Only LocalObjectProvider allows an object transfers");e=this.type!==Pg.GROUP;i&&(this.invalidate(Mg.REMOVE),e&&i.Ha(this));if(this.a=t)e&&t.ea(this),this.za=y,this.invalidate(Mg.ADD)}return r};M.prototype.Qb=function(){return this.za||(this.za=new Lg)};M.prototype.getInvalidations=M.prototype.Qb;M.prototype.ua=function(t){var e=this.pa(),i;(i=!!e)&&e.invalidateObject(this,t);return i};M.prototype.invalidate=M.prototype.ua;M.prototype.u=function(){this.Va&&this.Va.Ha(this);M.l.u.call(this)};M.prototype.setData=function(t){this.data=t;return this};M.prototype.setData=M.prototype.setData;M.prototype.Rc=function(t){if(t&&!Ca(t))throw new D(M.prototype.Rc,0,"opt_callback must be a function");t={type:"Feature",properties:Sg(this,t?t(this.data):this.data,!!t),geometry:this.ba().Rc()};this.m&&(t.id=this.m);return t};M.prototype.toGeoJSON=M.prototype.Rc;function Sg(t,e,i){if(null===e||e===B)return null;if(0<=Object.keys(e).length&&"[object Object]"!==Object.prototype.toString.call(e))throw Error(Tg(t,i));try{return JSON.stringify(e),e}catch(e){throw Error(Tg(t,i))}}function Tg(t,e){return"Object Remote-Id: "+t.m+" - "+(e?"The value returned by the callback is not a valid JSON object and cannot be set as Feature properties.":"The given object data is not a valid JSON object and cannot be set as Feature properties.")}M.prototype.W=function(){return{id:this.K,properties:{min:this.v,max:this.s,zIdx:this.o,sIdx:this.Ni,parent:this.Va?this.Va.fb():0,visible:this.Cc(),volatile:this.Yf()},type:"Feature"}};M.prototype.forWorkerMessage=M.prototype.W;function O(t){var e;if(t){var i=Ug;for(e=C(t,O);i--;){var r=Vg[i];if(t.hasOwnProperty(r)){var n=t[r];if(e)this[r]=n;else{if((n=Wg[i](n))===Xg)throw new D(O,0,r+": "+t[r]);n!==this[r]&&n!==B&&(this[r]=n)}}}i=e?t.Se:this.lineWidth&&Xe(this.strokeColor);i||(this.Se=i);i=e?t.Sb:Xe(this.fillColor);i||(this.Sb=i);i=e?t.Re:"none"!==this.strokeColor&&this.lineWidth;i||(this.Re=i)}oc(this)}t("H.map.SpatialStyle",O);O.prototype.Sb=!0;O.prototype.Se=!0;O.prototype.Re=!0;var Vg="strokeColor fillColor lineWidth lineCap lineJoin miterLimit lineDash lineDashOffset lineHeadCap lineTailCap".split(" ");O.prototype.strokeColor="rgba(0,85,170,.6)";O.prototype.strokeColor=O.prototype.strokeColor;O.prototype.fillColor="rgba(0,85,170,.4)";O.prototype.fillColor=O.prototype.fillColor;O.prototype.lineWidth=2;O.prototype.lineWidth=O.prototype.lineWidth;O.prototype.lineCap="round";O.prototype.lineCap=O.prototype.lineCap;O.prototype.lineJoin="miter";O.prototype.lineJoin=O.prototype.lineJoin;O.prototype.miterLimit=1;O.prototype.miterLimit=O.prototype.miterLimit;O.prototype.Pn=ff;O.prototype.lineDash=O.prototype.Pn;O.prototype.lineDashOffset=0;O.prototype.lineDashOffset=O.prototype.lineDashOffset;O.prototype.Qn=B;O.prototype.lineHeadCap=O.prototype.Qn;O.prototype.Rn=B;O.prototype.lineTailCap=O.prototype.Rn;var Ug=Vg.length;O.prototype.na=function(t){var e=this===t;if(!e&&t){for(e=0;e<Ug;e++){var i=Vg[e];if(this[i]!==t[i])break}e=e===Ug}return e};O.prototype.equals=O.prototype.na;O.prototype.Jj=function(t){if(t){var e={};Wa(e,this,t)}else e=this;return new O(e)};O.prototype.getCopy=O.prototype.Jj;var Xg=oc({}),Wg=[function(t){return t?nc(t):Xg},function(t){return t?nc(t):Xg},function(t){return 0<=t&&100>=t?+t:Xg},function(t){t=nc(t);return"butt"===t||"square"===t||"round"===t||"arrow-head"===t||"arrow-tail"===t?t:Xg},function(t){return"round"===t||"bevel"===t||"miter"===t?t:Xg},function(t){return 0<t&&100>=t?+t:Xg},function(t){return t&&t.every&&t.every(Dc)?t:Xg},function(t){return E(+t)?Xg:+t},function(t){return tc(t)?Wg[3](t):B},function(t){return tc(t)?Wg[3](t):B}];O.MAX_LINE_WIDTH=100;var Yg=new O;O.DEFAULT_STYLE=Yg;var Zg="fillColor strokeColor lineWidth lineCap lineJoin miterLimit lineDashOffset lineDash lineTailCap lineHeadCap".split(" ");O.prototype.W=function(){for(var t={},e=Zg.length,i;e--;)i=Zg[e],t[i]=this[i];return t};O.prototype.forWorkerMessage=O.prototype.W;function $g(t){var e;if(t){var i=C(t,$g);for(e in t)if(e in this){var r=t[e];r!==this[e]&&("fillColor"===e||0<(r=+r))&&(this[e]=r)}t=i?t.Sb:!!(Xe(this.fillColor)&&this.width&&this.width);t||(this.Sb=t)}oc(this)}t("H.map.ArrowStyle",$g);$g.prototype.Sb=!0;$g.prototype.fillColor="rgba(255,255,255,.75)";$g.prototype.width=1.2;$g.prototype.length=1.6;$g.prototype.frequency=5;$g.prototype.Ij=function(){return new $g(this)};$g.prototype.na=function(t){var e=this===t;!e&&t&&(e=t.width===this.width&&t.fillColor===this.fillColor&&t.length===this.length&&t.frequency===this.frequency);return e};$g.prototype.equals=$g.prototype.na;function ah(t,e){var i;ah.l.constructor.call(this,e);e&&this.gd(e.style);t&&(this.j=!0);e&&(i=e.arrows)&&this.Xk(i)}u(ah,M);t("H.map.Spatial",ah);ah.prototype.type=Pg.SPATIAL;ah.prototype.Fg=0;ah.prototype.style=Yg;ah.prototype.ta=function(){return this.style};ah.prototype.getStyle=ah.prototype.ta;ah.prototype.gd=function(t){var e=!0;t?this.style=C(t,O)?t:new O(t):this.style?delete this.style:e=!1;e&&this.invalidate(Mg.VISUAL);return this};ah.prototype.setStyle=ah.prototype.gd;ah.prototype.fm=function(){return this.g};ah.prototype.getArrows=ah.prototype.fm;ah.prototype.Xk=function(t){var e=this.g,i=!1;!t&&e?(delete this.g,i=!0):!t||e&&e.na(t)||(this.g=new $g(t),i=!0);i&&"none"!==this.style.strokeColor&&this.ua(1);return this};ah.prototype.setArrows=ah.prototype.Xk;function bh(t,e){var i=!1,r=!1,n;if(e.length){for(i=0;i<e.length;i++)if(e[i]!==ch){r=!0;break}e=t.style;i=r?e.Se||e.Sb&&t.j||(n=t.g||!1)&&e.Re&&n.Sb:e.Sb}return i&&t.Cc(!0)}ah.prototype.j=!1;ah.prototype.Hn=function(){return this.j};ah.prototype.isClosed=ah.prototype.Hn;ah.prototype.getGeometriesForTile=ah.prototype.Sd;ah.prototype.uh=function(){return y};ah.prototype.getLabels=ah.prototype.uh;function dh(t,e){dh.l.constructor.call(this,t,e)}u(dh,ah);t("H.map.GeoShape",dh);dh.prototype.getBoundingBox=dh.prototype.F;function eh(t,e,i,r){var n=[],o=e.length,a;for(a=0;a<o;a++){var s=e[a];s.length&&n.push(fh(t,s,i,r))}return n}function fh(t,e,i,r){var n,o=[],a=e.length,s=0;t.V=0;for(n=n||0;s<a;)o.push(gh(t,e[s++],e[s++],n,r));i&&o.push(gh(t,e[0],e[1],n,r));return o}function gh(t,e,i,r,n){var o=t.V;o&&180<Ad(o-i)&&(i+=0>o?-360:360);t.V=i;return n.Nh(e,i+r)}function hh(t,e,i){for(var r=e,n,o=t.length+e,a,s;r--;){e=t[r];a=e.length;for(n=Array(a);a--;)s=e[a],n[a]=new I(s.x+i,s.y);t[--o]=n}}var ih=new L([0,0,0,0,0,0,0,0,0]);function jh(t){uc(this,jh);jh.l.constructor.call(this);this.oa=kh(this,t,this.constructor,0)}u(jh,Wf);t("H.geo.MultiGeometry",jh);jh.prototype.splice=function(t,e,i){t=[t];e!==B&&t.push(e);i&&(e=kh(this,i,this.splice,2),t=t.concat(e));this.R=y;return this.oa.splice.apply(this.oa,t)};jh.prototype.splice=jh.prototype.splice;jh.prototype.oc=function(t){var e=this.oa.length;if(!(0<=t&&t<e))throw new je(this.oc,t,[0,e-1]);this.R=y;return this.oa.splice(t,1)[0]};jh.prototype.removeAt=jh.prototype.oc;jh.prototype.remove=function(t){t=this.oa.indexOf(t);if(0<=t){var e=this.oa.splice(t,1)[0];this.R=y}return e||y};jh.prototype.remove=jh.prototype.remove;jh.prototype.Cm=function(){return this.oa};jh.prototype.getGeometries=jh.prototype.Cm;jh.prototype.push=function(t){var e=kh(this,[t],this.push,0)[0];this.R&&(this.R=this.R.mc(t.F()));this.oa.push(e)};jh.prototype.push=jh.prototype.push;jh.prototype.F=function(){var t;if(!(t=this.R)){t=y;var e,i;if(this.oa.length)for(t=this.oa[0].F(),i=1;i<this.oa.length;i++)if(e=this.oa[i].F())t=t?t.mc(e):e}return this.R=t};jh.prototype.getBoundingBox=jh.prototype.F;jh.prototype.R=y;function kh(t,e,i,r){var n,o=[];if(!yc(e))throw new D(i,r);for(n=0;n<e.length;n++)if(t.a(e[n]))o.push(t.b(e[n]));else throw new D(i,r);return o}jh.prototype.b=function(t){return t};jh.prototype.na=function(t){var e=this===t,i;if(!e&&(e=C(t,this.constructor))){var r=this.oa;t=t.oa;for(e=(i=r.length)===t.length;e&&i--;)e=r[i].na(t[i])}return e};jh.prototype.equals=jh.prototype.na;n=jh.prototype;n.Sc=function(t){var e=this.oa,i=e.length,r,n,o=!1;if(i){t.push("(");for(r=0;r<i;r++)(n=0<r&&o)&&t.push(","),e[r].Sc(t),"EMPTY"===t[t.length-1]?t.splice(-1-n,1+n):o=!0;o?t.push(")"):t.splice(-1,1,"EMPTY")}else t.push("EMPTY");return t};n.toString=function(){return this.Sc([this.qb.toUpperCase()," "]).join("")};n.wc=function(){for(var t=[],e=this.oa,i=e.length;i--;)t[i]=e[i].wc();return t};n.W=function(){var t=jh.l.W.call(this);t.type=this.qb;return t};n.hd=function(){for(var t=[],e=this.oa,i=e.length;i--;)t[i]=e[i].hd();return t};function lh(t){lh.l.constructor.call(this,t)}u(lh,jh);t("H.geo.MultiLineString",lh);lh.prototype.a=function(t){return C(t,L)};lh.prototype.qb="Multi"+L.prototype.qb;lh.prototype.Mb="Multi"+L.prototype.Mb;function mh(t,e){mh.l.constructor.call(this,!1,e);this.da(t)}u(mh,dh);t("H.map.Polyline",mh);mh.prototype.F=function(){return this.eb.F()};mh.prototype.getBoundingBox=mh.prototype.F;mh.prototype.eb=y;mh.prototype.da=function(t){var e=this.da,i,r;if(C(t,lh)){var n=t.oa;if(i=n.length)for(r=0;r<i;r++)nh(n[r],e);else throw new D(e,0)}else nh(t,e);this.sd=!!n;this.eb=t;this.ua(Mg.SPATIAL);return this};mh.prototype.setGeometry=mh.prototype.da;mh.prototype.ba=function(){return this.eb};mh.prototype.getGeometry=mh.prototype.ba;mh.prototype.clip=function(t){var e=this.eb;return Ig(this.sd?e.oa[0]:e,t)};mh.prototype.clip=mh.prototype.clip;mh.prototype.Sd=function(t){var e=this.eb;var i,r=[];if(this.sd)for(e=e.oa,i=e.length;i--;)oh(this,e[i],t,r);else oh(this,e,t,r);return r.length?r:B};mh.prototype.getGeometriesForTile=mh.prototype.Sd;function nh(t,e){if(!C(t,L)||2>t.Oe())throw new D(e,0)}function oh(t,e,i,r){var n=Ig(e,i.Tf());if(n.length&&(e=i.Vf(),t=eh(t,n,!1,e),n=t.length)){var o=i.Qe();e=e.w;i.x||hh(t,n,-e);i.x===(1<<i.z)-1&&hh(t,n,e);i=ph(t,o.left,o.top,o.right,o.bottom,!1);i.length&&r.push(new qh(i))}}mh.prototype.W=function(){var t=mh.l.W.call(this),e=t.properties;t.geometry=this.ba().W();e.style=this.ta().W();e.height=0;return t};mh.prototype.forWorkerMessage=mh.prototype.W;var rh;function sh(t,e){if(x.URL)return new x.URL(t,e).toString();if(!t||!th(t))return t;if(!e||th(e))throw new TypeError("Failed to construct 'URL': Invalid base URL");rh||(rh=document.createElement("a"),Fc(rh));var i=rh;i.href=e;"/"!==t[0]?t=i.href.replace(/\/[^\/]*$/,"/")+t:((e=i.origin)||(e=i.protocol+"//"+i.host),t=e+t);return t}function th(t){var e=!1;"string"===typeof t&&(e=!(-1<t.search(/^(http|https|data|blob):/)||"//"===t.substr(0,2)));return e}function uh(t,e){var i,r=arguments.length,n,o;for(i=1;i<r;i++)if((n=arguments[i])&&n!==t&&n!==a){var a=n;for(o in n){var s=n[o];t[o]!==s&&(vh(s)?vh(t[o])?t[o]=uh(t[o],s):t[o]=qc(s):void 0!==s&&(t[o]=qc(s)))}}return t}t("H.util.webgl.mergeObjects",uh);var wh=mc();function xh(t,e,i){var r=i[t];return e&&r in e&&0>sc.indexOf(r)?(e=e[r],++t<i.length?xh(t,e,i):e):wh}var yh=xh.bind(null,0),zh={polygons:1,lines:1,"pattern-lines":1,points:1,text:1,raster:1,custom_icons:1,overlays:1},Ah={data:1,draw:1,enabled:1,filter:1,properties:1},Bh=Object.keys(Ah);function Ch(t,e,i,r,n,o){var a=r[t],s=i[a];if(++t<r.length){var l=e[a]||{};for(i=Bh.length;i--;){var u=Bh[i];if("draw"!==u||!o){var c=s[u];c!==B&&(l[u]=qc(c))}}Ch(t,l,s,r,n,o)}else n?l=qc(s):(l=s,delete i[a]);e[a]=e[a]?uh(e[a],l):l}var Dh=Ch.bind(null,0);function Eh(t,e){t in zh&&(e[t]=1)}function Fh(t,e,i){var r,n,o;for(r in t)if(Ah[r]){if("draw"===r){var a=t[r];for(n in a){var s=a[n];(o=s.style)?(s.style=e+o,Eh(o,i)):(delete a[n],a[e+n]=s,Eh(n,i))}}}else Fh(t[r],e,i)}function Gh(t,e){var i={},r,n,o,a;e+="_";t=uh({},t);if(r=t.styles)for(n in r){var s=r[n];delete r[n];r[e+n]=s;if(o=s.mix)for(zc(o)&&(o=[o]),a=o.length;a--;)Eh(o[a],i),o[a]=e+o[a];if(a=s.base)o||(o=s.mix=[]),o.unshift(e+a),delete s.base,Eh(a,i);Eh(n,i)}else r=t.styles={};if(s=t.layers)for(n in s)o=s[n],delete s[n],(a=o.data)&&!a.layer&&(a.layer=n),s[e+n]=o,Fh(o,e,i);for(n in i)r[e+n]={base:n};return t}function Hh(t,e){var i=t.sources,r=Object.keys(i)[0],n=uh(i[r],{uid:e});i=t.layers;var o;t.sources={};t.sources[e]=n;for(o in i)t=i[o],t.data?t.data.source===r&&(t.data.source=e):t.data={source:e}}function Ih(t,e){var i;var r=t.textures;var n=t.fonts;for(i in r){var o=r[i];o.url&&(o.url=sh(o.url,e))}for(i in n)if(r=n[i],yc(r))for(o=0;o<r.length;o++){var a=r[o];a.url=a.url&&sh(a.url,e)}else a=t.fonts[i],a.url=a.url&&sh(a.url,e)}function Jh(t,e){return"function(){return "+("feature."+t+(e||""))+";}"}function Kh(t){return Jh("style."+t,void 0)}function Lh(t,e,i,r){t={base:t,blend:e,blend_order:i};r&&(t.clean_depth=!!r);return t}function Mh(t){var e={};e["translucent-"+(t?"extruded-":"")+"polygons"]={color:Kh("fillColor"),order:1,interactive:!0,extrude:t};return e}function Nh(t,e,i,r){t={data:{source:t,layer:e}};i&&(t.draw=i);r&&(t.filter=r);return t}function vh(t){return Da(t)&&!yc(t)}function Oh(t,e){Oh.l.constructor.call(this);if(e&&th(e))throw new D(Oh,1,"Base URL must be absolute");this.A=Ph.INIT;this.a=null;this.c=e}u(Oh,F);t("H.map.render.Style",Oh);Oh.prototype.load=Oh.prototype.load;Oh.prototype.getState=function(){return this.A};Oh.prototype.getState=Oh.prototype.getState;Oh.prototype.P=function(t){this.A=t};Oh.prototype.setState=Oh.prototype.P;Oh.prototype.gc=function(){return this.c};Oh.prototype.getBaseUrl=Oh.prototype.gc;Oh.prototype.od=function(){return qc(this.a)};Oh.prototype.getConfig=Oh.prototype.od;Oh.prototype.mm=function(){return this.a};Oh.prototype.getConfigReference=Oh.prototype.mm;Oh.prototype.Dd=function(t){this.a=t};Oh.prototype.setConfig=Oh.prototype.Dd;Oh.prototype.Lb=function(t){this.a=null;this.P(Ph.ERROR);var e=Qh;se(this.aa,void 0!==e?String(e):void 0)?this.dispatchEvent(new td(Qh,t,this)):console.error(t)};Oh.prototype.dispatchError=Oh.prototype.Lb;Oh.prototype.u=function(){Oh.l.u.call(this);this.a=null};var Qh="error",Rh={jd:"change",aj:Qh},Ph={ERROR:-1,INIT:0,LOADING:1,READY:2};Oh.State=Ph;function Sh(t,e){Sh.l.constructor.call(this,t,e);if(zc(t))Th.test(t)&&-1===t.indexOf("import:")?(this.f=t,e||(this.j=th(this.f)?B:this.f)):this.g=t;else if(Da(t))this.Dd(qc(t));else throw new D(Sh,0,Uh)}u(Sh,Oh);t("H.map.render.webgl.Style",Sh);Sh.prototype.load=function(){var t=this,e=this.gc();this.f?(this.P(Ph.LOADING),new rf("text/plain",this.f).then(function(t){var i={};return Vh(t,e,!1,(i[e]=!0,i))}).then(function(e){return t.Dd(e)},function(e){return t.Lb(e.message)}),this.f=null):this.g&&(this.P(Ph.LOADING),Vh(this.g,e).then(function(e){return t.Dd(e)},function(e){return t.Lb(e.message)}),this.g=null)};Sh.prototype.cl=function(t,e,i){var r;Wh(this);t=Xh(this,t,this.cl,i);for(i=0;i<t.length;i++){var n=t[i].gb.draw;for(r in n){var o=n[r];vh(o)&&(o.interactive=!!e)}}Yh(this)};Sh.prototype.setInteractive=Sh.prototype.cl;Sh.prototype.setProperty=function(t,e,i){var r,n=t.split("."),o=0,a=n.length;Wh(this);if(!tc(e))throw new D(this.setProperty,1,"value");if(r=Zh(this.a,n)){if(!(r.parent instanceof Object)||r.parent instanceof Array)if(i)n.pop(),n=Zh(this.a,n),r.parent=n.parent[n.pg]={};else throw new D(this.setProperty,0,t+" property is not primitive type");r.parent[r.pg]=e}else{for(r=this.a;o!==a-1;)r[n[o]]={},r=r[n[o++]];r[n[o]]=e}$h(this)&&Yh(this)};Sh.prototype.setProperty=Sh.prototype.setProperty;Sh.prototype.yh=function(t){Wh(this);return(t=Zh(this.a,t.split(".")))?qc(t.node):void 0};Sh.prototype.getProperty=Sh.prototype.yh;Sh.prototype.removeProperty=function(t){Wh(this);(t=Zh(this.a,t.split(".")))&&t.parent&&t.parent.hasOwnProperty(t.pg)&&(delete t.parent[t.pg],$h(this)&&Yh(this))};Sh.prototype.removeProperty=Sh.prototype.removeProperty;Sh.prototype.De=function(t,e,i){var r;Wh(this);var n=this.a;var o=n.layers;var a=Xh(this,t,this.De,!1);t=a.length;for(r={};t--;)Dh(r,o,a[t].id,!!e,!!i);i={};a=Object.keys(n);for(t=a.length;t--;){var s=a[t];var l=n[s];i[s]=l===o?r:qc(l)}e||Yh(this);return i};Sh.prototype.extractConfig=Sh.prototype.De;Sh.prototype.We=function(t){Wh(this);if(!Da(t))throw new D(this.We,0,"config");this.Dd(uh(this.a,t))};Sh.prototype.mergeConfig=Sh.prototype.We;Sh.prototype.b=ba(2);Sh.prototype.toString=function(){return this.getState()===Ph.READY?x.H.gl.yaml.safeDump(this.a,{lineWidth:120}):""};Sh.prototype.u=function(){Sh.l.u.call(this);this.g=this.f=null};function $h(t){var e=t.a,i;if(Da(e)){var r;if(r=t.i){e=e&&e.sources;r=!1;for(var n in e)if(e[n].type===t.i){r=!0;break}r=!(e?r:1)}r&&(i="invalid source, the only valid type is "+t.i)}else i=Uh;i&&t.Lb(i);return!i}function Yh(t){t.dispatchEvent(new rd("change",t))}function Wh(t){if(t.getState()!==Ph.READY)throw new Yc(t.We,"style is not ready yet")}function Xh(t,e,i,r){var n=[],o=yc(e)?e:[e],a,s;void 0===r&&(r=!0);for(o=o.sort().reverse();a=o.pop();){e=String(a).split(".");t:{var l=t.a;for(var u=e.length;u--&&!Ah[e[u]];);if(l&&0>u&&(l=yh(l.layers,e),vh(l)))break t;l=wh}if(l===wh)throw new D(i,0,'Unresolvable layer ID "'+a+'"');n.push({id:e,gb:l});if(r)for(s in l)!Ah[s]&&vh(l[s])&&o.push(a+"."+s)}return n}function Zh(t,e){var i=0,r;for(r=e.length;i!==r;){var n=e[i++];var o=t;t=o[n];if(!t)break}return i===r?{node:t,parent:o,pg:n}:void 0}var Th=/^(http[s]?)?.*\.ya?ml/i,Uh="invalid style configuration";function Vh(t,e,i,r){i=void 0===i?!1:i;r=void 0===r?{}:r;try{var n=x.H.gl.yaml.safeLoad(t,{json:!0})}catch(t){return Promise.reject(t)}return n&&(t=n["import"],zc(t)&&(t=[t]),i&&e&&ai(n,e),delete n["import"],yc(t)&&t.length)?(i=t.reduce(function(t,i){var n=e?sh(i,e):i;r[n]||(r[n]=!0,t.push(new rf("text/plain",n).then(function(t){return Vh(t,n,!0,r)})));return t},[]),Promise.all(i).then(function(t){var e={};t.forEach(function(t){return t&&uh(e,t)});uh(e,n);return e})):Promise.resolve(n)}function ai(t,e){function i(t){t.url&&(t.url=sh(t.url,e))}var r=t&&t.fonts;if(r)for(var n in r)yc(r[n])?r[n].forEach(i):i(r[n]);if(t=t&&t.textures)for(var o in t)i(t[o])}Sh.normalize=ai;Sh.prototype.Dd=function(t){Sh.l.Dd.call(this,t);$h(this)&&(this.P(Ph.READY),Yh(this))};Sh.prototype.od=function(){return Sh.l.od.call(this)};Sh.prototype.gc=function(){return this.j||Sh.l.gc.call(this)};t("H.map.Style",Sh);Sh.State=Ph;function ph(t,e,i,r,n,o){var a,s,l=t.length,u,c;if(l)for(a=[];l--;){var h=t[l];var f=h.length;var p=0;for(u=1;u<f;u++)if(c=bi(h[u-1],h[u],i,e,r,n)){var d=c[0];var y=c[1];p&&p.na(d)?s.push(y):a.push(s=c);p=y;o&&(u=f,l=0)}}else a=t;return a}t("H.math.clipping.clipStrips",ph);function bi(t,e,i,r,n,o){var a=t.x;t=-t.y;var s=e.x;e=-e.y;i=-i;o=-o;if(a>s){if(s>n||a<r)return;var l=a;var u=t;a=s;t=e;s=l;e=u;l=1}else if(a>n||s<r)return;if(t>e){if(e>i||t<o)return;var c=1;t=-t;e=-e;u=o;o=-i;i=-u}else if(t>i||e<o)return;if(a<r){if((t+=(r-a)*(e-t)/(s-a))>i)return;a=r}if(t<o){if((a+=(o-t)*(s-a)/(e-t))>n)return;t=o}s>n&&(e=t+(n-a)*(e-t)/(s-a),s=n);e>i&&(s=a+(i-t)*(s-a)/(e-t),e=i);c&&(t=-t,e=-e);return l?[new I(s,-e),new I(a,-t)]:[new I(a,-t),new I(s,-e)]}function ci(t,e,i){t=di(t,!0);e=di(e,!1);var r,n;var o={};var a=r=1;switch(~~(i||0)){case 1:a=r=0;break;case 2:r=0;a=1;break;case 3:r=1,a=0}i=r;var s=a;if(e&&t){e.Jf=ei(e.x,e.y,null,fi(e));t.Jf=ei(t.x,t.y,null,fi(t));for(a=e;a.next;a=a.next)if(!a.$a)for(r=t;r.next;r=r.next)if(!r.$a){var l=gi(a.next);var u=gi(r.next);if(n=hi(a,l,r,u,o)){n=o.Gl;var c=o.Hl;var h=o.To;var f=o.Uo;n=ei(h,f,null,null,null,null,!0,0,0,n);ii(n,a,l);l=ei(h,f,null,null,null,null,!0,0,0,c);ii(l,r,u);n.fi=l;l.fi=n}}o=ce(e,ji(t));i&&(o=!o);for(a=e;a;a=a.next)a.$a&&(a.hh=o,o=!o);o=ce(t,ji(e));s&&(o=!o);for(r=t;r.next;r=r.next)r.$a&&(r.hh=o,o=!o);ki(e);for(ki(t);(t=li(e))!=e;){for(i=null;!t.Dg;t=t.fi){for(o=t.hh;;){i=ei(t.x,t.y,i);i.artificial=t.$a||t.Gn;t.Dg=1;t=o?t.next:t.Ub;if(!t)break;if(t.$a){t.Dg=1;break}}if(!t)break}i.gi=p;var p=i}return p}}t("H.math.clipping.clipPolygon",ci);function ei(t,e,i,r,n,o,a,s,l,u){t={x:t,y:e,next:i||null,Ub:r||null,gi:n||null,fi:o||null,$a:!!a,hh:s||0,Dg:l||0,alpha:u||0};r&&(t.Ub.next=t);i&&(t.next.Ub=t);return t}function gi(t){for(;t&&t.$a;)t=t.next;return t}function fi(t){if(t)for(;t.next;)t=t.next;return t}function li(t){var e=t;if(e){do{e=e.next}while(e!=t&&(!e.$a||e.$a&&e.Dg))}return e}function ki(t){var e=fi(t);e.Ub.next=t;t.Ub=e.Ub}function hi(t,e,i,r,n,o){var a,s=e.x-t.x,l=e.y-t.y;var u=r.x-i.x;var c=r.y-i.y;var h=s*c-l*u;if(!h)return 0;u=((i.x-t.x)*c-(i.y-t.y)*u)/h;h=(l*(i.x-t.x)-s*(i.y-t.y))/h;if(0>u||1<u||0>h||1<h)return 0;0===u?a=t:1===u?a=e:0===h?a=i:1===h&&(a=r);if(a&&!o)return a.x+=2480549651603763e-20,a.y+=7321997314118067e-20,a.Jf&&(a.Jf.x=a.x,a.Jf.y=a.y),hi(t,e,i,r,n);n.To=t.x+u*s;n.Uo=t.y+u*l;n.Gl=u;n.Hl=h;return 1}function ji(t){for(var e=[];t;)e.push(t.x,t.y),t=t.next;return e}function ii(t,e,i){for(e=e.next;e!==i&&e.alpha<=t.alpha;)e=e.next;t.next=e;t.Ub=e.Ub;t.next.Ub=t;t.Ub.next=t}function di(t,e){for(var i,r=null,n=0,o=t.length;n<o;n++){i=ei(t[n].x,t[n].y,r);i.Gn=e;if(i.next=r)r.Ub=i;r=i}return r}function P(t,e){var i;P.l.constructor.call(this);C(t,L,P,0);if(e!==B&&yc(e,P,1)){for(i=0;i<e.length;i++)C(e[i],L,P,1,"index "+i);this.Na=e}else this.Na=[];this.cb=t;this.a=[]}u(P,Wf);t("H.geo.Polygon",P);function mi(t){var e=P,i=L,r=t.ka,n=t.ca,o=t.ma,a=t.ga;n=[r,n,B,r,a,B,o,a,B,o,n,B];180<=t.Eb()&&(n.splice(9,0,o,t=t.lb().lng,B),n.splice(3,0,r,t,B));return new e(new i(n))}var ni={NORTH:90,SOUTH:-90};P.Direction=ni;P.prototype.vd=ni.NORTH;P.prototype.dl=function(t){this.vd!==t&&(this.R=y,this.a.length=0,this.vd=t);return this};P.prototype.setPoleCovering=P.prototype.dl;P.prototype.$m=function(){return this.vd};P.prototype.getPoleCovering=P.prototype.$m;P.prototype.wm=function(){return this.cb};P.prototype.getExterior=P.prototype.wm;P.prototype.al=function(t){if(!C(t,L))throw new D(this.al,0,t);this.cb=t;this.R=y};P.prototype.setExterior=P.prototype.al;P.prototype.Gm=function(){return this.Na};P.prototype.getInteriors=P.prototype.Gm;P.prototype.Cg=function(t,e,i){var r=arguments.length,n;for(n=2;n<r;n++)C(arguments[n],L,this.Cg,n);var o=this.Na.splice.apply(this.Na,arguments);for(n=2;n<r;n++)arguments[n]=B;this.a.splice.apply(this.a,arguments);return o};P.prototype.spliceInteriors=P.prototype.Cg;P.prototype.wo=function(t){return this.Cg(t,1)[0]};P.prototype.removeInteriorAt=P.prototype.wo;P.prototype.vo=function(t){t=this.Na.indexOf(t);return 0>t?B:this.Cg(t,1)[0]};P.prototype.removeInterior=P.prototype.vo;P.prototype.Lk=function(t){if(!C(t,L))throw new D(this.Lk,0,t);this.Na.push(t)};P.prototype.pushInterior=P.prototype.Lk;P.prototype.F=function(){var t=this.R;t||(this.R=t=oi(this.cb,this.vd));return t};P.prototype.getBoundingBox=P.prototype.F;n=P.prototype;n.Hj=function(t){var e=this.Na.length;if(0>t||t>=e)throw new je(this.Hj,t,[0,e-1]);(e=this.a[t])||(this.a[t]=e=oi(this.Na[t],this.vd));return e};n.cb=y;n.Na=[];function oi(t,e){var i,r,n;if(n=t.F())(i=t.qh(!0))&&(r=t.Oe())&&(n=n.mc(eg([t.Ee(0),t.Ee(r-1)],!0),!0)),360===n.Eb()&&1===i%2&&(n=n.dd(e,0));return n}n.qb="Polygon";n.Sc=function(t){var e=this.Na,i=e.length,r;if(this.cb.Oe()){t.push("(");this.cb.Sc(t,!0);for(r=0;r<i;r++)e[r].Oe()&&(t.push(","),e[r].Sc(t,!0));t.push(")")}else t.push("EMPTY");return t};n.Mb="Polygon";n.hd=function(){var t,e=[],i=this.Na,r=this.cb.hd();r[0].toString()!==r[r.length-1].toString()&&r.push(r[0]);e.push(r);for(t=0;t<i.length;t++)r=i[t].hd(),r[0].toString()!==r[r.length-1].toString()&&r.push(r[0]),e.push(r);return e};n.W=function(){var t=P.l.W.call(this);this.F().Fb()&&(t.type="Multi"+t.type);return t};n.wc=function(){var t=[],e=this.Na,i=e.length;for(t.push(this.cb.wc());i--;)t[i+1]=e[i].wc();return this.F().Fb()?[t]:t};n.na=function(t){var e=!1;if(C(t,P)){var i=t.Na,r=this.Na.length;e=i.length;var n=0;for(e=this.cb.na(t.cb)&&r===e;e&&n<r;)e=e&&this.Na[n].na(i[n]),n++}return e};function pi(t,e,i){var r=void 0===r?!0:r;var n=t.Na,o=qi.bind(null,e,i);return be(e,i,t.cb.X,0,!0,3)!==ae.NONE?r?!n.some(o):!0:!1}function qi(t,e,i){return be(t,e,i.X,0,!0,3)===ae.SURFACE}function si(t,e){e=e.X;t=t.cb.X;var i,r,n=e.length-3,o=t.length-3,a={};for(i=0;i<n;i+=3){var s=e[i];var l=e[i+1];var u=e[i+3];var c=e[i+4];for(r=0;r<o;r+=3){var h=t[r];var f=t[r+1];var p=t[r+3];var d=t[r+4];if(hi({x:l,y:s},{x:c,y:u},{x:f,y:h},{x:d,y:p},a,!0))return!0}}return!1}function ti(t,e){var i=e.cb,r=e.Na,n=r.length,o=i.X,a=o.length,s=t.cb.X,l=s.length;if(si(t,i))return!0;for(i=0;i<a;i+=3)if(pi(t,o[i],o[i+1]))return!0;for(i=0;i<l;i+=3)if(pi(e,s[i],s[i+1]))return!0;for(i=0;i<n;i++)if(si(t,r[i]))return!0;return!1}function ui(t){ui.l.constructor.call(this,t)}u(ui,jh);t("H.geo.MultiPolygon",ui);ui.prototype.a=function(t){return C(t,P)};ui.prototype.qb="Multi"+P.prototype.qb;ui.prototype.Mb="Multi"+P.prototype.Mb;function qh(t,e,i){this.paths=this.a=t;e!==B&&(this.interiorsIndex=this.b=e);i!==B&&(this.outlinesIndex=this.c=i)}qh.prototype.interiorsIndex=qh.prototype.b=Td;qh.prototype.outlinesIndex=qh.prototype.c=Td;var ch=pc(new qh([])),vi=oc([]);function wi(t,e){var i=e&&(+e.extrusion||+e.extrude),r=e&&+e.elevation,n=0;wi.l.constructor.call(this,!0,e);0<r&&(n+=r,this.f=r);0<i&&(n+=i,this.i=i);if(n>xi)throw new je(wi,n,[0,xi]);C(t,L)?this.da(new P(t)):this.da(t)}u(wi,dh);t("H.map.Polygon",wi);wi.prototype.i=0;wi.prototype.f=0;wi.prototype.eb=y;var xi=2047;wi.MAX_EXTRUDE_HEIGHT=xi;wi.prototype.Ai=function(t){var e=+t;if(e!==t)throw new D(this.Ai,0,t);if(0>e||this.f+e>xi)throw new je(this.Ai,this.f+e,[0,xi]);this.i=e;this.ua(Mg.SPATIAL)};wi.prototype.setExtrusion=wi.prototype.Ai;wi.prototype.xm=function(){return this.i};wi.prototype.getExtrusion=wi.prototype.xm;wi.prototype.zi=function(t){var e=+t;if(e!==t)throw new D(this.zi,0,t);if(0>e||this.i+e>xi)throw new je(this.zi,this.i+e,[0,xi]);this.f=e;this.ua(Mg.SPATIAL)};wi.prototype.setElevation=wi.prototype.zi;wi.prototype.vm=function(){return this.f};wi.prototype.getElevation=wi.prototype.vm;wi.prototype.ba=function(){return this.eb};wi.prototype.getGeometry=wi.prototype.ba;wi.prototype.da=function(t){if(t===y||C(t,P))var e=!1;else C(t,ui,this.da,0),e=!0;this.sd=e;e=this.eb;this.eb=t;e!==y&&this.ua(Mg.SPATIAL);return this};wi.prototype.setGeometry=wi.prototype.da;wi.prototype.F=function(){return this.ba().F()};wi.prototype.getBoundingBox=wi.prototype.F;wi.prototype.Sd=function(t){var e,i=this.ba(),r,n;if(this.sd){i=i.oa;var o=0;for(n=i.length;o<n;o++)if(r=yi(this,i[o],t,i[o].vd))e||(e=[]),e.push(r)}else r=this.Xa,r===B&&(r=this.sd?ni.NORTH:this.ba().vd),(r=yi(this,i,t,r))&&(e=[r]);return e};wi.prototype.getGeometriesForTile=wi.prototype.Sd;function yi(t,e,i,r){var n,o,a=0,s=!0;if(n=zi(t,e.cb,i,r,e.F())){var l=new qh(n);var u=e.Na;if(o=u.length)for(l.b=l.a.length;a<o;a++)if(n=zi(t,u[a],i,r,e.Hj(a)))l.a=l.a.concat(n);o=l.a.length;for(a=0;a<o;a++)if(l.a[a]!==vi){s=!1;break}s&&(l=a%2?ch:B)}return l}function zi(t,e,i,r,n){var o=i.Qe(),a=n,s=a.Eb();var l=[[]];var u=e.X;var c=[],h=u.length,f,p=!1;for(f=0;f<h;f+=3){var d=u[f];var y=u[f+1];p||180!=Ad(y)||(c.push(d),c.push(y),c.push(d),c.push(-y),p=!0);c.push(d);c.push(y)}u=c;360>s&&-180==a.ca&&(a=new K(a.ka,180,a.ma,a.ga));360>s&&180==a.ga&&(a=new K(a.ka,a.ca,a.ma,-180));if(a.Fb()){s=u;d=s.length;u=-1;for(c=0;c<d-2;c+=2)if(Vf(s[c+1],s[c+3])){u=c+2;break}-1===u&&Vf(s[d-1],s[1])&&(u=d);-1!==u&&(h=s[u-2],c=s[u-1],f=s[u%d],p=s[(u+1)%d],180!==Ad(h)&&180!==Ad(f)&&(y=Ad(f-h),d=Ad(p-c),d+=180<d?-360:0,p=Ad(180-p),p+=180<p?-360:0,d&&p&&(y/=Ad(d)/Ad(p),h=f+(f>h?-y:y),c=0<c?180:-180,s.splice(u,0,h,c,h,-c))));u=s}l[0]=Ai([].concat(u),a.ca);360>a.Eb()&&a.Ld(new Xf(a.ka,180))&&(u=Ai([].concat(u),a.ga),l.push(u));a=i.Vf();t=eh(t,l,!0,a);if(360===n.Eb()&&1===e.qh(!0)%2){e=t;t=i.Qe();e[0][1].x>e[0][e[0].length-1].x&&(e[0]=e[0].reverse());u=[];s=e[0].length-1;for(l=0;l<s;l++)c=e[0][l],u[l]=new I(c.x-2*a.w,c.y),u[l+s]=new I(c.x-a.w,c.y),u[l+2*s]=new I(c.x,c.y),u[l+3*s]=new I(c.x+a.w,c.y),u[l+4*s]=new I(c.x+2*a.w,c.y);e[0]=u;l=a.Nh(r,0);l.y=2*t[r===ni.NORTH?"top":"bottom"];r=l.clone();l.x=e[0][e[0].length-1].x+1;r.x=e[0][0].x-1;e[0].push(l,r);t=e}r=o.left;e=o.top;l=o.right;o=o.bottom;if(ph(t,r,e,l,o,!0).length){if(!i.Tf().Yg(n)){i=t;n=[new I(r,e),new I(l,e),new I(l,o),new I(r,o)];o=[];for(t=i.length;t--;)if(r=ci(n,i[t]))for(e=Bi(r),o.push(e);r.gi;)r=r.gi,e=Bi(r),o.push(e);t=o}}else i=Ci(r,e,t[0]),t[1]&&(i^=Ci(r,e,t[1])),t=i?[vi]:B;return t}function Ci(t,e,i){var r,n,o;var a=r=i[0].x;var s=n=i[0].y;var l=1;for(o=i.length;l<o;l++){var u=i[l].x;var c=i[l].y;u>r?r=u:u<a&&(a=u);c>n?n=c:c<s&&(s=c)}return a<=t&&t<=r&&s<=e&&e<=n&&ce({x:t,y:e},de(i.concat(i[0])))}function Bi(t){var e=[],i=t;do{var r=xd(100*(i.no?i.no:i.x))/100;var n=xd(100*(i.oo?i.oo:i.y))/100;if(!o||.01<Cd(Dd(o.x-r,2)+Dd(o.y-n,2))){var o=new I(r,n);e.push(o)}i=i.next}while(i&&i!==t);return e}wi.prototype.T=y;function Ai(t,e){var i,r=Number.POSITIVE_INFINITY,n=-1,o=t.length;for(i=0;i<o;i+=2){var a=Ad(t[i+1]-e);a+=180<a?360-a:a;a<r&&(r=a,n=i)}return 0<i?(e=t.splice(n,t.length-n),e.concat(t)):t}wi.prototype.W=function(){var t=wi.l.W.call(this),e=this.ba(),i=this.sd?e.oa:[e],r,n=t.properties;var o=t.geometry=e.W();n.style=this.ta().W();n.height=this.i+this.f;n.min_height=this.f;if(this.F().Fb()&&(o.type="MultiPolygon",this.sd)){var a=[];i.forEach(function(t,e){r=o.coordinates[e];t.F().Fb()?a=a.concat(r):a.push(r)});o.coordinates=a}return t};wi.prototype.forWorkerMessage=wi.prototype.W;function Di(t,e,i){Di.l.constructor.call(this,ih,i);this.yg(t);this.Ji(e);i&&"precision"in i&&this.Hi(i.precision)}u(Di,wi);t("H.map.Circle",Di);Di.prototype.yg=function(t){(t=Zf(t)).na(this.b)||(this.b=t,Ei(this))};Di.prototype.setCenter=Di.prototype.yg;Di.prototype.lb=function(){return this.b};Di.prototype.getCenter=Di.prototype.lb;Di.prototype.Ji=function(t){if(E(t=Yd(t,0,6371000.79*Md/2)))throw new D(this.Ji,0,t);this.fa!==t&&(this.fa=t,Ei(this))};Di.prototype.setRadius=Di.prototype.Ji;Di.prototype.en=function(){return this.fa};Di.prototype.getRadius=Di.prototype.en;Di.prototype.O=60;Di.prototype.Hi=function(t){if(!Cc(t))throw new D(this.Hi,0,t);this.O!==(t=Yd(xd(t),4,360))&&(this.O=t,Ei(this))};Di.prototype.setPrecision=Di.prototype.Hi;Di.prototype.bn=function(){return this.O};Di.prototype.getPrecision=Di.prototype.bn;Di.prototype.da=function(){return this};Di.prototype.setGeometry=Di.prototype.da;Di.prototype.ba=function(){this.eb||Di.l.da.call(this,Fi(this));return this.eb};Di.prototype.getGeometry=Di.prototype.ba;function Ei(t){t.eb!==y&&Di.l.da.call(t,Fi(t))}function Fi(t){var e=t.b,i=e.lat,r=t.fa,n=0,o=new L;if(90===Ad(i))for(i=e.Eg(0,r,!0).lat;360>n;n+=120)o.vi(i,n-180,B);else for(t=t.O,t=360/t;360>n;n+=t)o.xd(e.Eg(n,r,!0));e=new P(o);0>i&&e.dl(ni.SOUTH);return e}function Gi(t,e){if(!C(t,Element)){Hi.innerHTML=t;t=Hi.firstElementChild;if(!t)throw new D(Gi,0,"No element data");Hi.removeChild(t);var i=!0;Hi.innerHTML=""}this.a=0!==hf(t).length;this.c=i?t:jf(t,x.document,this.a);e&&(i="onAttach",i in e&&wc(t=e[i],"Function",Gi,1,i)&&(this.hi=t),i="onDetach",i in e&&wc(t=e[i],"Function",Gi,1,i)&&(this.b=t))}t("H.map.DomIcon",Gi);var Hi=document.createElement("DIV");Gi.prototype.hi=null;Gi.prototype.b=null;Gi.prototype.Ij=function(t){return jf(this.c,t,this.a)};Gi.prototype.a=!1;function Ii(t){Ii.l.constructor.call(this,t)}u(Ii,jh);t("H.geo.MultiPoint",Ii);Ii.prototype.a=function(t){return Yf(t)};Ii.prototype.b=function(t){return C(t,Xf)?t:Zf(t)};Ii.prototype.qb="Multi"+Xf.prototype.qb;Ii.prototype.Mb="Multi"+Xf.prototype.Mb;function Ji(t,e){this.w=+t;this.h=+e}t("H.math.Size",Ji);function Ki(t,e){var i;var r=t;var n=e||[];if(t!==Li.NONE){e=i=n.length;if(-1===this.b.indexOf(r))throw new D(Ki,0,t);if(!n)throw new D(Ki,1,n);for(;i--;)if(E(n[i]))throw new D(Ki,1,n);r===Li.RECT&&3<e&&(n=[n[0],n[1],n[2],n[1],n[2],n[3],n[0],n[3]],r=Li.POLYGON);if(r===Li.CIRCLE&&2<e&&(t=n[2],0<t)){r=n[0];var o=n[1];i=vd(2*zd(t),40);var a=360/i;for(n=[];i--;){var s=a*i*Rd;n.push(r+Fd(s)*t,o+Hd(s)*t)}r=Li.POLYGON}if(r!==Li.POLYGON||!e||n.length%2)throw new D(Ki,1,n);this.a=n}}t("H.map.HitArea",Ki);var Li={NONE:0,RECT:1,CIRCLE:2,POLYGON:3};Ki.ShapeType=Li;Ki.prototype.b=[Li.RECT,Li.CIRCLE,Li.POLYGON];Ki.prototype.$f=function(t,e,i){return this.a?be(t,e,this.a,i,!0):ae.NONE};Ki.prototype.hitTest=Ki.prototype.$f;function Mi(t,e){var i;uc(this,Mi);Mi.l.constructor.call(this,e);this.da(t);e&&"icon"in e&&(i=e.icon);this.Oc(i||Ni(this))}u(Mi,M);t("H.map.AbstractMarker",Mi);Mi.prototype.ba=function(){return this.b};Mi.prototype.getGeometry=Mi.prototype.ba;Mi.prototype.da=function(t){var e=this.b;C(t,Xf)||C(t,Ii)?this.b=t:(Yf(t,this.da,0),this.b=Zf(t));e&&this.ua(Mg.SPATIAL);return this};Mi.prototype.setGeometry=Mi.prototype.da;Mi.prototype.F=function(){return this.b.F()};Mi.prototype.zb=function(){return this.icon};Mi.prototype.getIcon=Mi.prototype.zb;Mi.prototype.Oc=function(t){var e=this.icon,i=!e;if(e!==t){if(!this.dk(t)){if(i)throw new D(this.constructor,1,t);throw new D(this.Oc,0,t)}this.icon=t;i||this.ua(Mg.VISUAL)}return this};Mi.prototype.setIcon=Mi.prototype.Oc;function Ni(t){var e=t.g;e||(e=t.constructor.prototype.g=t.f(Oi));return e}var Oi={svg:'<svg xmlns="http://www.w3.org/2000/svg" width="38" height="47" viewBox="0 0 38 47"><g fill="none"><path fill="#0F1621" fill-opacity=".4" d="M15 46c0 .317 1.79.574 4 .574s4-.257 4-.574c0-.317-1.79-.574-4-.574s-4 .257-4 .574z"></path><path fill="#01b6b2" d="M33.25 31.652A19.015 19.015 0 0 0 38 19.06C38 8.549 29.478 0 19 0S0 8.55 0 19.059c0 4.823 1.795 9.233 4.75 12.593L18.975 46 33.25 31.652z"></path><path fill="#6A6D74" fill-opacity=".5" d="M26.862 37.5l4.714-4.77c3.822-3.576 5.924-8.411 5.924-13.62C37.5 8.847 29.2.5 19 .5S.5 8.848.5 19.11c0 5.209 2.102 10.044 5.919 13.614l4.719 4.776h15.724zM19 0c10.493 0 19 8.525 19 19.041 0 5.507-2.348 10.454-6.079 13.932L19 46 6.079 32.973C2.348 29.495 0 24.548 0 19.04 0 8.525 8.507 0 19 0z"></path></g></svg>',size:new Ji(38,47),anchor:new I(19,45),hitArea:new Ki(Li.POLYGON,[19,46,2,27,0,18,5,6,19,0,32,5,38,15,36,27,19,47])};Mi.prototype.W=function(){var t=Mi.l.W.call(this),e=this.zb(),i=e.Bb(),r=e.nd();t.geometry=this.ba().W();i&&(e=t.properties.icon={id:e.uid},e.size={w:i.w,h:i.h},e.offset=[i.w/2-(r?r.x:0),i.h/2-(r?r.y:0)]);return t};Mi.prototype.forWorkerMessage=Mi.prototype.W;function Pi(t,e){Pi.l.constructor.call(this,t,e)}u(Pi,Mi);t("H.map.DomMarker",Pi);Pi.prototype.type=Pg.DOM_MARKER;Pi.prototype.Fg=2;Pi.prototype.f=function(t){var e=new Gi(t.svg,t);t=t.anchor;e.c.style.margin=-t.y+"px 0 0 -"+t.x+"px";return e};Pi.prototype.dk=function(t){return C(t,Gi)};function Qi(t,e,i,r){Qi.l.constructor.call(this,t,e,i);this.modifiers=r}u(Qi,Ng);t("H.map.ChangeEvent",Qi);var Ri={SIZE:1,POSITION:2,HEADING:4,TILT:8,INCLINE:16,ZOOM:32,BOUNDS:64};Qi.Type=Ri;Qi.prototype.Cl=Ri.SIZE;Qi.prototype.SIZE=Qi.prototype.Cl;Qi.prototype.hj=Ri.POSITION;Qi.prototype.POSITION=Qi.prototype.hj;Qi.prototype.bj=Ri.HEADING;Qi.prototype.HEADING=Qi.prototype.bj;Qi.prototype.jj=Ri.TILT;Qi.prototype.TILT=Qi.prototype.jj;Qi.prototype.cj=Ri.INCLINE;Qi.prototype.INCLINE=Qi.prototype.cj;Qi.prototype.kj=Ri.ZOOM;Qi.prototype.ZOOM=Qi.prototype.kj;Qi.prototype.Zi=Ri.BOUNDS;Qi.prototype.BOUNDS=Qi.prototype.Zi;function Si(){this.a=[];Si.l.constructor.call(this)}u(Si,F);t("H.util.OList",Si);function Ti(t,e,i){t=t.a.length;if(i)var r=t;else if(E(r=0>(r=+e)?wd(0,t+r):vd(t,r)))throw new je(Si,e,[0,t-1]);return r}Si.prototype.add=function(t,e){e=Ti(this,e,E(e));this.a.splice(e,0,t);this.dispatchEvent(new Ui(this,this.b.pe,e,t,null,null))};Si.prototype.add=Si.prototype.add;function Vi(t,e){var i=t.a.splice(e,1)[0];t.dispatchEvent(new Ui(t,t.b.re,e,null,i,null));return i}Si.prototype.oc=function(t){this.get(t);return Vi(this,t)};Si.prototype.removeAt=Si.prototype.oc;Si.prototype.remove=function(t){t=this.indexOf(t);return 0<=t?(Vi(this,t),!0):!1};Si.prototype.remove=Si.prototype.remove;Si.prototype.set=function(t,e){if(0!==this.a.length||0!==t){this.get(t);t=Ti(this,t,!1);var i=this.a[t]}this.a[t]=e;this.dispatchEvent(new Ui(this,this.b.se,t,e,i,null));return i};Si.prototype.set=Si.prototype.set;Si.prototype.indexOf=function(t){return this.a.indexOf(t)};Si.prototype.indexOf=Si.prototype.indexOf;Si.prototype.get=function(t){var e=Ti(this,t,!1),i=this.a;if(e>=i.length)throw new je(this.get,t,[0,i.length-1]);return i[e]};Si.prototype.get=Si.prototype.get;Si.prototype.Mm=function(){return this.a.length};Si.prototype.getLength=Si.prototype.Mm;Si.prototype.La=function(){return[].concat(this.a)};Si.prototype.asArray=Si.prototype.La;Si.prototype.flush=function(){for(var t=this.a.length;t--;)Vi(this,t)};Si.prototype.flush=Si.prototype.flush;Si.prototype.u=function(){this.flush();Si.l.u.call(this)};Si.prototype.b={pe:"add",re:"remove",se:"set",Yo:"move"};function Ui(t,e,i,r,n,o){Ui.l.constructor.call(this,e,t);this.idx=i;this.added=r;this.removed=n;this.moved=o}u(Ui,rd);var Wi={};t("H.geo.mercator",Wi);Wi.a=function(t){return vd(1,wd(0,.5-Bd(Id(Od+Nd*t/180))/Md/2))};Wi.b=function(t){return t/360+.5};Wi.dg=function(t,e,i){i?(i.x=Wi.b(e),i.y=Wi.a(t)):i=new I(Wi.b(e),Wi.a(t));return i};Wi.latLngToPoint=Wi.dg;Wi.Nb=function(t,e){return Wi.dg(t.lat,t.lng,e)};Wi.geoToPoint=Wi.Nb;Wi.f=function(t){return 0>=t?90:1<=t?-90:Sd*(2*Jd(Ed(Md*(1-2*t)))-Nd)};Wi.c=function(t){return 360*(1===t?1:Wd(t,1))-180};Wi.Pa=function(t,e,i){i?(i.lat=Wi.f(e),i.lng=Wi.c(t)):i=new Xf(Wi.f(e),Wi.c(t));return i};Wi.xyToGeo=Wi.Pa;Wi.og=function(t,e){return Wi.Pa(t.x,t.y,e)};Wi.pointToGeo=Wi.og;t("H.util.constants.DEFAULT_MIN_ZOOM_LEVEL",0);t("H.util.constants.DEFAULT_MAX_ZOOM_LEVEL",22);function Xi(t,e){this.projection=t||Wi;this.b=0;this.a=this.exp=Bd(e||256)/Ld;Yi(this);this.y=this.x=0}t("H.geo.PixelProjection",Xi);var Zi=Ad(24)+Ad(-8);Xi.prototype.Kk=Wi;Xi.prototype.projection=Xi.prototype.Kk;Xi.prototype.x=0;Xi.prototype.x=Xi.prototype.x;Xi.prototype.y=0;Xi.prototype.y=Xi.prototype.y;Xi.prototype.Ro=Dd(2,Zi);Xi.prototype.w=Xi.prototype.Ro;Xi.prototype.yn=Dd(2,Zi);Xi.prototype.h=Xi.prototype.yn;Xi.prototype.Fa=function(t){if(E(t))throw new D(this.Fa,0,t);var e=this.x/this.w;var i=this.y/this.h;this.b=t;this.a=this.exp+t;Yi(this);this.x=e*this.w;this.y=i*this.h};Xi.prototype.rescale=Xi.prototype.Fa;function Yi(t){t.a>Zi&&(t.a=Zi);t.w=Dd(2,t.a);t.h=Dd(2,t.a)}Xi.prototype.Tj=function(){return this.b||0};Xi.prototype.getZoomScale=Xi.prototype.Tj;Xi.prototype.kb=function(t,e){t=this.projection.dg(t.lat,t.lng,e);t.x=t.x*this.w-this.x;t.y=t.y*this.h-this.y;return t};Xi.prototype.geoToPixel=Xi.prototype.kb;Xi.prototype.Ze=function(t,e){return this.projection.Pa((t.x+this.x)/this.w,(t.y+this.y)/this.h,e)};Xi.prototype.pixelToGeo=Xi.prototype.Ze;Xi.prototype.Pa=function(t,e,i){return this.projection.Pa((t+this.x)/this.w,(e+this.y)/this.h,i)};Xi.prototype.xyToGeo=Xi.prototype.Pa;Xi.prototype.Nh=function(t,e,i){t=this.projection.dg(t,e,i);t.x=t.x*this.w-this.x;t.y=t.y*this.h-this.y;return t};Xi.prototype.latLngToPixel=Xi.prototype.Nh;Xi.prototype.ed=function(t){return new I(t.x*this.w-this.x,t.y*this.h-this.y)};Xi.prototype.pointToPixel=Xi.prototype.ed;function $i(t){t=t||{};$i.l.constructor.call(this);this.min=0;this.max=22;this.Rl=this.dark=!!t.dark;t.min&&this.Ei(t.min);t.max&&this.Ci(t.max);this.pixelProjection=new Xi(t.projection,t.minWorldSize);t.provider&&(this.a=t.provider,this.g=A(this.g,this),this.a.addEventListener(aj.prototype.g.Da,this.g,!1,this),this.i=A(this.i,this),this.a.addEventListener(aj.prototype.g.qe,this.i,!1,this))}u($i,F);t("H.map.layer.Layer",$i);$i.prototype.min=0;$i.prototype.min=$i.prototype.min;$i.prototype.max=22;$i.prototype.max=$i.prototype.max;$i.prototype.U=y;$i.prototype.pixelProjection=$i.prototype.U;$i.prototype.b={Da:"update",qe:"configchange",gj:"minchange",fj:"maxchange"};$i.prototype.pa=function(){return this.a};$i.prototype.getProvider=$i.prototype.pa;$i.prototype.Jn=function(t){return this.min<=t&&t<=this.max};$i.prototype.isValid=$i.prototype.Jn;function bj(t,e,i){var r=t[e],n="min"===e,o=n?t.Ei:t.Ci;if(i!==r)if(n?i<=t.max:i>=t.min)t[e]=i,t.g(),t.i(),t.dispatchEvent(new Ng(n?t.b.gj:t.b.fj,i,r));else throw new D(o,0,"Invalid condition min <= max");return t}$i.prototype.Ei=function(t){return bj(this,"min",+t)};$i.prototype.setMin=$i.prototype.Ei;$i.prototype.Ci=function(t){return bj(this,"max",+t)};$i.prototype.setMax=$i.prototype.Ci;$i.prototype.g=function(){this.dispatchEvent(this.b.Da)};$i.prototype.i=function(){this.dispatchEvent(this.b.qe)};$i.prototype.u=function(){$i.l.u.call(this)};$i.prototype.sa=function(){return null};$i.prototype.getCopyrights=$i.prototype.sa;function cj(t){var e;cj.l.constructor.call(this);this.dispatchEvent=A(this.dispatchEvent,this);if(t){var i=t.length;for(e=0;e<i;e++)this.add(t[e])}}u(cj,Si);t("H.map.DataModel",cj);function dj(t,e){var i=e.getProvider&&e.getProvider();i&&(ej[i.uid]=i);e.ja(t)}function fj(t){var e=t.getProvider&&t.getProvider();e&&delete ej[e.uid];t.ja(null)}cj.prototype.add=function(t,e){C(t,$i,this.add,0);dj(this,t);cj.l.add.call(this,t,e)};cj.prototype.add=cj.prototype.add;cj.prototype.set=function(t,e){C(e,$i,this.set,0);dj(this,e);(t=cj.l.set.call(this,t,e))&&fj(t);return t};cj.prototype.set=cj.prototype.set;cj.prototype.oc=function(t){var e;(e=cj.l.oc.call(this,t))&&fj(e);return e};cj.prototype.removeAt=cj.prototype.oc;cj.prototype.remove=function(t){var e;(e=cj.l.remove.call(this,t))&&fj(t);return e};cj.prototype.remove=cj.prototype.remove;cj.prototype.flush=function(){for(var t=this.a.length;t--;)this.oc(t);cj.l.flush.call(this)};cj.prototype.flush=cj.prototype.flush;var ej={};Fc(ej);function gj(t,e,i){if(t=ej[t])return C(t[e],Function,gj,1,"invalid method"),t[e].apply(t,i)}cj.invoke=gj;function hj(t,e){Ca(t)&&(this.i=t);Cc(e)&&(this.a=e)}t("H.util.Request",hj);hj.State={PENDING:0,PROCESSING:1,COMPLETE:2,CANCELLED:3,ERROR:4};var ij=[0,1,2,3,4];hj.prototype.A=0;hj.prototype.getState=function(){return this.A};hj.prototype.getState=hj.prototype.getState;hj.prototype.P=function(t){if(0>ij.indexOf(t))throw new D(this.P,0,t);if(this.A!==t||1===t&&1<this.a)this.A=t,this.i&&this.i(this)};hj.prototype.a=1;hj.prototype.qn=function(){return this.a};hj.prototype.getTotal=hj.prototype.qn;hj.prototype.b=0;hj.prototype.cn=function(){return this.b};hj.prototype.getProcessed=hj.prototype.cn;hj.prototype.g=0;hj.prototype.ym=function(){return this.g};hj.prototype.getFailed=hj.prototype.ym;function jj(t,e){t.b<t.a&&(tc(e)||(e=2),0===e||1===e||0!==t.A&&1!==t.A||(t.b++,2!==e&&t.g++,t.P(t.b<t.a?1:2)))}hj.prototype.we=function(){};hj.prototype.cancel=function(){3!==this.A&&(this.we(),this.P(3))};hj.prototype.cancel=hj.prototype.cancel;function kj(){}t("H.util.ICapturable",kj);kj.prototype.capture=function(){};kj.prototype.capture=kj.prototype.capture;t("H.util.Disposable",nd);nd.prototype.wb=nd.prototype.wb;nd.prototype.addOnDisposeCallback=nd.prototype.wb;t("H.util.dispose",qd);function lj(t,e){var i=t.G(),r=i.ownerDocument;lj.l.constructor.call(this);this.a=t;this.S=i=i.appendChild(mj(r,"DIV","position:absolute;bottom:0;right:0;left:0px;z-index:1;direction:ltr;pointer-events:none;height:40px-webkit-touch-callout: none;-webkit-user-select:none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select:none;",null,"H_imprint"));this.Bf=mj(r,"DIV","margin: 0 0 "+nj+"px "+nj+"px;display:inline-block;",oj,"H_logo");i.appendChild(this.Bf);i=i.appendChild(mj(r,"DIV","right:0;bottom:0;position:absolute;background-color:rgba(255,255,255,.8);color:#0F1621;padding:2px 16px",null,"H_copyright"));this.g=i.appendChild(mj(r,"A","color:inherit; margin:0px 8px; text-decoration:none; pointer-events:all;","Terms of use"));this.g.target="_blank";this.f=i.appendChild(mj(r,"SPAN","margin:0px 8px"));this.j=Ua(pj);this.Fi(e);this.c=A(this.c,this);this.b=A(this.b,this);this.a.addEventListener(this.a.o.ej,this.c);this.a.a.addEventListener("add",this.b);this.a.a.addEventListener("remove",this.b);this.a.a.addEventListener("set",this.b);this.b()}var qj;u(lj,nd);t("H.map.Imprint",lj);var nj=16,pj={font:'11px "Lucida Grande", Arial, Helvetica, sans-serif',href:"https://legal.here.com/{LN}/terms/serviceterms/{CN}",invert:!1,reportHref:"https://wego.here.com/",locale:"en-US"};lj.prototype.Fi=function(t){var e,i=this.Bf.firstChild.firstChild.childNodes;t||(this.j=Ua(pj));var r=this.j;for(e in r)t&&e in t&&(r[e]=t[e]);t=(this.Jh=t=r.invert)?rj:sj;i[0].style.fill=t.jl;i[0].style.fillOpacity=t.kl;i[1].style.fill=t.ol;i[1].style.fillOpacity=t.pl;t=r.locale;tj[t]||(t="en-US",r.locale=t);this.g.innerHTML=tj[t];t=t.split("-");this.g.href=r.href.replace("{LN}",t[0]).replace("{CN}",t[1].toLowerCase());this.S.style.font=r.font};lj.prototype.setOptions=lj.prototype.Fi;function mj(t,e,i,r,n){t=t.createElement(e);i&&(t.style.cssText=i);r&&(t.innerHTML=r);n&&(t.className=n);return t}lj.prototype.G=function(){return this.S};lj.prototype.c=function(){this.f.innerHTML=this.i+" "+this.sa()};lj.prototype.b=function(){this.c();setTimeout(this.c,5e3)};var oj='<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>',sj={ol:"#0F1621",pl:.3,jl:"#fff",kl:.6},rj={ol:"#fff",pl:1,jl:"#0F1621",kl:.7},uj="1987&ndash;"+wd(2015,(new Date).getFullYear())+" HERE";lj.prototype.sa=function(){var t=this.a,e=t.tb(),i=t.b.sb().bounds;t=t.a;var r=t.a.length,n={},o=0,a,s,l,u=[uj];if(i)for(;o<r;o++)if(s=t.get(o).getCopyrights(i.F(),e))for(a=0;a<s.length;a++)n[l=s[a].label]||(u.push(l),n[l]=1);return u.join(", ")};lj.prototype.getCopyrights=lj.prototype.sa;lj.prototype.ta=function(){return this.S.style};lj.prototype.i=String.fromCharCode(169);lj.prototype.u=function(){this.a.removeEventListener(this.a.o.ej,this.c);this.a.a.removeEventListener("add",this.b);this.a.a.removeEventListener("remove",this.b);this.a.a.removeEventListener("set",this.b);if(this.S.parentNode){var t=this.S;t.parentNode.removeChild(t)}};lj.prototype.capture=function(t,e,i,r){var n=t.getContext("2d"),o=window.getComputedStyle(this.f.parentElement),a=2*Ac(o.paddingLeft,10),s=(this.f.offsetWidth+2*a)*e,l=this.f.offsetHeight*e,u=Bc(o.getPropertyValue("font-size")),c=this.S.ownerDocument,h=+t.width,f=+t.height,p=nj*e,d=this.Bf.childNodes[0].getBoundingClientRect(),y=d.width*e,g=d.height*e,v=id;Ca(r)&&(v=function(){r("capture_error")});n.fillStyle=o.backgroundColor;n.fillRect(h-s,f-l,s,l);s=this.i+" "+function(t){t=mj(c,"div",null,t);return t.textContent||t.innerText||""}(this.sa());n.font=u*e+"px "+o.getPropertyValue("font-family");n.fillStyle=o.getPropertyValue("color");n.textBaseline="bottom";n.textAlign="right";n.fillText(s,h-a*e,f);vj(this,n.font,function(e){new rf("image",e).then(function(e){n.drawImage(e,p,f-(g+p),y,g);i(t)},v)},v)};lj.prototype.capture=lj.prototype.capture;function vj(t,e,i,r){wj(A(function(t){t?this.Jh?i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAADNklEQVRYR82XW6hVVRSGv7+rmJfSMKSnSkMEfY7EogcJC7tilGRopBAiSaI+SBARQSCIIqgFISih2YW0oAgLCsKXojA0RB+81VugZEFZv/yHuWTt7d7Hfc4+6+h4OWefNfcc3xlj/v+YS1zjoab5bE8DZgGngB8keSg5GwO0PQ54F3i2BnQIWCLpx14hGwG0fT3wOfBwB5DzwOOSDvQC2RTgM8Ae4D/gaeA3YDdwN5AWvyxp+6gD2r4OmAq8AbwInAMmA/OAT4CbgBWStvYClzUjWkHbrwHLgF8LVHJ8DDxah7P9JHCil7M40oA/A7OBC8ANtSqlrQOVs30/8CWQat8r6cxg1RwRQNvPA88Bk4D7gJzBV4A5teSp5MlS4VuA/ZIeu1Kr+wa0/QTwIRDlRhT5eTswBvi2CKOd42AULilndNAYCcA7gK+BmbVMiyXtsh3Qt4FFBTgW8w6wXtLfV4LrSyS2FwAvAWOBX+JtwF0laUDmS/oun23fDNwJnJb0Ty9g1ZphVdB2qrK2LdFfBbb685/AIxXkUKDqa4cMaDs2kjalRe8Fola57J3qRQSJviGHA3gMuAdYI2lDUfDOArQLWAd8VTuTOW9vjUoFy6TIGYpS9wKfAjuK5wVuSfn91iKcvZJeHy5ci0hsZwzNk5Qh3xIFbLyks7aPAtPLgv+L4VZwDwLvA6uKz6XdfcVAi22PBz4q4+lVSRurXW2vKYKIZfwEHCmmXC35HngAyITYD0ys2t8XWflyBfhmvKm24QCk7aVFCPVc7WMszzKucknI+NoHPCUppt13VICZm2nNwjoksByY0SXL72Vi3FieZ97mgrpyqF432H9xScW2O0H+W6oSE/4D2FYuA9kzlUzVTwO3Ad9IOtx3ydo2aLGZLpABm5KW2Z4AfAbMLfsEcpGkKLqRuMwHu0CukrSpCCrvGlF6hBEVL5MUw24kOhp1B8gc+FTqgxpkFLuzSbjk6jpJOkC2tDPeKCkVbDRkO67fDTTC2VK7vgfyBUlfNEpV2zyAK4HNXRLmZfshScdHC6g9T+WDGU2XpkdZdNXhWs6g7dXAhmsJ7jKR2M77bG4kV7Wt9TZfBLgYEC7PSpcIAAAAAElFTkSuQmCC"):i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIMSURBVFiFzdZPiE1RGADwXzPTTPIMQoodVpbKgpoUG5qExUi8DSVJQv4slJJsbNjYWFhNETWLUUosRDRLUVLCYhIiojFojHkW997uvefNGIuZc99Xp/fOO6/Or++c75xDi0d7hDlWYQNqeB9hvv+OGq6jUWjPsKZKVBbtuKOMy9p3bKqOlsROCWYc27AWr9PfJnCgKlgbluNqivmGDmzBrxR3sCocnMEw7sqXdEAzboeK9uLTFPVbed8VcesxglFJtqNEHbcxlIL68ChADuCSpEgauBULt11SDI3C5yJJdrLCCNsQumMBl+J5AKinY4slBfNTfsRcxJwYsK0YxD3J0r1RPut6Cv/twgp0xoDBBc3LNhr0RwJktNifAn7gsnLmsuxVinyVTn4i7dcLoH4sU96Tp2Pi2uSVehN75Gdev+QO7pIXztmZnLwTvf+AzU+/v5Rn50+A24gP2IW5M4mbJ7+ejgVjJ/EpHXuCa8p77nGK68FX5eWfsTgfTJoh92qu1vAaa+CtPJuDZuEh3CHZUyHyxSSYrL3DWKE/gStm8aybDDkmKYperJM/BrJMnsJuHMLq2YJNh/wsX7JuPAyQfTFg0yGPFMZreCCv4n2xgTQjxyXP+CxquK8iXBYhMlzOtliQBVg4RVuCG/iSto/YHAuWxWFTHyXDWBkbNFkc1cK4LI5rYVwW57QY7i/pZeJv8QQJRQAAAABJRU5ErkJggg=="):(t=this.Bf.cloneNode(!0),t.firstChild.setAttribute("style","font:"+e),i($e(t.innerHTML)))},t),r)}lj.prototype.Jh=!1;function wj(t,e){var i="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(oj),r=qj;tc(r)?t(r):new rf("image",i).then(function(e){We.drawImage(e,0,0);try{We.getImageData(0,0,1,1),r=!1}catch(t){r=18===t.code}finally{qj=r,t(r)}},e)}var tj={"de-DE":"Nutzungsbedingungen","en-US":"Terms of use","en-GB":"Terms of use","es-ES":"Condiciones de uso","fi-FI":"Palveluehdot","fr-FR":"Conditions d'utilisation","it-IT":"Condizioni di utilizzo","nl-NL":"Dienstvoorwaarden","pl-PL":"Warunki świadczenia usługi","pt-BR":"Termos de serviço","pt-PT":"Termos do serviço","ru-RU":"Условия использования","tr-TR":"Servis Koşulları","zh-CN":"使用条款"};function Q(t){var e={};this.i=e.previousSibling=e.nextSibling=e;this.j=new af;Q.l.constructor.call(this,t);t&&"objects"in t&&this.ec(t.objects)}u(Q,M);t("H.map.Group",Q);Q.prototype.type=Pg.GROUP;Q.prototype.me=function(t,e){this.f=!0;t=Q.l.me.call(this,t,e);this.f=!1;t&&this.forEach(xj,!0);return t};Q.prototype.setProvider=Q.prototype.me;function xj(t,e,i){t.me(i.a)}Q.prototype.contains=function(t){var e=this===t;if(!e&&this.b&&C(t,M))for(;!e&&t;)t===this?e=!0:t=t.Va;return e};Q.prototype.contains=Q.prototype.contains;Q.prototype.jf=function(){this.D=B;this.forEach(yj,!0)};Q.prototype.resetZInfo=Q.prototype.jf;function yj(t){t.jf()}Q.prototype.f=!1;Q.prototype.ua=function(t){var e=Q.l.ua.call(this,t);e&&!this.f&&(this.g=t,this.forEach(zj,!0),delete this.g);return e};Q.prototype.invalidate=Q.prototype.ua;function zj(t,e,i){t.ua(i.g)}Q.prototype.forEach=function(t,e,i){var r;if(this.b){var n=this.i;var o=n.nextSibling;for(r=0;o!==n;){var a=o.nextSibling;t.call(i,o,r++,this);e&&C(o,Q)&&o.forEach(t,e,i);o=a}}};Q.prototype.forEach=Q.prototype.forEach;Q.prototype.Ta=function(t){var e=[];this.forEach(Aj,t,e);return e};Q.prototype.getObjects=Q.prototype.Ta;Q.prototype.F=function(){var t=null;this.b&&this.forEach(function(e){(e=e.F())&&(t?t=t.mc(e):t=e)});return t};Q.prototype.getBoundingBox=Q.prototype.F;function Aj(t){this.push(t)}Q.prototype.b=0;Q.prototype.km=function(){return this.b};Q.prototype.getChildCount=Q.prototype.km;Q.prototype.ea=function(t){var e=this.i,i=e.previousSibling;C(t,M,this.ea,0);if(t.contains(this))throw new Yc(this.ea,"The new object contains the parent group");var r=t.Yf(!0);var n=t.Va;if(n!==this){if(n){n=t.previousSibling;var o=t.nextSibling;n.nextSibling=o;o.previousSibling=n}t.Va=this;M.l.ja.call(t,this);i.nextSibling=t;t.previousSibling=i;t.nextSibling=e;e.previousSibling=t;this.b++}t.Ni=this.j.next();t.jf();e=t.me(this.a,this.ea);t.Yf(!0)^r&&t.ua(Mg.VOLATILITY);e||t.ua(Mg.Z_ORDER);return t};Q.prototype.addObject=Q.prototype.ea;Q.prototype.ec=function(t){var e;yc(t,this.ec,0);var i=t.length;for(e=0;e<i;e++)this.ea(t[e])};Q.prototype.addObjects=Q.prototype.ec;Q.prototype.Ha=function(t){if(!t||t.Va!==this)throw new Yc(this.Ha,"object not found");var e=t.previousSibling,i=t.nextSibling;e.nextSibling=i;i.previousSibling=e;t.Va=null;M.l.ja.call(t,null);delete t.previousSibling;delete t.nextSibling;C(t.a,N)&&t.me(null,this.Ha);this.b--;return t};Q.prototype.removeObject=Q.prototype.Ha;Q.prototype.yd=function(t){var e;yc(t,this.yd,0);var i=t.length;for(e=0;e<i;e++)this.Ha(t[e])};Q.prototype.removeObjects=Q.prototype.yd;Q.prototype.ra=function(){var t=this.Ta();this.yd(t)};Q.prototype.removeAll=Q.prototype.ra;Q.prototype.Rc=function(t){for(var e=this.Ta(),i=0,r=e.length,n=[],o,a,s;i<r;i++)s=e[i],s instanceof Q?(o=t?t(s.getData()):s.getData(),a=Sg(this,o,!!t),o={type:"Feature"},o.properties=a,s.m&&(o.id=s.m),o.geometry={},o.geometry.type="GeometryCollection",o.geometry.geometries=Bj(this,s.Ta()),n.push(o)):n.push(s.Rc(t));return{type:"FeatureCollection",features:n}};Q.prototype.toGeoJSON=Q.prototype.Rc;function Bj(t,e){for(var i=0,r=e.length,n,o,a=[];i<r;i++)n=e[i],o={},n instanceof Q?(o.type="GeometryCollection",o.geometries=Bj(t,n.Ta())):o=n.ba().Rc(),a.push(o);return a}Q.prototype.W=function(){var t=Q.l.W.call(this);t.type="Group";return t};Q.prototype.forWorkerMessage=Q.prototype.W;function Cj(t,e,i,r,n){e&&(this.b=e);tc(i)&&(this.Rg=!!i);this.Rg&&r&&(this.Tg=new Ji(r.w,r.h));tc(n)&&(this.c={crossOrigin:n});switch(Dj[xc(t)]){case 2:this.wd=t;Ej(this,1);break;case 1:if(lf(t)){this.wd=t;Fj(this);Ej(this,1);break}t=t.src;case 0:if(t){t=$e(t);this.a=new rf("image",t,B,this.c);this.a.then(A(this.ko,this),A(this.jo,this));break}default:throw Ej(this,-1),new D(Cj,0,"No image data")}}n=Cj.prototype;n.A=0;n.getState=function(){return this.A};function Ej(t,e){t.A=e;delete t.a;t.b&&t.b(e,t)}n.Rg=!0;function Fj(t){if(t.Rg){var e=t.wd,i=Gj(t),r=i&&i.w||+e.width,n=i&&i.h||+e.height,o=Se();if(C(e,x.HTMLCanvasElement))i=e;else{i=e.ownerDocument.createElement("canvas");i.width=zd(r*o);i.height=zd(n*o);var a=i.getContext("2d");a.scale(o,o);a.drawImage(e,0,0,r,n);$c&&(a.clearRect(0,0,r,n),a.drawImage(e,0,0,r,n))}t.wd=i}}n.wd=y;n.getData=function(){return this.wd};var Dj={String:0,HTMLImageElement:1,HTMLCanvasElement:2};n=Cj.prototype;n.Tg=y;n.Bb=function(){return 1===this.A?Gj(this):y};function Gj(t){var e=t.Tg,i;if(!e){var r=t.wd;e=r.naturalWidth||r.width;if(0===e&&Ye&&1===Dj[xc(r)]){var n=!0;if(i=r.parentNode)var o=r.nextSibling;document.body.appendChild(r)}t.Tg=e=new Ji(r.naturalWidth||r.width,r.naturalHeight||r.height);n&&(i?i.insertBefore(r,o):document.body.removeChild(r))}return e}n.ko=function(t){this.wd=t;Fj(this);Ej(this,1)};n.jo=function(){Ej(this,-1)};n.cancel=function(){this.a&&this.a.cancel()};function Hj(t,e){var i,r="anonymous";this.uid=Ij.next();Hj.l.constructor.call(this);if(e){var n="size";if(n in e){var o=e[n];if(!o||isNaN(o.w)||isNaN(o.h))throw new D(Hj,1,n);this.c=new Ji(o.w,o.h)}n="anchor";if(n in e){o=e[n];if(!o||isNaN(o.x)||isNaN(o.y))throw new D(Hj,1,n);this.b=new I(o.x,o.y)}n="hitArea";n in e&&(o=e[n],C(o,Ki,Hj,1),this.g=e[n]);n="asCanvas";n in e&&(i=e[n]);n="crossOrigin";n in e&&(r=e[n]);o=e.stickHeight;o===+o&&0<o&&(this.Io=o);n="stickColor";o=e[n];n in e&&zc(o)&&(this.Ho=o)}t=new Cj(t,A(this.i,this),i,this.c,r);e=this.A=t.getState();0!==e?this.i(e,t):this.f=t}u(Hj,F);t("H.map.Icon",Hj);var Ij=new af;Hj.State={ERROR:-1,LOADING:0,READY:1};Hj.prototype.getState=function(){return this.A};Hj.prototype.getState=Hj.prototype.getState;Hj.prototype.i=function(t,e){this.a=e.getData();if(1===t){var i=this.c;i||(i=this.c=e.Bb());this.b||(this.b=new I(i.w/2|0,i.h))}this.f&&(this.A=t,delete this.f,this.dispatchEvent("statechange"))};Hj.prototype.a=y;Hj.prototype.Zc=function(){return this.a};Hj.prototype.getBitmap=Hj.prototype.Zc;Hj.prototype.c=y;Hj.prototype.Bb=function(){return this.c};Hj.prototype.getSize=Hj.prototype.Bb;Hj.prototype.b=y;Hj.prototype.nd=function(){return this.b};Hj.prototype.getAnchor=Hj.prototype.nd;Hj.prototype.g=y;Hj.prototype.Dm=function(){return this.g};Hj.prototype.getHitArea=Hj.prototype.Dm;Hj.prototype.u=function(){Hj.l.u.call(this);this.a?(this.a.removeAttribute("src"),delete this.a):(this.f.cancel(),delete this.f)};function Jj(t,e,i,r,n,o){Jj.l.constructor.call(this,isNaN(t)?15:t,e,i,r,n,o)}u(Jj,hg);Jj.prototype.m=function(t){for(var e,i,r,n=this.head;t;){if(e=t.entries)if(i=e.length){if(2>i&&(r=t.parent)&&1===r.a){r.removeChild(t);n===t&&(n=r);r.entries=e;t=e[0].node=r;continue}}else if(delete t.entries,r=t.parent)if(r.removeChild(t),n===t&&(n=r),1===r.a){t=r.a?r[0]||r[1]||r[2]||r[3]:null;continue}t=y}this.head!==n&&(this.head=n,mg(this))};Jj.prototype.Ec=function(t,e){if(rg(this.a,t,e,t,e))return Kj(this,this.a,t,e,this.c);throw Error("Coordinates out of bounds")};function Kj(t,e,i,r,n){var o=e.entries;if(n)if(e.a)o=Lj(t,e,i,r,n);else if(o){o=o[0];var a=pg(e,o[1]>=e[8]|(o[0]>=e[9])<<1);a.entries=e.entries;delete e.entries;o.node=a;mg(t,a);o=Lj(t,e,i,r,n)}else qg(e,o=new Mj(i,r)),mg(t,e),kg(t,o,!0);else o||mg(t,e),qg(e,o=new Mj(i,r)),kg(t,o,!0);return o}function Lj(t,e,i,r,n){return Kj(t,pg(e,i>=e[8]|(r>=e[9])<<1),i,r,n-1)}function Mj(t,e){this.id=og++;this[0]=e;this[1]=t}Mj.prototype.pd=function(t){return this[t%2]};function Nj(){this.a=new Jj(10,180,90,0,0,!0)}n=Nj.prototype;n.Rh=0;n.$c=function(){return this.Rh};n.R=null;n.F=function(){var t=this.R,e;!t&&(e=ig(this.a))&&(this.R=t=new K(-e[0],e[3],-e[2],e[1]));return t};n.Ec=function(t){++this.Rh;this.R=null;return this.a.Ec(t.lng,-t.lat)};n.remove=function(t){if(t=this.a.remove(t))--this.Rh,this.R=null;return t};n.ag=function(t,e,i){var r=this.a,n=t.Rb(),o=t.Ob(),a=-n.lat;n=n.lng;var s=-o.lat;o=o.lng;var l;t.Fb()?l=r.$a(-180,a,o,s,i,e).concat(r.$a(n,a,180,s,i,e)):l=r.$a(n,a,o,s,i,e);return l};function Oj(t,e,i){this.c=t;this.a=e;this.g=i;this.f=this.c&1?"function(){return sources[$source].isInMinMaxRange(feature, $zoom) && feature.ref.effectiveVisibility;}":B;this.b={}}function Pj(t,e,i,r){this.a=t;this.b=e;this.c=i;this.wf=r}function Qj(t,e,i,r){t={type:e,uid:t.b,tiled:i,max_zoom:t.c};r&&Wa(t,r);return t}function Rj(t){this.a=t}function Sj(t,e,i,r,n){this.a=t;this.b=e;this.c=i;this.f=r;this.wf=n}function Tj(t){if(t.a&32&&!(t.a&16))return{};var e=new Pj(t.a,t.b,t.c,t.wf);var i=new Rj(t.a);t=new Oj(t.a,t.b,t.f);var r={},n=e.b;e=e.a&1?Qj(e,"ObjectSource",!1,{progressiveUpdate:!0,has_volatile_data:!!(e.a&256)}):e.a&2?Qj(e,"RemoteRasterTileSource",!0,{url:""}):Qj(e,"ObjectTileSource",!0,{tile_size:e.wf});r[n]=e;e={};i.a&2&&(e={"translucent-raster":Lh("raster","inlay",1)});if(i.a&28){n=!!(i.a&64);var o={"translucent-polygons":Lh("polygons","inlay",2),"translucent-extruded-polygons":Lh("polygons","translucent",3),"translucent-pattern-lines":Lh("pattern-lines","translucent",4),"translucent-overlays":Lh("overlays","inlay",5),markers:Lh("custom_icons","overlay",6,!1)};o["translucent-polygons"].crop_by_tile=!!(i.a&128);o["translucent-pattern-lines"].crop_by_tile=n;o.markers.suppress_fade=!0;o.markers.stick=!0;Wa(e,o)}t.c&2&&(t.b["tile_layer_"+t.a]=Nh(t.a,"_default",{"translucent-raster":{color:[1,1,1,t.g],order:0}}));if(t.c&4){i={"translucent-pattern-lines":{color:Kh("strokeColor"),width:Kh("lineWidth * $meters_per_pixel"),join:Kh("lineJoin"),cap:Kh("lineCap"),tail_cap:Kh("lineTailCap"),head_cap:Kh("lineHeadCap"),miter_limit:Kh("miterLimit"),order:"function() { return 2 + feature.effectiveZIdx / 2; }",interactive:!0,dash:Kh("lineDash"),extrude:!0,dash_phase:Kh("lineDashOffset")}};n=t.b;o="polygon_layer_"+t.a;var a=Nh(t.a,"polygons",void 0,t.f);a.flat={filter:"function(){return !feature.height && !feature.min_height;}",draw:Mh(!1)};a.extruded={filter:"function(){return feature.height || feature.min_height;}",draw:Mh(!0)};n[o]=a;t.b["outline_layer_"+t.a]=Nh(t.a,"outlines",i,t.f);t.b["polyline_layer_"+t.a]=Nh(t.a,"polylines",i,t.f)}t.c&8&&(t.b["overlay_layer_"+t.a]=Nh(t.a,"overlays",{"translucent-overlays":{color:[1,1,1,t.g],order:8190,interactive:!0}}));t.c&16&&(t.b["marker_layer_"+t.a]=Nh(t.a,"markers",{markers:{sprite:Jh("icon.id"),offset:Jh("icon.offset"),collide:!1,priority:8191,elevate_by_altitude:!0,interactive:!0,stick:{color:Jh("icon.stick_color"),height:Jh("icon.stick_height")}}},t.f));return{sources:r,styles:e,layers:t.b}}function aj(t){var e=""+cf(),i;aj.l.constructor.call(this);t=t||{};this.min=t.min||0;this.max=t.max||22;if(i=t.uri){if(/_/.test(i))throw new D(aj,0,"uri "+i)}else i=e;this.uri=i||e;this.uid=e;t.getCopyrights&&wc(t.getCopyrights,"Function",aj)&&(this.getCopyrights=t.getCopyrights);this.f=this.f.bind(this);this.za=!0}u(aj,F);t("H.map.provider.Provider",aj);aj.prototype.g={qe:"configchange",Da:"update"};function Uj(t,e,i){t.dispatchEvent(new sd(t.g.Da,i,e))}aj.prototype.f=function(){this.dispatchEvent(this.g.qe)};aj.prototype.u=function(){F.prototype.u.call(this);this.b&&(this.b.removeEventListener("change",this.f),this.b=null)};aj.prototype.sa=function(){return null};aj.prototype.getCopyrights=aj.prototype.sa;aj.prototype.j=function(){var t=0;this.ti()&&(t|=1);this.providesRasters()&&(t|=2);this.providesSpatials()&&(t|=4);this.providesOverlays()&&(t|=8);this.providesMarkers()&&(t|=16);this.providesDomMarkers()&&(t|=32);return t};aj.prototype.ti=ef;aj.prototype.bf=ef;aj.prototype.providesRasters=aj.prototype.bf;aj.prototype.Ic=ef;aj.prototype.providesSpatials=aj.prototype.Ic;aj.prototype.ui=ef;aj.prototype.providesOverlays=aj.prototype.ui;aj.prototype.Wb=ef;aj.prototype.providesMarkers=aj.prototype.Wb;aj.prototype.Vb=ef;aj.prototype.providesDomMarkers=aj.prototype.Vb;aj.prototype.pi=id;aj.prototype.i=1;function Vj(t,e){e=Yd(e,0,1);E(e)&&(e=1);t.i!==e&&(t.i=e,t.za&&Wj(t),t.f(),Uj(t))}aj.prototype.Um=function(){return this.i};aj.prototype.getOpacityInternal=aj.prototype.Um;aj.prototype.Ed=function(t,e){this.b&&(this.b.removeEventListener("change",this.f),this.b.removeEventListener(Qh,this.f));this.b=t;this.b.addEventListener("change",this.f);this.b.addEventListener(Qh,this.f);e||this.f();this.za=!1};aj.prototype.setStyleInternal=aj.prototype.Ed;aj.prototype.Db=function(){this.b||Wj(this);return this.b};aj.prototype.getStyleInternal=aj.prototype.Db;function Wj(t){var e=new Sj(t.j(),t.uid,t.max,t.i,t.tileSize);t.b=new Sh(Tj(e));t.za=!0}function Xj(t){t=t.j();var e=Yj;t&1?e=Zj:t&2?e=null:t&28&&(e=ak);return e}aj.prototype.zm=function(){return!1};aj.prototype.getFeatureProxy=aj.prototype.zm;function bk(t){var e;uc(this,bk);bk.l.constructor.call(this,t);this.wa=t=[];for(e in Pg)t[Pg[e]]=new Lg}u(bk,aj);t("H.map.provider.ObjectProvider",bk);bk.prototype.ti=df;bk.prototype.providesByViewport=bk.prototype.ti;bk.prototype.Qb=function(t){return this.wa[t||Pg.ANY]};bk.prototype.getInvalidations=bk.prototype.Qb;bk.prototype.ae=function(t,e){if(e!==Mg.NONE){var i=this.wa[Pg.ANY];var r=i.a+1;i.update(r,e);i=this.wa[t.type];i.update(r,e);t.Qb().update(r,e);Uj(this,t)}};bk.prototype.invalidateObject=bk.prototype.ae;bk.prototype.requestOverlays=bk.prototype.zd;bk.prototype.requestSpatials=bk.prototype.tg;bk.prototype.requestSpatialsByTile=bk.prototype.ug;bk.prototype.vb=!1;bk.prototype.requestMarkers=bk.prototype.Kc;bk.prototype.requestDomMarkers=bk.prototype.Jc;function N(t){t=t||{};N.l.constructor.call(this,t);this.c=t=new Q({min:t.min,max:t.max});t.a=this;t.ja(this);t.ua(Mg.ADD);this.O=new wg;this.m=new wg;this.s=new Nj;this.v=new wg;this.D=new Nj;this.T=new wg}u(N,bk);t("H.map.provider.LocalObjectProvider",N);N.prototype.j=function(){return 125};N.prototype.Db=function(){if(!this.fa){this.fa=N.l.Db.call(this);var t=new Sj(this.j()|256,this.uid+"_vol",this.max,this.i,this.tileSize);this.fa.We(Tj(t))}return this.fa};N.prototype.jc=function(){return this.c};N.prototype.getRootGroup=N.prototype.jc;N.prototype.ae=function(t,e){e&Mg.SPATIAL&&this.ea(t);N.l.ae.call(this,t,e)};N.prototype.invalidateObject=N.prototype.ae;N.prototype.ea=function(t){var e;C(t,M,this.ea,0);if(t.a!==this)throw new Yc(this.ea,"foreign object");this.Ha(t);var i=t.type;if(i===Pg.MARKER)if((e=t.ba())instanceof Xf){var r=!0;i=this.s}else i=this.v;else i===Pg.DOM_MARKER?(e=t.ba())instanceof Xf?(r=!0,i=this.D):i=this.T:i=i===Pg.OVERLAY?this.O:this.m;r=r?i.Ec(e):i.Zj(t.F());r.Yi=t;t.la=r};N.prototype.Ha=function(t){var e;if(t)if(t.a!==this){if(C(t,M))throw new Yc(this.Ha,"foreign object")}else if(e=t.la){var i=t.type;i===Pg.MARKER?this.s.remove(e)||this.v.remove(e):i===Pg.DOM_MARKER?this.D.remove(e)||this.T.remove(e):i===Pg.OVERLAY?this.O.remove(e):this.m.remove(e);delete e.Yi;delete t.la}};N.prototype.removeObject=N.prototype.Ha;function ck(t,e,i,r,n,o,a){a=a||[];if(e.$c())for(t=e!==t.s&&e!==t.v,n=!n,e=e.ag(i,o,o),i=e.length,o=0;o<i;o++){var s=e[o].Yi;for(var l,u=yd(r),c=s;(l=c.v<=u&&c.s>=u)&&(c=c.Va););l&&(n||s.Cc(!0))&&(t||1===s.zb().getState())&&a.push(s)}return a}N.prototype.ui=function(){return 0<this.O.$c()};N.prototype.providesOverlays=N.prototype.ui;N.prototype.zd=function(t,e,i){return ck(this,this.O,t,e,i,!1).filter(function(t){return t.Zc()})};N.prototype.requestOverlays=N.prototype.zd;N.prototype.Ic=function(){return 0<this.m.$c()};N.prototype.providesSpatials=N.prototype.Ic;N.prototype.tg=function(t,e,i){return ck(this,this.m,t,e,i,!1)};N.prototype.requestSpatials=N.prototype.tg;N.prototype.ug=function(t,e){return ck(this,this.m,t.Tf(),t.zL,e,!1)};N.prototype.requestSpatialsByTile=N.prototype.ug;N.prototype.Wb=function(){return 0<this.s.$c()+this.v.$c()};N.prototype.providesMarkers=N.prototype.Wb;N.prototype.Kc=function(t,e,i){return dk(this,t,e,i,!1)};N.prototype.requestMarkers=N.prototype.Kc;function dk(t,e,i,r,n){var o=ck(t,t.s,e,i,r,n);ck(t,t.v,e,i,r,n,o);return o}N.prototype.Vb=function(){return 0<this.D.$c()+this.T.$c()};N.prototype.providesDomMarkers=N.prototype.Vb;N.prototype.Jc=function(t,e,i){return ek(this,t,e,i,!1)};N.prototype.requestDomMarkers=N.prototype.Jc;function ek(t,e,i,r,n){var o=ck(t,t.D,e,i,r,n);ck(t,t.T,e,i,r,n,o);return o}function fk(t,e,i){var r=i.ba(),n,o=gk.bind(null,t);t=hk.bind(null,t);C(i,mh)?n=C(r,L)?o(r):r.oa.some(o):C(i,wi)?n=C(r,P)?t(r):r.oa.some(t):C(i,ik)&&(n=t(mi(r)));n&&e.push(i)}function gk(t,e){t:{var i=e.X;var r=si(t,e);if(!r){e=e.X.length;for(var n=0;n<e;n+=3)if(pi(t,i[n],i[n+1])){t=!0;break t}}t=r}return t}function hk(t,e){return ti(t,e)}function jk(t,e,i){for(var r=t.length;r--;){var n=t[r],o=n.ba();if(C(o,Ii)){o=o.oa;for(var a=o.length,s;a--;)if(s=o[a],pi(e,s.lat,s.lng)){i.push(n);break}}else pi(e,o.lat,o.lng)&&i.push(n)}}N.prototype.Ta=function(t,e,i,r,n){for(var o=this,a=t.F(),s=[],l=Xb(),u=1;u&Pg.ANY;){if(u&r)switch(u){case Pg.MARKER:l=l.then(function(){return dk(o,a,i,e,!0)}).then(function(e){return jk(e,t,s)});break;case Pg.DOM_MARKER:l=l.then(function(){return ek(o,a,i,e,!0)}).then(function(e){return jk(e,t,s)});break;case Pg.SPATIAL:l=l.then(function(){return ck(o,o.m,a,i,e,!0)}).then(function(e){e.forEach(fk.bind(null,t,s))});break;case Pg.OVERLAY:l=l.then(function(){return ck(o,o.O,a,i,e,!0)}).then(function(e){e.forEach(fk.bind(null,t,s))})}u<<=1}l.then(function(){return n(s)})};N.prototype.u=function(){N.l.u.call(this);this.c.ra()};var kk={PENDING:0,ACTIVE:1,DONE:2};t("H.map.render.RenderState",kk);function lk(t,e){e=e||{};var i;if(!C(t,Element))throw new D(lk,0,t);var r=t.ownerDocument.createElement("div");this.S=t;lk.l.constructor.call(this);this.padding=new mk(0,0,0,0);this.center=new I(0,0);this.margin=0;this.element=r;r.style.zIndex=0;r.style.height=r.style.width="100%";r.style.position="relative"===t.style.position?"absolute":"relative";this.resize();t.appendChild(r);(i=e.padding)!==B&&this.Gi(i.top,i.right,i.bottom,i.left);this.Bi((i=e.margin)!==B?i:0)}u(lk,F);t("H.map.ViewPort",lk);lk.prototype.a={Da:"update",te:"sync"};lk.prototype.Bi=function(t){if(this.margin!==+t){if(E(this.margin=+t))throw new D(this.Bi,0,t);nk(this);this.dispatchEvent(this.a.Da)}};lk.prototype.setMargin=lk.prototype.Bi;lk.prototype.Gi=function(t,e,i,r){var n=this.padding;if(n.top!==t||n.right!==e||n.bottom!==i||n.left!==r){if(E(t+e+i+r))throw new D(this.Gi);n.top=t;n.right=e;n.bottom=i;n.left=r;nk(this);this.dispatchEvent(this.a.Da)}};lk.prototype.setPadding=lk.prototype.Gi;function nk(t){var e=t.padding;t.center.set((t.width+e.left-e.right)/2<<0,(t.height+e.top-e.bottom)/2<<0)}lk.prototype.resize=function(){var t=this.S.offsetWidth,e=this.S.offsetHeight;if(this.width!==t||this.height!==e)this.c=new Ji(this.width,this.height),this.width=t,this.height=e,nk(this),this.dispatchEvent(this.a.Da)};lk.prototype.resize=lk.prototype.resize;lk.prototype.ab=function(t){this.dispatchEvent(new Qi(this.a.te,this.c,t,Ri.SIZE))};lk.prototype.synchronize=lk.prototype.ab;lk.prototype.u=function(){x.clearTimeout(this.b);this.b=null;this.S.removeChild(this.element);this.element=this.S=null;lk.l.u.call(this)};lk.prototype.sc=Nc;lk.prototype.startInteraction=lk.prototype.sc;lk.prototype.kc=Nc;lk.prototype.interaction=lk.prototype.kc;lk.prototype.yb=Nc;lk.prototype.endInteraction=lk.prototype.yb;function ok(t,e,i,r,n,o){var a;for(a=[];r<=n;r++)a=a.concat(pk(t,i,r));t=a.length;hj.call(this,o,t);this.j=i=[];this.f=A(this.f,this);this.c=A(this.c,this);for(this.P(1);t--;)o=a[t],i.push(qk(e,o[0],o[1],o[2],this.f,this.c))}u(ok,hj);ok.prototype.f=function(){jj(this,2)};ok.prototype.c=function(){jj(this,4)};ok.prototype.we=function(){for(var t=this.j,e=t.length;e--;)t[e].cancel();this.j=y};function rk(){}t("H.util.ICancelable",rk);rk.prototype.cancel=function(){};rk.prototype.cancel=rk.prototype.cancel;function sk(t,e){var i=this;if(!Ca(e))throw new D(tk,1,e);if(!Ca(t.next||Ca(t.cycle)))throw new D(sk,2,'Argument "mode" must implement H.util.AsyncQueue.Mode');this.b=[];this.c=[];this.g=t;this.i=e;this.j=function(){uk(i)};this.a=null;this.f=function(){i.a||(i.a=x.setTimeout(i.j,1))}}t("H.util.AsyncQueue",sk);sk.prototype.push=function(t,e){if(!Ca(e))throw new D(this.push,1,e);t=vk(new wk,t,this.f,e);this.b.push(t);this.f();return t};sk.prototype.push=sk.prototype.push;function uk(t){var e=t.c,i=0,r=t.g;r.a();for(t.a=null;i<e.length;){var n=e[i];n.ck?e.splice(i,1):i++}for(;n=r.next(t.b,t.c);)n.cancelled?n.done(null,"cancelled"):(e.push(n),t.i(n,n.data))}function wk(){vk(this,null,null,null)}sk.Task=wk;function vk(t,e,i,r){t.data=e;t.cancelled=!1;t.ck=!1;t.b=i;t.c=r;t.a=null;return t}wk.prototype.done=function(t,e){this.ck=!0;this.b();this.c(this,t,e)};wk.prototype.done=wk.prototype.done;wk.prototype.cancel=function(){this.a&&this.a();this.cancelled=!0};wk.prototype.cancel=wk.prototype.cancel;wk.prototype.Bo=function(t){this.a=t;return this};wk.prototype.setCancelFn=wk.prototype.Bo;function xk(){}sk.Mode=xk;xk.prototype.next=function(){};xk.prototype.a=function(){};function yk(t,e){yk.l.constructor.call(this,new zk(t),e)}u(yk,sk);t("H.util.SequentialQueue",yk);function zk(t){if(isNaN(t)||0>t)throw new D(yk,1,'Argument "maxTime" must be a positive number');this.b=t;this.Qc=Ak()}zk.prototype.next=function(t){return t.length&&Ak()-this.Qc<this.b?t=t.shift():null};zk.prototype.a=function(){this.Qc=Ak()};function Bk(t){uc(this,Bk);Bk.l.constructor.call(this,t);if(t&&"tileSize"in t){var e=Bd(+t.tileSize)/Ld;if(isNaN(e)||e%1||0>e||30<e)throw new D(Bk,0,"tileSize: "+t.tileSize);this.tileSize=+t.tileSize}}u(Bk,aj);t("H.map.provider.TileProvider",Bk);function Ck(t,e){return Vd(t)-8-xd(Vd(e))}Bk.getZoomLevelOffset=Ck;Bk.prototype.rd=function(t,e,i){return this.uri.concat("_",t,"_",e,"_",i)};Bk.prototype.getTileKey=Bk.prototype.rd;Bk.prototype.wf=256;Bk.prototype.tileSize=Bk.prototype.wf;function Dk(){}t("H.util.ICache",Dk);Dk.prototype.add=function(){};Dk.prototype.add=Dk.prototype.add;Dk.prototype.get=function(){};Dk.prototype.get=Dk.prototype.get;Dk.prototype.Mf=function(){};Dk.prototype.drop=Dk.prototype.Mf;Dk.prototype.forEach=function(){};Dk.prototype.forEach=Dk.prototype.forEach;Dk.prototype.ra=function(){};Dk.prototype.removeAll=Dk.prototype.ra;Dk.prototype.ge=function(){};Dk.prototype.registerOnDrop=Dk.prototype.ge;Dk.prototype.dh=function(){};Dk.prototype.deRegisterOnDrop=Dk.prototype.dh;function Ek(t,e,i){this.g=[];e&&this.ge(e);if(i&&!Ca(i))throw new D(Ek,2,i);this.b=0;this.filter=i;this.a={};this.f=this.c=null;this.Di(t)}t("H.util.Cache",Ek);Ek.prototype.add=function(t,e,i){var r,n;i=+i;if(!Cc(i)||0>i)throw new D(this.add,2,i);t=String(t);if(n=this.filter?this.filter(t,e,i):!0)(r=this.a[t])?(r.data!==e&&Fk(this,r),this.b+=i-r.size,r.size=i,r.data=e,Gk(this,r)):this.a[t]=Hk(this,{id:t,data:e,size:i,nc:null,fd:null},this.c),Ik(this);return n};Ek.prototype.add=Ek.prototype.add;Ek.prototype.ge=function(t){if(!Ca(t))throw new D(this.ge,0,t);this.g.push(t)};Ek.prototype.registerOnDrop=Ek.prototype.ge;Ek.prototype.dh=function(t){this.g=this.g.filter(function(e){return e!==t})};Ek.prototype.deRegisterOnDrop=Ek.prototype.dh;Ek.prototype.get=function(t,e){return(t=e?this.a[t]:Gk(this,this.a[t]))&&t.data};Ek.prototype.get=Ek.prototype.get;Ek.prototype.Mf=function(t){var e;(e=this.a[t])&&Jk(this,e,!0)};Ek.prototype.drop=Ek.prototype.Mf;Ek.prototype.forEach=function(t,e,i){var r;for(r in this.a){var n=this.a[r];(i?i(r,n.data,n.size):1)&&t.call(e,r,n.data,n.size)}};Ek.prototype.forEach=Ek.prototype.forEach;Ek.prototype.ra=function(t){var e;for(e in this.a){var i=this.a[e];(t?t(e,i.data,i.size):1)&&Jk(this,this.a[e],!0)}};Ek.prototype.removeAll=Ek.prototype.ra;Ek.prototype.Di=function(t){if(!(0<+t))throw new D(Ek.prototype.Di,0,t);this.i=+t;Ik(this);return this};Ek.prototype.setMaxSize=Ek.prototype.Di;Ek.prototype.Rm=function(){return this.i};Ek.prototype.getMaxSize=Ek.prototype.Rm;Ek.prototype.qm=function(){return this.b};Ek.prototype.getCurrentSize=Ek.prototype.qm;function Gk(t,e){e&&(t.c=Hk(t,e,t.c));return e}function Ik(t){for(;t.b>t.i&&t.f;)Jk(t,t.f,!0)}function Hk(t,e,i){if(i!==e){(e.nc||e.fd)&&Jk(t,e,!1);if(e.nc=i)e.fd=i.fd,i.fd=e;e.fd||(t.c=e);e.nc||(t.f=e);t.b+=e.size}return e}function Jk(t,e,i){var r=e.fd,n=e.nc;if(r||n||e==t.c&&e==t.f)r?r.nc=n:t.c=n,n?n.fd=r:t.f=r,t.b-=e.size,i&&(delete t.a[e.id],Fk(t,e));e.nc=e.fd=null}function Fk(t,e){for(var i=t.g.length;i--;)t.g[i].call(t,e.id,e.data,e.size)}var Kk,Lk=function(){function t(){}for(var e,i,r,n=rc("o ms moz webkit "),o=5;o--&&!e;)e=n[o],e=(i=x[e+(e?"R":"r")+"equestAnimationFrame"])&&!E(i.call(window,t))&&(r=x[e+(e?"C":"c")+"ancelAnimationFrame"]);Kk=e?function(t){return i.call(x,t)}:function(t){return x.setTimeout(t,25)};return e?function(t){return r.call(x,t)}:function(t){return x.clearTimeout(t)}}(),Ak=x.performance&&x.performance.now?function(){return x.performance.now()}:function(){return x.Date.now()};function Mk(t,e,i,r){this.key="";this.x=t;this.y=e;this.z=i;this.data=r;this.valid=!0}t("H.map.provider.Tile",Mk);function Nk(t,e,i,r){t-=i;e-=r;return t*t+e*e}function Ok(t,e,i){return Pk(t,e*e,i||0,0,t.length-1)}t("H.math.simplifyDP",Ok);function Pk(t,e,i,r,n){var o=0,a=r,s=t[r].x,l=t[r].y,u=t[n].x,c=t[n].y,h=r+1,f=Nk(s,l,u,c);if(f)for(;h<n;){var p=t[h++];var d=p.x;p=p.y;var y=((d-s)*(u-s)+(p-l)*(c-l))/f;d=0>y?Nk(d,p,s,l):1<y?Nk(d,p,u,c):Nk(d,p,s+y*(u-s),l+y*(c-l));d>o&&(o=d,a=h-1)}else for(;h<n;)p=t[h++],d=p.x,p=p.y,d=Nk(d,p,s,l),d>o&&(o=d,a=h-1);o>=e||0<i&&a-r?(--i,1<a-r?(r=Pk(t,e,i,r,a),r.splice(r.length-1,1)):r=[t[r]],r=1<n-a?r.concat(Pk(t,e,i,a,n)):r.concat(t.slice(a,n+1))):r=[t[r],t[n]];return r}function Qk(t,e,i,r,n,o,a,s){Qk.l.constructor.call(this,e,i,r,null);this.key=t;this.aa=s;this.a=n;this.g=o;this.i={};this.zL=a;this.o=zd(O.MAX_LINE_WIDTH/2*this.g+1)}u(Qk,Mk);t("H.map.provider.SpatialTile",Qk);Qk.prototype.c=Ud;Qk.prototype.s=Ud;Qk.prototype.b=Ud;function Rk(t){return t.aa.getInvalidations(Pg.SPATIAL)}function Sk(t){var e=Rk(t),i=e.a,r=t.c,n=r===i,o;if(!(n||e.ak(r)||e.Lh(r))){n=t.f;var a=t.i;if(e.cg(r))for(o=n.length;o--;){var s=n[o];if(s.Qb().cg(r)){n.splice(o,1);var l=l||Tk(t,s.fb())}}if(e.Mh(r)){for(o=n.length;o--;)if(s=n[o],s.Qb().Mh(r)){var u=1;if((s=a[s.fb()])&&s.a){l=1;break}}u&&n.sort(Uk)}if(!l&&e.ce(r))for(o=n.length;o--;)if(n[o].Qb().ce(r)){var c=1;break}t.s!==r||c||(t.s=i,t.b!==r||l||(t.b=i));t.c=i;n=!0}return n}Qk.prototype.be=function(){var t=Rk(this),e=t.a,i=this.b,r=i===e;r||(this.aa.vb&&!t.ce(i)?r=!0:Sk(this)&&(r=this.b===e));return r};Qk.prototype.isCanvasValid=Qk.prototype.be;Object.defineProperty(Qk.prototype,"valid",{get:function(){return this.be()},set:id,configurable:!0});function Vk(t,e){this.b=t;this.a=e}function Tk(t,e){t=t.i;var i=t[e];if(i)return delete t[e],i.a}Qk.prototype.f=ff;function Wk(t){var e=Rk(t),i=t.c,r=t.f,n;if(!Sk(t)){for(n=r.length;n--;){var o=r[n];var a=o.Qb();(a.cg(i)||a.Lh(i))&&Tk(t,o.fb())}t.f=t.aa.requestSpatialsByTile(t,!1,!1).sort(Uk);t.c=e.a}}function Uk(t,e){return Qg(t.bd(),e.bd(),!1)}Qk.prototype.Ta=function(){return this.f};Qk.prototype.getObjects=Qk.prototype.Ta;var Xk={};Qk.prototype.Qe=function(){var t=this.a+"_"+this.g,e=Xk[t];if(!e){e=-this.o;var i=this.a-e;e=Xk[t]=new mk(e,e,i,i)}return e};Qk.prototype.getPxClipRect=Qk.prototype.Qe;Qk.prototype.Tf=function(){var t=this.rb;if(!t){var e=this.Vf();t=0;var i=this.a;this.z&&(i-=t+=this.Qe().top);t=this.rb=dg(e.Ze(new I(t,t)),e.Ze(new I(i,i)))}return t};Qk.prototype.getGeoClipRect=Qk.prototype.Tf;Qk.prototype.Vf=function(){var t=this.v;if(!t){var e=this.a;t=this.v=new Xi(B,e);t.Fa(this.z);t.x=this.x*e;t.y=this.y*e}return t};Qk.prototype.getPxProj=Qk.prototype.Vf;Qk.prototype.Za=function(){return this.g};Qk.prototype.getPixelRatio=Qk.prototype.Za;Qk.prototype.qg=function(){var t=this.data;this.data=null;this.b=Ud;return t};Qk.prototype.releaseCanvas=Qk.prototype.qg;Qk.prototype.rg=function(){this.i={};delete this.f;this.c=Ud};Qk.prototype.releaseData=Qk.prototype.rg;Qk.prototype.$=function(t){var e=t.getContext("2d"),i,r,n,o,a=0;Wk(this);if(this.b<this.c){var s=this.f;if(i=s.length){t.width=t.height=this.a;e.clearRect(0,0,this.a,this.a);var l=this.i;for(r=0;r<i;r++){var u=s[r];var c=u.fb();if(o=(n=l[c])?n.b:u.getGeometriesForTile(this)){if(n)u.Qb().ce(this.b)&&(n.a=bh(u,o)),n=n.a;else{n=bh(u,o);var h;var f=o;for(var p=u.j?2:0,d=f.length;d--;){var y=f[d];if(y!==ch){var g=y.a;for(h=g.length;h--;)y=g[h],4<y.length&&(g[h]=Ok(y,.6,p))}}this.i[c]=new Vk(o,n)}if(n){e.save();f=u.j?this.O:this.B;for(c=0;c<o.length;c++)f.call(this,u,o[c],u.ta(),e);if(o=u.getLabels(this))for(u=e,c=o.length;c--;)for(p=o[c],f=p.size,u.font=f+"px "+p.font,u.fillStyle=p.color,u.textAlign="center",u.translate(p.x,p.y),u.rotate(p.angle),f=p.lineHeight||1.375*f,d=p.lines,p=d.length;p--;)u.fillText(d[p],0,p*f);e.restore()}a|=n}}}this.data=a?t:null;this.s=this.b=this.c}else this.data&&(a=1);return 0<a};Qk.prototype.render=Qk.prototype.$;Qk.prototype.B=function(t,e,i,r){var n;i.Se&&(Yk(r,i,this.g),Zk(e,r,!1,!0,!1,this.a,this.o));i.Re&&(n=t.g)&&n.Sb&&($k(r,n),al(this,r,e,n,i.lineWidth))};Qk.prototype.O=function(t,e,i,r){var n=i.Sb,o=i.Se,a,s=this.a,l=this.o;if(e===ch)n&&($k(r,i),r.fillRect(0,0,s,s));else{o&&Yk(r,i,this.g);if(i.Re&&(a=t.g)){var u=i.lineWidth;a.Sb||(a=null)}t=e.c;if(t===Td){if(o||n)$k(r,i),Zk(e,r,!0,o,n,s,this.o);a&&($k(r,a),al(this,r,e,a,u,0))}else n&&($k(r,i),Zk(e,r,!0,!1,n,s,l,0,t)),o&&Zk(e,r,!1,o,!1,s,l,t),a&&($k(r,a),al(this,r,e,a,u,t))}};function Zk(t,e,i,r,n,o,a,s,l){var u=t.a,c=-a;a=o+a;s=s||0;l===B&&(l=u.length);if(n&&t===ch)e.fillRect(0,0,o,o);else if(l>s){e.beginPath();for(o=s;o<l;o++){var h=u[o];var f=h.length;if(h===vi)e.moveTo(c,c),e.lineTo(c,a),e.lineTo(a,a),e.lineTo(a,c);else{var p=h[0];e.moveTo(p.x,p.y);for(s=1;s<f;s++)p=h[s],e.lineTo(p.x,p.y)}i&&e.closePath()}i&&n&&e.fill(t.b!==Td?"evenodd":"nonzero");r&&e.stroke()}}function Yk(t,e,i){var r;t.strokeStyle=e.strokeColor;t.lineWidth=e.lineWidth*i;t.lineCap=e.lineCap;t.lineJoin=e.lineJoin;t.miterLimit=e.miterLimit;t.setLineDash&&(r=e.lineDash)!==ff&&(t.setLineDash(r),t.lineDashOffset=e.lineDashOffset)}function $k(t,e){t.fillStyle=e.fillColor}function al(t,e,i,r,n,o){var a=n*r.width/2;n=n*r.length/2;var s=n/2;r=2*n*r.frequency;var l=Cd(Dd(n,2)+Dd(a,2));t=t.a-l;t=new mk(l,l,t,t);i=i.a;var u,c,h,f,p,d,y,g=Md/2;o=o||0;for(l=i.length;l-- >o;){var v=0;var _=i[l];if(c=u=_.length){var m=_;c=m.length;for(h=0;--c;)h+=m[c].Ya(m[c-1]);c=(m=h)>=r}if(c)for(c=vd(yd(m/r),1e3),c=m/(c+1),h=c/2;--u;){for(f=(p=_[u]).Ya(d=_[u-1]);h<=v+f;){var b=p.x+(d.x-p.x)*(y=(h-v)/f);y=p.y+(d.y-p.y)*y;t.If(b,y)&&(e.save(),e.translate(b,y),e.rotate(-Jd((d.y-p.y)/(p.x-d.x))+(p.x<d.x?g:-g)),e.beginPath(),e.moveTo(-a,-n),e.lineTo(0,n),e.lineTo(a,-n),e.lineTo(0,-s),e.closePath(),e.fill(),e.restore());h+=c}v+=f}}}var bl=[];Qk.prototype.Ua=function(t,e,i){for(var r=this.f,n=r.length,o,a,s,l,u,c,h=ff,f,p=this.g;n--;)if(a=r[n],a.Cc(!0)&&(s=this.i[a.fb()])&&(l=s.b)){o=a.ta();c="none"!==o.fillColor&&a.j;f="none"===o.strokeColor?0:o.lineWidth*p;for(o=l.length;o--;){u=l[o];var d;if(!(d=c&&u===ch)&&(d=c||f)){var y;d=t;var g=e,v=c,_=f,m=u.b,b=u.c,x=b!==Td,w=u.a,k=w.length,A=0,T=0,E=!1;for(u=0;u<k;u++){var M=w[u];var S=u>=b;var R=!S&&u>=m;if(M===vi&&v)R?A++:T++;else{var P=M.length;bl.length=2*P;for(y=0;y<P;y++){var O=M[y];bl[2*y]=O.x;bl[2*y+1]=O.y}y=v&&!S;S=x&&!S?0:_;if(y||S)if(S=be(d,g,bl,S,y),S===ae.EDGE||S===ae.VERTEX){E=!0;break}else if(S===ae.SURFACE)if(R)A++;else if(T++,m===Td)break}}d=E||0<T&&!(A%2)}if(d){h===ff&&(h=[]);h.push(a);break}}if(i&&h.length)break}return h};function cl(t,e){var i;cl.l.constructor.call(this,e);this.B=t;this.K=t=e.pixelRatio;this.tileSize=i=1<<xd(Vd((e.tileSize||256)*t));this.T=Ck(i,t);this.Uh=A(this.Uh,this);this.ii=A(this.ii,this);this.Vh=A(this.Vh,this);this.Th=A(this.Th,this);this.v=A(this.v,this);this.B.addEventListener(aj.prototype.g.Da,this.v,!1,this);this.c=[];this.m=new Ek(e.tileCacheSize||256,this.Uh);this.s=new Ek(e.dataCacheSize||512,this.ii);this.D=new yk(20,this.Vh);this.a={};this.O=Ak()}u(cl,Bk);cl.prototype.v=function(t){t.target.type===Pg.SPATIAL&&Uj(this,t.target)};cl.prototype.ib=function(t,e,i,r){var n=this.getTileKey(t,e,i),o;if(o=this.m.get(n,r)){if(r||o.be())return o;r||this.m.Mf(n)}if((o=this.s.get(n,r))&&(r||Sk(o)))return t=this.c.pop()||document.createElement("canvas"),o.$(t)||this.c.push(t),this.m.add(n,o,1),o;r||((o=this.a[n])?o.count++:(o=this.D.push([n,t,e,i],this.Th),o.count=1,this.a[n]=o))};cl.prototype.requestTile=cl.prototype.ib;cl.prototype.ld=function(){};cl.prototype.Vc=function(t,e,i){this.Ef(this.getTileKey(t,e,i))};cl.prototype.cancelTile=cl.prototype.Vc;cl.prototype.Ef=function(t){var e;if(e=this.a[t])e.count--,e.count||(e.cancel(),delete this.a[t])};cl.prototype.cancelTileByKey=cl.prototype.Ef;n=cl.prototype;n.Vh=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3];i=this.m.get(i)||new Qk(i,r,n,o,this.tileSize,this.K,o+this.T,this.B);r=i.data||this.c.pop()||document.createElement("canvas");i.$(r)||this.c.push(r);e.push(i);t.done(i)};n.Th=function(t,e){t=t.data[0];e&&this.m.add(t,e,1);delete this.a[t];Uj(this)};n.Uh=function(t,e){e.data&&this.c.push(e.qg());this.s.add(t,e,1)};n.ii=function(t,e){e.rg()};n.u=function(){for(var t in this.a)this.a[t].cancel();this.m.ra();this.s.ra();this.c.length=0;cl.l.u.call(this)};function dl(t,e){e=e||{};if(!t)throw new D(dl,0,t);this.tileSize=t.tileSize;this.c={};$i.call(this,{min:void 0!==e.min?e.min:t.min,max:void 0!==e.max?e.max:t.max,minWorldSize:this.tileSize,projection:e.Kk,dark:e.dark,provider:t})}u(dl,$i);t("H.map.layer.BaseTileLayer",dl);dl.prototype.He=function(t,e){var i=this.pixelProjection;if(!C(t,K))throw new D(this.He,0,t);if(!E(e)){var r=i.Tj();i.Fa(e)}t=el(i.kb(t.Rb()),i.kb(t.Ob()));!E(r)&&i.Fa(r);return t};dl.prototype.geoRectToRect=dl.prototype.He;dl.prototype.$d=function(t,e){var i=Dd(2,yd(e)),r=this.tileSize;if(!C(t,mk))throw new D(this.$d,0,t);if(E(e=+e))throw new D(this.$d,1,e);e=yd(t.left/r);e===i&&--e;var n=yd(t.right/r);n===i&&--n;return new mk(e,Yd(yd(t.top/r),0,i-1),n,Yd(yd(t.bottom/r),0,i-1))};dl.prototype.getTileBounds=dl.prototype.$d;dl.prototype.ib=function(t,e,i,r){return this.a.requestTile(t,e,i,r)};dl.prototype.Vc=function(t,e,i){this.a.cancelTile(t,e,i)};dl.prototype.cancelTile=dl.prototype.Vc;dl.prototype.sa=function(t,e){return this.a.getCopyrights?this.a.getCopyrights(t,e):null};dl.prototype.getCopyrights=dl.prototype.sa;function fl(t,e,i,r,n){r=yd(r);var o=Dd(2,r),a=e.left,s=e.top,l=e.right;i=l+(i?o+(l===e.left?0:1):1);var u=e.bottom,c=[];if(n){var h=a+(1+l-a)/2+n.x/t.tileSize-.5;var f=s+(1+u-s)/2+n.y/t.tileSize-.5}for(;a<i;){for(s=e.top;s<=u;)t=a%o,c.push([t,s,r,n?Ad(h-a)+Ad(f-s):0]),s++;a++}return c}function pk(t,e,i){i=yd(i);t.pixelProjection.Fa(i);e=t.He(e);var r=t.$d(e,i);return fl(t,r,e.left>e.right,i)}dl.prototype.Pe=function(t,e,i,r,n,o){var a,s=[],l,u=this.a;o=null!=o?o:"__default__";var c=u.requestTile;if(!C(t,mk))throw new D(this.Pe,0,t);if(E(i=+i))throw new D(this.Pe,1,i);r||(a={});e=fl(this,t,e,i,n);if(t=e.length)for(r||e.sort(gl),i=t;i--;)n=e[i],r||(a[u.rd.apply(u,n)]=!0),n[3]=+r,(l=c.apply(u,n))&&s.push(l);if(!r){r=a;var h;a=this.c[o]||{};for(h in a)a.hasOwnProperty(h)&&a[h]&&!r[h]&&this.a.cancelTileByKey(h);this.c[o]=r}return{total:t,tiles:s}};dl.prototype.getProviderTiles=dl.prototype.Pe;function gl(t,e){return e[3]-t[3]}function R(t){uc(this,R);R.l.constructor.call(this,t);this.dc=new hl;this.fc=A(this.fc,this);this.T=il;this.createTileInternal=this.ld.bind(this)}u(R,Bk);t("H.map.provider.RemoteTileProvider",R);R.prototype.Rd=function(){return 1};R.prototype.getEntryWeight=R.prototype.Rd;var il=new Ek(65536);R.prototype.m={};R.prototype.fa={};R.prototype.Pb=function(){return this.T};R.prototype.getCache=R.prototype.Pb;R.prototype.O=ba(3);R.prototype.fc=function(t){var e=this.uri;return!t.indexOf(e)&&"_"===t.charAt(e.length)};R.prototype.cacheFilter=R.prototype.fc;R.prototype.Xa=function(t,e){e.valid=!1};R.prototype.reload=function(t){var e=this.getCache();t?e.ra(this.fc):e.forEach(this.Xa,this,this.fc);jl(this);Uj(this,this,{isReload:!0})};R.prototype.reload=R.prototype.reload;R.prototype.Wg=function(){return!1};R.prototype.MAX_STORE_TIME=Infinity;R.prototype.Yd=function(){return this.dc};R.prototype.la=function(t,e){e(t)};function qk(t,e,i,r,n,o){r=~~r;return t.requestInternal(e,i,r,function(a,s){t.Yd().put(t.rd(e,i,r),{raw:s&&s.raw||a,timestamp:x.Date.now()},n,o)},o,0)}R.prototype.requestInternal=R.prototype.J;R.prototype.ib=function(t,e,i,r){var n=this;var o=this.getCache();if(E(t=+t))throw new D(this.ib,0,t);if(E(e=+e))throw new D(this.ib,0,e);if(E(i=+i))throw new D(this.ib,0,i);i=~~i;var a=this.getTileKey(t,e,i);o=o.get(a);o&&o.valid||r||this.m[a]||(o=B,this.requestTileAsPromise(t,e,i,r).then(function(t){Uj(n,t)},id));return o};R.prototype.requestTile=R.prototype.ib;R.prototype.Qk=function(t,e,i,r){var n=this,o=this.getCache(),a=this.getTileKey(t,e,i),s=this.m,l=this.fa,u,c=this.Yd();if(l[a])return l[a];l[a]=l=new Ob(function(l,h){function f(u){var f,p;var d=function(r,s){p=n.createTileInternal(t,e,i,r,s);p.key=a;o.add(a,p,n.Rd(r));l(p);kl(n,a)};u&&(f=x.Date.now()-u.timestamp);u&&f<n.MAX_STORE_TIME?n.la(u.raw,d):(f&&c.remove(a),(p=o.get(a))&&p.valid||r?l(p||null):s[a]=n.requestInternal(t,e,i,d,h))}u=c.get(a,f,f)});s[a]||(s[a]=u);l.then(function(){kl(n,a)},function(){kl(n,a)});return l};R.prototype.requestTileAsPromise=R.prototype.Qk;R.prototype.Pk=function(t,e){var i=this,r=t.id,n=t.tile.coords;return new Ob(function(t,o){i.Qk(n.x,n.y,n.z,e).then(function(e){var i=y;e=e.Ta?e.Ta():e.data;for(var n=e.length,o;n--;)if(o=e[n],o.fb()===r){i=o;break}t(i)},o)})};R.prototype.requestObjectAsPromise=R.prototype.Pk;function kl(t,e){delete t.m[e];delete t.fa[e]}function jl(t){for(var e in t.m)t.fc(e)&&t.cancelTileByKey(e)}var ll={cancel:function(){}};R.prototype.ld=function(t,e,i,r){return new Mk(t,e,i,r)};R.prototype.Ef=function(t){var e=this.m[t];e&&(e.cancel(),kl(this,t))};R.prototype.cancelTileByKey=R.prototype.Ef;R.prototype.Vc=function(t,e,i){this.cancelTileByKey(this.getTileKey(t,e,i))};R.prototype.cancelTile=R.prototype.Vc;R.prototype.u=function(){R.l.u.call(this);this.getCache().ra(this.fc);jl(this)};function hl(){}R.NullStorage=hl;hl.prototype.get=function(t,e){e();return ll};hl.prototype.get=hl.prototype.get;hl.prototype.put=function(t,e,i){i&&i()};hl.prototype.put=hl.prototype.put;hl.prototype.clear=function(t){t&&t()};hl.prototype.clear=hl.prototype.clear;hl.prototype.remove=function(t,e){e&&e()};hl.prototype.remove=hl.prototype.remove;function tk(t){tk.l.constructor.call(this,t);t&&(this.B={crossOrigin:t.crossOrigin||"anonymous",headers:t.headers||{}},this.v=t.getURL);if(!Ca(this.v))throw new D(tk,0,"getURL");Vj(this,t.opacity);this.c=x.URL||x.webkitURL;t=this.B.crossOrigin;if(!(t="anonymous"===t||"use-credentials"===t)){t=this.v(0,0,0);var e=window.location,i=document.createElement("a");i.href=t;t=i.hostname===e.hostname&&i.port===e.port&&i.protocol===e.protocol}(this.K=t&&!!rf.prototype.b.arraybuffer&&!!this.c)&&this.Pb().ge(A(this.wa,this))}u(tk,R);t("H.map.provider.ImageTileProvider",tk);tk.prototype.pc=function(t){Vj(this,t)};tk.prototype.setOpacity=tk.prototype.pc;tk.prototype.ad=function(){return this.i};tk.prototype.getOpacity=tk.prototype.ad;tk.prototype.bf=df;tk.prototype.providesRasters=tk.prototype.bf;tk.prototype.Rd=function(){return this.tileSize};tk.prototype.getEntryWeight=tk.prototype.Rd;tk.prototype.J=function(t,e,i,r,n,o){var a=this,s=this.v(t,e,i),l;t=null;if(s){var u=x.setTimeout(function(){a.K?(l=new rf("arraybuffer",s,o,a.B),l.then(function(t){return t.blob()}).then(function(t){var e=new Image;e.onload=A(r,null,e,{raw:t});e.onerror=A(n,null,"bad url");try{e.src=a.c.createObjectURL(t)}catch(t){}},n)):(l=new rf("image",s,o,a.B),l.then(r,n))},150);t={cancel:function(){l?l.cancel():x.clearTimeout(u)}}}else r(null);return t};tk.prototype.requestInternal=tk.prototype.J;tk.prototype.la=function(t,e){var i=new Image;i.onload=function(){e(this)};i.src=this.c.createObjectURL(t)};tk.prototype.wa=function(t,e){(t=e.data)&&t instanceof HTMLImageElement&&this.c.revokeObjectURL(t.src)};function mk(t,e,i,r){this.left=+t;this.top=+e;this.right=+i;this.bottom=+r}t("H.math.Rect",mk);mk.prototype.set=mk;mk.prototype.set=mk.prototype.set;mk.prototype.Rb=function(){return this.c||(this.c=new I(this.left,this.top))};mk.prototype.getTopLeft=mk.prototype.Rb;mk.prototype.Ob=function(){return this.a||(this.a=new I(this.right,this.bottom))};mk.prototype.getBottomRight=mk.prototype.Ob;mk.prototype.If=function(t,e){return this.left<=t&&this.right>=t&&this.top<=e&&this.bottom>=e};mk.prototype.containsXY=mk.prototype.If;function el(t,e){return new mk(t.x,t.y,e.x,e.y)}mk.fromPoints=el;mk.prototype.clone=function(){return new mk(this.left,this.top,this.right,this.bottom)};mk.prototype.clone=mk.prototype.clone;function ml(t,e){dl.call(this,t,e)}u(ml,dl);t("H.map.layer.TileLayer",ml);ml.prototype.Ad=function(t,e,i,r,n){if(!C(t,K))throw new D(this.Ad,0,t);if(E(e=+e))throw new D(this.Ad,1,e);e=yd(e);this.pixelProjection.Fa(e);t=this.He(t);var o=this.$d(t,e);return this.Pe(o,t.left>t.right,e,i,r,n)};ml.prototype.requestTiles=ml.prototype.Ad;function nl(t,e){e=e?Ua(e):{};e.tileSize=e.tileSize||256;e.pixelRatio=e.pixelRatio||Se();e.max=24;this.c=new cl(t,e);this.f=new ml(this.c);e.minWorldSize=this.c.tileSize;e.provider=t;nl.l.constructor.call(this,e);this.tileSize=this.f.tileSize;this.j=A(this.j,this);this.c.addEventListener(this.c.g.Da,this.j);t.addEventListener(t.g.Da,this.j)}u(nl,$i);t("H.map.layer.ObjectLayer",nl);nl.prototype.j=function(t){t.currentTarget!==this.c&&t.target.type===Pg.SPATIAL||this.g()};var ol={markers:ff,total:0};nl.prototype.Kc=function(t,e,i){var r=this.a,n;return r.providesMarkers()&&(n=r.requestMarkers(t,e,!0,i)).length?{markers:n,total:n.length}:ol};nl.prototype.requestMarkers=nl.prototype.Kc;nl.prototype.Jc=function(t,e,i){var r=this.a,n;return r.providesDomMarkers()&&(n=r.requestDomMarkers(t,e,!0,i)).length?{markers:n,total:n.length}:ol};nl.prototype.requestDomMarkers=nl.prototype.Jc;var pl={tiles:ff,total:0};nl.prototype.Ad=function(t,e,i,r){if(this.a.providesSpatials()){var n=this.f.Ad(t,e,i,r);i||(i=this.c,n=Ak(),33<n-i.O&&(uk(i.D),i.O=n),n=this.f.Ad(t,e,!0,r))}else n=pl;return n};nl.prototype.requestTiles=nl.prototype.Ad;nl.prototype.ib=function(t,e,i,r){return this.f.ib(t,e,i,r)};nl.prototype.requestTile=nl.prototype.ib;nl.prototype.Vc=function(t,e,i){this.f.Vc(t,e,i)};nl.prototype.cancelTile=nl.prototype.Vc;var ql={overlays:ff,total:0};nl.prototype.zd=function(t,e,i){var r=this.a,n=ql;r.providesOverlays&&r.providesOverlays()&&(t=r.requestOverlays(t,e,!0,i),e=t.length)&&(n={overlays:t,total:e});return n};nl.prototype.requestOverlays=nl.prototype.zd;nl.prototype.u=function(){this.c.C();this.f.C();this.a.dispose();nl.l.u.call(this)};function rl(t,e,i,r){var n=new mk(0,0,0,0);rl.l.constructor.call(this);if(!t)throw new D(rl,0,t);if(!e)throw new D(rl,1,e);if(!i)throw new D(rl,2,i);if("object"!==typeof r)throw new D(rl,3,r+" is not an object");if("number"!==typeof r.pixelRatio)throw new D(rl,3,r.pixelRatio+" is not a number");this.qa=r.pixelRatio;this.zoom=0;this.hb=Bd(this.qa)/Ld;this.U=new Xi;this.vb={1:n.clone(),2:n.clone(),4:n.clone()};this.b=new I(.5,.5);this.i=t;sl(this,this.qa);this.sc=A(this.sc,this);this.kc=A(this.kc,this);this.yb=A(this.yb,this);t.startInteraction=this.sc;t.interaction=this.kc;t.endInteraction=this.yb;t.addEventListener(t.a.Da,this.T,!1,this);this.getCapabilities=this.getCapabilities;this.capture=this.capture;this.zoomAt=this.oe;this.relaunch=this.ha;this.dispose=this.C;this.screenToGeo=this.Wa;this.geoToScreen=this.Ga;this.screenToLookAtData=this.xg;this.O=e;this.rc=A(this.rc,this);this.control=A(this.control,this);this.xb=A(this.xb,this);e.startControl=this.rc;e.control=this.control;e.endControl=this.xb;e.addEventListener(e.a.Da,this.Ug,!1,this);this.c=i;this.ig=A(this.ig,this);this.Ue=A(this.Ue,this);this.Ve=A(this.Ve,this);this.hg=A(this.hg,this);i.addEventListener($i.prototype.b.Da,this.ig,!1,this);i.addEventListener(i.b.pe,this.Ue,!1,this);i.addEventListener(i.b.re,this.Ve,!1,this);i.addEventListener(i.b.se,this.hg,!1,this)}u(rl,F);t("H.map.render.RenderEngine",rl);function sl(t,e){var i=t.i,r=i.width,n=i.height,o=i.padding,a=o.top,s=o.left,l=o.bottom;o=o.right;i=i.margin;var u=-(r+s-o)/2<<0,c=-(n+a-l)/2<<0;r+=u;n+=c;t=t.vb;t[1].set((u-i)*e,(c-i)*e,(r+i)*e,(n+i)*e);t[2].set(u*e,c*e,r*e,n*e);t[4].set((u+s)*e,(c+a)*e,(r-o)*e,(n-l)*e)}rl.prototype.T=function(){sl(this,this.qa)};rl.prototype.u=function(){var t=this.i,e=this.O,i=this.c;t.removeEventListener(t.a.Da,this.T,!1,this);t.startInteraction===this.sc&&(t.startInteraction=lk.prototype.sc);t.interaction===this.kc&&(t.interaction=lk.prototype.kc);t.endInteraction===this.yb&&(t.endInteraction=lk.prototype.yb);e.removeEventListener(e.a.Da,this.Ug,!1,this);e.startControl===this.rc&&(e.startControl=tl.prototype.rc);e.control===this.control&&(e.control=tl.prototype.control);e.endControl===this.xb&&(e.endControl=tl.prototype.xb);i.removeEventListener($i.prototype.b.Da,this.ig,!1,this);i.removeEventListener(i.b.pe,this.Ue,!1,this);i.removeEventListener(i.b.re,this.Ve,!1,this);i.removeEventListener(i.b.se,this.hg,!1,this)};rl.prototype.control=function(){};rl.prototype.capture=function(){return Yb(Error("not implemented"))};function ul(t,e){t.style.transition="opacity 1.5s";Ce(t,"transitionend",e,!1);t.style.opacity=0}var vl={ZOOM:1,HEADING:2,TILT:4,INCLINE:8,COORD:16};rl.InteractionModifiers=vl;n=rl.prototype;n.hk={ij:"render"};n.ig=function(t){this.zk(t);this.ha()};n.Ue=function(t){this.Xe(t.idx,t.added)};n.Ve=function(t){this.ji(t.idx,t.removed,t.type===this.c.b.se)};n.hg=function(t){t.removed&&this.Ve(t);this.Ue(t)};n.zk=id;n.Xe=function(t,e){this.Hh(t,e);0===t&&this.Jb();C(e,$i)&&wl(this,e,!0);this.ie();this.ha()};n.Jb=function(){var t=this.c.La();if(0<t.length){var e=t[0].max;this.Gg=t[0].min;this.Kg=e}else t=this.getCapabilities().lookAt.zoom,e=t.max,this.Gg=t.min,this.Kg=e;t=xl(this,this.zoom);t!==this.zoom&&(this.zoom=t,this.U.Fa(t),this.ab())};n.ab=function(t){this.D=this.sb();t&&(this.D.position=t);this.D.zoom=this.zoom-this.hb;this.D.position.alt=0};n.Lo=0;n.heading=180;n.sb=function(){return yl(this,{position:this.U.projection.og(this.b),zoom:this.zoom,tilt:this.Lo,heading:this.heading})};function yl(t,e){e.tilt=zl(t,e.tilt);e.heading=Al(t,e.heading);e.incline=t.getCapabilities().lookAt.incline.min;return e}function xl(t,e){var i=t.getCapabilities().lookAt.zoom;return Yd(e,wd(i.min,t.Gg),vd(i.max,t.Kg))}function zl(t,e){t=t.getCapabilities().lookAt.tilt;return Yd(e,t.min,t.max)}function Al(t,e){t=t.getCapabilities().lookAt.heading;return Yd((e%360+360)%360,t.min,t.max)}function wl(t,e,i){i=i?e.addEventListener:e.removeEventListener;i.call(e,e.b.gj,t.ki,!1,t);i.call(e,e.b.fj,t.ki,!1,t)}n.Hh=id;n.ji=id;n.Co=function(t,e){this.B={before:t,after:e}};rl.prototype.setOnRenderCallbacks=rl.prototype.Co;var Bl={P2D:0,WEBGL:1,HARP:2};rl.EngineType=Bl;var Cl={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:85},incline:{min:0,max:0},heading:{min:0,max:360}},interaction:{ZOOM:vl.ZOOM,COORD:vl.COORD},capture:!0};t("H.map.render.webgl.capabilities",Cl);function Dl(t){var e,i=this,r=x.H.gl;Dl.l.constructor.call(this);this.a=e=r.Scene.create(x.URL.createObjectURL(nf(JSON.stringify(El))),{viewport:t.viewport,container:t.tc,disableRenderLoop:!0,devicePixelRatio:t.devicePixelRatio,logLevel:"error"});t.lo&&e.subscribe({load:t.lo});e.subscribe({view_complete:function(){i.g=!0;t.Bk()}});var n=e.requestRedraw;e.requestRedraw=function(){n.apply(e);t.Bk()};this.i=A(this.i,this);this.f=A(this.f,this);this.j=0;this.c={};this.b={}}u(Dl,nd);Dl.prototype.g=!1;function Fl(t){t=t.a.sources;var e;for(e in t){var i=t[e];if(i.hasPendingCommands&&i.hasPendingCommands())return!0}return x.H.gl.Task.hasPendingTasks()}Dl.prototype.$=function(){var t=x.H.gl.Task;this.a.immediateRedraw();t.setState({user_moving_view:this.a.view.user_input_active});t.processAll();return this.g&&!this.a.dirty&&!this.a.building&&!Fl(this)&&!Object.keys(this.b).length};function Gl(t){t.g=!1;t.a.resetViewComplete()}function Hl(t){return t.a.view}function Il(t,e){function i(){var i=e.La(),n={},o={},a,s,l,u=++t.j,c,h;uh(o,El);for(s=0;s<i.length;s++){var f=i[s];if(a=f.pa()){var p=a.Db();if(p.getState()===Ph.READY){var d=p.od();if(!Ta(d)){delete d.cameras;delete d.camera;n[s]=d=Gh(d,s);!C(f,nl)&&d.sources&&Hh(d,a.uid);for(l in d.sources){var g=d.sources[l];g.max_zoom=vd(a.max,Cl.lookAt.zoom.max);g.max_display_zoom=f.max;g.min_display_zoom=f.min;if(h=a.tileSize)2<=r&&256<h&&a instanceof tk&&(h/=2),g.tile_size=h}(c=p.gc())&&Ih(d,c);uh(o,d)}}}}uh(o.layers.skybox.draw.skybox.color,o.scene.sky);t.a.config=o;return t.a.updateConfig().then(function(){var e={},r,o;if(u!==t.j)return!1;t.j=0;for(o in n){f=i[+o];var a=n[o].sources;for(r in a)if(a=t.a.sources[r])e[r]=a,a.initialize&&f.getProvider()&&a.initialize(f.getProvider(),t.i,t.a.getWorkers().length,a.tiled?B:t.a.tile_manager.getWorkerForTile(y,a))}for(r in t.c)!e[r]&&t.c[r].dispose&&t.c[r].dispose();t.c=e;return!0})}var r=t.a.pixelRatio();t.a.initialized?i():t.a.load(y,{blocking:!1}).then(i)}Dl.prototype.i=function(t,e,i){var r=this,n=this.a.sources[t],o=i&&i.isReload;e?!0!==this.b[t]&&(this.b[t]||(this.b[t]={ql:{},Sg:[]}),C(e,Mk)?this.b[t].ql[e.x+"/"+e.y+"/"+e.z]=!0:(e=e.boundingBox,this.b[t].Sg.push(new K(e[0],e[1],e[2],e[3])))):this.b[t]=!0;n&&n.has_volatile_data?Jl(this,o):(x.clearTimeout(this.m),this.m=x.setTimeout(function(){return Jl(r,o)},Kl))};var Kl=100;Dl.prototype.f=function(t){var e=!1,i=this.b[t.source.name],r=x.H.gl;if(i)if(!0===i)e=!0;else{var n=r.Tile.coord(r.Geo.wrapTile(t.coords));e=!!i.ql[n.key];if(!e)for(t=r.Geo.getTileBoundingBox(n,t.source.tile_size,O.MAX_LINE_WIDTH/2),t=dg(t.getTopLeft(),t.getBottomRight()),r=0;r<i.Sg.length;r++)if(i.Sg[r].td(t,!0)){e=!0;break}}return e};function Jl(t,e){var i=t.a.tile_manager;i.removeTiles(t.f);i.updateTilesForView();e&&i.removeCachedTiles(t.f);Gl(t);t.b={}}Dl.prototype.od=function(){return this.a.config};function Ll(t,e,i,r){t.a.getFeatureAt(e,i,r);t.a.update()}function Ml(t){return t.a.screenshot(void 0).then(function(t){return new Ob(function(e,i){new Cj(URL.createObjectURL(t.blob),function(t,r){1===t?e(r.getData()):i()},!1)})})}Dl.prototype.Za=function(){return this.a.pixelRatio()};Dl.prototype.u=function(){var t=this.c;Dl.l.u.call(this);this.a.destroy();this.b={};t&&Object.keys(t).forEach(function(e){t[e].dispose()});x.clearTimeout(this.m);this.c=this.a=null};var El={scene:{background:{color:"#FFFFFF"},sky:{zenith:"#347BC0",horizon:"#EDF2F9",fog:"#FFFFFF"}},lights:{default_light:{type:"directional",name:"default_light",visible:!0}},camera:{type:"perspective"},styles:{},fonts:{},sources:{skybox:{type:"SkyBox"}},layers:{skybox:{data:{source:"skybox"},draw:{skybox:{color:{}}}}},global:{}};function Nl(t,e){if(E(this.x=+t))throw new D(Nl,0,t);if(E(this.y=+e))throw new D(Nl,1,e)}Nl.prototype.add=function(t){return new Nl(this.x+t.x,this.y+t.y)};Nl.prototype.a=function(t){if(!C(t,Nl))throw new D(this.a,0,t);t=this.b(t);return t.x+t.y};Nl.prototype.b=function(t){if(!C(t,Nl))throw new D(this.b,0,t);return new Nl(this.x*t.x,this.y*t.y)};Nl.prototype.Fa=function(t){return new Nl(this.x*t,this.y*t)};function Ol(t){return Cd(t.a(t))}function Pl(t){t=t||gf;this.rb=tc(t.fo)?t.fo:3;this.aa=tc(t.co)?t.co:300;this.s=tc(t.Qo)?t.Qo:3;this.v=tc(t.Mo)?t.Mo:50;this.f=[];this.clear()}t("H.map.render.InteractionUtils",Pl);Pl.prototype.In=function(){return this.c};Pl.prototype.isGestureDetected=Pl.prototype.In;Pl.prototype.start=function(t,e){var i=vl.HEADING,r=vl.TILT;this.a&&this.clear();this.i=t;this.m=!!e;this.a=!0;this.c=!(t&(i|r))||t===i||t===r};Pl.prototype.start=Pl.prototype.start;Pl.prototype.store=function(t,e,i,r,n){var o=!1;if(this.a){t=new Ql(t,e,i,r,n);o=t.c;this.o=this.b;this.b=t;if(this.g){if(this.j=!0,o){e=this.i;var a=this.c;if(!a&&this.j){n=vl.HEADING;var s=vl.TILT;i=vl.COORD;r=vl.ZOOM;var l=e&(i|s)?this.Vd(!0):Rl;var u=e&r?this.Pf(!0):1;var c=e&n?Ad(this.oh(!0)):0;var h=Ad(l.x);var f=Ad(l.y);l=10<h||10<f;h=10<f&&f>3*h;u=.8>u||1.2<u;c=7<c;e&s&&(c||u||l&&!h?Sl(this,s):h&&(Sl(this,~s>>>0),a=!0));!a&&e&n&&e&(i|r)&&(u||l?(Sl(this,n),a=!0):c&&(Sl(this,s),a=!0));this.c=a}}}else this.g=t,o||(this.c=!0);this.m&&this.f.push(t)}return o};Pl.prototype.store=Pl.prototype.store;Pl.prototype.clear=function(){this.f.length=0;this.a=this.m=this.j=this.c=!1;this.g=this.o=this.b=void 0};Pl.prototype.clear=Pl.prototype.clear;Pl.prototype.Gc=function(t){return 0<(this.i&t)};Pl.prototype.isModifierEnabled=Pl.prototype.Gc;function Sl(t,e){t.i^=t.i&e}Pl.prototype.Ea=function(){return this.a};Pl.prototype.isRunning=Pl.prototype.Ea;var Rl=oc(new Nl(0,0));Pl.prototype.xc=function(){var t;if(this.m){var e=this.f;var i=e.length;var r=0;for(t=new Nl(0,0);--i&&r<this.s;)t=t.add(Tl(e[i-1],e[i])),r++}else t=this.Vd();e=t;i=Ol(e);return 0!==i?new Nl(e.x/i,e.y/i):e};Pl.prototype.getDirection=Pl.prototype.xc;Pl.prototype.Cb=function(t){t=t||Ak();var e,i;if(this.m){var r=this.f;var n=this.f.length;var o=this.f[n-1];for(i=e=0;--n&&e<this.s;)i+=Ol(Tl(r[n],r[n-1])),e++;r=i/e}else o=this.b,r=Ol(this.Vd());return r=r>=this.rb&&t-o.timestamp<=this.v?r>this.aa?this.aa:r:0};Pl.prototype.getSpeed=Pl.prototype.Cb;Pl.prototype.Of=function(){return this.b?Ul(this.b):B};Pl.prototype.getBifocalCenter=Pl.prototype.Of;Pl.prototype.Vd=function(t){return(t=t?this.g:this.o)?Tl(t,this.b):new Nl(0,0)};Pl.prototype.getMoveVector=Pl.prototype.Vd;Pl.prototype.Pf=function(t){var e=1;if(this.j){var i=this.b;t=t?this.g:this.o;if(t=Vl(t))if(i=Vl(i))e=i/t}return e};Pl.prototype.getBifocalScaling=Pl.prototype.Pf;Pl.prototype.oh=function(t){if(this.j){var e=t?this.g:this.o,i=this.b;t=e.b;var r=i.b,n=0;t&&r&&(e=e.a,i=i.a,n-=Kd(r.y-i.y,r.x-i.x)*Sd-Kd(t.y-e.y,t.x-e.x)*Sd);t=n}else t=0;return t};Pl.prototype.getBifocalRotation=Pl.prototype.oh;function Ql(t,e,i,r,n){this.a=new I(t,e);i!==B&&(this.b=new I(i,r),this.c=!0);this.timestamp=n!==B?n:Ak()}Ql.prototype.c=!1;function Ul(t){var e=t.a;return(t=t.b)?new I(e.x-(e.x-t.x)/2,e.y-(e.y-t.y)/2):B}function Wl(t,e){var i=t.a;return(t=t.b)&&t.Ya(e)<i.Ya(e)?t:i}function Tl(t,e){var i=t.b,r=e.b;r&&i?(e=Ul(e),t=Ul(t)):i?(e=e.a,t=Wl(t,e)):r?(t=t.a,e=Wl(e,t)):(e=e.a,t=t.a);return new Nl(e.x-t.x,e.y-t.y)}function Vl(t){var e=t.b;return e?t.a.Ya(e):0}var Yj=1,Zj=2,ak=3;function Xl(){F.call(this);this.reset()}u(Xl,F);Xl.prototype.start=function(t,e){this.a&&this.reset();E(t-e)||(this.b=+t,this.c=+e);this.a=!0};Xl.prototype.reset=function(){this.a=!1;this.b=this.c=null;this.f=new Yl(0,0,0,0,0,0)};Xl.prototype.Ea=function(){return this.a};Xl.prototype.g={Ig:"animationupdate"};function Zl(t){Zl.l.constructor.call(this,Xl.prototype.g.Ig);this.c=t}u(Zl,rd);Xl.prototype.set=function(t,e,i,r,n,o){var a=this.f;this.a&&(t=new Yl(t/1e3,e/1e3,i/1e3,r/1e3,n/1e3,o/1e3),a.na(t)||(this.f=t,this.dispatchEvent(new Zl($l(this)))))};function $l(t){return x.Object.create(t.f)}Xl.prototype.Cb=function(){return $l(this).Cb()};Xl.prototype.xc=function(){var t=$l(this),e=this.Cb()||1;return new Yl(t.mb/e,t.nb/e,t.ob/e,t.je,t.ke,t.kf)};Xl.prototype.u=function(){this.reset();Xl.l.u.call(this)};function Yl(t,e,i,r,n,o){this.mb=t;this.nb=e;this.ob=i;this.je=r;this.ke=n;this.kf=o}Yl.prototype.Cb=function(){return Cd(this.mb*this.mb+this.nb*this.nb+this.ob*this.ob)};Yl.prototype.xc=function(){var t=this.Cb()||1;return new Yl(this.mb/t,this.nb/t,this.ob/t,this.je,this.ke,this.kf)};Yl.prototype.na=function(t){return!!t&&this.mb===t.mb&&this.nb===t.nb&&this.ob===t.ob&&this.je===t.je&&this.ke===t.ke&&this.kf===t.kf};function am(t,e,i,r){am.l.constructor.call(this);this.tc=t;this.qa=r;this.a=t.appendChild(this.createElement(t.ownerDocument));bm(this,e,i)}u(am,nd);n=am.prototype;n.G=function(){return this.a};function bm(t,e,i){t.size?(t.size.w=e,t.size.h=i):t.size=new Ji(e,i);t.hl(t.a,t.a.style,e,i,t.qa)}n.Bb=function(){return this.size};n.Za=function(){return this.qa};n.ek=!0;n.ub=function(t){t!==this.ek&&(this.a.style.display=t?"block":"none",this.ek=t)};n.Wh=1;n.pc=function(t){this.Wh!==t&&(this.ik(t),this.Wh=t)};n.ad=function(){return this.Wh};n.rf=function(t){this.a.style.zIndex=t};n.Sj=function(){return+this.a.style.zIndex};n.Yc=function(){};n.clear=function(){};n.u=function(){this.clear();this.tc.removeChild(this.a);bm(this,0,0);this.a=this.tc=null;am.l.u.call(this)};n.Mk=0;n.wg=function(){++this.Mk};n.release=function(){--this.Mk||this.C()};function cm(t,e,i,r){cm.l.constructor.apply(this,arguments)}u(cm,am);n=cm.prototype;n.Qd=function(){return"dom"};n.createElement=function(t){t=t.createElement("DIV");t.style.position="absolute";return t};n.hl=function(t,e,i,r){e.width=i+"px";e.height=r+"px"};n.ik=function(t){this.a.style.opacity=t};n.Yc=function(t,e,i){var r=this.qa,n=t.style;n[xf("transform")]="matrix(1,0,0,1,"+e/r+","+i/r+")";t.parentNode!==this.a&&(n.position="absolute",this.a.appendChild(t))};n.clear=function(t){t?this.a.removeChild(t):this.a.innerHTML=""};function dm(t,e,i,r,n,o){var a=n||"2d";dm.l.constructor.apply(this,arguments);this.b=this.a.getContext(a,o);this.c="2d"===a;this.f=a;this.Un=o}u(dm,am);n=dm.prototype;n.createElement=function(t){t=t.createElement("canvas");var e=t.style;e.position="absolute";e.top=e.left="0";return t};n.hl=function(t,e,i,r,n){t.width=wd(i,1);t.height=wd(r,1);e.width=xd(i/n)+"px";e.height=xd(r/n)+"px"};n.ik=function(t){this.b.globalAlpha=t};n.Yc=function(t,e,i,r,n){this.c&&this.b.drawImage(t,e,i,r,n)};n.Qd=function(){return this.f};n.clear=function(t){var e,i;this.c&&(t?this.b.clearRect(e=t.left,i=t.top,t.right-e,t.bottom-i):this.a.width=this.size.w)};n.u=function(){this.a.width=this.a.height=0;this.b=y;dm.l.u.call(this)};function em(t){this.gb=t}u(em,nd);em.prototype.Ab=function(){return this.gb};em.prototype.qf=function(t){var e=this.Hb;t!==e&&(this.Hb=t,t.wg(),e&&e.release())};em.prototype.u=function(){this.Hb.release()};em.prototype.Zd=function(){};function fm(t){var e="dom";fm.l.constructor.call(this,t);C(this.gb,gm)&&(e="2d"===t.Qd()?"2d":"webgl");this.a=e}u(fm,em);fm.prototype.$=function(t,e,i,r,n,o,a,s){a=this.gb;var l=this.Hb,u=!(C(l,dm)&&"2d"===l.Qd());if(r>=a.min&&r<=a.max)return u&&l.ub(!0),a.$(l.G(),{boundingBox:t,zoom:r,screenCenter:e,priorityCenter:o,projection:i,cacheOnly:n,size:l.Bb(),pixelRatio:l.Za(),cameraMatrix:s});u&&l.ub(!1);return kk.DONE};fm.prototype.Zd=function(){return this.a};t("H.util.animation.ease.LINEAR",function(t){return t});t("H.util.animation.ease.EASE_IN_QUAD",function(t){return t*t});function hm(t){return-t*(t-2)}t("H.util.animation.ease.EASE_OUT_QUAD",hm);t("H.util.animation.ease.EASE_IN_OUT_QUINT",function(t){t*=2;return 1>t?Dd(t,5)/2:(t-=2,Dd(t,5)/2+1)});t("H.util.animation.ease.EASE_OUT_CIRC",function(t){return Cd(2*t-t*t)});function im(t,e,i,r){if(!Ca(this.i=t))throw new D(im,0,t);if(E(this.g=+e))throw new D(im,1,e);if(!Ca(this.f=i)&&null!=i)throw new D(im,2,i);if(!Ca(this.c=r)&&null!=r)throw new D(im,3,r);this.id=jm.next();this.a=!1}t("H.util.animation.Animation",im);var jm=new af;im.prototype.start=function(){var t=this,e=Kk;var i=function(){var n=Ak(),o=n-t.Qc,a=o/t.g;if(1<=a){a=1;var s=!0}t.c&&(a=t.c(a));t.i(a,o,n-r,n);r=n;s?t.stop():t.b=e(i)};t.Qc=Ak();var r=t.Qc;t.a=!0;t.b=e(i)};im.prototype.start=im.prototype.start;im.prototype.stop=function(t){Lk(this.b);this.a=!1;t||this.f&&this.f(this)};im.prototype.stop=im.prototype.stop;im.prototype.Ea=function(){return this.a};im.prototype.isRunning=im.prototype.Ea;function km(t,e){km.l.constructor.call(this,t);this.vc=!(!e||!e.vc);this.c={}}u(km,em);km.prototype.qf=function(t){km.l.qf.call(this,t);this.f=t.tc.ownerDocument};var lm=function(t,e){e=e.ba();return C(e,jh)?e.oa:(t[0]=e,t)}.bind(null,[]);km.prototype.$=function(t,e,i,r,n,o,a){var s=this.gb,l,u,c,h;this.j=e=this.c;this.c=i={};if(r>=s.min&&r<=s.max){var f=this.Fj(t,r,n,o);var p=f.markers;if(t=p.length){r=[];n=this.Hb;for(o=0;o<t;o++){s=p[o];var d=lm(s);for(l=d.length;l--;)if(u=a(d[l]))(h=e[c=s.fb()+"_"+l])?delete e[c]:h={uk:s},i[c]=h,r.push([h,s,s.zb(),n,u.x,u.y])}r.sort(mm);t=r.length;for(o=0;o<t;o++)this.Ok.apply(this,r[o])}}return!f||f.requested&&f.requested===f.total||!f.requested&&p.length===f.total?kk.DONE:kk.PENDING};function mm(t,e){var i=t[1].bd(),r=e[1].bd();return Qg(i,r,!0)||t[5]-e[5]||Qg(i,r,!1)}km.prototype.Ua=function(){};function nm(t,e){nm.l.constructor.apply(this,arguments);this.b=0;this.a=[];this.jh=A(this.jh,this)}u(nm,km);n=nm.prototype;n.Fj=function(){return this.gb.Jc.apply(this.gb,arguments)};n.$=function(t,e,i,r,n,o,a){this.jh();this.i=0;var s=nm.l.$.apply(this,arguments);var l=this.Hb,u=this.j,c;for(c in u)om(this,l,u[c]);return 0===this.a.length&&s?kk.DONE:kk.PENDING};n.qf=function(t){nm.l.qf.call(this,t);this.g=t.Za()};n.jh=function(){for(var t=this.a.length,e,i,r;t--;)r=this.a[t],e=r.xf,i=r.xf.zb(),i.hi(r,i,e);this.a.length=0};n.Ok=function(t,e,i,r,n,o){var a;var s=r.Za();var l=e.Qb();n*=s;o*=s;this.vc||(n=xd(n),o=xd(o));t.detail&&(l.ce(t.En)?om(this,r,t):a=t.detail);a||(t.detail=a=i.Ij(this.f),this.b++,Ca(i.hi)&&this.a.push(a));t.En=l.a;a.style.zIndex=this.i++;a.xf=e;r.Yc(a,n,o,0,0)};var pm,qm="pointer-events",rm;if(Ye){var sm;Ye&&Zc!==y&&(Zc=(sm=/(MSIE\s+|rv:)([^\);]+)(\)|;)/.exec(navigator.userAgent))?+sm[2]:y);rm=Zc;9===rm?qm="display":10===rm&&(qm="visibility")}pm=qm;nm.prototype.Ua=function(t,e,i){var r=this.g,n=ff,o,a,s,l,u;if(this.b){t/=r;e/=r;r=this.f;var c=r.documentElement;var h=this.Hb.G();var f=h.getBoundingClientRect();t+=f.left;for(e+=f.top;(a=s=r.elementFromPoint(t,e))&&a!==h&&a!==c&&s!==p;){for(;(l=a.parentNode)&&(!Ca(l.contains)||!l.contains(h));)a=l;if(l===h&&(a!==s||"svg"!==a.nodeName)&&0>n.indexOf(u=a.xf)&&(n===ff&&(n=[]),n.push(u),i))break;o||(o=[]);var p=a.style;o.push({sj:p.getPropertyValue(pm),Dn:p.getPropertyPriority(pm),style:p});p.setProperty(pm,"visibility"===pm?"hidden":"none","important");p=s}if(o)for(e=o.length;e--;)t=o[e],t.style.removeProperty(pm),zc(t.sj)&&t.style.setProperty(pm,t.sj,t.Dn)}return n};nm.prototype.Zd=function(){return"dom"};function om(t,e,i){e.clear(e=i.detail);delete e.xf;t.b--;i=(t=i.uk).zb();i.b&&i.b(e,i,t)}nm.prototype.u=function(){this.a.length=0;var t=this.Hb,e=this.c,i;for(i in e)om(this,t,e[i]);this.Hb.C();nm.l.u.call(this)};function gm(t,e){var i=e||{},r=i.contextType;i=i.contextAttributes;gm.l.constructor.call(this,e);wc(t,"Function",gm,0,"invalid render callback");if(r){if(-1===tm.indexOf(r))throw new D(gm,1,"invalid context type");this.f=r}i&&(this.m=i);this.j=t}u(gm,$i);t("H.map.layer.CanvasLayer",gm);var tm=["2d","webgl","webgl2","experimental-webgl"];gm.prototype.f="2d";gm.prototype.Qd=function(){return this.f};gm.prototype.$=function(t,e){this.c&&this.c.canvas===t||(this.c=t.getContext(this.f,this.m));return this.j(this.c,e)};gm.prototype.u=function(){gm.l.u.call(this);this.c=B};function um(t,e){um.l.constructor.call(this,e);wc(t,"Function",um,0,"invalid render callback");this.c=t}u(um,$i);t("H.map.layer.DomLayer",um);um.prototype.$=function(t,e){return this.c(t,e)};function vm(t,e){if(E(this.b=+t))throw new D(vm,0,t);this.a=0;e&&this.bl(e)}t("H.util.kinetics.KineticMove",vm);vm.prototype.bl=function(t){this.a=t;return this};vm.prototype.setInitialSpeed=vm.prototype.bl;vm.prototype.um=function(){return Math.abs(this.a/this.b)};vm.prototype.getDuration=vm.prototype.um;vm.prototype.Ke=function(t){return this.a+this.b*t};vm.prototype.getCurrentSpeed=vm.prototype.Ke;vm.prototype.pm=function(t){return this.a*t+this.b*t*t/2};vm.prototype.getCurrentPath=vm.prototype.pm;function wm(t,e){this.a=t;this.b=e}function xm(t,e,i){var r=[],n={tc:t.a,width:e.w,height:e.h,qa:t.b};for(t=0;t<i.length;t++){e=i[t];var o=e.Zd();var a={};Wa(a,n);var s=e.Hb;switch(o){case"2d":C(e.Ab(),gm)&&(a.Zg=e.Ab().m);if(o=c&&"2d"===c.Qd()){o=a.Zg;var l=c.Un;o=l===o?!0:l&&!o?!l.alpha&&!l.willReadFrequently:o&&!l?!o.alpha&&!o.willReadFrequently:!o.alpha===!o.alpha&&!l.willReadFrequently===!o.willReadFrequently}if(o)var u=!1;else if(s&&!u){var c=s;u=!1}else c=new dm(a.tc,a.width,a.height,a.qa,"2d",a.Zg),u=!0;break;case"dom":c=s||new cm(a.tc,a.width,a.height,a.qa);u=!s;break;default:c=s||new dm(a.tc,a.width,a.height,a.qa,e.Ab().Qd(),a.Zg),u=!s}r[r.length-1]!==c&&(c.rf(r.length),r.push(c));e.qf(c)}return r}t("H.util.events.listenOnce",Ce);t("H.util.events.dispatchEvent",function(t,e){return t.dispatchEvent(e)});t("H.util.events.fireListeners",function(t,e,i,r){return le(t)?t.md(e,i,r):Me(t,e,i,r)});t("H.util.events.listen",Be);t("H.util.events.unlisten",Ke);var ym=Ne;Ne=function(t,e){var i,r,n=!0;var o=e[e.currentTarget===e.target?"AT_TARGET":t.capture?"CAPTURING_PHASE":(i=!0,"BUBBLING_PHASE")];if(!i||"pointerenter"!==(r=e.type)&&"pointerleave"!==r)e.eventPhase=o,n=ym(t,e),i&&t.src&&t.src.ic&&null===t.src.ic()&&delete e.eventPhase;return n};function tl(){tl.l.constructor.call(this);this.c={};this.b={position:new Xf(0,0),zoom:0,heading:180,incline:0,tilt:0,bounds:new P(Gg([90,-180,90,0,90,180,-90,180,-90,-180]))}}u(tl,F);t("H.map.ViewModel",tl);tl.prototype.a={Da:"update",te:"sync"};tl.prototype.$b=function(t,e){if(!t)throw new D(this.$b,0,t);var i=t[zm];if(tc(i)&&!Yf(i))throw new D(this.$b,0,zm);i=t[Am];if(tc(i)&&E(+i))throw new D(this.$b,0,Am);i=t[Bm];if(tc(i)&&!C(i,Wf))throw new D(this.$b,0,Bm);t=x.Object.assign({},t);i=Cm(t,this.c,this.b);Dm(this,this.c,t);this.dispatchEvent(new Em(this.c,i,e));return this};tl.prototype.setLookAtData=tl.prototype.$b;tl.prototype.sb=function(){var t={};t[zm]=Zf(this.b[zm]);Dm(this,t,this.b,!0);return t};tl.prototype.getLookAtData=tl.prototype.sb;var zm="position",Am="zoom",Bm="bounds",Fm={hj:zm,kj:Am,bj:"heading",jj:"tilt",cj:"incline",Zi:Bm},Gm=Object.keys(Fm).map(function(t){return Fm[t]});function Dm(t,e,i,r){t.i={};t.g={};t.f=[];for(var n=t.m,o=t.j,a=Gm.length,s,l,u,c;a--;)if(s=Gm[a],c=i[s],l=e[s],null==l||!r)if(null!=c){tc(n)&&n.call(t,s,l,c);u=s;var h;(h="position"!==s)||(h=c,h=!h||E(h.lat)||E(h.lng)?!1:!0);e[u]=h?c:Zf(c);if(tc(o)){switch(s){case"position":u=c&&l&&(c.lat!==l.lat||c.lng!==l.lng);break;case"bounds":u=c&&l&&!c.na(l);break;default:u=c!==l}u&&o.call(t,s,l,c)}}else delete e[s]}tl.prototype.m=function(t,e,i){this.i[t]=e;this.g[t]=i};tl.prototype.j=function(t){this.f.push(Hm[t])};var Hm=Gm.reduce(function(t,e){t[e]=Ri[e.toUpperCase()];return t},{});function Cm(t,e,i){var r=0;["tilt","incline","heading",Am].forEach(function(n){if(E(t[n])){var o=E(e[n])?i[n]:e[n];t[n]=o}else r|=Hm[n]});[zm,Bm].forEach(function(n){t[n]?r|=Hm[n]:t[n]=e[n]||i[n]});return r}tl.prototype.ab=function(t){var e={},i={};Dm(this,this.b,t);this.c={};e.lookAt=this.g;i.lookAt=this.i;t=this.f;t=t.length?t.reduce(Im):0;this.dispatchEvent(new Qi(this.a.te,e,i,t))};tl.prototype.synchronize=tl.prototype.ab;function Im(t,e){return t|e}tl.prototype.sf=function(t,e){if(E(t=+t))throw new D(this.sf,0,Am);this.$b({zoom:t},e)};tl.prototype.tb=function(){return this.b.zoom};tl.prototype.rc=Nc;tl.prototype.startControl=tl.prototype.rc;tl.prototype.control=Nc;tl.prototype.control=tl.prototype.control;tl.prototype.xb=Nc;tl.prototype.endControl=tl.prototype.xb;function Em(t,e,i){Em.l.constructor.call(this,tl.prototype.a.Da,t,null,e);this.b=this.animate=!!i}u(Em,Qi);function S(t,e,i,r){S.l.constructor.call(this,t,e,i,r);this.Gd=new Ek(100);this.fa=new I(0,0);this.Be=!!r.enableSubpixelRendering;this.jb=Jm;this.o=new Pl;this.j=r=new Xl;this.cc=A(this.cc,this);r.addEventListener(r.g.Ig,this.cc);r=t.element;this.K=t=r.ownerDocument.createElement("div");t.style.position="absolute";t.style.width=t.style.height="100%";t.style.zIndex=0;r.insertBefore(t,r.firstChild);this.Id=new wm(this.K,this.qa);t=x.H.gl;if(!t)throw new Yc(S,'"H-webgl" module is missing');this.a=new Dl({viewport:this.i,tc:this.K,devicePixelRatio:this.qa,Bk:A(this.ha,this)});t.WorkerBroker.addTarget("model",cj);t=this.c.La();r=0;var n=t.length;this.m={Xc:[],ia:[]};for(this.f=t;r<n;r++){var o=t[r];this.Xe(r,o);wl(this,o,!0)}this.Jb();this.dc=A(this.dc,this);this.Yh=A(this.Yh,this);this.Ga=A(this.Ga,this);i.addEventListener($i.prototype.b.qe,this.dc);this.A=Km;this.hf();this.zoom=xl(this,this.O.tb());this.Jb();this.U.Fa(this.zoom);this.b=this.U.projection.Nb(e.sb().position);this.U.x=this.U.w*this.b.x;this.U.y=this.U.h*this.b.y;this.T()}u(S,rl);t("H.map.render.webgl.RenderEngine",S);S.prototype.dc=function(t){t=(t=t.target.pa())&&t.Db();(t&&t.getState())===Ph.INIT?t.load():(Gl(this.a),Il(this.a,this.c),this.ha())};S.prototype.type=Bl.WEBGL;S.prototype.type=S.prototype.type;var Km=2;S.prototype.getState=function(){return this.A};S.prototype.getState=S.prototype.getState;function Lm(t,e,i){e=i-e;return Ad(e)<t.U.w/2?e:e-t.U.w*i/Ad(i)}S.prototype.Ug=function(t){var e=t.newValue,i=t.modifiers,r=Hl(this.a);Mm(this);this.fa.set(0,0);var n=Nm(this,e);Om(this);Gm.forEach(function(e){i&t[e.toUpperCase()]||delete n[e]});t.b?Pm(this,n,t):r.setLookAtData(n);Qm(this);Gl(this.a);this.ha()};function Pm(t,e,i){var r=[],n=i.modifiers;i=Hl(t.a);var o=i.getLookAtData(),a,s,l,u=0,c={},h=i.setLookAtData.bind(i);Gm.forEach(function(t){switch(t){case"heading":case"tilt":case"incline":if(n&(Ri.HEADING|Ri.TILT|Ri.INCLINE)){var i=e[t]-o[t];c[t]=-180<i&&180>=i?i:180<i?i-360:i+360;c[t]&&r.push(t)}break;case"zoom":n&Ri.ZOOM&&(c[t]=e[t]-o[t],c[t]&&r.push(t));break;case"position":if(n&Ri.POSITION){a=Zf(o.position);var u=e.position;i=u.lat*Rd;var h=a.lat*Rd,f=u.lng*Rd-a.lng*Rd;u=Fd(f)*Hd(i);i=Hd(h)*Fd(i)-Fd(h)*Hd(i)*Hd(f);i=Math.atan2(u,i);l=(0<=i?i:Pd+i)*Sd;(s=a.Ya(e.position))&&r.push(t)}}delete o.bounds});r.length?Rm(t,function(t){var e=t-u,i={};n&(Ri.HEADING|Ri.TILT|Ri.INCLINE|Ri.ZOOM)&&r.forEach(function(t){Cc(c[t])&&(o[t]+=c[t]*e,i[t]=o[t])});n&Ri.POSITION&&(i.position=a.Eg(l,s*t,!0));h(i);Gl(this.a);Qm(this);this.ha();u=t}.bind(t),t.la,function(){h(e);Gl(this.a);this.ha()}.bind(t),t.V):h(e)}S.prototype.la=300;S.prototype.lf=function(t){var e=Cc(t);if(!e||e&&0>t)throw new D(this.lf,1,"positive number required");this.la=t};S.prototype.setAnimationDuration=S.prototype.lf;S.prototype.mh=function(){return this.la};S.prototype.getAnimationDuration=S.prototype.mh;S.prototype.V=hm;S.prototype.mf=function(t){if(!Ca(t))throw new D(this.mf,1,"function required");this.V=t};S.prototype.setAnimationEase=S.prototype.mf;S.prototype.nh=function(){return this.V};S.prototype.getAnimationEase=S.prototype.nh;S.prototype.hf=function(){this.V=hm;this.la=300};S.prototype.resetAnimationDefaults=S.prototype.hf;n=S.prototype;n.zk=function(){Gl(this.a);this.ha()};n.Xe=function(t,e){S.l.Xe.call(this,t,e);Sm(e)&&(Gl(this.a),(t=(t=e.pa())&&t.Db())&&t.getState()===Ph.INIT&&t.load())};n.ji=function(t,e,i){var r;this.Xa=Ak();if(e.requestDomMarkers||C(e,gm)||C(e,um)){var n=this.m.ia;for(r=n.length;r--;){var o=n[r];if(o.Ab()===e){n.splice(r,1);o.C();break}}}Sm(e)&&Il(this.a,this.c);this.f=this.c.La();0===t&&(wl(this,e,!1),this.Jb());xm(this.Id,Tm(this),this.m.ia.filter(tc));this.ie();i||this.ha()};function Sm(t){return!(C(t,um)||C(t,gm))}n.ki=function(){this.Jb()};n.Jb=function(){S.l.Jb.call(this);var t=this.getCapabilities().lookAt.zoom;Hl(this.a).setZoomConstraints(wd(t.min,this.Gg),vd(t.max,this.Kg))};n.Hh=function(t,e){var i;if(e){t={vc:this.Be,hb:this.hb};e.$?C(e,gm)?i=new fm(e):C(e,um)&&(i=new fm(e)):e.requestDomMarkers&&(i=new nm(e,t));if(i){this.m.ia.push(i);var r=this.c.La();this.m.ia.sort(function(t,e){return r.indexOf(t.gb)-r.indexOf(e.gb)});xm(this.Id,Tm(this),this.m.ia.filter(tc))}Sm(e)&&Il(this.a,this.c)}this.f=this.c.La()};function Nm(t,e){var i=e.position;return yl(t,{zoom:xl(t,e.zoom),position:new Xf(i.lat,i.lng),tilt:e.tilt,heading:e.heading,bounds:e.bounds})}function Qm(t){var e=t.U,i=Hl(t.a).getLookAtData();e.Fa(i.zoom);t.zoom=i.zoom;t.b=e.projection.Nb(i.position);e.x=e.w*t.b.x;e.y=e.h*t.b.y}n.Ga=function(t){return Hl(this.a).geoToPixel(t)};S.prototype.geoToScreen=S.prototype.Ga;S.prototype.Wa=function(t,e){return Hl(this.a).xyToGeo(t,e)};S.prototype.screenToGeo=S.prototype.Wa;S.prototype.xg=function(t,e){t=this.Wa(t,e);e=this.O.sb();e.position=t;return e};function Um(t,e,i,r,n,o,a,s){var l,u,c=0,h;var f=function(){0===--c&&o(n)};if(s&&s.features)for(c=u=s.features.length,h=0;h<u;h++){var p=s.features[h];var d=p.id;if(l=t.a.a.sources[p.source_name]){var y=l.provider;var g=Xj(y);if(g===Zj){var v=p.source_layer;if("overlays"===v)Vm(t,e,i,r,n,l,p.properties.overlays_config);else if(l=l.getMapObjectById(d))if("markers"!==v)n.push(l);else if(Wm(t,e,i,l))n.push(l);else if(r&&!a){var _=!0;Ll(t.a,{x:e,y:i},{radius:Xm,top_most_only:!1},function(a){Um(t,e,i,r,n,o,!0,a)})}c--}else g===Yj?(v=p.tile.coords,_=y.getFeatureProxy(p.properties,v,function(t){if(t){for(var e=t,i;e&&(i=e.ic())&&i!==y;)e=i;i||e.ja(y);n.push(t)}f()}),_||(l=t.Gd.get(d),l||(l=new Kg(p),l.ja(y),t.Gd.add(d,l,1)),n.push(l),c--)):g===ak&&(_=!0,y.Pk(p,!1).then(function(t){t&&(t instanceof Mi?Wm(this,e,i,t):1)&&n.push(t);f()},function(){f()},t))}}g&&(_||0!==c)||o(n)}function Vm(t,e,i,r,n,o,a){var s;t=t.Wa(e,i);for(e=a.length;e--&&(!(s=o.getMapObjectById(a[e].id))||0<=n.indexOf(s)||!s.ba().Ld(t)||(n.push(s),!r)););}function Wm(t,e,i,r){var n=r.zb(),o=n.g,a,s=!o;if(o)if(n=n.nd(),e+=n.x,i+=n.y,n=r.ba(),C(n,Ii))for(r=n.oa,a=r.length;a--&&!s;)n=t.Ga(r[a]),s=o.$f(e-n.x,i-n.y,0)!==ae.NONE;else n=t.Ga(n),s=o.$f(e-n.x,i-n.y,0)!==ae.NONE;return s}S.prototype.Ua=function(t,e,i,r){var n=this,o=[];o=Ym(o,this.m.ia,t*this.qa,e*this.qa,i);i&&o.length?r(o):this.a.a.initialized?Ll(this.a,{x:t,y:e},{radius:Xm,top_most_only:i},function(a){Um(n,t,e,i,o,r,!1,a)}):r(o)};S.prototype.getObjectsAt=S.prototype.Ua;function Ym(t,e,i,r,n){for(var o=e.length,a;o--&&!((a=e[o])&&a.Ua&&(t=t.concat(a.Ua(i,r,n)),t.length&&n)););return t}S.prototype.wa=y;function Tm(t){t=t.vb[2];return{w:t.right-t.left,h:t.bottom-t.top}}S.prototype.T=function(){var t=this.m.ia.length;sl(this,this.qa);this.fa.set(0,0);var e=Tm(this);var i=e.w;var r=e.h;for(this.a.a.handleViewportUpdate();t--;){e=this.m.ia[t].Hb;var n=e.Bb();n.w===i&&n.h===r||bm(e,i,r)}this.wa=new Ji(i,r);Gl(this.a);this.ha()};S.prototype.getCapabilities=function(){return Cl};S.prototype.getCapabilities=S.prototype.getCapabilities;function Zm(t){(Fl(t.a)||Ak()-t.Xa<t.jb)&&!t.v?t.Jg=Kk(t.Yh):(t.v&&(t.ie(),$m(t)),t.A=Km)}n=S.prototype;n.ie=function(){this.m.Xc.length=0};n.Yh=function(){this.B&&this.B.before();var t=Hl(this.a);var e=t.getLookAtData(!1);var i=t.getLookAtData(!0);t=this.i.center.clone();i=i.bounds.F();var r=this.zoom;var n=this.fa;var o=this.f;var a=o.length;for(this.jb=Jm;a--;){var s=o[a];C(s,$i)&&s.pa()&&s.pa().pi(i,r)}this.v=this.a.$();this.O.ab(e);e=this.v;o=this.m;a=o.ia.length;var l=!0,u;for(u=0;u<a;u++){s=o.ia[u];var c=o.Xc;if(s){var h=s.$(i,t,void 0,r,!1,n,this.Ga,this.a.a.getCameraMatrix());h===kk.ACTIVE&&(this.jb=Infinity);h!==kk.DONE||c[u]||($m(this,s.Ab()),c[u]=!0);c[u]||(l=!1)}}this.v=e&l;this.wa&&(this.i.ab(this.wa),this.wa=y);this.B&&this.B.after();Zm(this)};function $m(t,e){setTimeout(A(t.dispatchEvent,t,{type:t.hk.ij,target:e||t}),1)}n.u=function(){var t=this.c.La()[0],e=this.i;Lk(this.Jg);Om(this,!0);t&&wl(this,t,!1);this.m.ia.filter(tc).forEach(function(t){t.C()});e.element&&e.element.removeChild(this.K);this.K=null;this.A=3;this.a.C();S.l.u.call(this)};n.ha=function(){this.Xa=Ak();this.A===Km&&(this.v=!1,this.A=1,Zm(this))};function an(t,e,i){Hl(t.a).applyPxOffset([e,i]);Qm(t);t.fa.set(0,0);Gl(t.a);t.ha()}n.oe=function(t,e,i){t=xl(this,xl(this,t));bn(this,t,e,i)};S.prototype.zoomAt=S.prototype.oe;function bn(t,e,i,r){Hl(t.a).setLookAtData({zoom:e},Cc(i)&&Cc(i)?[i,r]:B);Qm(t);Gl(t.a);t.ha()}function Mm(t){Om(t,!0);t.j.Ea()&&t.xb(!0);t.o.Ea()&&t.yb(!0);Om(t,!0)}function cn(t,e){if(e){var i={};i.af=e.power;i.Ce=e.ease;i.duration=e.duration;t.s=i}}S.prototype.sc=function(t,e){var i=!!(e||t&(vl.HEADING|vl.TILT));Mm(this);cn(this,e);this.o.start(t,i);Hl(this.a).setPanning(!0)};S.prototype.startInteraction=S.prototype.sc;S.prototype.kc=function(t,e,i,r,n){var o=this.o;var a=!1;if(o.Ea()){var s=Hl(this.a);var l=s.getLookAtData();var u=this.i.center;u=[u.x,u.y];e=o.store(t,e,i,r,n);i=o.Of();t=o.Vd();n=this.o.Pf();r=this.o.oh();o.c&&(o.Gc(vl.TILT)&&(s.setLookAtData({tilt:zl(this,l.tilt+t.y/this.i.height*-180)},u),a=!0),e&&1!==n&&o.Gc(vl.ZOOM)&&(a=o.Of(),n=Bd(Dd(2,this.zoom)*n)/Ld,bn(this,xl(this,n),a.x,a.y),a=!0),o.Gc(vl.COORD)&&0<Ol(t)&&(an(this,-t.x,-t.y),a=!0),o.Gc(vl.HEADING)&&(e?s.setLookAtData({heading:l.heading+Al(this,r)},[i.x,i.y]):t.x&&s.setLookAtData({heading:Al(this,l.heading+t.x/this.i.width*360)},u),a=!0),a&&(Gl(this.a),this.ha()))}};S.prototype.interaction=S.prototype.kc;S.prototype.yb=function(t){var e=this;if(this.o.Ea()&&!t){if(this.s){t=this.o.Cb();var i=this.o.xc();var r=this.s.duration;var n=(this.s.af||1)*t;var o=new vm(-n/(0<r?r:1),n);!E(i.x)&&!E(i.y)&&0<n&&e.o.Gc(vl.COORD)&&Rm(this,function(t){n=o.Ke(t*r);E(n)||an(e,xd(-i.x*n),xd(-i.y*n))},r,void 0,this.s.Ce)}this.s=null;this.o.clear()}Hl(this.a).setPanning(!1);this.ha()};S.prototype.endInteraction=S.prototype.yb;S.prototype.rc=function(t,e,i){Mm(this);this.j.start(e,i);cn(this,t);Hl(this.a).setPanning(!0)};S.prototype.startControl=S.prototype.rc;S.prototype.control=function(t,e,i,r,n,o){for(var a=0,s;a<arguments.length;a++)if(s=+arguments[a],s!==s)throw new D(this.control,a,s);this.j.Ea()&&this.j.set(t,e,i,r,n,o)};S.prototype.control=S.prototype.control;S.prototype.xb=function(t,e){var i=this,r;if(this.j.Ea()){Om(this,!0);var n=Ak();var o=n-this.za;if(1<=o){var a=$l(this.j);dn(this,a,o)}if(!this.s||t||e)"function"===typeof e&&(t=Hl(this.a),t=t.getLookAtData(),e(t),en(this,t));else{e=this.j.Cb();var s=this.j.xc();var l=this.s.duration;var u=(this.s.af||1)*e;var c=new vm(-u/(0<l?l:1),u);!E(s.mb)&&!E(s.nb)&&0<u&&Rm(this,function(t,e,o,a){n&&(o=a-n,n=0);u=c.Ke(t*l)*o;E(u)||((r=s.ob*u)&&bn(i,xl(i,i.zoom+r),i.j.b,i.j.c),an(i,xd(s.mb*u),xd(s.nb*u)))},l,void 0,this.s.Ce)}this.j.reset();Hl(this.a).setPanning(!1);this.ha()}};S.prototype.endControl=S.prototype.xb;function en(t,e){var i=t.b,r=t.U.projection.Nb(e.position),n=t.U.ed(r);r=n.y;n=n.x;var o=e.zoom;i=t.U.ed(i);e=i.y;var a=i.x;i=t.zoom;var s=t.j.Cb(),l=t.j.b,u=t.j.c,c=0;n=Lm(t,a,n);n-=a;r-=e;i=o-i;e=Cd(n*n+r*r+i*i);if(0!==s&&0!==e){var h=n/e;var f=r/e;var p=i/e;var d=s*s/(2*e);Rm(t,function(e,i){var r;if(1!==e){e=s*i-d*i*i/2;i=e-c;if(r=p*i)r=xl(t,t.zoom+r),bn(t,r,l,u);an(t,xd(h*i),xd(f*i));c=e}else bn(t,xl(t,o),l,u),t.ha()},2*e/s)}}S.prototype.cc=function(t){var e=this,i=t.c;this.fa.set(0,0);i.mb||i.nb||i.ob||i.je||i.ke||i.kf?(this.za=Ak(),Rm(this,function(t,r,n,o){e.za=o;dn(e,i,n)},Td)):Om(this,!0)};function dn(t,e,i){i=i||0;var r=t.j,n=Hl(t.a),o=n.getLookAtData();e.ob&&bn(t,xl(t,o.zoom+e.ob*i),r.b,r.c);n.setLookAtData({heading:Al(t,o.heading+e.ke*i),tilt:zl(t,o.tilt+e.je*i)});Qm(t);an(t,e.mb*i,e.nb*i)}function Rm(t,e,i,r,n){t.g&&t.g.Ea()&&t.g.stop(!0);t.g=new im(e,i,r,n);t.g.start()}function Om(t,e){t.g&&t.g.Ea()&&t.g.stop(e)}S.prototype.gh=function(){};S.prototype.enter=S.prototype.gh;S.prototype.Nf=function(t){ul(this.K,t)};S.prototype.exit=S.prototype.Nf;S.prototype.capture=function(t,e,i,r){var n=this;return Ml(n.a).then(function(o){var a=n.K.ownerDocument.createElement("canvas"),s=n.qa,l=a.getContext("2d"),u=n.a.Za()/s,c=(i-t)*s;s*=r-e;a.width=c;a.height=s;l.drawImage(o,t*u,e*u,c*u,s*u,0,0,c,s);return a})};S.prototype.bm=function(t){return Hl(this.a).geoToMeters(t)};S.prototype.geoToMeters=S.prototype.bm;S.prototype.eo=function(t){return Hl(this.a).metersToGeo(t)};S.prototype.metersToGeo=S.prototype.eo;var Jm=5e3,Xm=3.5;function U(t,e,i){var r={};U.l.constructor.call(this);this.D=A(U.prototype.D,this);this.i=fn(i,U);this.b=i=new tl;this.K=!1;i.addEventListener(i.a.te,this.za,!1,this);if(!C(t,Element))throw new D(U,0,t);i=this.S=t.ownerDocument.createElement("div");var n=i.style;n.position="relative";n.height=i.style.width="100%";n.overflow="hidden";n.webkitTapHighlightColor="transparent";"transparent"!==n.webkitTapHighlightColor&&(n.webkitTapHighlightColor="rgba(0,0,0,0)");t.appendChild(i);this.ya=new lk(this.S,this.i);this.ya.addEventListener(this.ya.a.te,this.za,!1,this);t=this.a=new cj(this.i.layers);t.addEventListener(t.b.se,this.T,!1,this);t.addEventListener(t.b.pe,this.T,!1,this);t.addEventListener(t.b.re,this.T,!1,this);!this.f&&gn(this);this.c=null;this.a.add(e,0);this.g=this.O(null!=this.i.engineType?this.i.engineType:hn.WEBGL,this.i);this.v=A(this.v,this);this.B=A(this.B,this);e=this.i.imprint;if(e!==B&&"object"!==typeof e)throw new D(U,1,"imprint");this.m=null===e?e:new lj(this,e);e=this.i.autoColor;this.fa=e===B||!!e;jn(this);(e=this.i.zoom)&&(r.zoom=e);(e=this.i.bounds)&&(r.bounds=e);(e=this.i.center)&&(r.position=e);this.b.$b(r)}u(U,F);t("H.Map",U);function fn(t,e){if(t){var i=t.pixelRatio;if(i===B)t.pixelRatio=Se();else if(!(0<i))throw new D(e,0,"pixelRatio: "+i)}else t={},t.pixelRatio=Se();t.renderBaseBackground||(t.renderBaseBackground={lower:3,higher:2});return t}U.prototype.u=function(){this.fa=!1;this.m&&this.m.C();this.g.dispose();this.b.C();this.ya.C();this.f.C();this.j.C();this.a.C();var t=this.S;t.parentNode.removeChild(t);this.S=null;F.prototype.u.call(this)};U.prototype.G=function(){return this.S};U.prototype.getElement=U.prototype.G;U.prototype.Za=function(){return this.i.pixelRatio};U.prototype.getPixelRatio=U.prototype.Za;function jn(t){t.m&&t.fa&&t.m.Fi({invert:t.c&&t.c.Rl})}U.prototype.T=function(t){var e=t.added,i=t.removed;e&&e.pa()&&e.pa().ja(this);i&&i.pa()&&i.pa().ja(null);i===this.f&&(this.j=this.f=null);i===this.c&&(this.c=null);0===t.idx&&(this.dispatchEvent(new Ng(this.o.yf,this.c=t.type!==this.a.b.re?e:0<this.a.a.length?this.a.get(0):y,t.type!==this.a.b.pe?i:1<this.a.a.length?this.a.get(1):y)),jn(this))};U.prototype.za=function(t){t.modifiers&&(this.K||(kn(this,"start"),this.K=!0),kn(this,"",t),this.V&&x.clearTimeout(this.V),this.V=x.setTimeout(this.B,333))};function kn(t,e,i){t.dispatchEvent(i?new Qi(t.o.dj,i.newValue,i.oldValue,i.modifiers):t.o.dj+e)}U.prototype.B=function(){kn(this,"end");this.K=!1};U.prototype.yg=function(t,e){this.g.getCapabilities().lookAt&&this.b.$b({position:t},!!e);return this};U.prototype.setCenter=U.prototype.yg;U.prototype.lb=function(){var t=this.b.sb();return t?t.position:y};U.prototype.getCenter=U.prototype.lb;U.prototype.sf=function(t,e){this.b.sf(t,!!e);return this};U.prototype.setZoom=U.prototype.sf;U.prototype.tb=function(){return this.b.tb()};U.prototype.getZoom=U.prototype.tb;U.prototype.oe=function(t,e,i){this.g.zoomAt(t,e,i)};U.prototype.zoomAt=U.prototype.oe;U.prototype.vn=function(){return this.ya};U.prototype.getViewPort=U.prototype.vn;U.prototype.un=function(){return this.b};U.prototype.getViewModel=U.prototype.un;U.prototype.Km=function(){return this.a};U.prototype.getLayers=U.prototype.Km;U.prototype.Fm=function(){return this.m};U.prototype.getImprint=U.prototype.Fm;U.prototype.capture=function(t,e,i,r,n,o){function a(t,e){f?t.cancel():(g.save(),e.capture(d,c,function(e){g.restore();t.done(e)},function(e){t.done(null,e);s(null)}))}function s(e){f||(f=!0,t(e))}var l=this.hc(),u=l.getCapabilities(),c=this.i.pixelRatio,h=this.ya,f=!1,p=this,d,g;if(!Ca(t))throw new D(this.capture,0,t);i=i||0;r=r||0;n=n||h.width;o=o||h.height;var v=wd(0,vd(i,n));var _=wd(0,vd(r,o));i=vd(h.width,wd(i,n));r=vd(h.height,wd(r,o));u.capture?l.capture(v,_,i,r).then(function(t){var i=p.m,r=e||[];d=t;g=d.getContext("2d");d.style.width=d.width/c+"px";d.style.height=d.height/c+"px";var n=new yk(10,a);r=r.concat(i).filter(function(t){return Ca(t&&t.capture)});r.length?(t=r.pop(),r.forEach(function(t){n.push(t,id)}),n.push(t,A(s,p,d)),uk(n)):s(d)},function(){s(y)}):t(null)};U.prototype.capture=U.prototype.capture;U.prototype.hc=function(){return this.s||this.g};U.prototype.getEngine=U.prototype.hc;U.prototype.$k=function(t){this.g.type===t||this.la||(this.la=!0,this.s=this.O(t),this.s.addEventListener("render",this.v));return this};U.prototype.setEngineType=U.prototype.$k;U.prototype.v=function(t){t.target===this.s&&(this.s.removeEventListener("render",this.v),this.g.Nf(this.D))};U.prototype.D=function(){var t=this.g.type;this.g.C();this.g=this.s;this.s=B;this.la=!1;this.dispatchEvent(new Ng(this.o.yl,this.g.type,t))};U.prototype.O=function(t,e){e=e?fn(e,this.O):this.i;jn(this);if(t===hn.P2D)return new x.H.map.render.p2d.RenderEngine(this.ya,this.b,this.a,e);if(t===hn.WEBGL)return new S(this.ya,this.b,this.a,e);if(t===hn.HARP)return new x.H.harp.RenderEngine(this.ya,this.b,this.a,e);throw new D(this.$k,0,t)};U.prototype.vf=function(t,e,i,r,n){e=tc(e)?C(e,K,this.vf,1,e)&&e:this.b.sb().bounds.F();n=n||this.c;if(!C(n,dl))throw new D(this.vf,4);var o=n.pa(),a=this.Za(),s=n.tileSize;2<=a&&256<s&&o instanceof tk&&(s/=2);a=this.tb();s=Math.log2(s)-8;i=tc(i)?+i:a;r=tc(r)?+r:a;if(!(i<=r))throw new D(this.vf,B,"!(min <= max)");a=o.min;var l=o.max,u=this.hc().type===hn.WEBGL?yd:xd;i=Yd(u(i)-s,a,l);r=Yd(u(r)-s,a,l);if(!(o&&C(o,R)&&md()&&o.Wg()))throw new Yc(this.vf,"Storing is not supported");return new ok(n,o,e,i,r,t)};U.prototype.storeContent=U.prototype.vf;function ln(t){hj.call(this,t)}u(ln,hj);ln.prototype.f=function(){jj(this,2)};ln.prototype.c=function(){jj(this,4)};U.prototype.Ql=function(t){t=new ln(t);ld().clear(A(t.f,t),A(t.c,t));return t};U.prototype.clearContent=U.prototype.Ql;U.prototype.Og=function(t,e){var i=this.a,r=i.indexOf(t),n=e!==+e;e=n?i.a.length-1:e;0>r?i.add(t,e):r-e&&(i.oc(r),i.add(t,n?e-1:e));return this};U.prototype.addLayer=U.prototype.Og;U.prototype.ef=function(t){var e=this.a.indexOf(t);t!==this.c&&t!==this.f&&-1!==e&&this.a.oc(e);return this};U.prototype.removeLayer=U.prototype.ef;U.prototype.Cd=function(t){this.c!==t&&(this.a.a.length&&this.a.get(0)!==this.f?this.a.set(0,t):this.a.add(t,0),this.c=t);return this};U.prototype.setBaseLayer=U.prototype.Cd;U.prototype.hm=function(){return this.c};U.prototype.getBaseLayer=U.prototype.hm;U.prototype.Ga=function(t){if(!Yf(t))throw new D(this.Ga,0,t);return(t=this.g.geoToScreen(t))?wf(t):y};U.prototype.geoToScreen=U.prototype.Ga;U.prototype.Wa=function(t,e){var i;if(i=+E(t)||2*E(e))throw new D(this.Wa,i-1,arguments[i-1]);return(i=this.g.screenToGeo(t,e))?Zf(i):y};U.prototype.screenToGeo=U.prototype.Wa;U.prototype.xg=function(t,e){return this.g.screenToLookAtData(t,e)};U.prototype.screenToLookAtData=U.prototype.xg;U.prototype.ea=function(t){if(!C(t,M))throw new D(this.ea,0,t);!this.f&&gn(this);this.j.jc().ea(t);return t};U.prototype.addObject=U.prototype.ea;U.prototype.Ha=function(t){if(!C(t,M))throw new D(this.Ha,0,t);!this.f&&gn(this);this.j.jc().Ha(t);return t};U.prototype.removeObject=U.prototype.Ha;U.prototype.Ta=function(t){!this.f&&gn(this);return this.j.jc().Ta(t)};U.prototype.getObjects=U.prototype.Ta;U.prototype.ec=function(t){var e;yc(t,this.ec,0,t);!this.f&&gn(this);var i=t.length;for(e=0;e<i;e++)this.ea(t[e]);return this};U.prototype.addObjects=U.prototype.ec;U.prototype.yd=function(t){var e;yc(t,this.yd,0,t);!this.f&&gn(this);var i=t.length;for(e=0;e<i;e++)this.Ha(t[e]);return this};U.prototype.removeObjects=U.prototype.yd;U.prototype.Wd=function(t,e,i){var r;if(r=+E(t)||2*E(e))throw new D(this.Wd,r-1,arguments[r-1]);this.g.getObjectsAt(t,e,!0,function(t){i(t[0])})};U.prototype.getObjectAt=U.prototype.Wd;U.prototype.Ua=function(t,e,i){var r;if(r=+E(t)||2*E(e))throw new D(this.Wd,r-1,arguments[r-1]);this.g.getObjectsAt(t,e,!1,i)};U.prototype.getObjectsAt=U.prototype.Ua;U.prototype.wh=function(t,e,i){var r=i||gf;i=r.visiblesOnly;var n=r.zoom;r=r.types;var o=Pg.ANY;C(t,P,this.wh,0,"area");wc(e,"Function",this.wh,1,"callback");this.j.Ta(t,tc(i)?!!i:!0,tc(n)?+n:this.b.tb(),tc(r)?r&o:o,e)};U.prototype.getObjectsWithin=U.prototype.wh;function gn(t){t.j=new N({max:24});t.f=new nl(t.j,t.i);t.a.add(t.f)}var hn={P2D:Bl.P2D,WEBGL:Bl.WEBGL};U.EngineType=hn;hn.HARP=Bl.HARP;U.prototype.o={Xo:"mapviewchangestart",dj:"mapviewchange",ej:"mapviewchangeend",yf:"baselayerchange",yl:"enginechange"};function mn(t,e){mn.l.constructor.call(this,t,e)}u(mn,Mi);t("H.map.Marker",mn);n=mn.prototype;n.type=Pg.MARKER;n.Fg=1;n.ua=function(t){if(t!==Mg.VISUAL||1===this.Jk||1===this.icon.getState())var e=mn.l.ua.call(this,t);return e||!1};n.Jk=0;n.dk=function(t){return C(t,Hj)};n.Kh=!1;n.yk=function(){this.ua(Mg.VISUAL)};n.Oc=function(t){var e=this.icon;this.Kh&&(e.removeEventListener("statechange",this.yk,!1,this),delete this.Kh);e&&(this.Jk=e.getState());mn.l.Oc.call(this,t);0===t.getState()&&(this.Kh=!0,Ce(t,"statechange",this.yk,!1,this));return this};mn.prototype.setIcon=mn.prototype.Oc;mn.prototype.f=function(t){return new Hj(t.svg,t)};mn.prototype.W=function(){var t=this.getIcon(),e=t.Io||0,i=mn.l.forWorkerMessage.call(this),r=i.properties.icon;r&&0<e&&Wa(r,{stick_color:t.Ho,stick_height:e});return i};mn.prototype.forWorkerMessage=mn.prototype.W;function nn(t,e){nn.l.constructor.call(this,ih,e);this.le(t)}u(nn,wi);t("H.map.Rect",nn);nn.prototype.le=function(t){if(!C(t,K))throw new D(this.le,0,t);t.na(this.T)||(this.T=this.R=t,this.eb!==y&&nn.l.da.call(this,mi(t)))};nn.prototype.setBoundingBox=nn.prototype.le;nn.prototype.F=function(){return this.R};nn.prototype.getBoundingBox=nn.prototype.F;nn.prototype.da=function(){return this};nn.prototype.setGeometry=nn.prototype.da;nn.prototype.ba=function(){this.eb||nn.l.da.call(this,mi(this.T));return this.eb};nn.prototype.getGeometry=nn.prototype.ba;function ik(t,e,i){var r="anonymous",n=1;this.f=A(this.f,this);M.call(this,i);this.da(t);i&&(t="crossOrigin",t in i&&(r=i[t]),t="opacity",t in i&&(n=i[t]));this.Zk(e,r);this.pc(n)}u(ik,M);t("H.map.Overlay",ik);ik.prototype.type=Pg.OVERLAY;ik.prototype.F=function(){return this.R};ik.prototype.getBoundingBox=ik.prototype.F;ik.prototype.le=function(t){C(t,K,this.le,0,t);return this.da(t)};ik.prototype.setBoundingBox=ik.prototype.le;ik.prototype.ba=function(){return this.R};ik.prototype.getGeometry=ik.prototype.ba;ik.prototype.da=function(t){var e=this.R,i=!e;C(t,K,this.da,0,t);if(i||!e.na(t))this.R=t,i||this.ua(Mg.SPATIAL);return this};ik.prototype.setGeometry=ik.prototype.da;ik.prototype.Zc=function(){return this.b.getData()};ik.prototype.getBitmap=ik.prototype.Zc;ik.prototype.Zk=function(t,e){var i=this.b;i&&1!==i.getState()&&i.cancel();this.b=new Cj(t,this.f,!0,B,e);return this};ik.prototype.setBitmap=ik.prototype.Zk;ik.prototype.f=function(t,e){this.b=e;1===t&&this.ua(Mg.VISUAL)};ik.prototype.ad=function(){return this.g};ik.prototype.getOpacity=ik.prototype.ad;ik.prototype.pc=function(t){var e=this.g,i=2>e;if(0<=t&&1>=t)t!==e&&(this.g=t,i&&this.ua(Mg.VISUAL));else throw new D(this.pc,0);return this};ik.prototype.setOpacity=ik.prototype.pc;ik.prototype.W=function(){var t=ik.l.W.call(this);t.geometry=mi(this.R).W();t.properties.overlay=!0;return t};ik.prototype.forWorkerMessage=ik.prototype.W;function on(t){if(!t||!Ca(t.requestData))throw new D(on,0,"options.requestData");on.l.constructor.call(this,t);this.K=t.requestData;this.D=!!t.providesDomMarkers}u(on,R);t("H.map.provider.MarkerTileProvider",on);on.prototype.Rd=function(t){return t?t.length+1:1};on.prototype.getEntryWeight=on.prototype.Rd;on.prototype.J=function(t,e,i,r,n){var o=this;return this.K(t,e,i,function(n){for(var a=[],s,l,u=n.length;u--;)l=n[u],l.Ko=o.getTileKey(t,e,i),l.ja(o),s=l.zb(),(C(l,Pi)||1===s.getState())&&a.push(n[u]);r(a)},n)};on.prototype.requestInternal=on.prototype.J;on.prototype.ae=function(t,e){e===Mg.VISUAL&&(t=this.Pb().get(t.Ko))&&(t.valid=!1,Uj(this,t))};on.prototype.invalidateObject=on.prototype.ae;on.prototype.Vb=function(){return this.D};on.prototype.providesDomMarkers=on.prototype.Vb;on.prototype.Wb=df;on.prototype.providesMarkers=on.prototype.Wb;function pn(t,e){pn.l.constructor.call(this,t,e)}u(pn,dl);t("H.map.layer.MarkerTileLayer",pn);var qn={markers:[],total:0,requested:0};function rn(t,e,i,r,n){var o=yd(i);t.pixelProjection.Fa(o);e=t.$d(t.He(e),o);i=t.Pe(e,e.left>e.right,~~i,r,n);t=i.tiles;i=i.total;r=t.length;n=[];var a;for(a=0;a<r;a++)for(e=t[a],o=e.data.length;o--;)n.push(e.data[o]);return{markers:n,total:t.length,requested:i}}pn.prototype.Kc=function(t,e,i,r){return this.a.providesDomMarkers()?qn:rn(this,t,e,i,r)};pn.prototype.requestMarkers=pn.prototype.Kc;pn.prototype.Jc=function(t,e,i,r){return this.a.providesDomMarkers()?rn(this,t,e,i,r):qn};pn.prototype.requestDomMarkers=pn.prototype.Jc;function sn(t,e,i){var r,n=6;if(e){for(r=' expected close to: "'+e;n--;)e=t.a.next(),-1!==e&&(r+=String.fromCharCode(e));r+='"'}throw new D(tn,0,"- Malformed WKT: "+(r?i+r:"unexpected end of stream"))}var un={Dl:" ",Al:"(",Bl:")",xl:",",zl:""};Object.keys(un).reduce(function(t,e){t[un[e]]=!0;return t},mc());function vn(t,e){var i=t.next();e=e?")":"(";i!==e&&sn(t,i,'"'+e+'"')}function wn(t){return","===xn(t)?(t.next(),!0):!1}function yn(t,e,i,r,n){var o,a,s=2+e+i;for(a=1;a<=s;a++)(i=t.next())?(o=+i)!==o?sn(t,i,"number"):1===a?r[n+1]=o:2===a?r[n]=o:3===a&&(r[n+2]=o):sn(t,i);e||(r[n+2]=0)}var zn=[];function An(t,e,i,r){r||vn(t,0);yn(t,e,i,zn,0);r||vn(t,1);return new Xf(zn[0],zn[1],e?zn[2]:B)}function Bn(t,e,i){var r=[];vn(t,0);do{yn(t,e,i,r,r.length)}while(wn(t));vn(t,1);return new L(r)}function Cn(t,e,i){vn(t,0);var r=Bn(t,e,i);if(wn(t)){var n=[];do{n.push(Bn(t,e,i))}while(wn(t))}vn(t,1);return new P(r,n)}var Dn=[],En=[Cn],Fn=[An],Gn={POINT:Fn,LINESTRING:[Bn],POLYGON:En,MULTIPOINT:[An,Ii],MULTILINESTRING:[Bn,lh],MULTIPOLYGON:[Cn,ui],GEOMETRY:Dn,GEOMETRYCOLLECTION:Dn,CIRCULARSTRING:Dn,COMPOUNDCURVE:Dn,CURVEPOLYGON:Dn,MULTICURVE:Dn,MULTISURFACE:Dn,CURVE:Dn,SURFACE:Dn,POLYHEDRALSURFACE:Dn,TIN:Dn,TRIANGLE:Dn},Hn={Z:1,M:2,ZM:3};function tn(t){t=new In(t);var e;var i=t.next();(e=Gn[i.toUpperCase()])||sn(t,i,"type name");if(e!==Dn){i=xn(t);i=Hn[i.toUpperCase()];var r=i&1;var n=i>>1;r|n&&t.next();i=xn(t);if("EMPTY"===i)if(t.next(),r=e[1])var o=new r([]);else e!==Fn&&(o=new L([]),e===En&&(o=new P(o)));else if("("===i){o=e[0];e=e[1];if(e){var a=[];vn(t,0);if(o===An){var s="("!==xn(t);do{a.push(o(t,r,n,s))}while(wn(t))}else{do{a.push(o(t,r,n))}while(wn(t))}vn(t,1);r=new e(a)}else r=o(t,r,n);o=r}else sn(t,i,'"Z", "M", "ZM", "(" or "EMPTY"');t.next()&&sn(t,i,"end of stream")}return o||y}function In(t){this.a=t}function xn(t){var e=t.b;if(e===B){for(e=t.a;e.Tb()===Jn;)e.next();if(Kn[e.Tb()])e=e.next(),e=e===Ln?"":String.fromCharCode(e);else{e.ne();do{e.next()}while(!Kn[e.Tb()]);e=String.fromCharCode.apply(null,e.Od())}t.b=e}return e}In.prototype.next=function(){var t=xn(this);""!==t&&delete this.b;return t};var Jn=32,Ln=-1,Mn={Dl:Jn,Al:40,Bl:41,xl:44,zl:Ln},Kn=Object.keys(Mn).reduce(function(t,e){t[Mn[e]]=!0;return t},mc());function Nn(){}t("H.util.ICharStream",Nn);Nn.prototype.next=function(){};Nn.prototype.ne=function(){};Nn.prototype.Od=function(){};Nn.prototype.Tb=function(){};function On(t){this.c=String(t);this.f=0;this.a=[];this.b=!1}t("H.util.CharStream",On);On.prototype.next=function(){var t=this.c.charCodeAt(this.f++);t=isNaN(t)?-1:t;this.b&&this.a.push(t);return t};On.prototype.ne=function(){this.b=!0;this.a=[]};On.prototype.Od=function(){var t=this.a.slice();this.b=!1;this.a=[];return t};On.prototype.Tb=function(){var t=this.c.charCodeAt(this.f);return isNaN(t)?-1:t};t("H.util.wkt.toGeometry",function(t){return tn(new On(t))});t("H.buildInfo",function(){return Ef("H-core","1.21.3","648ff682")});var Pn=function(){var a="maps"+eval('"js-"');var b=x.document.querySelector('script[src*="'+a+'"]');if(!b){var c=x.document.getElementsByTagName("script");var d=new RegExp("^.*"+a);var e=0;for(a=c.length;e<a;e++)if(d.test(c[e].src)){b=c[e];break}}return b?b.src.replace(/\/[^\/]*$/,"/"):""}();t("H.getScriptPath",function(){return Pn})}).call(window);H.__bootstrap__='var l,ba="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ca="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function da(a,b){if(b){var c=ca;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ba(c,a,{configurable:!0,writable:!0,value:b})}}var fa;\nif("function"==typeof Object.setPrototypeOf)fa=Object.setPrototypeOf;else{var ha;a:{var ia={gb:!0},ka={};try{ka.__proto__=ia;ha=ka.gb;break a}catch(a){}ha=!1}fa=ha?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var la=fa;da("Object.setPrototypeOf",function(a){return a||la});var p=this||self;\nfunction ma(a,b,c){a=a.split(".");c=c||p;a[0]in c||"undefined"==typeof c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)a.length||void 0===b?c[d]&&c[d]!==Object.prototype[d]?c=c[d]:c=c[d]={}:c[d]=b}function na(){}\nfunction oa(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";\nelse if("function"==b&&"undefined"==typeof a.call)return"object";return b}function r(a){return"function"==oa(a)}function qa(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var ra="closure_uid_"+(1E9*Math.random()>>>0),sa=0;function ta(a,b,c){return a.call.apply(a.bind,arguments)}\nfunction ua(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function va(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?va=ta:va=ua;return va.apply(null,arguments)}\nfunction wa(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function t(a,b){ma(a,b,void 0)}function xa(a,b){function c(){}c.prototype=b.prototype;a.V=b.prototype;a.prototype=new c;a.prototype.constructor=a};function x(){}t("H.util.ICache",x);x.prototype.add=function(){};x.prototype.add=x.prototype.add;x.prototype.get=function(){};x.prototype.get=x.prototype.get;x.prototype.sa=function(){};x.prototype.drop=x.prototype.sa;x.prototype.forEach=function(){};x.prototype.forEach=x.prototype.forEach;x.prototype.T=function(){};x.prototype.removeAll=x.prototype.T;x.prototype.ba=function(){};x.prototype.registerOnDrop=x.prototype.ba;x.prototype.qa=function(){};x.prototype.deRegisterOnDrop=x.prototype.qa;function ya(){var a=za,b;for(b in a)return!1;return!0}function Aa(a){var b={},c;for(c in a)b[c]=a[c];return b}var Ba="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ca(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Ba.length;f++)c=Ba[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var y=this;function Da(a){if(Error.captureStackTrace)Error.captureStackTrace(this,Da);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}xa(Da,Error);Da.prototype.name="CustomError";var Ea=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"===typeof a)return"string"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};var Fa=va,Ga=String,Ha=y.Object.freeze||function(a){return a},z=self.eval("undefined"),Ia=self.eval("null");function La(a){return Ga(a).split(","!==z?",":" ")}var Ma="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Na(a,b,c,d){if(!(b=a instanceof b)&&c)throw new A(c,d,void 0!==z?void 0:a);return b}function Oa(a,b,c,d){var e;if(!(e="Array"===Pa(a))&&b)throw new A(b,c,d!==z?d:a);return e}\nt("H.lang.isArray",function(a,b,c,d){return Oa(a,b,c,d)});function Qa(a){return"string"===typeof a}t("H.lang.isString",Qa);var Ra=isNaN;function Sa(a){return a===+a}t("H.lang.isNumber",Sa);t("H.lang.isInteger",Number.isInteger?Number.isInteger:function(a){return"number"===typeof a&&0===a%1});function Pa(a){var b=Object[Ma[0]][Ma[6]].call(a).match(/^\\[object (\\w+)\\]$/);return b?b[1]:typeof a}var Ta=[];0>Ta.indexOf(Ta)&&Ta.push(Ta);\nfunction Ua(a,b,c,d){var e="",f=2>arguments.length,g;f&&(b={H:y.H},c="",d=Ta.slice());Va(b,!0,function(h,k){try{if(g=h[k],k=Wa(h,g),!(qa(g)&&g.window===g&&g.self===g||qa(g)&&0<g.nodeType&&r(g.cloneNode))&&qa(g)){if(g===a)return e=c+"."+k,!0;if(0>d.indexOf(g)&&(d.push(g),e=Ua(a,g,c+"."+k,d)))return!0}}catch(m){}});f&&(e=e?e.substr(1).replace("."+Ma[0]+".","#"):"~"+(r(a)?Xa(a)+"()":Pa(a)));return e}\nfunction Wa(a,b){var c=[];Va(a,!1,function(d,e){d[e]===b&&c.push(e)});return c.sort(Ya)[0]}function Ya(a,b){return b.length-a.length}var Za=Object[Ma[0]][Ma[2]];function Va(a,b,c){var d;if(a){for(e in a)if((!b||Za.call(a,e))&&c(a,e,!0))return;for(d=Ma.length;d--;){var e=Ma[d];if((!b||Za.call(a,e))&&c(a,e,!1))break}}}function Xa(a){return(a=/^\\s*function ([^\\( ]+)/.exec(a))?a[1]:"anonymous"}function $a(a,b,c){c[b]="#"+b};function B(a,b,c){this.g=[];b&&this.ba(b);if(c&&!r(c))throw new A(B,2,c);this.b=0;this.filter=c;this.a={};this.f=this.c=null;this.Ia(a)}t("H.util.Cache",B);B.prototype.add=function(a,b,c){var d,e;c=+c;if(!Sa(c)||0>c)throw new A(this.add,2,c);a=String(a);if(e=this.filter?this.filter(a,b,c):!0)(d=this.a[a])?(d.data!==b&&db(this,d),this.b+=c-d.size,d.size=c,d.data=b,eb(this,d)):this.a[a]=fb(this,{id:a,data:b,size:c,A:null,D:null},this.c),gb(this);return e};B.prototype.add=B.prototype.add;\nB.prototype.ba=function(a){if(!r(a))throw new A(this.ba,0,a);this.g.push(a)};B.prototype.registerOnDrop=B.prototype.ba;B.prototype.qa=function(a){this.g=this.g.filter(function(b){return b!==a})};B.prototype.deRegisterOnDrop=B.prototype.qa;B.prototype.get=function(a,b){return(a=b?this.a[a]:eb(this,this.a[a]))&&a.data};B.prototype.get=B.prototype.get;B.prototype.sa=function(a){var b;(b=this.a[a])&&hb(this,b,!0)};B.prototype.drop=B.prototype.sa;\nB.prototype.forEach=function(a,b,c){var d;for(d in this.a){var e=this.a[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};B.prototype.forEach=B.prototype.forEach;B.prototype.T=function(a){var b;for(b in this.a){var c=this.a[b];(a?a(b,c.data,c.size):1)&&hb(this,this.a[b],!0)}};B.prototype.removeAll=B.prototype.T;B.prototype.Ia=function(a){if(!(0<+a))throw new A(B.prototype.Ia,0,a);this.o=+a;gb(this);return this};B.prototype.setMaxSize=B.prototype.Ia;B.prototype.zb=function(){return this.o};\nB.prototype.getMaxSize=B.prototype.zb;B.prototype.vb=function(){return this.b};B.prototype.getCurrentSize=B.prototype.vb;function eb(a,b){b&&(a.c=fb(a,b,a.c));return b}function gb(a){for(;a.b>a.o&&a.f;)hb(a,a.f,!0)}function fb(a,b,c){if(c!==b){(b.A||b.D)&&hb(a,b,!1);if(b.A=c)b.D=c.D,c.D=b;b.D||(a.c=b);b.A||(a.f=b);a.b+=b.size}return b}function hb(a,b,c){var d=b.D,e=b.A;if(d||e||b==a.c&&b==a.f)d?d.A=e:a.c=e,e?e.D=d:a.f=d,a.b-=b.size,c&&(delete a.a[b.id],db(a,b));b.A=b.D=null}\nfunction db(a,b){for(var c=a.g.length;c--;)a.g[c].call(a,b.id,b.data,b.size)};function C(){}t("H.service.extension.dataView.ITable",C);C.prototype.ya=function(){};C.prototype.getMeta=C.prototype.ya;C.prototype.za=function(){};C.prototype.getRowCount=C.prototype.za;C.prototype.ia=function(){};C.prototype.getRow=C.prototype.ia;C.prototype.C=function(){};C.prototype.getColumnNames=C.prototype.C;C.prototype.xa=function(){};C.prototype.getColumn=C.prototype.xa;C.prototype.s=function(){};C.prototype.getCell=C.prototype.s;C.prototype.concat=function(){};C.prototype.concat=C.prototype.concat;function ib(){}t("H.service.extension.dataView.IRow",ib);ib.prototype.C=function(){};ib.prototype.getColumnNames=ib.prototype.C;ib.prototype.s=function(){};ib.prototype.getCell=ib.prototype.s;ib.prototype.Aa=function(){};ib.prototype.getTable=ib.prototype.Aa;function jb(a,b){this.a=a;this.b=b}t("H.service.extension.dataView.ObjRow",jb);jb.prototype.C=function(){return this.a.C()};jb.prototype.getColumnNames=jb.prototype.C;jb.prototype.s=function(a){return this.a.s(this.b,a)};jb.prototype.getCell=jb.prototype.s;jb.prototype.Aa=function(){return this.a};jb.prototype.getTable=jb.prototype.Aa;function kb(){}t("H.service.extension.dataView.IColumn",kb);kb.prototype.s=function(){};kb.prototype.getCell=kb.prototype.s;function lb(a,b){this.b=a;this.a=b}t("H.service.extension.dataView.ObjColumn",lb);lb.prototype.s=function(a){return this.b.s(a,this.a)};lb.prototype.getCell=lb.prototype.s;function A(a,b,c){var d=arguments.length;b=b!==z?+b:b;if(b!==z){var e=(e=/^.*?\\(([^\\)]+)/.exec((""+a).replace(/(\\/\\*([\\s\\S]*?)\\*\\/)|(\\/\\/(.*)$)/gm,"")))?La(e[1].replace(/\\s+/g,"")):[];e.forEach($a);e=e[b]||"#"+b}var f=a?Ua(a):"";d=2<d?Ga(c):"";if(e||d)f+=" (Argument "+(e||"")+(d?" "+d:"")+")";d=Error(f);Object.setPrototypeOf(d,A.prototype);return d}xa(A,Error);t("H.lang.InvalidArgumentError",A);A.prototype.name="InvalidArgumentError";function D(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):z);this.F=a;if(b)for(this.N=b,this.pa=a=Object.create(Ia,void 0),d=b.length;d--;)a[b[d]]=!0;c!==z&&(this.Ca=c)}t("H.service.extension.dataView.ObjTable",D);l=D.prototype;l.Ca=z;l.F=z;l.N=z;l.pa=z;l.ya=function(){return this.Ca};D.prototype.getMeta=D.prototype.ya;D.prototype.za=function(){return this.F?this.F.length:0};D.prototype.getRowCount=D.prototype.za;D.prototype.ia=function(a){var b=this.F;return b&&b[a]?new jb(this,a):z};\nD.prototype.getRow=D.prototype.ia;D.prototype.C=function(){return this.N||mb};D.prototype.getColumnNames=D.prototype.C;D.prototype.xa=function(a){return this.pa[a]?new lb(this,a):z};D.prototype.getColumn=D.prototype.xa;D.prototype.s=function(a,b){var c=this.F;return(a=c&&this.pa[b]&&c[a])&&a[b]};D.prototype.getCell=D.prototype.s;\nD.prototype.concat=function(){var a=arguments.length,b,c=this.N,d=""+this.N,e=(this.F||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof D))throw new A(this.concat,b);if(f.F){if(c&&""+f.N!==d)throw new A(this.concat,b,"Incompatible columns!");e=e.concat(f.F)}}return new D(e,this.N,this.Ca)};D.prototype.concat=D.prototype.concat;function E(a,b){this.x=+a;this.y=+b}t("H.math.Point",E);E.prototype.set=E;E.prototype.set=E.prototype.set;E.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new E(this.x,this.y);return a};E.prototype.clone=E.prototype.clone;E.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};E.prototype.add=E.prototype.add;E.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};E.prototype.sub=E.prototype.sub;E.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};\nE.prototype.scale=E.prototype.scale;E.prototype.round=function(){this.x=nb(this.x);this.y=nb(this.y);return this};E.prototype.round=E.prototype.round;E.prototype.floor=function(){this.x=ob(this.x);this.y=ob(this.y);return this};E.prototype.floor=E.prototype.floor;E.prototype.ceil=function(){this.x=pb(this.x);this.y=pb(this.y);return this};E.prototype.ceil=E.prototype.ceil;E.prototype.G=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};E.prototype.equals=E.prototype.G;\nE.prototype.Ab=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=a;if(c||d){var f=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d);0>=f?e=a:1<=f?e=b:e=new E(a.x+f*c,a.y+f*d)}return e};E.prototype.getNearest=E.prototype.Ab;E.prototype.ra=function(a){return qb(rb(this.x-a.x,2)+rb(this.y-a.y,2))};E.prototype.distance=E.prototype.ra;E.fromIPoint=function(a){if(!a)throw Error("invalid argument");return a instanceof E?a:new E(a.x,a.y)};var F=Math,sb=F.min,tb=F.max,nb=F.round,ob=F.floor,pb=F.ceil,ub=F.abs,vb=F.log,qb=F.sqrt,rb=F.pow,wb=F.exp,xb=F.sin,yb=F.asin,zb=F.cos,Ab=F.tan,Bb=F.atan,Cb=F.atan2,Db=F.LN2,I=F.PI,Eb=I/2,Gb=I/4,Hb=2*I,Ib=3*I,Jb=I/180,Kb=180/I,Lb=1/0;rb(-2,53);function Mb(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}t("H.math.normalize",function(a,b,c){b-=c=c||0;a-=c;return a-ob(a/b)*b+c});function Nb(a,b,c){return a>c?c:a<b?b:a}t("H.math.clamp",Nb);function Ob(a,b,c){return b<c?a>=b&&a<=c:a>=c&&a<=b}\nfunction Pb(a,b,c,d,e,f){return qb(rb((a-e)*(d-f)-(b-f)*(c-e),2)/(rb(c-e,2)+rb(d-f,2)))}var Qb={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};t("H.math.CoverType",Qb);\nfunction Rb(a,b,c){for(var d=c.length,e=d,f,g,h,k,m=c[0],n=0,q=0,u=0;1!=n&&1<e;){g=c[--e];f=c[--e];k=c[e?e-1:(d+(e-1))%d];h=c[e?e-2:(d+(e-2))%d];if(f>=a&&f<=a&&g>=b&&g<=b||h>=a&&h<=a&&k>=b&&k<=b)n=1;else if(!n&&f===a)h===a&&(g<b&&k>b||g>b&&k<b)||(m<=a&&h>a||m>=a&&h<a)&&(g>=b?++q:++u),n=Ob(b,g,k)&&0>=Pb(a,b,f,g,h,k)?2:0;else if(!n&&Ob(a,f,h)){if(f<a&&h>a||f>a&&h<a)m=g+(a-f)/(h-f)*(k-g),q+=m>b,u+=m<b;n=Ob(b,g,k)&&0>=Pb(a,b,f,g,h,k)?2:0}m=f}!n&&0!==u&&0!==q%2&&(n=3);return n}\nfunction Sb(a,b){return Rb(a.x,a.y,b)!==Qb.NONE}t("H.math.isPointInsidePolygon",Sb);function Tb(a){for(var b=a.length,c=new Float64Array(2*b),d=b&&a[0].x!==z;b--;){var e=a[b],f=b<<1;c[f]=d?e.x:e[0];c[f+1]=d?e.y:e[1]}return c}t("H.math.flatten",Tb);function Ub(a,b,c,d,e,f){var g,h,k=a.length,m,n;if(k)for(g=[];k--;){var q=a[k];var u=q.length;var J=0;for(m=1;m<u;m++)if(n=Vb(q[m-1],q[m],c,b,d,e)){var M=n[0];var v=n[1];J&&J.G(M)?h.push(v):g.push(h=n);J=v;f&&(m=u,k=0)}}else g=a;return g}t("H.math.clipping.clipStrips",Ub);\nfunction Vb(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var m=a;g=h;a=b;h=k;b=m;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var n=1;a=-a;b=-b;m=f;f=-c;c=-m}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);n&&(a=-a,b=-b);return k?[new E(h,-b),new E(g,-a)]:[new E(g,-a),new E(h,-b)]}\nfunction Wb(a,b,c){a=Xb(a,!0);b=Xb(b,!1);var d,e;var f={};var g=d=1;switch(~~(c||0)){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.ga=Yb(b.x,b.y,null,Zb(b));a.ga=Yb(a.x,a.y,null,Zb(a));for(g=b;g.next;g=g.next)if(!g.B)for(d=a;d.next;d=d.next)if(!d.B){var k=$b(g.next);var m=$b(d.next);if(e=ac(g,k,d,m,f)){e=f.jb;var n=f.kb;var q=f.ic;var u=f.jc;e=Yb(q,u,null,null,null,null,!0,0,0,e);bc(e,g,k);k=Yb(q,u,null,null,null,null,!0,0,0,n);bc(k,d,m);e.Da=k;k.Da=e}}f=Sb(b,cc(a));\nc&&(f=!f);for(g=b;g;g=g.next)g.B&&(g.ta=f,f=!f);f=Sb(a,cc(b));h&&(f=!f);for(d=a;d.next;d=d.next)d.B&&(d.ta=f,f=!f);dc(b);for(dc(a);(a=ec(b))!=b;){for(c=null;!a.na;a=a.Da){for(f=a.ta;;){c=Yb(a.x,a.y,c);c.artificial=a.B||a.Mb;a.na=1;a=f?a.next:a.u;if(!a)break;if(a.B){a.na=1;break}}if(!a)break}c.Wa=J;var J=c}return J}}t("H.math.clipping.clipPolygon",Wb);\nfunction Yb(a,b,c,d,e,f,g,h,k,m){a={x:a,y:b,next:c||null,u:d||null,Wa:e||null,Da:f||null,B:!!g,ta:h||0,na:k||0,alpha:m||0};d&&(a.u.next=a);c&&(a.next.u=a);return a}function $b(a){for(;a&&a.B;)a=a.next;return a}function Zb(a){if(a)for(;a.next;)a=a.next;return a}function ec(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.B||b.B&&b.na))}return b}function dc(a){var b=Zb(a);b.u.next=a;a.u=b.u}\nfunction ac(a,b,c,d,e){var f,g=b.x-a.x,h=b.y-a.y;var k=d.x-c.x;var m=d.y-c.y;var n=g*m-h*k;if(!n)return 0;k=((c.x-a.x)*m-(c.y-a.y)*k)/n;n=(h*(c.x-a.x)-g*(c.y-a.y))/n;if(0>k||1<k||0>n||1<n)return 0;0===k?f=a:1===k?f=b:0===n?f=c:1===n&&(f=d);if(f)return f.x+=2.480549651603763E-5,f.y+=7.321997314118067E-5,f.ga&&(f.ga.x=f.x,f.ga.y=f.y),ac(a,b,c,d,e);e.ic=a.x+k*g;e.jc=a.y+k*h;e.jb=k;e.kb=n;return 1}function cc(a){for(var b=[];a;)b.push(a.x,a.y),a=a.next;return b}\nfunction bc(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.u=b.u;a.next.u=a;a.u.next=a}function Xb(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=Yb(a[e].x,a[e].y,d);c.Mb=b;if(c.next=d)d.u=c;d=c}return d};function fc(a,b){var c=[];a&&c.push(Ua(a));1<arguments.length&&c.push(""+b);c=Error(c.join(" "));Object.setPrototypeOf(c,fc.prototype);return c}xa(fc,Error);t("H.lang.IllegalOperationError",fc);fc.prototype.name="IllegalOperationError";function gc(){if(!Qa("STATIC_DB"))throw new A(this.constructor,0);this.o=y.indexedDB||y.hc||y.Pb||y.Qb;if(!this.o)throw new fc(this.constructor,"This browser does not support IndexedDB");this.a=[];this.c=[];this.g=Fa(this.g,this)}var hc,ic;gc.prototype.get=function(a,b,c){var d;if(!Qa(a)&&!Sa(a))throw new A(this.get,0);if(!r(b))throw new A(this.get,1);jc(this,function(e){d=e.get(a);kc(d,b,c)},c);return{cancel:function(){d&&(d.onsuccess=lc)}}};\ngc.prototype.g=function(){var a=this.b.result;a.objectStoreNames.contains("data")||a.createObjectStore("data")};\nfunction mc(a,b,c){if(a.b)a.a?(a.a.push(b),c&&a.c.push(c)):a.f?c&&c(a.f):b(a.b.result);else{a.b=a.o.open(nc+"STATIC_DB",1);a.b.onupgradeneeded=a.g;var d=a.b.onerror=function(){clearTimeout(a.v);a.f=this.error;a.c.forEach(function(e){e(a.f)});a.a=a.c=null};a.v=setTimeout(function(){d.call({error:Error("DbOpenTimeoutError")})},500);a.b.onsuccess=function(){clearTimeout(a.v);a.a?(a.a.forEach(function(e){e(this.result)},this),a.a=a.c=null):(a.b=a.f=null,a.a=[],a.c=[])};a.a.push(b);c&&a.c.push(c)}}\nfunction jc(a,b,c){mc(a,function(d){d=d.transaction(["data"],"readwrite");b(d.objectStore("data"))},c)}function kc(a,b,c){b&&(a.onsuccess=function(){b(this.result)});c&&(a.onerror=function(){c(this.error)})}t("H.util.IndexedDBStorage.getInstance",function(){hc||(hc=new gc);return hc});var nc="H_";\nt("H.util.IndexedDBStorage.isSupported",function(){if(ic===z)if("file:"===window.location.protocol&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&128<=window.location.href.length)ic=!1;else{var a=y.indexedDB||y.hc||y.Pb||y.Qb;var b=nc+"TEST_DB";try{var c=a&&a.open(b,1)}catch(d){}ic=!!c&&null===c.onupgradeneeded;c&&a.deleteDatabase&&a.deleteDatabase(b)}return ic});function oc(){0!=pc&&(qc[this[ra]||(this[ra]=++sa)]=this);this.c=this.c;this.a=this.a}var pc=0,qc={};oc.prototype.c=!1;oc.prototype.O=function(){if(!this.c&&(this.c=!0,this.ha(),0!=pc)){var a=this[ra]||(this[ra]=++sa);if(0!=pc&&this.a&&0<this.a.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass\' method.");delete qc[a]}};\noc.prototype.M=function(a,b){this.c?void 0!==b?a.call(b):a():(this.a||(this.a=[]),this.a.push(void 0!==b?va(a,b):a))};oc.prototype.ha=function(){if(this.a)for(;this.a.length;)this.a.shift()()};function K(a,b){this.type=a;this.currentTarget=this.target=b;this.a=!1;this.Ya=!0}K.prototype.stopPropagation=function(){this.a=!0};K.prototype.c=function(){this.Ya=!1};t("H.util.Event",K);K.prototype.stopPropagation=K.prototype.stopPropagation;K.prototype.stopPropagation=K.prototype.stopPropagation;K.prototype.CAPTURING_PHASE=1;K.prototype.CAPTURING_PHASE=K.prototype.CAPTURING_PHASE;K.prototype.AT_TARGET=2;K.prototype.AT_TARGET=K.prototype.AT_TARGET;K.prototype.BUBBLING_PHASE=3;K.prototype.BUBBLING_PHASE=K.prototype.BUBBLING_PHASE;K.prototype.eventPhase=0;K.prototype.eventPhase=K.prototype.eventPhase;function rc(a,b,c){rc.V.constructor.call(this,a,c);this.data=b}xa(rc,K);t("H.util.DataEvent",rc);function sc(a,b,c){sc.V.constructor.call(this,a,c);this.message=b}xa(sc,K);t("H.util.ErrorEvent",sc);function tc(a,b){this.c=a;this.f=b;this.b=0;this.a=null}tc.prototype.get=function(){if(0<this.b){this.b--;var a=this.a;this.a=a.next;a.next=null}else a=this.c();return a};function uc(a,b){a.f(b);100>a.b&&(a.b++,b.next=a.a,a.a=b)};function vc(){this.b=this.a=null}var xc=new tc(function(){return new wc},function(a){a.reset()});vc.prototype.add=function(a,b){var c=xc.get();c.set(a,b);this.b?this.b.next=c:this.a=c;this.b=c};function yc(){var a=Bc,b=null;a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null);return b}function wc(){this.next=this.b=this.a=null}wc.prototype.set=function(a,b){this.a=a;this.b=b;this.next=null};wc.prototype.reset=function(){this.next=this.b=this.a=null};var Cc=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\\s\\xa0]*([\\s\\S]*?)[\\s\\xa0]*$/.exec(a)[1]};function Dc(a,b){return a<b?-1:a>b?1:0};var Ec;a:{var Fc=p.navigator;if(Fc){var Gc=Fc.userAgent;if(Gc){Ec=Gc;break a}}Ec=""}function L(a){return-1!=Ec.indexOf(a)};function Hc(a,b){this.b=a===Ic&&b||"";this.a=Jc}var Jc={},Ic={},Kc=new Hc(Ic,"");function Lc(a,b){this.b=a===Mc&&b||"";this.a=Nc}var Nc={},Mc={};function Oc(){this.a="";this.b=Pc}function Qc(){var a=Rc;if(a instanceof Oc&&a.constructor===Oc&&a.b===Pc)return a.a;oa(a);return"type_error:SafeHtml"}var Pc={};function Sc(a){var b=new Oc;b.a=a;return b}Sc("<!DOCTYPE html>");var Rc=Sc("");Sc("<br>");function Tc(a){var b=new Lc(Mc,Kc instanceof Hc&&Kc.constructor===Hc&&Kc.a===Jc?Kc.b:"type_error:Const");b instanceof Lc&&b.constructor===Lc&&b.a===Nc?b=b.b:(oa(b),b="type_error:TrustedResourceUrl");a.src=b.toString()};function Uc(a){Uc[" "](a);return a}Uc[" "]=na;var Vc=L("Opera"),Wc=L("Trident")||L("MSIE"),Xc=L("Edge"),Yc=L("Gecko")&&!(-1!=Ec.toLowerCase().indexOf("webkit")&&!L("Edge"))&&!(L("Trident")||L("MSIE"))&&!L("Edge"),Zc=-1!=Ec.toLowerCase().indexOf("webkit")&&!L("Edge");function $c(){var a=p.document;return a?a.documentMode:void 0}var ad;\na:{var bd="",cd=function(){var a=Ec;if(Yc)return/rv:([^\\);]+)(\\)|;)/.exec(a);if(Xc)return/Edge\\/([\\d\\.]+)/.exec(a);if(Wc)return/\\b(?:MSIE|rv)[: ]([^\\);]+)(\\)|;)/.exec(a);if(Zc)return/WebKit\\/(\\S+)/.exec(a);if(Vc)return/(?:Version)[ \\/]?(\\S+)/.exec(a)}();cd&&(bd=cd?cd[1]:"");if(Wc){var dd=$c();if(null!=dd&&dd>parseFloat(bd)){ad=String(dd);break a}}ad=bd}var ed={},fd;fd=p.document&&Wc?$c():void 0;function gd(a){var b=document;a=String(a);"application/xhtml+xml"===b.contentType&&(a=a.toLowerCase());return b.createElement(a)};function hd(a){p.setTimeout(function(){throw a;},0)}var id;\nfunction jd(){var a=p.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!L("Presto")&&(a=function(){var e=gd("IFRAME");e.style.display="none";Tc(e);document.documentElement.appendChild(e);var f=e.contentWindow;e=f.document;e.open();e.write(Qc());e.close();var g="callImmediate"+Math.random(),h="file:"==f.location.protocol?"*":f.location.protocol+"//"+f.location.host;e=va(function(k){if(("*"==h||k.origin==h)&&k.data==g)this.port1.onmessage()},\nthis);f.addEventListener("message",e,!1);this.port1={};this.port2={postMessage:function(){f.postMessage(g,h)}}});if("undefined"!==typeof a&&!L("Trident")&&!L("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var e=c.Na;c.Na=null;e()}};return function(e){d.next={Na:e};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in gd("SCRIPT")?function(e){var f=gd("SCRIPT");f.onreadystatechange=function(){f.onreadystatechange=null;\nf.parentNode.removeChild(f);f=null;e();e=null};document.documentElement.appendChild(f)}:function(e){p.setTimeout(e,0)}};function kd(a,b){ld||md();nd||(ld(),nd=!0);Bc.add(a,b)}var ld;function md(){if(p.Promise&&p.Promise.resolve){var a=p.Promise.resolve(void 0);ld=function(){a.then(od)}}else ld=function(){var b=od;!r(p.setImmediate)||p.Window&&p.Window.prototype&&!L("Edge")&&p.Window.prototype.setImmediate==p.setImmediate?(id||(id=jd()),id(b)):p.setImmediate(b)}}var nd=!1,Bc=new vc;function od(){for(var a;a=yc();){try{a.a.call(a.b)}catch(b){hd(b)}uc(xc,a)}nd=!1};function pd(a){this.a=qd;this.v=void 0;this.f=this.b=this.c=null;this.g=this.o=!1;if(a!=na)try{var b=this;a.call(void 0,function(c){rd(b,sd,c)},function(c){rd(b,td,c)})}catch(c){rd(this,td,c)}}var qd=0,sd=2,td=3;function ud(){this.next=this.c=this.b=this.f=this.a=null;this.g=!1}ud.prototype.reset=function(){this.c=this.b=this.f=this.a=null;this.g=!1};var vd=new tc(function(){return new ud},function(a){a.reset()});function wd(a,b,c){var d=vd.get();d.f=a;d.b=b;d.c=c;return d}\nfunction xd(a,b,c){yd(a,b,c,null)||kd(wa(b,a))}function zd(a){return new pd(function(b,c){var d=a.length,e=[];if(d)for(var f=function(m,n){d--;e[m]=n;0==d&&b(e)},g=function(m){c(m)},h=0,k;h<a.length;h++)k=a[h],xd(k,wa(f,h),g);else b(e)})}function Ad(){var a,b,c=new pd(function(d,e){a=d;b=e});return new Bd(c,a,b)}pd.prototype.then=function(a,b,c){return Cd(this,r(a)?a:null,r(b)?b:null,c)};pd.prototype.$goog_Thenable=!0;\npd.prototype.cancel=function(a){if(this.a==qd){var b=new Dd(a);kd(function(){Ed(this,b)},this)}};function Ed(a,b){if(a.a==qd)if(a.c){var c=a.c;if(c.b){for(var d=0,e=null,f=null,g=c.b;g&&(g.g||(d++,g.a==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.a==qd&&1==d?Ed(c,b):(f?(d=f,d.next==c.f&&(c.f=d),d.next=d.next.next):Fd(c),Gd(c,e,td,b)))}a.c=null}else rd(a,td,b)}function Hd(a,b){a.b||a.a!=sd&&a.a!=td||Id(a);a.f?a.f.next=b:a.b=b;a.f=b}\nfunction Cd(a,b,c,d){var e=wd(null,null,null);e.a=new pd(function(f,g){e.f=b?function(h){try{var k=b.call(d,h);f(k)}catch(m){g(m)}}:f;e.b=c?function(h){try{var k=c.call(d,h);void 0===k&&h instanceof Dd?g(h):f(k)}catch(m){g(m)}}:g});e.a.c=a;Hd(a,e);return e.a}pd.prototype.Ea=function(a){this.a=qd;rd(this,sd,a)};pd.prototype.Ga=function(a){this.a=qd;rd(this,td,a)};\nfunction rd(a,b,c){a.a==qd&&(a===c&&(b=td,c=new TypeError("Promise cannot resolve to itself")),a.a=1,yd(c,a.Ea,a.Ga,a)||(a.v=c,a.a=b,a.c=null,Id(a),b!=td||c instanceof Dd||Jd(a,c)))}function yd(a,b,c,d){if(a instanceof pd)return Hd(a,wd(b||na,c||null,d)),!0;if(a)try{var e=!!a.$goog_Thenable}catch(g){e=!1}else e=!1;if(e)return a.then(b,c,d),!0;if(qa(a))try{var f=a.then;if(r(f))return Kd(a,f,b,c,d),!0}catch(g){return c.call(d,g),!0}return!1}\nfunction Kd(a,b,c,d,e){function f(k){h||(h=!0,d.call(e,k))}function g(k){h||(h=!0,c.call(e,k))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function Id(a){a.o||(a.o=!0,kd(a.S,a))}function Fd(a){var b=null;a.b&&(b=a.b,a.b=b.next,b.next=null);a.b||(a.f=null);return b}pd.prototype.S=function(){for(var a;a=Fd(this);)Gd(this,a,this.a,this.v);this.o=!1};\nfunction Gd(a,b,c,d){if(c==td&&b.b&&!b.g)for(;a&&a.g;a=a.c)a.g=!1;if(b.a)b.a.c=null,Ld(b,c,d);else try{b.g?b.f.call(b.c):Ld(b,c,d)}catch(e){Md.call(null,e)}uc(vd,b)}function Ld(a,b,c){b==sd?a.f.call(a.c,c):a.b&&a.b.call(a.c,c)}function Jd(a,b){a.g=!0;kd(function(){a.g&&Md.call(null,b)})}var Md=hd;function Dd(a){Da.call(this,a)}xa(Dd,Da);Dd.prototype.name="cancel";function Bd(a,b,c){this.a=a;this.b=b;this.reject=c};function Nd(a,b,c){this.type=a;this.data=b;this.a=Ad();this.Ua=Fa(this.Ua,this);this.reject=Fa(this.reject,this);this.priority=Od;c!==z&&(this.priority=c);this.b().add(this)}var Od=1,Pd={lc:0,mc:Od,kc:2};l=Nd.prototype;l.then=function(a,b,c){return this.a.a.then(a,b,c)};l.Ua=function(a){this.Z=3;this.a.b(a)};l.reject=function(a){this.Z=5;this.a.reject(a)};l.Z=0;\nl.cancel=function(){this.a.a.cancel();if(3>this.Z){this.c();var a=this.b(),b=this.priority,c=a.a[b].indexOf(this);-1<c&&a.a[b].splice(c,1);this.Z=4}};function Qd(a){var b;this.a={};for(b in Pd)this.a[Pd[b]]=[];this.ma=a;this.ma.addEventListener("allocatable",Fa(this.b,this))}t("H.util.JobManager",Qd);var Rd=Object.keys(Pd).map(function(a){return Pd[a]}).sort().reverse();Qd.prototype.add=function(a){Na(a,Nd,this.add,0);this.a[a.priority].push(a);this.b()};Qd.prototype.contains=function(a){return-1<this.a[a.priority].indexOf(a)};\nQd.prototype.b=function(){Rd.forEach(function(a){this.a[a]=this.a[a].filter(function(b){var c;if((c=this.ma.nc(b))!==Ia){var d=Fa(this.ma.oc,this.ma,c,b);b.then(d,d);b.Z=b.pc(c)?1:5}else return!0},this)},this)};function Sd(a,b,c){var d=[],e=arguments.length;a&&d.push(Ua(a));1<e&&(e=2<e&&Oa(c,void 0,void 0,void 0)?" out of ["+c[0]+"..."+c[1]+"]":"",d.push("("+b+e+")"));d=Error(d.join(" "));Object.setPrototypeOf(d,Sd.prototype);return d}xa(Sd,Error);t("H.lang.OutOfRangeError",Sd);Sd.prototype.name="OutOfRangeError";var Td="closure_listenable_"+(1E6*Math.random()|0),Ud=0;function Vd(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.ja=e;this.key=++Ud;this.U=this.da=!1}function Wd(a){a.U=!0;a.listener=null;a.proxy=null;a.src=null;a.ja=null};function Xd(a){this.src=a;this.a={};this.b=0}Xd.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.a[f];a||(a=this.a[f]=[],this.b++);var g=Yd(a,b,d,e);-1<g?(b=a[g],c||(b.da=!1)):(b=new Vd(b,this.src,f,!!d,e),b.da=c,a.push(b));return b};function Zd(a,b){var c=b.type;if(c in a.a){var d=a.a[c],e=Ea(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(Wd(b),0==a.a[c].length&&(delete a.a[c],a.b--))}}\nXd.prototype.T=function(a){a=a&&a.toString();var b=0,c;for(c in this.a)if(!a||c==a){for(var d=this.a[c],e=0;e<d.length;e++)++b,Wd(d[e]);delete this.a[c];this.b--}return b};function Yd(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.U&&f.listener==b&&f.capture==!!c&&f.ja==d)return e}return-1};var $d;($d=!Wc)||($d=9<=Number(fd));var ae=$d,be;\nif(be=Wc){var ce;if(Object.prototype.hasOwnProperty.call(ed,"9"))ce=ed["9"];else{for(var de=0,ee=Cc(String(ad)).split("."),fe=Cc("9").split("."),ge=Math.max(ee.length,fe.length),he=0;0==de&&he<ge;he++){var ie=ee[he]||"",je=fe[he]||"";do{var ke=/(\\d*)(\\D*)(.*)/.exec(ie)||["","","",""],le=/(\\d*)(\\D*)(.*)/.exec(je)||["","","",""];if(0==ke[0].length&&0==le[0].length)break;de=Dc(0==ke[1].length?0:parseInt(ke[1],10),0==le[1].length?0:parseInt(le[1],10))||Dc(0==ke[2].length,0==le[2].length)||Dc(ke[2],le[2]);\nie=ke[3];je=le[3]}while(0==de)}ce=ed["9"]=0<=de}be=!ce}var me=be,ne=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{p.addEventListener("test",na,b),p.removeEventListener("test",na,b)}catch(c){}return a}();function oe(a,b){K.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.pointerId=0;this.pointerType="";this.b=null;if(a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(Yc){a:{try{Uc(b.nodeName);var e=!0;break a}catch(f){}e=\n!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.key=a.key||"";this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=\na.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType="string"===typeof a.pointerType?a.pointerType:pe[a.pointerType]||"";this.b=a;a.defaultPrevented&&this.c()}}xa(oe,K);var pe={2:"touch",3:"pen",4:"mouse"};oe.prototype.stopPropagation=function(){oe.V.stopPropagation.call(this);this.b.stopPropagation?this.b.stopPropagation():this.b.cancelBubble=!0};\noe.prototype.c=function(){oe.V.c.call(this);var a=this.b;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,me)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var qe="closure_lm_"+(1E6*Math.random()|0),re={},se=0;function te(a,b,c,d,e){if(d&&d.once)ue(a,b,c,d,e);else if("array"==oa(b))for(var f=0;f<b.length;f++)te(a,b[f],c,d,e);else c=ve(c),a&&a[Td]?a.b.add(String(b),c,!1,qa(d)?!!d.capture:!!d,e):we(a,b,c,!1,d,e)}\nfunction we(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=qa(e)?!!e.capture:!!e,h=xe(a);h||(a[qe]=h=new Xd(a));c=h.add(b,c,d,g,f);if(!c.proxy){d=ye();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)ne||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(ze(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");se++}}\nfunction ye(){var a=Ae,b=ae?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function ue(a,b,c,d,e){if("array"==oa(b))for(var f=0;f<b.length;f++)ue(a,b[f],c,d,e);else c=ve(c),a&&a[Td]?a.b.add(String(b),c,!0,qa(d)?!!d.capture:!!d,e):we(a,b,c,!0,d,e)}\nfunction Ce(a,b,c,d,e){if("array"==oa(b))for(var f=0;f<b.length;f++)Ce(a,b[f],c,d,e);else(d=qa(d)?!!d.capture:!!d,c=ve(c),a&&a[Td])?(a=a.b,b=String(b).toString(),b in a.a&&(f=a.a[b],c=Yd(f,c,d,e),-1<c&&(Wd(f[c]),Array.prototype.splice.call(f,c,1),0==f.length&&(delete a.a[b],a.b--)))):a&&(a=xe(a))&&(b=a.a[b.toString()],a=-1,b&&(a=Yd(b,c,d,e)),(c=-1<a?b[a]:null)&&De(c))}\nfunction De(a){if("number"!==typeof a&&a&&!a.U){var b=a.src;if(b&&b[Td])Zd(b.b,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(ze(c),d):b.addListener&&b.removeListener&&b.removeListener(d);se--;(c=xe(b))?(Zd(c,a),0==c.b&&(c.src=null,b[qe]=null)):Wd(a)}}}function ze(a){return a in re?re[a]:re[a]="on"+a}\nfunction Ee(a,b,c,d){var e=!0;if(a=xe(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.U&&(f=Fe(f,d),e=e&&!1!==f)}return e}function Fe(a,b){var c=a.listener,d=a.ja||a.src;a.da&&De(a);return c.call(d,b)}\nfunction Ae(a,b){if(a.U)return!0;if(!ae){if(!b)a:{b=["window","event"];for(var c=p,d=0;d<b.length;d++)if(c=c[b[d]],null==c){b=null;break a}b=c}d=b;b=new oe(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.currentTarget;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;!b.a&&0<=e;e--){b.currentTarget=d[e];var f=Ee(d[e],a,!0,b);c=c&&f}for(e=0;!b.a&&e<d.length;e++)b.currentTarget=\nd[e],f=Ee(d[e],a,!1,b),c=c&&f}return c}return Fe(a,new oe(b,this))}function xe(a){a=a[qe];return a instanceof Xd?a:null}var Ge="__closure_events_fn_"+(1E9*Math.random()>>>0);function ve(a){if(r(a))return a;a[Ge]||(a[Ge]=function(b){return a.handleEvent(b)});return a[Ge]};function N(){oc.call(this);this.b=new Xd(this);this.v=this;this.o=null}xa(N,oc);N.prototype[Td]=!0;l=N.prototype;l.J=function(){return this.o};l.Ja=function(a){this.o=a};l.addEventListener=function(a,b,c,d){te(this,a,b,c,d)};l.removeEventListener=function(a,b,c,d){Ce(this,a,b,c,d)};\nl.dispatchEvent=function(a){var b,c=this.J();if(c)for(b=[];c;c=c.J())b.push(c);c=this.v;var d=a.type||a;if("string"===typeof a)a=new K(a,c);else if(a instanceof K)a.target=a.target||c;else{var e=a;a=new K(d,c);Ca(a,e)}e=!0;if(b)for(var f=b.length-1;!a.a&&0<=f;f--){var g=a.currentTarget=b[f];e=g.P(d,!0,a)&&e}a.a||(g=a.currentTarget=c,e=g.P(d,!0,a)&&e,a.a||(e=g.P(d,!1,a)&&e));if(b)for(f=0;!a.a&&f<b.length;f++)g=a.currentTarget=b[f],e=g.P(d,!1,a)&&e;return e};\nl.ha=function(){N.V.ha.call(this);this.b&&this.b.T(void 0);this.o=null};l.P=function(a,b,c){a=this.b.a[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.U&&f.capture==b){var g=f.listener,h=f.ja||f.src;f.da&&Zd(this.b,f);d=!1!==g.call(h,c)&&d}}return d&&0!=c.Ya};t("H.util.EventTarget",N);N.prototype.Ja=N.prototype.Ja;N.prototype.setParentEventTarget=N.prototype.Ja;N.prototype.J=N.prototype.J;N.prototype.getParentEventTarget=N.prototype.J;N.prototype.addEventListener=N.prototype.addEventListener;N.prototype.addEventListener=N.prototype.addEventListener;N.prototype.removeEventListener=N.prototype.removeEventListener;N.prototype.removeEventListener=N.prototype.removeEventListener;N.prototype.dispatchEvent=N.prototype.dispatchEvent;\nN.prototype.dispatchEvent=N.prototype.dispatchEvent;N.prototype.O=N.prototype.O;N.prototype.dispose=N.prototype.O;N.prototype.M=N.prototype.M;N.prototype.addOnDisposeCallback=N.prototype.M;N.prototype.S=N.prototype.P;\nN.prototype.P=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?"AT_TARGET":b?"CAPTURING_PHASE":(d=!0,"BUBBLING_PHASE")];if(!d||"pointerenter"!==(e=c.type)&&"pointerleave"!==e)c.eventPhase=g,f=N.prototype.S.apply(this,arguments),d&&this.J&&null===this.J()&&delete c.eventPhase;return f};function O(a){a=a||{};var b=a.callback;this.g=a.label;r(b)&&(this.callback=b);this.f=!!a.disabled;O.V.constructor.call(this)}xa(O,N);t("H.util.ContextItem",O);O.prototype.xb=function(){return this.g};O.prototype.getLabel=O.prototype.xb;O.prototype.ac=function(a){this.g!==a&&(this.g=a,this.dispatchEvent("update"));return this};O.prototype.setLabel=O.prototype.ac;O.prototype.Nb=function(){return this.f};O.prototype.isDisabled=O.prototype.Nb;\nO.prototype.$b=function(a){a^this.f&&(this.f=a,this.dispatchEvent("update"));return this};O.prototype.setDisabled=O.prototype.$b;var He=new O;O.SEPARATOR=He;function Ie(){if(y.document){var a=document.createElement("canvas");a.width=a.height=1;a.getContext("2d")}}t("H.util.getPixelRatio",function(){return window.devicePixelRatio||1});Object.create(Ia,void 0);t("H.util.eval",function(a){return eval(a)});t("H.util.provide",function(a){var b=p.$jscomp;if(b&&("function"!=typeof b.ub?0:b.ub()))throw Error("goog.provide cannot be used within a module.");ma(a,void 0)});function Je(){this.A=0}\nJe.prototype.next=function(a){if(9007199254740992===this.A)throw new Sd(a,this.A,[0,9007199254740991]);return this.A++};var Ke=new Je;Fa(Ke.next,Ke);function lc(){}var mb=Ha([]);Ha({});Ie();Ie();function Le(a,b,c){var d=Nb(+a,-90,90);if(b&&Ra(d))throw new A(b,c,a);return d}function Me(a,b,c){var d=+a;if(-180>d||180<d)d=Mb(d+180,360)-180;if(b&&Ra(d))throw new A(b,c,a);return d}function Ne(a,b,c){var d;if(a!==z&&Ra(d=+a)&&b)throw new A(b,c,a);return d}t("H.geo.isDBC",function(a,b){return 0!==(0>a^0>b)&&180<ub(b-a)});function Q(){var a=Q;if(!0===(Na(this,a)&&this.constructor===a))throw new TypeError("Illegal constructor "+Ua(a));}t("H.geo.AbstractGeometry",Q);Q.prototype.getBoundingBox=Q.prototype.X;Q.prototype.equals=Q.prototype.G;Q.prototype.oa="";Q.prototype.wa="";Q.prototype.toString=function(){return this.cb([this.oa.toUpperCase()," "]).join("")};Q.prototype.toString=Q.prototype.toString;Q.prototype.cc=function(){return{type:this.wa,coordinates:this.bb()}};Q.prototype.toGeoJSON=Q.prototype.cc;\nQ.prototype.ua=function(){return{type:this.oa,coordinates:this.va(),boundingBox:this.X().ua()}};Q.prototype.forWorkerMessage=Q.prototype.ua;function S(a,b,c){this.lat=Le(a,S,0);this.lng=Me(b,S,1);c!==z&&(this.alt=Ne(c,S,2))}xa(S,Q);t("H.geo.Point",S);S.prototype.G=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&(this.alt||0)===(a.alt||0)};S.prototype.equals=S.prototype.G;S.prototype.ra=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*Jb;var c=a.lat*Jb;a=1.274200158E7*yb(sb(1,qb(rb(xb((b-c)/2),2)+zb(b)*zb(c)*rb(xb((this.lng*Jb-a.lng*Jb)/2),2))))}return a};\nS.prototype.distance=S.prototype.ra;\nS.prototype.gc=function(a,b,c){if(c){if(b/=6371000.79){a*=Jb;var d=Jb*this.lat;var e=xb(d);var f=xb(b);var g=zb(b);var h=Jb*this.lng;var k=zb(d);d=yb(k*zb(a)*f+e*g);a=Cb(xb(a)*k*f,g-e*xb(d));a=(h+a+I)%(2*I)-I;k=a*Kb}return b?new S(d*Kb,(k+540)%360-180):this}a=(a%360+360)%360;if(0===(a+90)%180)return d=this.lng+b/(6371000.79*Hb*zb(this.lat*Jb))*(270===a?-360:360),new S(this.lat,(d+540)%360-180);if(b/=6371000.79){a*=Jb;h=this.lat*Jb;e=this.lng*Jb;f=h+b*zb(a);g=f-h;d=vb(Ab(f/2+Gb)/Ab(h/2+Gb));d=Ra(g/\nd)?zb(h):g/d;var m=b*xb(a)/d;ub(f)>Eb&&(f=0<f?I-f:-(I+f))}return b?new S(f*Kb,((e+m+Ib+(ub(h+g)>Eb?I:0))%Hb-I)*Kb):this};S.prototype.walk=S.prototype.gc;S.prototype.X=function(){return new V(this.lat,this.lng,this.lat,this.lng)};S.prototype.getBoundingBox=S.prototype.X;function Oe(a,b,c){var d=qa(a)&&!(Ra(a.lat=Le(a.lat))||Ra(a.lng=Me(a.lng))||a.alt!==z&&Ra(a.alt=Ne(a.alt)));if(!d&&b)throw new A(b,c,a);return d}S.validate=Oe;\nfunction Pe(a){if(!a)throw new A(Pe,0,a);return new S(a.lat,a.lng,a.alt)}S.fromIPoint=Pe;l=S.prototype;l.oa="Point";l.cb=function(a){a.push("(",this.lng," ",this.lat,")");return a};l.wa="Point";l.bb=function(){return[this.lng,this.lat,this.alt||0]};l.va=function(){return[this.lat,this.lng,this.alt||0]};var W={};t("H.geo.mercator",W);W.a=function(a){return sb(1,tb(0,.5-vb(Ab(Gb+Eb*a/180))/I/2))};W.b=function(a){return a/360+.5};W.ka=function(a,b,c){c?(c.x=W.b(b),c.y=W.a(a)):c=new E(W.b(b),W.a(a));return c};W.latLngToPoint=W.ka;W.rb=function(a,b){return W.ka(a.lat,a.lng,b)};W.geoToPoint=W.rb;W.f=function(a){return 0>=a?90:1<=a?-90:Kb*(2*Bb(wb(I*(1-2*a)))-Eb)};W.c=function(a){return 360*(1===a?1:Mb(a,1))-180};W.W=function(a,b,c){c?(c.lat=W.f(b),c.lng=W.c(a)):c=new S(W.f(b),W.c(a));return c};\nW.xyToGeo=W.W;W.Ub=function(a,b){return W.W(a.x,a.y,b)};W.pointToGeo=W.Ub;t("H.util.constants.DEFAULT_MIN_ZOOM_LEVEL",0);t("H.util.constants.DEFAULT_MAX_ZOOM_LEVEL",22);function Y(a,b){this.projection=a||W;this.b=0;this.a=this.exp=vb(b||256)/Db;Qe(this);this.y=this.x=0}t("H.geo.PixelProjection",Y);var Re=ub(24)+ub(-8);Y.prototype.Xb=W;Y.prototype.projection=Y.prototype.Xb;Y.prototype.x=0;Y.prototype.x=Y.prototype.x;Y.prototype.y=0;Y.prototype.y=Y.prototype.y;Y.prototype.fc=rb(2,Re);Y.prototype.w=Y.prototype.fc;Y.prototype.Hb=rb(2,Re);Y.prototype.h=Y.prototype.Hb;\nY.prototype.ca=function(a){if(Ra(a))throw new A(this.ca,0,a);var b=this.x/this.w;var c=this.y/this.h;this.b=a;this.a=this.exp+a;Qe(this);this.x=b*this.w;this.y=c*this.h};Y.prototype.rescale=Y.prototype.ca;function Qe(a){a.a>Re&&(a.a=Re);a.w=rb(2,a.a);a.h=rb(2,a.a)}Y.prototype.Ra=function(){return this.b||0};Y.prototype.getZoomScale=Y.prototype.Ra;Y.prototype.qb=function(a,b){a=this.projection.ka(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Y.prototype.geoToPixel=Y.prototype.qb;\nY.prototype.Fa=function(a,b){return this.projection.W((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};Y.prototype.pixelToGeo=Y.prototype.Fa;Y.prototype.W=function(a,b,c){return this.projection.W((a+this.x)/this.w,(b+this.y)/this.h,c)};Y.prototype.xyToGeo=Y.prototype.W;Y.prototype.Ba=function(a,b,c){a=this.projection.ka(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Y.prototype.latLngToPixel=Y.prototype.Ba;Y.prototype.Vb=function(a){return new E(a.x*this.w-this.x,a.y*this.h-this.y)};\nY.prototype.pointToPixel=Y.prototype.Vb;t("H.util.Disposable",oc);oc.prototype.M=oc.prototype.M;oc.prototype.addOnDisposeCallback=oc.prototype.M;t("H.util.dispose",function(a){a&&"function"==typeof a.O&&a.O()});function Se(){}t("H.util.ICancelable",Se);Se.prototype.cancel=function(){};Se.prototype.cancel=Se.prototype.cancel;function Te(a,b,c,d){this.key="";this.x=a;this.y=b;this.b=c;this.Y=d;this.a=Ad()}Te.prototype.then=function(a,b,c){return this.a.a.then(a,b,c)};Te.prototype.reject=function(a){this.a.reject(a)};Te.prototype.cancel=function(){this.a.a.cancel()};function Ue(a,b,c,d){if(!a||!b||!c)throw new A(Ue,null,"Must specify name, version and revision parameter");this.name=a;this.version=b;this.revision=c;d&&Ca(this,d)}t("H.util.BuildInfo",Ue);Ue.prototype.toString=function(){var a,b=[];for(a in this)Qa(this[a])&&b.push(this[a]);return b.join(";")};var Ve={};function We(a,b,c,d){if(!a)throw new A(We,1,"Must specify a name parameter");return Ve[a]||(Ve[a]=new Ue(a,b,c,d))}Ue.get=We;function Z(a,b,c,d,e,f){if(a&&b)this.ab(a),this.Ha(b),this.Ka(c),this.$a(e),this.Za(f),this.La(d);else throw Error(\'Parameters "scheme" and "host" must be specified\');}t("H.service.Url",Z);\nfunction Xe(a,b){var c=y.document,d,e=c&&c.createElement("a"),f="";if(c){if(b){var g=(d=c.getElementsByTagName("base")[0])&&d.href;var h=c.head;var k=d||h.appendChild(c.createElement("base"));k.href=b}e.href=a;f=e.href;b&&(d?d.href=g:h.removeChild(k))}else/[\\w]+:\\/\\//.test(a)&&(f=a);g=/(?:(\\w+):\\/\\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\\/[^?#]*)?(\\?[^#]+)?(#.*)?/.exec(f);a=g[1];k=g[4];b=g[5];h=g[6];c=g[7];d=g[8];!g[2]&&k&&/@/.test(k)&&(k=k.split("@")[1]);g=k;h=h&&0<h.length?h.substr(1):\n"";k={};if(c)for(e=/([?&]?([^=&+]+))(=([^&]+))?/g;f=e.exec(c);)k[decodeURIComponent(f[2])]=f[4]?decodeURIComponent(f[4]):void 0;return new Z(a,g,h,k,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):"")}Z.parse=Xe;var Ye=0;Z.prototype.clone=function(){Ye++;var a={},b;for(b in this.a)a[b]=this.a[b];return new Z(this.o,this.f,this.b,a,this.g,this.c)};Z.prototype.clone=Z.prototype.clone;\nZ.prototype.ab=function(a){if(!a||"string"!==typeof a)throw Error(\'The "scheme" parameter must be a non-empty string.\');this.o=a;return this};Z.prototype.setScheme=Z.prototype.ab;Z.prototype.Eb=function(){return this.o};Z.prototype.getScheme=Z.prototype.Eb;Z.prototype.Ha=function(a){if(!a||"string"!==typeof a||"-"===a.charAt(0)||"."===a.charAt(0)||"."===a.charAt(a.length-1))throw Error(\'The "host" parameter is not a valid host name.\');this.f=a;return this};Z.prototype.setHost=Z.prototype.Ha;\nZ.prototype.wb=function(){return this.f};Z.prototype.getHost=Z.prototype.wb;Z.prototype.Ka=function(a){this.b=a||void 0;return this};Z.prototype.setPath=Z.prototype.Ka;Z.prototype.Bb=function(){return this.b};Z.prototype.getPath=Z.prototype.Bb;Z.prototype.La=function(a){if(a)if("object"==typeof a)this.a=a;else throw Error(\'Parameter "params" must be an object.\');else this.a={};return this};Z.prototype.setQuery=Z.prototype.La;Z.prototype.Ib=function(){return!Ze(this)};Z.prototype.hasQuery=Z.prototype.Ib;\nZ.prototype.getQuery=function(){return this.a};Z.prototype.getQuery=Z.prototype.getQuery;Z.prototype.$a=function(a){if(a&&isNaN(parseInt(a,10)))throw Error(\'Parameter "port" must be a number or undefined\');this.g=+a||void 0;return this};Z.prototype.setPort=Z.prototype.$a;Z.prototype.Cb=function(){return this.g};Z.prototype.getPort=Z.prototype.Cb;Z.prototype.Za=function(a){this.c=a||void 0;return this};Z.prototype.setAnchor=Z.prototype.Za;Z.prototype.sb=function(){return this.c};\nZ.prototype.getAnchor=Z.prototype.sb;Z.prototype.$=function(a){if("object"!==typeof a)throw Error(\'Parameter "other" must be an object.\');var b=this.a,c;for(c in a)a.hasOwnProperty(c)&&"function"!==typeof a[c]&&(b[c]=a[c]);return this};Z.prototype.mergeQuery=Z.prototype.$;Z.prototype.hb=function(a){if(!a||"string"!==typeof a)throw Error(\'Parameter "subDomain" must be a non-empty string\');"."===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.Ha(a+"."+this.f)};\nZ.prototype.addSubDomain=Z.prototype.hb;Z.prototype.ib=function(a){if(!a||"string"!==typeof a)throw Error(\'Parameter "subPath" must be a non-empty string\');return this.Ka((this.b?this.b+"/":"")+a)};Z.prototype.addSubPath=Z.prototype.ib;Z.prototype.toString=function(){return[this.o+"://",this.f,this.g?":"+this.g:"",this.b||!Ze(this)||this.c?"/":"",this.b?encodeURI(this.b):"",$e(this),this.c?"#"+encodeURIComponent(this.c):""].join("")};Z.prototype.toString=Z.prototype.toString;\nfunction $e(a){var b=[],c,d=a.a,e;for(c in d)if(d.hasOwnProperty(c)&&"function"!==typeof d[c]){var f=a.a[c];if(Na(f,af)){var g=0;var h=f.eb;for(e=h.length;g<e;)b.push(encodeURIComponent(c)+(void 0===f?"":"="+encodeURIComponent(h[g]))),g++}else b.push(encodeURIComponent(c)+(void 0===f?"":"="+encodeURIComponent(f)))}return 0<b.length?"?"+b.join("&"):""}function Ze(a){var b,c=0;for(b in a.a)if(a.a.hasOwnProperty(b)&&"function"!==typeof a.a[b]&&(c++,0<c))break;return!c}\nfunction af(a){var b;if(!Oa(a,void 0,void 0,void 0))throw new A(af,0,a);for(b=0;b<a.length;b++){var c=a[b];if(!Qa(c)&&!Sa(c))throw new A(af,0,"The array can only contain strings and numbers");}this.eb=a}Z.MultiValueQueryParameter=af;af.prototype.Gb=function(){return this.eb};af.prototype.getValues=af.prototype.Gb;var bf={};function cf(a){try{importScripts.apply(self,arguments)}catch(b){this.postError("invalid_script")}}function df(a){bf[a]=null;this.postMessage(a)}function ef(a,b,c){if(r(b))var d=b;else try{d=self.eval("("+b+")"),r(d)||(d=null)}catch(e){}d?(bf[a]=d,c||this.postMessage(a)):this.postError("invalid_processor")}function ff(a){this.b=a&&a[0];this.a=a&&a[1];this.c=a&&a[2]||[]}ff.prototype.postError=function(a){this.postMessage(a,z,0)};\nff.prototype.postMessage=function(a,b,c){self.postMessage({processor:this.b,taskId:this.a,type:c===z?1:c,data:a},b||z)};function gf(a,b,c){if(!Qa(a))throw new A(gf,0,"InvalidArgument");if(!r(b))throw new A(gf,1,"InvalidArgument");var d=hf++;jf[d]={mimeType:c||kf,lb:b};(new ff(["3",d,[]])).postMessage(a,[],2)}var jf={},hf=0;\nfunction lf(a,b){var c=a;if(jf[this.a]){var d=jf[this.a];var e=d.lb;delete jf[this.a];if(b)e(null,b);else{if(d.mimeType===mf){a=new Uint8Array(a);b=a.byteLength;d="";c=0;for(var f,g,h,k;c<b;)f=a[c++],192>f||(g=a[c++],224>f?f=(f&31)<<6|g&63:(h=a[c++],240>f?f=(f&15)<<12|(g&63)<<6|h&63:(k=a[c++],f=(f&7)<<18|(g&63)<<12|(h&63)<<6|k&63))),65536>f?d+=String.fromCharCode(f):(f-=65536,d+=String.fromCharCode((f>>10)+55296,(f&1023)+56320));c=d}e(c)}}}var kf=0,mf=1;function V(a,b,c,d){nf(this,Le(a,V,0),Me(b,V,1),Le(c,V,2),Me(d,V,3))}xa(V,Q);t("H.geo.Rect",V);V.prototype.oa="Polygon";V.prototype.cb=function(a){var b=this.m,c=this.i,d=this.l,e=this.j;a.push("(","(",c," ",b,",",e," ",b,",",e," ",d,",",c," ",d,",",c," ",b,")",")");return a};V.prototype.G=function(a){return this===a||!!a&&this.m===a.m&&this.i===a.i&&this.l===a.l&&this.j===a.j};V.prototype.equals=V.prototype.G;V.prototype.clone=function(){return new V(this.m,this.i,this.l,this.j)};\nV.prototype.clone=V.prototype.clone;function nf(a,b,c,d,e){a.i=c;a.j=e;b<d&&(c=b,b=d,d=c);a.m=b;a.l=d;a.c=a.a=a.b=null;return a}V.prototype.Qa=function(){this.c||(this.c=new S(this.m,this.i));return this.c};V.prototype.getTopLeft=V.prototype.Qa;V.prototype.Pa=function(){this.a||(this.a=new S(this.l,this.j));return this.a};V.prototype.getBottomRight=V.prototype.Pa;V.prototype.Fb=function(){return this.m};V.prototype.getTop=V.prototype.Fb;V.prototype.tb=function(){return this.l};\nV.prototype.getBottom=V.prototype.tb;V.prototype.yb=function(){return this.i};V.prototype.getLeft=V.prototype.yb;V.prototype.Db=function(){return this.j};V.prototype.getRight=V.prototype.Db;V.prototype.I=function(){this.b||(this.b=new S(this.l+(this.m-this.l)/2,of(this.i,this.K())));return this.b};V.prototype.getCenter=V.prototype.I;V.prototype.K=function(){return pf(this.i,this.j)};V.prototype.getWidth=V.prototype.K;V.prototype.R=function(){return this.m-this.l};V.prototype.getHeight=V.prototype.R;\nV.prototype.Lb=function(){return this.i>this.j};V.prototype.isCDB=V.prototype.Lb;V.prototype.Ob=function(){return!this.K()&&!this.R()};V.prototype.isEmpty=V.prototype.Ob;V.prototype.X=function(){return new V(this.m,this.i,this.l,this.j)};V.prototype.getBoundingBox=V.prototype.X;V.prototype.ea=function(a,b,c){var d=this.I();c||(a=Le(a,this.ea,0),b=Me(b,this.ea,1));b=this.L(a,b,c);a=b.I();return a.lat===d.lat&&a.lng===d.lng&&this.R()===b.R()&&this.K()===b.K()};V.prototype.containsLatLng=V.prototype.ea;\nV.prototype.fa=function(a,b){b||Oe(a,this.fa,0);return this.ea(a.lat,a.lng,b)};V.prototype.containsPoint=V.prototype.fa;V.prototype.Oa=function(a,b){var c=this.I();if(!b&&!Na(a,V))throw new A(this.Oa,0,a);b=this.la(a,b);a=b.I();return a.lat===c.lat&&a.lng===c.lng&&this.R()===b.R()&&this.K()===b.K()};V.prototype.containsRect=V.prototype.Oa;\nV.prototype.L=function(a,b,c,d){if(!c){if(Ra(a=Le(a)))throw new A(this.L,0,a);if(Ra(b=Me(b)))throw new A(this.L,1,b);}return qf(this.m,this.i,this.l,this.j,a,b,a,b,d)};V.prototype.mergeLatLng=V.prototype.L;V.prototype.Va=function(a,b,c){b||Oe(a,this.Va,0);return this.L(a.lat,a.lng,b,c)};V.prototype.mergePoint=V.prototype.Va;V.prototype.la=function(a,b,c){if(!b&&!Na(a,V))throw new A(this.la,0,a);return qf(this.m,this.i,this.l,this.j,a.m,a.i,a.l,a.j,c)};V.prototype.mergeRect=V.prototype.la;\nV.prototype.aa=function(a,b,c,d,e,f){e||(a=Le(a,this.aa,0),b=Me(b,this.aa,1),c=Le(c,this.aa,2),d=Me(d,this.aa,3));return qf(this.m,this.i,this.l,this.j,a,b,c,d,f)};V.prototype.mergeTopLeftBottomRight=V.prototype.aa;V.prototype.Ta=function(a,b){var c=this.i<=this.j,d=a.i<=a.j,e=this.i<a.j,f=a.i<this.j;if(!b&&!Na(a,V))throw new A(this.Ta,0,a);return this.l<=a.m&&a.l<=this.m&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};V.prototype.intersects=V.prototype.Ta;function pf(a,b){a=b-a;return a+(0>a?360:0)}\nfunction of(a,b){a+=b/2;return a-(180<a?360:0)}function qf(a,b,c,d,e,f,g,h,k){c=sb(c,g);a=tb(a,e);e=pf(b,d);var m=of(b,e);g=pf(f,h);var n=of(f,g)-m;n+=0>n-1E-6?360:0;if(180>n-1E-6){m=b;var q=h}else n=360-n,m=f,q=d;n=n+e/2+g/2;360<=n+5E-7?(m=-180,q=180):n-5E-7<e?(m=b,q=d):n-5E-7<g&&(m=f,q=h);return k?nf(k,a,m,c,q):new V(a,m,c,q)}V.merge=qf;function rf(a,b,c){c||(Oe(a,rf,0),Oe(b,rf,1));return new V(a.lat,a.lng,b.lat,b.lng)}V.fromPoints=rf;\nfunction sf(a,b){var c=1,d=a.length,e=null;var f=oa(a);if("array"!=f&&("object"!=f||"number"!=typeof a.length))throw new A(sf,0,a);if(0<d)for(f=a[0],e=rf(f,f,b);c<d;c++)f=a[c],e.L(f.lat,f.lng,b,e);return e}V.coverPoints=sf;function tf(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new A(tf,0,a);if(0<d)for(e=new V(a[0],a[1],a[0],a[1]);c<d;c+=3)e.L(a[c],a[c+1],b,e);return e}V.coverLatLngAlts=tf;\nfunction uf(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new A(uf,0,a);if(0<d)for(e=new V(a[0].m,a[0].i,a[0].l,a[0].j);c<d;c++)e.la(a[c],b,e);return e}V.coverRects=uf;\nV.prototype.Xa=function(a,b){var c=this.i,d=this.m,e=this.j,f=this.l,g=this.I().lng;Oe(a,this.Xa,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?nf(b,d,a,f,e):new V(d,a,f,e)};V.prototype.resizeToCenter=V.prototype.Xa;V.prototype.wa="Polygon";\nV.prototype.bb=function(){return[[this.i,this.m,0],[this.j,this.m,0],[this.j,this.l,0],[this.i,this.l,0],[this.i,this.m,0]]};V.prototype.ua=function(){return this.va()};V.prototype.va=function(){return[this.m,this.i,this.l,this.j]};function vf(a,b,c,d){var e=!!c,f,g=0,h=0,k=0,m=0,n=0,q,u=-1;var J=y.Float32Array;var M,v=[];if(b){b=La(b);a=La(a);e&&(f=La(c));c=b.length;d=d?1E-7:1E-5;for(M=new J(3*c);g<c;){J=b[g];var G=+J;var X=+a[g];e&&(q=+f[g]);wf.test(J)?0<=u&&(0<g-u&&v.push(u,g+1),u=-1):0>u&&(u=g);g++;m=M[h++]=m+X*d;k=M[h++]=k+G*d;e&&(n=M[h]=n+q);h++}0<=u&&1<c-u&&v.push(u,c)}else M=new J(0);return{path:M,outlineIndices:v}}var wf=/^-?0\\d/;\nfunction xf(a,b){for(var c=0,d=a.length/3,e=new y.Array(d),f=0;c<d;)e[c++]=b.Ba(a[f],a[++f]),f+=2;return e};function yf(a,b){b=180/(1<<b);var c=a.lat+90;a=(a.lng+180)%360;var d=0;180==c&&d--;d+=Math.floor(c/b);return[d,Math.floor(a/b)]}var zf=1/Math.pow(10,10);function Af(a,b){var c=[],d=a.Qa();a=a.Pa();var e;180==a.lng&&(a.lng-=zf);d=yf(d,b);a=yf(a,b);for(e=d[0];e>=a[0];e--)for(b=d[1];b<=a[1];b++)c.push(e,b);return c};function Bf(a,b){var c=a.tileSize||256;this.b={};this.v=Xe(a.serverUrl);this.g=b;this.dc=a.layerConfigs||[];this.o=a.projected;this.S=c;this.Ea=!1!==a.batchTiles;this.Ga=a.horizontalMargin||0;this.ec=a.onlyOutline;this.fb=new Y(Ia,c);this.f=new Y(Ia,c);this.f.ca(22-Math.log(c)/Math.LN2+8)}xa(Bf,oc);l=Bf.prototype;\nl.Zb=function(a,b,c){var d=this.S,e=this.Ga,f={x:a*d-e,y:b*d};d={x:(a+1)*d-1+e,y:(b+1)*d-1};e=this.fb;e.ca(c);f=e.Fa(f);d=e.Fa(d);return Cf(this,new V(f.lat,f.lng,d.lat,d.lng),this.dc,{x:a,y:b,z:c})};l.Yb=function(a,b,c,d,e){return Cf(this,new V(a,b,c,d),e)};\nfunction Cf(a,b,c,d){var e=Df(c),f=e.length,g={},h,k=a.b,m=[],n=[];for(c=0;c<f;c++){var q=e[c];var u=q.layerId;var J=q.level;g[u]=q.columns;q=Af(b,J);var M=q.length-1;for(h=0;h<M;h+=2){var v=[u,q[h+1],q[h],J].join("_");var G=k[v]||a.g.get(v);G||(G=new Te(q[h+1],q[h],J,u),G.key=v,k[v]=G,n.push(G));m.push(G)}}n.length&&(a.Ea?Ef(a,n):Ff(a,n));return zd(m.map(function(X){return X.then(Fa(this.ob,this,X.Y,Gf(e))).then(Fa(this.Wb,this,X,d||{})).then(Fa(this.pb,this,g[X.Y]))},a))}\nl.ob=function(a,b,c){var d=c.Rows,e=d.length,f,g;if(e&&(f=b[a])){b=new D(c.Rows);var h=[];for(g=0;g<e;g++){var k=d[g];f(b.ia(g),a)&&h.push(k)}a={Rows:h};if(c=c.Meta)a.Meta=c}else a=c;return a};function Ff(a,b){function c(k,m,n){n?(delete a.b[k.key],k.reject(n)):Hf(a,k,m)}var d,e=b.length,f=a.v;for(d=0;d<e;d++){var g=b[d];var h=f.clone().$({tilex:g.x}).$({tiley:g.y}).$({level:g.b}).$({layer:g.Y});new gf(h.toString(),Fa(c,null,g),mf)}}\nfunction Ef(a,b){var c=b.length,d;for(d=0;d<c;d+=15){var e=b.slice(d,d+15);If(a,e)}}function If(a,b){var c=a.v.clone(),d=[],e=[],f=[],g=c.getQuery();b.length&&(b.forEach(function(h){d.push(h.x,h.y);e.push(h.b);f.push(h.Y)}),g.tilexy=d.join(","),g.layers=f.join(","),g.levels=e.join(","),c.La(g),new gf(c.toString(),function(h,k){k?b.forEach(function(m){delete a.b[m.key];m.reject("error")}):Hf(a,b,h)},mf))}\nfunction Hf(a,b,c){var d=b.length,e;if(Oa(b,void 0,void 0,void 0)){var f=c.indexOf("[")+1;for(e=0;e<d;e++){var g=c.indexOf("]},{",f+3)+2;g<f&&(g=c.lastIndexOf("]}"));var h=c.substr(f,g-f);f=g+1;Jf(a,b[e],h)}}else Jf(a,b,c)}function Jf(a,b,c){try{var d=c.length;var e=b.key;delete a.b[e];a.g.add(e,b,2*d);var f=JSON.parse(c);b.a.b(f)}catch(g){b.reject(g.message)}}\nfunction Gf(a){var b={},c,d=a.length;for(c=0;c<d;c++){var e=a[c];if(e.rowFilter){var f=e.layerId;f=f!==z?f:e.layer;b[f]=Fa(e.rowFilter,e.rowFilterContext)}}return b}function Kf(a,b,c,d,e){return e?[new E(a,b),new E(c,b),new E(c,d),new E(a,d),new E(a,b)]:[a,b,c,b,c,d,a,d]}\nl.Wb=function(a,b,c){var d=this.f.Ra()-b.z,e=this.S<<d,f=50<<d,g=b.x*e;b=b.y*e;var h=g+e;e=b+e;var k=g-f,m=b-f,n=h+f;f=e+f;var q,u,J=c.Rows,M=J.length,v,G=/^ADAS/.test(a.Y),X=this.f,pa=this.ec,R,ab=[],Ja=[],Ka=[],bb=[];for(a=0;a<M;a++){var w=v=J[a];var P=(R=G)?"HPY":"LAT";var T=R?"HPX":"LON";var ea=R?"HPZ":"ZLEVEL";if(w[P]){var U=vf(w[P],w[T],w[ea],R);w.geometry=U;delete w[P];delete w[T];delete w[ea];if(w.INNER_LAT)for(P=w.INNER_LAT.split(";"),U=w.INNER_LON.split(";"),delete w.INNER_LAT,delete w.INNER_LON,\nw.interiors=ea=[],T=P.length,w=0;w<T;w++)ea.push(vf(P[w],U[w],"",R))}if(this.o){R=void 0;T=v;U=X;P=T.$$projected$$;if(!P){var aa=T.geometry;w=xf(aa.path,U);v=[w];T.$$projected$$=P={Tb:v};T=(ea=T.interiors)?ea.length:0;v.length+=T;R|=Lf(v,w,aa.outlineIndices);if(T)for(P.Jb=1,q=0;q<T;q++)aa=ea[q],w=xf(aa.path,U),v[1+q]=w,R|=Lf(v,w,aa.outlineIndices);R&&(P.Rb=1+T)}w=P;R=w.Tb;v=w.Jb;var zc=w.Rb;U=[];P=T=Lb;var cb=ea=z;w=R[0];if(1===w.length){var Ac=Ac||(Ac=Kf(g,b,h,e,!1));v=w[0];Rb(v.x,v.y,Ac)&&U.push(Mf(w,\ng,b,d))}else{var Be=R.length;for(aa=pa?zc:0;aa<Be&&(pa||!aa||U.length);aa++)if(w=R[aa],aa>=zc){aa===zc&&(P=U.length);var ja=Ub([w],k,m,n,f,!1);Nf(ja,g,b,d,U)}else{var Fb=Fb||(Fb=Kf(k,m,n,f,!0));if(aa>=v)if(aa===v&&(T=U.length),cb)for(q=cb.length;q--;){if(ja=Of(cb[q],w),u=ja.length){for(ea=ea||[];u--;)ea.push(q);Nf(ja,g,b,d,U)}}else ja=Of(Fb,w),Nf(ja,g,b,d,U);else if(ja=Of(Fb,w),Nf(ja,g,b,d,U),1<ja.length&&v<Be)for(cb=[],q=ja.length;q--;)cb[q]=ja[q]}}U.length&&(ab[a]=U,Ja[a]=T,Ka[a]=ea,bb[a]=P)}}return{bc:c,\nmb:ab,Kb:Ja,nb:Ka,Sb:bb}};function Lf(a,b,c){for(var d=c.length,e=0,f,g,h=b.length;e<d;)f=c[e++],g=c[e++],a.push(g-f===h?b:b.slice(f,g));return 0<c.length}function Of(a,b){var c,d=[];if(c=Wb(a,b)){do{a=[];b=c;do a.push(b);while(b=b.next);d.push(a)}while(c=c.Wa)}else Sb(b[0],Tb(a))?d.push(b):Sb(a[0],Tb(b))&&d.push(a);return d}function Nf(a,b,c,d,e){for(var f=0,g=a.length;f<g;f++)e.push(Mf(a[f],b,c,d))}\nfunction Mf(a,b,c,d){var e,f=a.length,g=new Int32Array(2*f),h=0;for(e=0;e<f;e++){var k=a[e];g[h++]=k.x-b>>d;g[h++]=k.y-c>>d}return g}\nl.pb=function(a,b){var c=b.bc,d=b.mb,e=b.Kb,f=b.Sb;b=b.nb;for(var g=[],h,k={Rows:g},m,n=a?a.length:0,q=0,u,J=c.Rows,M=J.length,v;q<M;q+=1)if(d[q]||!this.o){h={};u=J[q];if(n)for(m=0;m<n;m++)u.hasOwnProperty(a[m])&&(h[a[m]]=u[a[m]]);else for(v in u)"$$projected$$"!==v&&(h[v]=u[v]);u.geometry&&(h.geometry=u.geometry);m=void 0;var G,X=h,pa=d[q],R=e[q],ab=b[q],Ja=f[q],Ka=g;if(pa){var bb=pa.length;if(ab)for(G=R;G--;){if(G){var w={};for(m in X)w[m]=X[m]}else w=X;u=[pa[G]];var P=sb(bb,Ja)-R;for(h=0;h<P;h++)ab[h]===\nG&&u.push(pa[R+h]);P=u.length;if(!G)for(h=Ja;h<bb;h++)u.push(pa[h]);w.$HProjGeometry={paths:u,interiorsIndex:1,outlinesIndex:P};Ka.push(w)}else X.$HProjGeometry={paths:pa,interiorsIndex:R,outlinesIndex:Ja},Ka.push(X)}else Ka.push(X)}c.Meta&&(k.Meta=c.Meta);return k};l.ha=function(){var a,b=this.b;for(a in b)b.hasOwnProperty(a)&&(b[a].reject("disposed"),delete b[a])};\nfunction Df(a){for(var b=[],c,d=a.length,e=0;e<d;e++){c=Aa(a[e]);if(c.rowFilter&&(c.rowFilter=eval("("+c.rowFilter+")"),!r(c.rowFilter)))throw Error("Invalid row filter for layer "+c.layerId);b.push(c)}return b};t("H.service.extension.worker.processor",function(a,b,c){function d(h){e.postMessage(h)}var e=this,f=za[a];var g=function(h){e.postError(h.toString())};if(0===b)f||(za[a]=new Bf(c,Pf)),this.postMessage();else if(f)switch(b){case 1:try{f.Zb.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 2:try{f.Yb.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 3:f.O();delete za[a];ya()&&Pf.T();break;default:e.postError("Unsupported command")}else e.postError("TileProvider is not initialized")});\nvar Pf=new B(26214400),za=Object.create(Ia,void 0);function Qf(a,b,c){var d=a[b];a=a[b+1];this.Sa=[];this.Ma=0;this.b=b;this.a=[a-c,d-c,a+c,d+c]}Qf.prototype.fa=function(a,b){var c=a[b];a=a[b+1];b=this.a;return b[1]<=c&&c<=b[3]&&b[0]<=a&&a<=b[2]};Qf.prototype.I=function(){return this.b};var Rf=new E(0,0);function Sf(a,b,c,d,e){d[e]=b;d[e+1]=a}var Tf=new Y;function Uf(a,b,c,d,e){Tf.Ba(a,b,Rf);d[e]=Rf.x;d[e+1]=Rf.y}\nt("H.clustering.dynamicgrid.worker",function(a,b,c,d,e){var f=e?Sf:Uf,g=0;e=!!self.ArrayBuffer;var h=a.byteLength?new Float64Array(a):a,k=h.length/3;a=[];var m=[],n=[],q=e?new Float64Array(2*k):[];k=0;var u=0;for(Tf.ca(d);g<h.length;){var J=h[g++];var M=h[g++];var v=h[g++];f(v,M,d,q,u);for(v=a.length;v--;)if(M=a[v],M.fa(q,u)){var G=M;break}G||(G=new Qf(q,u,b),a.push(G));v=u/2;G.Ma+=J||1;G.Sa.push(v);G=null;u+=2}for(v=a.length;v--;)M=a[v],b=M.Ma>=c,f=M.Sa,d=f.length,b?(m.push(d),m=m.concat(f)):\n(k+=d,n=n.concat(f));c=[k].concat(n,m);c=e?(new Uint32Array(c)).buffer:c;this.postMessage(c,[c])});self.addEventListener("message",function(a){a=new ff(a.data);var b=bf[a.b];if(b)try{b.apply(a,a.c)}catch(c){a.postError(c.message)}else a.postError("processor_not_found")});(function(){var a=new ff;var b=function(c,d){ef.apply(a,[c,d,!0])};b("0",cf);b("1",ef);b("2",df);b("3",lf)})();\n';!function(){var t=function(){var e,i,r;"undefined"!=typeof self&&("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope)||!("undefined"!=typeof module&&module.exports||"undefined"!=typeof window)||(e=t.toString(),i="",r="undefined"!=typeof document&&document.currentScript instanceof HTMLScriptElement?document.currentScript.src:""),function(){"use strict";function t(t){return n.call(t).slice(8,-1)}var n={}.toString,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(t,e){return t(e={exports:{}},e.exports),e.exports}function s(t){return t&&t.Math==Math&&t}function l(t){try{return!!t()}catch(t){return!0}}function u(t){return"object"==typeof t?null!==t:"function"==typeof t}function c(t){return w?x.createElement(t):{}}function h(t){if(!u(t))throw TypeError(String(t)+" is not an object");return t}function f(t,e){if(!u(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!u(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!u(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!u(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function p(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function d(t,e){try{E(m,t,e)}catch(i){m[t]=e}return e}function y(t){return"Symbol(".concat(void 0===t?"":t,")_",(++S+R).toString(36))}function g(t){return O[t]||(O[t]=P&&C[t]||(P?C:y)("Symbol."+t))}function v(e){var i,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(i=Object(e),L))?r:I?t(i):"Object"==(n=t(i))&&"function"==typeof i.callee?"Arguments":n}var _="object",m=s(typeof globalThis==_&&globalThis)||s(typeof window==_&&window)||s(typeof self==_&&self)||s(typeof o==_&&o)||Function("return this")(),b=!l(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),x=m.document,w=u(x)&&u(x.createElement),k=!b&&!l(function(){return 7!=Object.defineProperty(c("div"),"a",{get:function(){return 7}}).a}),A=Object.defineProperty,T={f:b?A:function(t,e,i){if(h(t),e=f(e,!0),h(i),k)try{return A(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},E=b?function(t,e,i){return T.f(t,e,p(1,i))}:function(t,e,i){return t[e]=i,t},M=a(function(t){var e="__core-js_shared__",i=m[e]||d(e,{});(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.1.0",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),S=0,R=Math.random(),P=!l(function(){return!String(Symbol())}),O=M("wks"),C=m.Symbol,L=g("toStringTag"),I="Arguments"==t(function(){return arguments}()),j={};j[g("toStringTag")]="z";function N(t,e){return Y.call(t,e)}function z(t){return $[t]||($[t]=y(t))}var D,F,U,B,G,V,q,W,X="[object z]"!==String(j)?function(){return"[object "+v(this)+"]"}:j.toString,Y={}.hasOwnProperty,K=M("native-function-to-string",Function.toString),Z=m.WeakMap,Q="function"==typeof Z&&/native code/.test(K.call(Z)),$=M("keys"),J={},tt=m.WeakMap;q=Q?(D=new tt,F=D.get,U=D.has,B=D.set,G=function(t,e){return B.call(D,t,e),e},V=function(t){return F.call(D,t)||{}},function(t){return U.call(D,t)}):(W=z("state"),J[W]=!0,G=function(t,e){return E(t,W,e),e},V=function(t){return N(t,W)?t[W]:{}},function(t){return N(t,W)});var et={set:G,get:V,has:q,enforce:function(t){return q(t)?V(t):G(t,{})},getterFor:function(t){return function(e){var i;if(!u(e)||(i=V(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return i}}},it=a(function(t){var e=et.get,i=et.enforce,r=String(K).split("toString");M("inspectSource",function(t){return K.call(t)}),(t.exports=function(t,e,n,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable,l=!!o&&!!o.noTargetGet;"function"==typeof n&&("string"!=typeof e||N(n,"name")||E(n,"name",e),i(n).source=r.join("string"==typeof e?e:"")),t!==m?(a?!l&&t[e]&&(s=!0):delete t[e],s?t[e]=n:E(t,e,n)):s?t[e]=n:d(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||K.call(this)})}),rt=Object.prototype;X!==rt.toString&&it(rt,"toString",X,{unsafe:!0});function nt(t){return isNaN(t=+t)?0:(0<t?gt:yt)(t)}function ot(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function at(t){return xt(ot(t))}function st(t){return 0<t?At(nt(t),9007199254740991):0}function lt(t,e){var i,r=at(t),n=0,o=[];for(i in r)!N(J,i)&&N(r,i)&&o.push(i);for(;e.length>n;)N(r,i=e[n++])&&(~Mt(o,i)||o.push(i));return o}function ut(t,e){var i=Nt[jt(t)];return i==Dt||i!=zt&&("function"==typeof e?l(e):!!e)}function ct(t,e){var i,r,n,o,a=t.target,s=t.global,l=t.stat,u=s?m:l?m[a]||d(a,{}):(m[a]||{}).prototype;if(u)for(i in e){if(n=e[i],r=t.noTargetGet?(o=Ut(u,i))&&o.value:u[i],!Ft(s?i:a+(l?".":"#")+i,t.forced)&&void 0!==r){if(typeof n==typeof r)continue;!function(t,e){for(var i=Lt(e),r=T.f,n=kt.f,o=0;o<i.length;o++){var a=i[o];N(t,a)||r(t,a,n(e,a))}}(n,r)}(t.sham||r&&r.sham)&&E(n,"sham",!0),it(u,i,n,t)}}var ht,ft,pt,dt,yt=Math.ceil,gt=Math.floor,vt={}.propertyIsEnumerable,_t=Object.getOwnPropertyDescriptor,mt={f:_t&&!vt.call({1:2},1)?function(t){var e=_t(this,t);return!!e&&e.enumerable}:vt},bt="".split,xt=l(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==t(e)?bt.call(e,""):Object(e)}:Object,wt=Object.getOwnPropertyDescriptor,kt={f:b?wt:function(t,e){if(t=at(t),e=f(e,!0),k)try{return wt(t,e)}catch(t){}if(N(t,e))return p(!mt.f.call(t,e),t[e])}},At=Math.min,Tt=Math.max,Et=Math.min,Mt=(ht=!1,function(t,e,i){var r,n,o,a=at(t),s=st(a.length),l=(r=s,(n=nt(i))<0?Tt(n+r,0):Et(n,r));if(ht&&e!=e){for(;l<s;)if((o=a[l++])!=o)return!0}else for(;l<s;l++)if((ht||l in a)&&a[l]===e)return ht||l||0;return!ht&&-1}),St=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Rt=St.concat("length","prototype"),Pt={f:Object.getOwnPropertyNames||function(t){return lt(t,Rt)}},Ot={f:Object.getOwnPropertySymbols},Ct=m.Reflect,Lt=Ct&&Ct.ownKeys||function(t){var e=Pt.f(h(t)),i=Ot.f;return i?e.concat(i(t)):e},It=/#|\.prototype\./,jt=ut.normalize=function(t){return String(t).replace(It,".").toLowerCase()},Nt=ut.data={},zt=ut.NATIVE="N",Dt=ut.POLYFILL="P",Ft=ut,Ut=kt.f,Bt=!l(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Gt=z("IE_PROTO"),Ht=Object.prototype,Vt=Bt?Object.getPrototypeOf:function(t){return t=Object(ot(t)),N(t,Gt)?t[Gt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Ht:null},qt=g("iterator"),Wt=!1;[].keys&&("next"in(dt=[].keys())?(pt=Vt(Vt(dt)))!==Object.prototype&&(ft=pt):Wt=!0),null==ft&&(ft={}),N(ft,qt)||E(ft,qt,function(){return this});function Xt(){}var Yt={IteratorPrototype:ft,BUGGY_SAFARI_ITERATORS:Wt},Kt=Object.keys||function(t){return lt(t,St)},Zt=b?Object.defineProperties:function(t,e){h(t);for(var i,r=Kt(e),n=r.length,o=0;o<n;)T.f(t,i=r[o++],e[i]);return t},Qt=m.document,$t=Qt&&Qt.documentElement,Jt=z("IE_PROTO"),te="prototype",ee=function(){var t,e=c("iframe"),i=St.length,r="script";for(e.style.display="none",$t.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object</"+r+">"),t.close(),ee=t.F;i--;)delete ee[te][St[i]];return ee()},ie=Object.create||function(t,e){var i;return null!==t?(Xt[te]=h(t),i=new Xt,Xt[te]=null,i[Jt]=t):i=ee(),void 0===e?i:Zt(i,e)};J[Jt]=!0;function re(t,e,i){t&&!N(t=i?t:t.prototype,le)&&se(t,le,{configurable:!0,value:e})}function ne(){return this}function oe(){return this}function ae(t,e,i,r,n,o,a){var s,l,u;function c(t){if(t===n&&m)return m;if(!de&&t in v)return v[t];switch(t){case"keys":case ye:case ge:return function(){return new i(this,t)}}return function(){return new i(this)}}l=r,u=e+" Iterator",(s=i).prototype=ie(ce,{next:p(1,l)}),re(s,u,!1),ue[u]=ne;var h,f,d,y=e+" Iterator",g=!1,v=t.prototype,_=v[fe]||v["@@iterator"]||n&&v[n],m=!de&&_||c(n),b="Array"==e&&v.entries||_;if(b&&(h=Vt(b.call(new t)),pe!==Object.prototype&&h.next&&(Vt(h)!==pe&&(he?he(h,pe):"function"!=typeof h[fe]&&E(h,fe,oe)),re(h,y,!0))),n==ye&&_&&_.name!==ye&&(g=!0,m=function(){return _.call(this)}),v[fe]!==m&&E(v,fe,m),ue[e]=m,n)if(f={values:c(ye),keys:o?m:c("keys"),entries:c(ge)},a)for(d in f)!de&&!g&&d in v||it(v,d,f[d]);else ct({target:e,proto:!0,forced:de||g},f);return f}var se=T.f,le=g("toStringTag"),ue={},ce=Yt.IteratorPrototype,he=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(i,[]),e=i instanceof Array}catch(i){}return function(i,r){return function(t,e){if(h(t),!u(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(i,r),e?t.call(i,r):i.__proto__=r,i}}():void 0),fe=g("iterator"),pe=Yt.IteratorPrototype,de=Yt.BUGGY_SAFARI_ITERATORS,ye="values",ge="entries",ve="String Iterator",_e=et.set,me=et.getterFor(ve);ae(String,"String",function(t){_e(this,{type:ve,string:String(t),index:0})},function(){var t,e,i,r,n,o,a,s,l=me(this),u=l.string,c=l.index;return c>=u.length?{value:void 0,done:!0}:(e=c,i=!0,o=String(ot(u)),a=nt(e),s=o.length,t=a<0||s<=a?i?"":void 0:(r=o.charCodeAt(a))<55296||56319<r||a+1===s||(n=o.charCodeAt(a+1))<56320||57343<n?i?o.charAt(a):r:i?o.slice(a,a+2):n-56320+(r-55296<<10)+65536,l.index+=t.length,{value:t,done:!1})});var be={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},xe=g("unscopables"),we=Array.prototype;null==we[xe]&&E(we,xe,ie(null));function ke(t){we[xe][t]=!0}var Ae="Array Iterator",Te=et.set,Ee=et.getterFor(Ae),Me=ae(Array,"Array",function(t,e){Te(this,{type:Ae,target:at(t),index:0,kind:e})},function(){var t=Ee(this),e=t.target,i=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==i?{value:r,done:!1}:"values"==i?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");ue.Arguments=ue.Array,ke("keys"),ke("values"),ke("entries");var Se=g("iterator"),Re=g("toStringTag"),Pe=Me.values;for(var Oe in be){var Ce=m[Oe],Le=Ce&&Ce.prototype;if(Le){if(Le[Se]!==Pe)try{E(Le,Se,Pe)}catch(o){Le[Se]=Pe}if(Le[Re]||E(Le,Re,Oe),be[Oe])for(var Ie in Me)if(Le[Ie]!==Me[Ie])try{E(Le,Ie,Me[Ie])}catch(o){Le[Ie]=Me[Ie]}}}function je(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function Ne(t,e,i){if(je(t),void 0===e)return t;switch(i){case 0:return function(){return t.call(e)};case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)}}return function(){return t.apply(e,arguments)}}var ze=g("iterator"),De=Array.prototype,Fe=g("iterator"),Ue=a(function(t){var e={};(t.exports=function(t,i,r,n,o){var a,s,l,u,c,f,p=Ne(i,r,n?2:1);if(o)a=t;else{if("function"!=typeof(s=function(t){if(null!=t)return t[Fe]||t["@@iterator"]||ue[v(t)]}(t)))throw TypeError("Target is not iterable");if(void 0!==(f=s)&&(ue.Array===f||De[ze]===f)){for(l=0,u=st(t.length);l<u;l++)if((n?p(h(c=t[l])[0],c[1]):p(t[l]))===e)return e;return}a=s.call(t)}for(;!(c=a.next()).done;)if(function(t,e,i,r){try{return r?e(h(i)[0],i[1]):e(i)}catch(e){var n=t.return;throw void 0!==n&&h(n.call(t)),e}}(a,p,c.value,n)===e)return e}).BREAK=e}),Be=g("iterator"),Ge=!1;try{var He=0;({next:function(){return{done:!!He++}},return:function(){Ge=!0}})[Be]=function(){return this}}catch(o){}function Ve(t,e){var i,r=h(t).constructor;return void 0===r||null==(i=h(r)[$e])?e:je(i)}function qe(t){var e;ai.hasOwnProperty(t)&&(e=ai[t],delete ai[t],e())}function We(t){return function(){qe(t)}}function Xe(t){qe(t.data)}function Ye(t){m.postMessage(t+"",Je.protocol+"//"+Je.host)}var Ke,Ze,Qe,$e=g("species"),Je=m.location,ti=m.setImmediate,ei=m.clearImmediate,ii=m.process,ri=m.MessageChannel,ni=m.Dispatch,oi=0,ai={},si="onreadystatechange";ti&&ei||(ti=function(t){for(var e=[],i=1;i<arguments.length;)e.push(arguments[i++]);return ai[++oi]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},Ke(oi),oi},ei=function(t){delete ai[t]},"process"==t(ii)?Ke=function(t){ii.nextTick(We(t))}:ni&&ni.now?Ke=function(t){ni.now(We(t))}:ri?(Qe=(Ze=new ri).port2,Ze.port1.onmessage=Xe,Ke=Ne(Qe.postMessage,Qe,1)):!m.addEventListener||"function"!=typeof postMessage||m.importScripts||l(Ye)?Ke=si in c("script")?function(t){$t.appendChild(c("script"))[si]=function(){$t.removeChild(this),qe(t)}}:function(t){setTimeout(We(t),0)}:(Ke=Ye,m.addEventListener("message",Xe,!1)));var li,ui,ci,hi,fi,pi,di,yi={set:ti,clear:ei},gi=m.navigator,vi=gi&&gi.userAgent||"",_i=kt.f,mi=yi.set,bi=m.MutationObserver||m.WebKitMutationObserver,xi=m.process,wi=m.Promise,ki="process"==t(xi),Ai=_i(m,"queueMicrotask"),Ti=Ai&&Ai.value;Ti||(li=function(){var t,e;for(ki&&(t=xi.domain)&&t.exit();ui;){e=ui.fn,ui=ui.next;try{e()}catch(t){throw ui?hi():ci=void 0,t}}ci=void 0,t&&t.enter()},hi=ki?function(){xi.nextTick(li)}:bi&&!/(iphone|ipod|ipad).*applewebkit/i.test(vi)?(fi=!0,pi=document.createTextNode(""),new bi(li).observe(pi,{characterData:!0}),function(){pi.data=fi=!fi}):wi&&wi.resolve?(di=wi.resolve(void 0),function(){di.then(li)}):function(){mi.call(m,li)});function Ei(t){var e,i;this.promise=new t(function(t,r){if(void 0!==e||void 0!==i)throw TypeError("Bad Promise constructor");e=t,i=r}),this.resolve=je(e),this.reject=je(i)}function Mi(t,e){if(h(t),u(e)&&e.constructor===t)return e;var i=Gi.f(t);return(0,i.resolve)(e),i.promise}function Si(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}function Ri(t){return"function"==typeof t?t:void 0}function Pi(t,e){return arguments.length<2?Ri(Hi[t])||Ri(m[t]):Hi[t]&&Hi[t][e]||m[t]&&m[t][e]}function Oi(t){var e;return!(!u(t)||"function"!=typeof(e=t.then))&&e}function Ci(t,e,i){var r;e.notified||(e.notified=!0,r=e.reactions,Bi(function(){for(var n=e.value,o=1==e.state,a=0;r.length>a;)!function(i){var r,a,s,l=o?i.ok:i.fail,u=i.resolve,c=i.reject,h=i.domain;try{l?(o||(2===e.rejection&&pr(t,e),e.rejection=1),!0===l?r=n:(h&&h.enter(),r=l(n),h&&(h.exit(),s=!0)),r===i.promise?c($i("Promise-chain cycle")):(a=Oi(r))?a.call(r,u,c):u(r)):c(n)}catch(i){h&&!s&&h.exit(),c(i)}}(r[a++]);e.reactions=[],e.notified=!1,i&&!e.rejection&&hr(t,e)}))}function Li(t,e,i){var r,n;sr?((r=Ji.createEvent("Event")).promise=e,r.reason=i,r.initEvent(t,!1,!0),m.dispatchEvent(r)):r={promise:e,reason:i},(n=m["on"+t])?n(r):t===lr&&function(t,e){var i=m.console;i&&i.error&&(1===arguments.length?i.error(t):i.error(t,e))}("Unhandled promise rejection",i)}function Ii(t,e,i,r){return function(n){t(e,i,n,r)}}function ji(t,e,i,r){e.done||(e.done=!0,r&&(e=r),e.value=i,e.state=2,Ci(t,e,!0))}var Ni,zi,Di,Fi,Ui,Bi=Ti||function(t){var e={fn:t,next:void 0};ci&&(ci.next=e),ui||(ui=e,hi()),ci=e},Gi={f:function(t){return new Ei(t)}},Hi=m,Vi=g("species"),qi="Promise",Wi=yi.set,Xi=g("species"),Yi=et.get,Ki=et.set,Zi=et.getterFor(qi),Qi=m[qi],$i=m.TypeError,Ji=m.document,tr=m.process,er=m.fetch,ir=tr&&tr.versions,rr=ir&&ir.v8||"",nr=Gi.f,or=nr,ar="process"==t(tr),sr=!!(Ji&&Ji.createEvent&&m.dispatchEvent),lr="unhandledrejection",ur=Ft(qi,function(){function t(){}var e=Qi.resolve(1),i=(e.constructor={})[Xi]=function(e){e(t,t)};return!((ar||"function"==typeof PromiseRejectionEvent)&&e.then(t)instanceof i&&0!==rr.indexOf("6.6")&&-1===vi.indexOf("Chrome/66"))}),cr=ur||!function(t,e){if(!e&&!Ge)return!1;var i=!1;try{var r={};r[Be]=function(){return{next:function(){return{done:i=!0}}}},t(r)}catch(t){}return i}(function(t){Qi.all(t).catch(function(){})}),hr=function(t,e){Wi.call(m,function(){var i,r=e.value;if(fr(e)&&(i=Si(function(){ar?tr.emit("unhandledRejection",r,t):Li(lr,t,r)}),e.rejection=ar||fr(e)?2:1,i.error))throw i.value})},fr=function(t){return 1!==t.rejection&&!t.parent},pr=function(t,e){Wi.call(m,function(){ar?tr.emit("rejectionHandled",t):Li("rejectionhandled",t,e.value)})},dr=function(t,e,i,r){if(!e.done){e.done=!0,r&&(e=r);try{if(t===i)throw $i("Promise can't be resolved itself");var n=Oi(i);n?Bi(function(){var r={done:!1};try{n.call(i,Ii(dr,t,r,e),Ii(ji,t,r,e))}catch(i){ji(t,r,i,e)}}):(e.value=i,e.state=1,Ci(t,e,!1))}catch(i){ji(t,{done:!1},i,e)}}};ur&&(Qi=function(t){!function(t,e,i){if(!(t instanceof e))throw TypeError("Incorrect "+(i?i+" ":"")+"invocation")}(this,Qi,qi),je(t),Ni.call(this);var e=Yi(this);try{t(Ii(dr,this,e),Ii(ji,this,e))}catch(t){ji(this,e,t)}},(Ni=function(){Ki(this,{type:qi,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=function(t,e,i){for(var r in e)it(t,r,e[r],i);return t}(Qi.prototype,{then:function(t,e){var i=Zi(this),r=nr(Ve(this,Qi));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=ar?tr.domain:void 0,i.parent=!0,i.reactions.push(r),0!=i.state&&Ci(this,i,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),zi=function(){var t=new Ni,e=Yi(t);this.promise=t,this.resolve=Ii(dr,t,e),this.reject=Ii(ji,t,e)},Gi.f=nr=function(t){return t===Qi||t===Di?new zi:or(t)},"function"==typeof er&&ct({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return Mi(Qi,er.apply(m,arguments))}})),ct({global:!0,wrap:!0,forced:ur},{Promise:Qi}),re(Qi,qi,!1),Fi=Pi(qi),Ui=T.f,b&&Fi&&!Fi[Vi]&&Ui(Fi,Vi,{configurable:!0,get:function(){return this}}),Di=Hi[qi],ct({target:qi,stat:!0,forced:ur},{reject:function(t){var e=nr(this);return e.reject.call(void 0,t),e.promise}}),ct({target:qi,stat:!0,forced:ur},{resolve:function(t){return Mi(this,t)}}),ct({target:qi,stat:!0,forced:cr},{all:function(t){var e=this,i=nr(e),r=i.resolve,n=i.reject,o=Si(function(){var i=je(e.resolve),o=[],a=0,s=1;Ue(t,function(t){var l=a++,u=!1;o.push(void 0),s++,i.call(e,t).then(function(t){u||(u=!0,o[l]=t,--s||r(o))},n)}),--s||r(o)});return o.error&&n(o.value),i.promise},race:function(t){var e=this,i=nr(e),r=i.reject,n=Si(function(){var n=je(e.resolve);Ue(t,function(t){n.call(e,t).then(i.resolve,r)})});return n.error&&r(n.value),i.promise}}),ct({target:"Promise",proto:!0,real:!0},{finally:function(t){var e=Ve(this,Pi("Promise")),i="function"==typeof t;return this.then(i?function(i){return Mi(e,t()).then(function(){return i})}:t,i?function(i){return Mi(e,t()).then(function(){throw i})}:t)}});var yr,gr;Hi.Promise;function vr(t){return(vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mr(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function br(t,e,i){return e&&mr(t.prototype,e),i&&mr(t,i),t}function xr(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function wr(t,e){var i,r=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)),r}function kr(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?wr(Object(i),!0).forEach(function(e){xr(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):wr(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function Ar(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Er(t,e)}function Tr(t){return(Tr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Er(t,e){return(Er=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Mr(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function Sr(t,e,i){return(Sr=Mr()?Reflect.construct:function(t,e,i){var r=[null];r.push.apply(r,e);var n=new(Function.bind.apply(t,r));return i&&Er(n,i.prototype),n}).apply(null,arguments)}function Rr(t){var e="function"==typeof Map?new Map:void 0;return(Rr=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Sr(t,arguments,Tr(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Er(r,t)})(t)}function Pr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Or(t){var e=Mr();return function(){var i,r,n,o,a=Tr(t);return r=e?(i=Tr(this).constructor,Reflect.construct(a,arguments,i)):a.apply(this,arguments),n=this,!(o=r)||"object"!=typeof o&&"function"!=typeof o?Pr(n):o}}function Cr(t,e,i){return(Cr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Tr(t)););return t}(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function Lr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],r=!0,n=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);r=!0);}catch(t){n=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}return i}(t,e)||jr(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ir(t){return function(t){if(Array.isArray(t))return Nr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||jr(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jr(t,e){if(t){if("string"==typeof t)return Nr(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Nr(t,e):void 0}}function Nr(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function zr(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=jr(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}return e}),"function"!=typeof Object.values&&(Object.values=function(t){return Object.keys(t).map(function(e){return t[e]})}),Math.hypot=Math.hypot||function(){for(var t=0,e=arguments.length,i=0;i<e;i++){if(arguments[i]===1/0||arguments[i]===-1/0)return 1/0;t+=arguments[i]*arguments[i]}return Math.sqrt(t)},Math.log2=Math.log2||function(t){return Math.log(t)*Math.LOG2E},"undefined"!=typeof window?("performance"in window==!1&&(window.performance={}),yr=window.performance):"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&("performance"in self==!1&&(self.performance={}),yr=self.performance),yr&&"function"!=typeof yr.now&&(gr=+new Date,yr.now=function(){return new Date-gr});var Dr=Fr;function Fr(t,e){this.x=t,this.y=e}Fr.prototype={clone:function(){return new Fr(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,n=i*this.x+e*this.y;return this.x=r,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.x+i*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Fr.convert=function(t){return!(t instanceof Fr)&&Array.isArray(t)?new Fr(t[0],t[1]):t};var Ur=Br;function Br(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(Gr,this,e)}function Gr(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){var i=t.readVarint()+t.pos;for(;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}Br.types=["Unknown","Point","LineString","Polygon"],Br.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i,r=t.readVarint()+t.pos,n=1,o=0,a=0,s=0,l=[];t.pos<r;){if(o||(n=7&(i=t.readVarint()),o=i>>3),o--,1===n||2===n)a+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new Dr(a,s));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&l.push(e),l},Br.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,o=0,a=0,s=1/0,l=-1/0,u=1/0,c=-1/0;t.pos<i;){if(n||(r=7&(e=t.readVarint()),n=e>>3),n--,1===r||2===r)(o+=t.readSVarint())<s&&(s=o),l<o&&(l=o),(a+=t.readSVarint())<u&&(u=a),c<a&&(c=a);else if(7!==r)throw new Error("unknown command "+r)}return[s,u,l,c]},Br.prototype.toGeoJSON=function(t,e,i){var r,n=this.extent*Math.pow(2,i),o=this.extent*t,a=this.extent*e,s=this.loadGeometry(),l=Br.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e],r=180-360*(i.y+a)/n;t[e]=[360*(i.x+o)/n-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:for(var c=[],h=0;h<s.length;h++)c[h]=s[h][0];u(s=c);break;case 2:for(h=0;h<s.length;h++)u(s[h]);break;case 3:for(s=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var a=function(t){for(var e,i,r=0,n=0,o=t.length,a=o-1;n<o;a=n++)e=t[n],i=t[a],r+=(i.x-e.x)*(e.y+i.y);return r}(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}i&&n.push(i);return n}(s),h=0;h<s.length;h++)for(r=0;r<s[h].length;r++)u(s[h][r])}1===s.length?s=s[0]:l="Multi"+l;var f={type:"Feature",geometry:{type:l,coordinates:s},properties:this.properties};return"id"in this&&(f.id=this.id),f};var Hr=Vr;function Vr(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(qr,this,e),this.length=this._features.length}function qr(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){var e=null,i=t.readVarint()+t.pos;for(;t.pos<i;){var r=t.readVarint()>>3;e=1==r?t.readString():2==r?t.readFloat():3==r?t.readDouble():4==r?t.readVarint64():5==r?t.readVarint():6==r?t.readSVarint():7==r?t.readBoolean():null}return e}(i))}function Wr(t,e,i){var r;3!==t||(r=new Hr(i,i.readVarint()+i.pos)).length&&(e[r.name]=r)}Vr.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Ur(this._pbf,e,this.extent,this._keys,this._values)};var Xr,Yr=function(t,e){this.layers=t.readFields(Wr,{},e)},Kr=Ur,Zr="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},Qr={};(function(){var t,e,i="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,i){t!=Array.prototype&&t!=Object.prototype&&(t[e]=i.value)},r=("undefined"==typeof window||window!==this)&&void 0!==Zr&&null!=Zr?Zr:this;if("function"==typeof Object.setPrototypeOf)t=Object.setPrototypeOf;else{t:{var n={};try{n.__proto__={ea:!0},e=n.ea;break t}catch(t){}e=!1}t=e?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var o=t;!function(t,e){if(e){var n=r;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in n||(n[a]={}),n=n[a]}(e=e(o=n[t=t[t.length-1]]))!=o&&null!=e&&i(n,t,{configurable:!0,writable:!0,value:e})}}("Object.setPrototypeOf",function(t){return t||o});var a=this||self;function s(t){var e=vr(t);if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var i=Object.prototype.toString.call(t);if("[object Window]"==i)return"object";if("[object Array]"==i||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==i||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function l(t){return"function"==s(t)}function u(t){var e=vr(t);return"object"==e&&null!=t||"function"==e}function c(t,e){t=t.split(".");var i,r=a;t[0]in r||void 0===r.execScript||r.execScript("var "+t[0]);for(;t.length&&(i=t.shift());)t.length||void 0===e?r=r[i]&&r[i]!==Object.prototype[i]?r[i]:r[i]={}:r[i]=e}function h(t,e){function i(){}i.prototype=e.prototype,t.ua=e.prototype,t.prototype=new i,t.prototype.constructor=t}var f=Math,p=f.min,d=f.max,y=f.round,g=f.floor,v=f.ceil,_=f.abs,m=f.log,b=f.sqrt,x=f.pow,w=f.sin,k=f.asin,A=f.cos,T=f.tan,E=f.atan2,M=f.PI,S=M/2,R=M/4,P=2*M,O=3*M,C=M/180,L=180/M;function I(t,e,i){return i<t?i:t<e?e:t}function j(t,e,i){return e<i?e<=t&&t<=i:i<=t&&t<=e}function N(t,e,i,r,n,o){return b(x((t-n)*(r-o)-(e-o)*(i-n),2)/(x(i-n,2)+x(r-o,2)))}c("H.math.normalize",function(t,e,i){return e-=i=i||0,(t-=i)-g(t/e)*e+i}),c("H.math.clamp",I);var z={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};function D(t,e){var i=t.x;t=t.y;for(var r,n,o,a,s=e.length,l=s,u=e[0],c=0,h=0,f=0;1!=c&&1<l;)n=e[--l],r=e[--l],a=e[l?l-1:(s+(l-1))%s],o=e[l?l-2:(s+(l-2))%s],i<=r&&r<=i&&t<=n&&n<=t||i<=o&&o<=i&&t<=a&&a<=t?c=1:c||r!==i?!c&&j(i,r,o)&&((r<i&&i<o||i<r&&o<i)&&(h+=t<(u=n+(i-r)/(o-r)*(a-n)),f+=u<t),c=j(t,n,a)&&N(i,t,r,n,o,a)<=0?2:0):(o===i&&(n<t&&t<a||t<n&&a<t)||(u<=i&&i<o||i<=u&&o<i)&&(t<=n?++h:++f),c=j(t,n,a)&&N(i,t,r,n,o,a)<=0?2:0),u=r;return c||0===f||0==h%2||(c=3),c!==z.NONE}function F(t,e){this.x=+t,this.y=+e}function U(t,e,i,r,n,o,a,s,l,u){return t={x:t,y:e,next:i||null,s:r||null,ta:n||null,X:o||null,o:!!a,T:s||0,O:l||0,alpha:u||0},r&&(t.s.next=t),i&&(t.next.s=t),t}function B(t){for(;t&&t.o;)t=t.next;return t}function G(t){if(t)for(;t.next;)t=t.next;return t}function H(t){var e=G(t);(e.s.next=t).s=e.s}function V(t){for(var e=[];t;)e.push(t.x,t.y),t=t.next;return e}function q(t,e,i){for(e=e.next;e!==i&&e.alpha<=t.alpha;)e=e.next;t.next=e,t.s=e.s,(t.next.s=t).s.next=t}function W(t,e){for(var i,r=null,n=0,o=t.length;n<o;n++)(i=U(t[n].x,t[n].y,r)).qa=e,(i.next=r)&&(r.s=i),r=i;return r}function X(t,e,i,r){return(t-=i)*t+(e-=r)*e}c("H.math.CoverType",z),c("H.math.isPointInsidePolygon",D),c("H.math.flatten",function(t){for(var e=t.length,i=new Float64Array(2*e),r=e&&t[0].x!==Z;e--;){var n=t[e],o=e<<1;i[o]=r?n.x:n[0],i[1+o]=r?n.y:n[1]}return i}),c("H.math.Point",F),(F.prototype.set=F).prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t=new F(this.x,this.y),t},F.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},F.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},F.prototype.scale=function(t,e){return this.x*=t,this.y*=void 0===e?t:e,this},F.prototype.round=function(){return this.x=y(this.x),this.y=y(this.y),this},F.prototype.floor=function(){return this.x=g(this.x),this.y=g(this.y),this},F.prototype.ceil=function(){return this.x=v(this.x),this.y=v(this.y),this},F.prototype.equals=F.prototype.w=function(t){return!(!t||this.x!==t.x||this.y!==t.y)},F.prototype.getNearest=F.prototype.la=function(t,e){var i,r=e.x-t.x,n=e.y-t.y,o=t;return(r||n)&&(o=(i=((this.x-t.x)*r+(this.y-t.y)*n)/(r*r+n*n))<=0?t:1<=i?e:new F(t.x+i*r,t.y+i*n)),o},F.prototype.distance=F.prototype.R=function(t){return b(x(this.x-t.x,2)+x(this.y-t.y,2))},F.fromIPoint=function(t){if(!t)throw Error("invalid argument");return t instanceof F?t:new F(t.x,t.y)},c("H.math.clipping.clipStrips",function(t,e,i,r,n,o){var a,s,l,u=t.length;if(u)for(a=[];u--;)for(var c,h,f=t[u],p=f.length,d=0,y=1;y<p;y++){(l=function(t,e,i,r,n,o){var a=t.x;t=-t.y;var s=e.x;if(e=-e.y,i=-i,o=-o,s<a){if(n<s||a<r)return;var l=a,u=t;a=s,t=e,s=l,e=u,l=1}else if(n<a||s<r)return;if(e<t){if(i<e||t<o)return;var c=1;t=-t,e=-e,u=o,o=-i,i=-u}else if(i<t||e<o)return;if(a<r){if((t+=(r-a)*(e-t)/(s-a))>i)return;a=r}if(t<o){if((a+=(o-t)*(s-a)/(e-t))>n)return;t=o}return n<s&&(e=t+(n-a)*(e-t)/(s-a),s=n),i<e&&(s=a+(i-t)*(s-a)/(e-t),e=i),c&&(t=-t,e=-e),l?[new F(s,-e),new F(a,-t)]:[new F(a,-t),new F(s,-e)]}(f[y-1],f[y],i,e,r,n))&&(c=l[0],h=l[1],d&&d.w(c)?s.push(h):a.push(s=l),d=h,o&&(y=p,u=0))}else a=t;return a}),c("H.math.clipping.clipPolygon",function(t,e,i){var r;t=W(t,!0),e=W(e,!1);var n={},o=r=1;switch(~~(i||0)){case 1:o=r=0;break;case 2:r=0,o=1;break;case 3:r=1,o=0}i=r;var a,s,l,u,c,h,f=o;if(e&&t){for(e.M=U(e.x,e.y,null,G(e)),t.M=U(t.x,t.y,null,G(t)),o=e;o.next;o=o.next)if(!o.o)for(r=t;r.next;r=r.next){r.o||(h=function t(e,i,r,n,o){var a,s=i.x-e.x,l=i.y-e.y;var u=n.x-r.x;var c=n.y-r.y;var h=s*c-l*u;if(!h)return 0;u=((r.x-e.x)*c-(r.y-e.y)*u)/h;h=(l*(r.x-e.x)-s*(r.y-e.y))/h;if(u<0||1<u||h<0||1<h)return 0;0===u?a=e:1===u?a=i:0===h?a=r:1===h&&(a=n);if(a)return a.x+=2480549651603763e-20,a.y+=7321997314118067e-20,a.M&&(a.M.x=a.x,a.M.y=a.y),t(e,i,r,n,o);o.xa=e.x+u*s;o.ya=e.y+u*l;o.fa=u;o.ga=h;return 1}(o,a=B(o.next),r,s=B(r.next),n))&&(h=n.fa,l=n.ga,q(h=U(u=n.xa,c=n.ya,null,null,null,null,!0,0,0,h),o,a),q(a=U(u,c,null,null,null,null,!0,0,0,l),r,s),(h.X=a).X=h)}for(n=D(e,V(t)),i&&(n=!n),o=e;o;o=o.next)o.o&&(n=!(o.T=n));for(n=D(t,V(e)),f&&(n=!n),r=t;r.next;r=r.next)r.o&&(n=!(r.T=n));for(H(e),H(t);(t=function(t){var e=t;if(e)for(;(e=e.next)!=t&&(!e.o||e.o&&e.O););return e}(e))!=e;){for(i=null;!t.O;t=t.X){for(n=t.T;(i=U(t.x,t.y,i)).artificial=t.o||t.qa,t.O=1,t=n?t.next:t.s;)if(t.o){t.O=1;break}if(!t)break}i.ta=p;var p=i}return p}}),c("H.math.simplifyDP",function(t,e,i){return function t(e,i,r,n,o){var a=0,s=n,l=e[n].x,u=e[n].y,c=e[o].x,h=e[o].y,f=n+1,p=X(l,u,c,h);if(p)for(;f<o;){var d=e[f++],y=d.x;d=d.y;var g=((y-l)*(c-l)+(d-u)*(h-u))/p;y=g<0?X(y,d,l,u):1<g?X(y,d,c,h):X(y,d,l+g*(c-l),u+g*(h-u)),a<y&&(a=y,s=f-1)}else for(;f<o;)d=e[f++],y=d.x,d=d.y,y=X(y,d,l,u),a<y&&(a=y,s=f-1);n=i<=a||0<r&&s-n?(--r,1<s-n?(n=t(e,i,r,n,s),n.splice(n.length-1,1)):n=[e[n]],1<o-s?n.concat(t(e,i,r,s,o)):n.concat(e.slice(s,o+1))):[e[n],e[o]];return n}(t,e*e,i||0,0,t.length-1)});var Y=this,K=String,Z=self.eval("undefined"),Q=self.eval("null"),$="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(t,e){if(!0==(t instanceof e&&t.constructor===e))throw new TypeError("Illegal constructor "+nt(e))}c("H.lang.isArray",function(t,e,i,r){var n;if(!(n="Array"===it(t))&&e)throw new ut(e,i,r!==Z?r:t);return n}),c("H.lang.isString",function(t){return"string"==typeof t});var tt=isNaN;function et(t){return t===+t}function it(t){var e=Object[$[0]][$[6]].call(t).match(/^\[object (\w+)\]$/);return e?e[1]:vr(t)}c("H.lang.isNumber",et),c("H.lang.isInteger",Number.isInteger?Number.isInteger:function(t){return"number"==typeof t&&0==t%1});var rt=[];function nt(t,e,i,r){var n,o,a="",s=arguments.length<2;return s&&(e={H:Y.H},i="",r=rt.slice()),st(e,!0,function(e,o){try{if(n=e[o],s=n,st(e,!(c=[]),function(t,e){t[e]===s&&c.push(e)}),o=c.sort(ot)[0],!(u(n)&&n.window===n&&n.self===n||u(n)&&0<n.nodeType&&l(n.cloneNode))&&u(n)){if(n===t)return a=i+"."+o,1;if(r.indexOf(n)<0&&(r.push(n),a=nt(t,n,i+"."+o,r)))return 1}}catch(e){}var s,c}),s&&(a=a?a.substr(1).replace("."+$[0]+".","#"):"~"+(l(t)?((o=/^\s*function ([^\( ]+)/.exec(o=t))?o[1]:"anonymous")+"()":it(t))),a}function ot(t,e){return e.length-t.length}rt.indexOf(rt)<0&&rt.push(rt);var at=Object[$[0]][$[2]];function st(t,e,i){var r;if(t){for(n in t)if((!e||at.call(t,n))&&i(t,n,!0))return;for(r=$.length;r--;){var n=$[r];if((!e||at.call(t,n))&&i(t,n,!1))break}}}function lt(t,e,i){i[e]="#"+e}function ut(t,e,i){var r,n,o=arguments.length;return(e=e!==Z?+e:e)!==Z&&((n=r=(n=/^.*?\(([^\)]+)/.exec((""+t).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")))?K(n[1].replace(/\s+/g,"")).split(","!==Z?",":" "):[]).forEach(lt),n=n[e]||"#"+e),r=t?nt(t):"",o=2<o?K(i):"",(n||o)&&(r+=" (Argument "+(n||"")+(o?" "+o:"")+")"),o=Error(r),Object.setPrototypeOf(o,ut.prototype),o}function ct(t,e,i){var r=I(+t,-90,90);if(e&&tt(r))throw new ut(e,i,t);return r}function ht(t,e,i){var r,n=+t;if((n<-180||180<n)&&(n=(!1==(r=(n+180)%360)<0?r:360+r)-180),e&&tt(n))throw new ut(e,i,t);return n}function ft(t,e,i){var r;if(t!==Z&&tt(r=+t)&&e)throw new ut(e,i,t);return r}function pt(){J(this,pt)}function dt(t,e,i){this.lat=ct(t,dt,0),this.lng=ht(e,dt,1),i!==Z&&(this.alt=ft(i,dt,2))}function yt(t,e,i){var r=u(t)&&!(tt(t.lat=ct(t.lat))||tt(t.lng=ht(t.lng))||t.alt!==Z&&tt(t.alt=ft(t.alt)));if(!r&&e)throw new ut(e,i,t);return r}function gt(t,e,i,r){vt(this,ct(t,gt,0),ht(e,gt,1),ct(i,gt,2),ht(r,gt,3))}function vt(t,e,i,r,n){return t.f=i,t.g=n,e<r&&(i=e,e=r,r=i),t.i=e,t.h=r,t.m=t.b=t.c=null,t}function _t(t,e){return(t=e-t)+(t<0?360:0)}function mt(t,e){return(t+=e/2)-(180<t?360:0)}function bt(t,e,i,r,n,o,a,s,l){i=p(i,a),t=d(t,n);var u=mt(e,n=_t(e,r)),c=mt(o,a=_t(o,s))-u,h=(c+=c-1e-6<0?360:0)-1e-6<180?(u=e,s):(c=360-c,u=o,r);return 360<=(c=c+n/2+a/2)+5e-7?(u=-180,h=180):c-5e-7<n?(u=e,h=r):c-5e-7<a&&(u=o,h=s),l?vt(l,t,u,i,h):new gt(t,u,i,h)}function xt(t,e,i){return i||(yt(t,xt,0),yt(e,xt,1)),new gt(t.lat,t.lng,e.lat,e.lng)}function wt(t,e,i,r,n,o){J(this,wt),this.sa=t||10,this.c=this.b=null,this.j=r||0,this.l=n||0,this.m=e||1,this.u=i||1,this.I=!!o,this.flush()}function kt(t,e,i){var r,n;if(t.I&&(r=t.c))for(n=3;0<=n;n--){var o=e[n];if(n%3?o>=r[n]:o<=r[n]){if(!i){t.c=null;break}r[n]=o}}}function At(t,e){var i,r=t.a;if(e){var n=e;if(n!==r)for(r=n;n=n.c;)(n.entries||1<n.a)&&(r=n)}else for(;!r.entries&&(i=r.a)<2&&i;)r=n;t.a=r}h(ut,Error),c("H.lang.InvalidArgumentError",ut),ut.prototype.name="InvalidArgumentError",c("H.geo.isDBC",function(t,e){return 0!=(t<0^e<0)&&180<_(e-t)}),c("H.geo.AbstractGeometry",pt),pt.prototype.getBoundingBox=pt.prototype.D,pt.prototype.equals=pt.prototype.w,pt.prototype.a="",pt.prototype.l="",pt.prototype.toString=function(){return this.I([this.a.toUpperCase()," "]).join("")},pt.prototype.toGeoJSON=pt.prototype.va=function(){return{type:this.l,coordinates:this.u()}},pt.prototype.forWorkerMessage=pt.prototype.U=function(){return{type:this.a,coordinates:this.j(),boundingBox:this.D().U()}},h(dt,pt),c("H.geo.Point",dt),dt.prototype.equals=dt.prototype.w=function(t){return this===t||!!t&&this.lat===t.lat&&this.lng===t.lng&&(this.alt||0)===(t.alt||0)},dt.prototype.distance=dt.prototype.R=function(t){var e,i;return t=this===t||this.lat===t.lat&&this.lng===t.lng?0:(e=this.lat*C,i=t.lat*C,12742001.58*k(p(1,b(x(w((e-i)/2),2)+A(e)*A(i)*x(w((this.lng*C-t.lng*C)/2),2)))))},dt.prototype.walk=dt.prototype.wa=function(t,e,i){var r,n,o,a,s,l,u;return i?((e/=6371000.79)&&(t*=C,s=C*this.lat,r=w(s),n=w(e),o=A(e),a=C*this.lng,l=A(s),s=k(l*A(t)*n+r*o),l=(t=(a+(t=E(w(t)*l*n,o-r*w(s)))+M)%(2*M)-M)*L),e?new dt(s*L,(l+540)%360-180):this):0==((t=(t%360+360)%360)+90)%180?(s=this.lng+e/(6371000.79*P*A(this.lat*C))*(270===t?-360:360),new dt(this.lat,(s+540)%360-180)):((e/=6371000.79)&&(t*=C,a=this.lat*C,r=this.lng*C,o=(n=a+e*A(t))-a,s=m(T(n/2+R)/T(a/2+R)),s=tt(o/s)?A(a):o/s,u=e*w(t)/s,_(n)>S&&(n=0<n?M-n:-(M+n))),e?new dt(n*L,((r+u+O+(_(a+o)>S?M:0))%P-M)*L):this)},dt.prototype.getBoundingBox=dt.prototype.D=function(){return new gt(this.lat,this.lng,this.lat,this.lng)},dt.validate=yt,dt.fromIPoint=function t(e){if(!e)throw new ut(t,0,e);return new dt(e.lat,e.lng,e.alt)},dt.prototype.a="Point",dt.prototype.I=function(t){return t.push("(",this.lng," ",this.lat,")"),t},dt.prototype.l="Point",dt.prototype.u=function(){return[this.lng,this.lat,this.alt||0]},dt.prototype.j=function(){return[this.lat,this.lng,this.alt||0]},h(gt,pt),c("H.geo.Rect",gt),gt.prototype.a="Polygon",gt.prototype.I=function(t){var e=this.i,i=this.f,r=this.h,n=this.g;return t.push("(","(",i," ",e,",",n," ",e,",",n," ",r,",",i," ",r,",",i," ",e,")",")"),t},gt.prototype.equals=gt.prototype.w=function(t){return this===t||!!t&&this.i===t.i&&this.f===t.f&&this.h===t.h&&this.g===t.g},gt.prototype.clone=function(){return new gt(this.i,this.f,this.h,this.g)},gt.prototype.getTopLeft=gt.prototype.W=function(){return this.m||(this.m=new dt(this.i,this.f)),this.m},gt.prototype.getBottomRight=gt.prototype.V=function(){return this.b||(this.b=new dt(this.h,this.g)),this.b},gt.prototype.getTop=gt.prototype.na=function(){return this.i},gt.prototype.getBottom=gt.prototype.ha=function(){return this.h},gt.prototype.getLeft=gt.prototype.ja=function(){return this.f},gt.prototype.getRight=gt.prototype.ma=function(){return this.g},gt.prototype.getCenter=gt.prototype.F=function(){return this.c||(this.c=new dt(this.h+(this.i-this.h)/2,mt(this.f,this.A()))),this.c},gt.prototype.getWidth=gt.prototype.A=function(){return _t(this.f,this.g)},gt.prototype.getHeight=gt.prototype.G=function(){return this.i-this.h},gt.prototype.isCDB=gt.prototype.N=function(){return this.f>this.g},gt.prototype.isEmpty=gt.prototype.ra=function(){return!this.A()&&!this.G()},gt.prototype.getBoundingBox=gt.prototype.D=function(){return new gt(this.i,this.f,this.h,this.g)},gt.prototype.containsLatLng=gt.prototype.L=function(t,e,i){var r=this.F();return i||(t=ct(t,this.L,0),e=ht(e,this.L,1)),(t=(e=this.B(t,e,i)).F()).lat===r.lat&&t.lng===r.lng&&this.G()===e.G()&&this.A()===e.A()},gt.prototype.containsPoint=gt.prototype.$=function(t,e){return e||yt(t,this.$,0),this.L(t.lat,t.lng,e)},gt.prototype.containsRect=gt.prototype.aa=function(t,e){var i=this.F();if(!(e||t instanceof gt))throw new ut(this.aa,0,t);return(t=(e=this.J(t,e)).F()).lat===i.lat&&t.lng===i.lng&&this.G()===e.G()&&this.A()===e.A()},gt.prototype.mergeLatLng=gt.prototype.B=function(t,e,i,r){if(!i){if(tt(t=ct(t)))throw new ut(this.B,0,t);if(tt(e=ht(e)))throw new ut(this.B,1,e)}return bt(this.i,this.f,this.h,this.g,t,e,t,e,r)},gt.prototype.mergePoint=gt.prototype.ca=function(t,e,i){return e||yt(t,this.ca,0),this.B(t.lat,t.lng,e,i)},gt.prototype.mergeRect=gt.prototype.J=function(t,e,i){if(!(e||t instanceof gt))throw new ut(this.J,0,t);return bt(this.i,this.f,this.h,this.g,t.i,t.f,t.h,t.g,i)},gt.prototype.mergeTopLeftBottomRight=gt.prototype.C=function(t,e,i,r,n,o){return n||(t=ct(t,this.C,0),e=ht(e,this.C,1),i=ct(i,this.C,2),r=ht(r,this.C,3)),bt(this.i,this.f,this.h,this.g,t,e,i,r,o)},gt.prototype.intersects=gt.prototype.ba=function(t,e){var i=this.f<=this.g,r=t.f<=t.g,n=this.f<t.g,o=t.f<this.g;if(!(e||t instanceof gt))throw new ut(this.ba,0,t);return this.h<=t.i&&t.h<=this.i&&(!i&&(!r||n||o)||!r&&(n||o)||n&&o)},gt.merge=bt,gt.fromPoints=xt,gt.coverPoints=function t(e,i){var r=1,n=e.length,o=null,a=s(e);if("array"!=a&&("object"!=a||"number"!=typeof e.length))throw new ut(t,0,e);if(0<n)for(o=xt(a=e[0],a,i);r<n;r++)a=e[r],o.B(a.lat,a.lng,i,o);return o},gt.coverLatLngAlts=function t(e,i){var r,n=3,o=e.length;if(!(i||e&&null!=e.length))throw new ut(t,0,e);if(0<o)for(r=new gt(e[0],e[1],e[0],e[1]);n<o;n+=3)r.B(e[n],e[n+1],i,r);return r},gt.coverRects=function t(e,i){var r,n=1,o=e.length;if(i&&(!e||null==e.length))throw new ut(t,0,e);if(0<o)for(r=new gt(e[0].i,e[0].f,e[0].h,e[0].g);n<o;n++)r.J(e[n],i,r);return r},gt.prototype.resizeToCenter=gt.prototype.da=function(t,e){var i=this.f,r=this.i,n=this.g,o=this.h,a=this.F().lng;yt(t,this.da,0);var s=t.lat-o-(r-o)/2,l=t.lng-a;return t=(t=i+((l=180<l||l<-180?-(a+t.lng):l)<0?2*l:0))<-180?360+t:t,n=180<(n+=0<l?2*l:0)?n-360:n,90<=(r=0<s?r+2*s:r)&&(r=90),(o=s<0?o+2*s:o)<=-90&&(o=-90),e?vt(e,r,t,o,n):new gt(r,t,o,n)},gt.prototype.l="Polygon",gt.prototype.u=function(){return[[this.f,this.i,0],[this.g,this.i,0],[this.g,this.h,0],[this.f,this.h,0],[this.f,this.i,0]]},gt.prototype.U=function(){return this.j()},gt.prototype.j=function(){return[this.i,this.f,this.h,this.g]},wt.prototype.remove=function(t){var e,i,r,n,o,a,s=!1;if(t&&(e=t.a)&&e.b===this&&(i=e.entries)&&0<=(r=i.indexOf(t))){for(i.splice(r,1),i=this.a;e;){(n=e.entries)&&n.length||(n&&delete e.entries,e.a||!(o=e.c))?e=Q:((r=o)[a=(s=e).j]===s&&(delete r[a],delete s.c,--r.a),i===e&&(i=o),e=o)}this.a!==i&&(this.a=i,At(this)),kt(this,t,!1),s=!0}return s},wt.prototype.flush=function(){var t=new Et(null,NaN,this.j-this.m,this.l-this.u,this.j+this.m,this.l+this.u);(t.b=this).a=this.b=t,this.c=null},wt.prototype.o=function(t,e,i,r,n,o){var a=[],s=this.a,l=this.b;return t<=s[5]&&e<=s[6]&&(n?i>=s[7]:i>s[7])&&(o?r>=s[4]:r>s[4])&&function t(e,i,r,n,o,a,s,l,u){var c,h=i.entries,f=i[7],p=i[4],d=i[5],y=i[6],g=i[8],v=i[9];if(h){var _=h.length;if(p<o||f<n||s<y||a<d)for(;_--;){f=h[_],p=f[3],d=f[0],y=f[1];var m=f[2];o<=m&&n<=y&&(d<s||l&&d==s)&&(p<a||u&&p==a)&&r.push(f)}else for(;_--;)r.push(h[_])}(g<a||u&&a==g)&&(o<v&&(c=i[1])&&t(e,c,r,n,o,a,s,l,u),(v<s||l&&s==v)&&(c=i[3])&&t(e,c,r,n,o,a,s,l,u));n<g&&(o<v&&(c=i[0])&&t(e,c,r,n,o,a,s,l,u),(v<s||l&&s==v)&&(c=i[2])&&t(e,c,r,n,o,a,s,l,u))}(this,s,a,t,e,i,r,o||r>=l[6],n||i>=l[5]),a};var Tt=0;function Et(t,e,i,r,n,o){this.j=e,t&&(this.c=t,this.b=t.b,n=1&e?(i=t[8],t[5]):(i=t[7],t[8]),o=2&e?(r=t[9],t[6]):(r=t[4],t[9])),this[7]=i,this[5]=n,this[8]=(i+n)/2,this[4]=r,this[6]=o,this[9]=(r+o)/2}function Mt(t,e,i,r,n,o){Mt.ua.constructor.apply(this,arguments)}function St(t,e,i,r,n,o,a){var s,l,u=e[8],c=e[9];return a&&(n<u||(s=u<=i))&&(o<c||(l=c<=r))?i=(u=St)(t,e=e[s|=l<<1]||(++e.a,e[s]=new Et(e,s)),i,r,n,o,a-1):(r=i=new Rt(i,r,n,o),(e.entries||(e.entries=[])).push(r),r.a=e,kt(t,i,!0),At(t,e)),i}function Rt(t,e,i,r){this.id=Tt++,this[0]=e,this[1]=i,this[2]=r,this[3]=t}function Pt(t){this.l=new Mt(+t||10,180,90,0,0,!0),this.j=[],this.m=!1,this.a=this.b=this.c=null}function Ot(t,e,i,r,n,o){if(o)o=new Rt(n,-e,i+360,-r),t.j.push(o),t.m=!0,t.a&&t.a.C(e,i,r,n,!0,t.a);else{var a=-e,s=-r,l=(o=t.l).b,u=l[5],c=l[6];if(!(l[7]<=i&&l[4]<=a&&(n<u||u===n&&u===l.b.b[5])&&(s<c||c===s&&c===l.b.b[6])))throw Error("Coordinates out of bounds");o=St(o,o.b,i,a,n,s,o.sa),t.b&&t.b.C(e,i,r,n,!0,t.b)}return t.c=null,o}function Ct(t,e,i,r,n,o,a){var s=(t=t.j).length,l=[];if(s)for(var u=i+360,c=n+360;s--;){var h=t[s];(Lt(h,e,i,r,n,o,a)||Lt(h,e,u,r,c,o,a))&&l.push(h)}return l}function Lt(t,e,i,r,n,o,a){var s=t[3],l=t[0],u=t[1];return t=t[2],(o?l<=r:l<r)&&(a?s<=n:s<n)&&e<=t&&i<=u}function It(t,e){var i,r;if(i=e.length){for(var n=t.length,o={};n--;)o[t[n].id]=1;for(;i--;)(r=e[i]).id in o||t.push(r)}}function jt(){}function Nt(t,e,i){if(this.l=[],e&&this.K(e),i&&!l(i))throw new ut(Nt,2,i);this.b=0,this.m=i,this.a={},this.j=this.c=null,this.Z(t)}function zt(t,e){return e&&(t.c=Ft(t,e,t.c)),e}function Dt(t){for(;t.b>t.u&&t.j;)Ut(t,t.j,!0)}function Ft(t,e,i){return i!==e&&((e.H||e.v)&&Ut(t,e),(e.H=i)&&(e.v=i.v,i.v=e),e.v||(t.c=e),e.H||(t.j=e),t.b+=e.size),e}function Ut(t,e,i){var r=e.v,n=e.H;if((r||n||e==t.c&&e==t.j)&&(r?r.H=n:t.c=n,n?n.v=r:t.j=r,t.b-=e.size,i)){for(i=t.l.length;i--;)t.l[i].call(t,e.id,e.data,e.size);delete t.a[e.id]}e.H=e.v=null}Et.prototype.a=0,h(Mt,wt),c("H.geo.QuadTree",Pt),Pt.prototype.N=function(){return this.m},Pt.prototype.D=function(){var t;if(!this.c){var e,i,r=[];if((a=!this.b)&&(s=(o=this.l).c,o.I&&!s&&((a=o.a).entries||a[0]||a[1]||a[2]||a[3])&&(s=function t(e,i){for(var r,n,o=0,a=3;0<=a;a--){for(var s=a+4,l=0<a%3,u=[],c=i[a],h=e[a],f=h.length;f--;){var p=h[f];if(r=p.entries)for(n=r.length;n--;){var d=r[n][a];(l?c<d:d<c)&&(c=d)}for(n=4;n--;)(r=p[n])&&(l?r[s]>c:r[s]<c)&&u.push(r)}o+=u.length,i[a]=c,e[a]=u}return o&&(i=t(e,i)),i}([s=[a],s,s,s],[a[6],a[7],a[4],a[5]]),o.c=s),a=o=s),a&&(this.b=new gt(-o[0],o[3],-o[2],o[1])),(t=this.b)&&r.push(t),!this.a&&(i=(e=this.j).length)){for(a=360,s=-(o=90),l=0;i--;)var n=e[i],o=p(o,n[0]),a=p(a,n[3]),s=d(s,n[2]),l=d(l,n[1]);this.a=new gt(-o,a,-s,l-360)}(t=this.a)&&r.push(t),(t=r[0])&&(r[1]&&(t=t.J(r[1],!0)),this.c=t)}return this.c},Pt.prototype.insertBoundingBox=Pt.prototype.oa=function(t){var e=t.W(),i=t.V();return(t=t.N())?Ot(this,e.lat,i.lng,i.lat,e.lng,t):Ot(this,e.lat,e.lng,i.lat,i.lng,t)},Pt.prototype.remove=function(t){var e,i;return t.a?(i=this.l.remove(t),this.b=null):(i=0<=(t=(e=this.j).indexOf(t)))&&(e.splice(t,1),this.m=0<e.length,this.a=null),i&&(this.c=null),i},Pt.prototype.intersectBoundingBox=Pt.prototype.pa=function(t,e,i){var r=this.l,n=t.W(),o=t.V(),a=-n.lat,n=n.lng,s=-o.lat,o=o.lng;return!e&&a==s||!i&&n===o?t=[]:t.N()?(It(t=r.o(-180,a,o,s,i,e),r.o(n,a,180,s,!1,e)),It(t,Ct(this,a,o,s,n+360,e,i))):It(t=r.o(n,a,o,s,i,e),Ct(this,a,n,s,o,e,i)),t},c("H.util.ICache",jt),jt.prototype.add=function(){},jt.prototype.get=function(){},jt.prototype.drop=jt.prototype.S=function(){},jt.prototype.forEach=function(){},jt.prototype.removeAll=jt.prototype.Y=function(){},jt.prototype.registerOnDrop=jt.prototype.K=function(){},jt.prototype.deRegisterOnDrop=jt.prototype.P=function(){},c("H.util.Cache",Nt),Nt.prototype.add=function(t,e,i){if(!et(i=+i)||i<0)throw new ut(this.add,2,i);t=String(t);var r=this.a[t],n=!0;return this.m&&(n=this.m(t,e,i)),r?n?(this.b+=i-r.size,r.size=i,r.data=e,zt(this,r)):Ut(this,r,!0):n&&(this.a[t]=Ft(this,{id:t,data:e,size:i,H:null,v:null},this.c)),Dt(this),n},Nt.prototype.registerOnDrop=Nt.prototype.K=function(t){if(!l(t))throw new ut(this.K,0,t);this.l.push(t)},Nt.prototype.deRegisterOnDrop=Nt.prototype.P=function(t){this.l=this.l.filter(function(e){return e!==t})},Nt.prototype.get=function(t,e){return(t=e?this.a[t]:zt(this,this.a[t]))&&t.data},Nt.prototype.drop=Nt.prototype.S=function(t){var e;(e=this.a[t])&&Ut(this,e,!0)},Nt.prototype.forEach=function(t,e,i){var r;for(r in this.a){var n=this.a[r];i&&!i(r,n.data,n.size)||t.call(e,r,n.data,n.size)}},Nt.prototype.removeAll=Nt.prototype.Y=function(t){var e;for(e in this.a){var i=this.a[e];t&&!t(e,i.data,i.size)||Ut(this,this.a[e],!0)}},Nt.prototype.setMaxSize=Nt.prototype.Z=function(t){if(!(0<+t))throw new ut(Nt.prototype.Z,0,t);return this.u=+t,Dt(this),this},Nt.prototype.getMaxSize=Nt.prototype.ka=function(){return this.u},Nt.prototype.getCurrentSize=Nt.prototype.ia=function(){return this.b}}).call(Qr);var $r,Jr=Xr={};function tn(t){return Sr(Qr.H.math.Point,Ir(t))}Xr.clipPolygon=function(t,e){var i,r,n,o=[],a=Qr.H.math.clipping.clipPolygon(t.map(tn),e.map(tn));if(a)do{for(i=[],r=a;i.push([(n=r).x,n.y]),r=r.next;);o.push(i)}while(a=a.nextPoly);else Xr.isPointInsidePolygon(e[0],t)?o.push(e):Xr.isPointInsidePolygon(t[0],e)&&o.push(t);return o},Xr.isPointInsidePolygon=function(t,e){return Qr.H.math.isPointInsidePolygon({x:t[0],y:t[1]},Qr.H.math.flatten(e))},Xr.clamp=function(t,e,i){return(t-=0)>i?i:t<e?e:t},Xr.splitLegs=function(t,e){var i=[];t.push(t[0]);for(var r=0;r<t.length-1;r++){var n,o=t[r],a=t[r+1];i.push(o),Math.abs(a[0]-o[0])>=e&&(n=[(o[0]+a[0])/2,(o[1]+a[1])/2],i.push(n))}return i.length!==t.length-1?Xr.splitLegs(i,e):i},Xr.getBBox=function(t){var e=1/0,i=1/0,r=-1/0,n=-1/0;return t.forEach(function(t){t[0]<e&&(e=t[0]),t[1]<i&&(i=t[1]),t[0]>r&&(r=t[0]),t[1]>n&&(n=t[1])}),[e,i,r,n]},Xr.getBBoxCenter=function(t){var e=Lr(t,4),i=e[0],r=e[1];return[i+(e[2]-i)/2,r+(e[3]-r)/2]},Xr.getLineLength=function(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))};var en=$r={};$r.default_source_max_zoom=18,$r.default_view_max_zoom=20,$r.tile_size=256,$r.half_circumference_meters=20037508.342789244,$r.circumference_meters=2*$r.half_circumference_meters,$r.min_zoom_meters_per_pixel=$r.circumference_meters/$r.tile_size;var rn=[];$r.metersPerPixel=function(t){return rn[t]=rn[t]||$r.min_zoom_meters_per_pixel/Math.pow(2,t),rn[t]};var nn=[];$r.metersPerTile=function(t){return nn[t]=nn[t]||$r.circumference_meters/Math.pow(2,t),nn[t]},$r.tile_scale=4096,$r.units_per_pixel=$r.tile_scale/$r.tile_size,$r.height_scale=16;var on=[];$r.unitsPerMeter=function(t){return on[t]=on[t]||$r.tile_scale/($r.tile_size*$r.metersPerPixel(t)),on[t]},$r.metersForTile=function(t){return{x:t.x*$r.circumference_meters/Math.pow(2,t.z)-$r.half_circumference_meters,y:-(t.y*$r.circumference_meters/Math.pow(2,t.z)-$r.half_circumference_meters)}},$r.tileForMeters=function(t,e){var i=Lr(t,2),r=i[0],n=i[1];return{x:Math.floor((r+$r.half_circumference_meters)/($r.circumference_meters/Math.pow(2,e))),y:Math.floor((-n+$r.half_circumference_meters)/($r.circumference_meters/Math.pow(2,e))),z:e}},$r.metersToExactTileCoords=function(t,e){var i=Lr(t,2),r=i[0],n=i[1];return{x:Math.pow(2,e-1)*(1+r/$r.half_circumference_meters),y:Math.pow(2,e-1)*(1-n/$r.half_circumference_meters),z:e}},$r.wrapTile=function(t){var e=t.x,i=t.y,r=t.z,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{x:!0,y:!1},o=(1<<r)-1;return n.x&&(e&=o),n.y&&(i&=o),{x:e,y:i,z:r}},$r.metersToLatLng=function(t){var e=Lr(t,2),i=e[0],r=e[1];return i/=$r.half_circumference_meters,r/=$r.half_circumference_meters,r=(2*Math.atan(Math.exp(r*Math.PI))-Math.PI/2)/Math.PI,[i*=180,r*=180]},$r.latLngToMeters=function(t){var e=Lr(t,2),i=e[0],r=e[1],r=Math.log(Math.tan(r*Math.PI/360+Math.PI/4))/Math.PI;return r*=$r.half_circumference_meters,r=Math.min(Math.max(r,-$r.half_circumference_meters),$r.half_circumference_meters),[i*=$r.half_circumference_meters/180,r]},$r.tileSpaceToMeters=function(t,e,i){var r=Lr(t,2),n=r[0],o=r[1],a=$r.unitsPerMeter(e);return[n/a+i.x,o/a+i.y]},$r.tileSpaceToLatlng=function(t,e,i){var r=$r.unitsPerMeter(e);return $r.transformGeometry(t,function(t){t[0]=t[0]/r+i.x,t[1]=t[1]/r+i.y;var e=Lr($r.metersToLatLng(t),2),n=e[0],o=e[1];t[0]=n,t[1]=o}),t},$r.copyGeometry=function(t){if(null!=t){var e={type:t.type};return"Point"===t.type?e.coordinates=[t.coordinates[0],t.coordinates[1]]:"LineString"===t.type||"MultiPoint"===t.type?e.coordinates=t.coordinates.map(function(t){return[t[0],t[1]]}):"Polygon"===t.type||"MultiLineString"===t.type?e.coordinates=t.coordinates.map(function(t){return t.map(function(t){return[t[0],t[1]]})}):"MultiPolygon"===t.type&&(e.coordinates=t.coordinates.map(function(t){return t.map(function(t){return t.map(function(t){return[t[0],t[1]]})})})),e}},$r.transformGeometry=function(t,e){null!=t&&("Point"===t.type?e(t.coordinates):"LineString"===t.type||"MultiPoint"===t.type?t.coordinates.forEach(e):"Polygon"===t.type||"MultiLineString"===t.type?t.coordinates.forEach(function(t){return t.forEach(e)}):"MultiPolygon"===t.type&&t.coordinates.forEach(function(t){t.forEach(function(t){return t.forEach(e)})}))},$r.boxIntersect=function(t,e){return!(e.sw.x>t.ne.x||e.ne.x<t.sw.x||e.sw.y>t.ne.y||e.ne.y<t.sw.y)},$r.findBoundingBox=function(t){for(var e=1/0,i=-1/0,r=1/0,n=-1/0,o=t[0].length,a=0;a<o;a++){var s=t[0][a];s[0]<e&&(e=s[0]),s[1]<r&&(r=s[1]),s[0]>i&&(i=s[0]),s[1]>n&&(n=s[1])}return[e,r,i,n]},$r.geometryType=function(t){return"Polygon"===t||"MultiPolygon"===t?"polygon":"LineString"===t||"MultiLineString"===t?"line":"Point"===t||"MultiPoint"===t?"point":void 0},$r.centroid=function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(t&&0!==t.length){var i,r=0,n=0,o=0,a=t[0],s=a.length;e&&(i=a[0],a=a.map(function(t){return[t[0]-i[0],t[1]-i[1]]}));for(var l=0,u=s-1;l<s;u=l,l++){var c=a[l],h=a[u],f=c[1]*h[0]-h[1]*c[0];r+=(c[0]+h[0])*f,n+=(c[1]+h[1])*f,o+=3*f}var p=[r/o,n/o];return e&&(p[0]+=i[0],p[1]+=i[1]),p}},$r.multiCentroid=function(t){for(var e=t.length,i=[0,0],r=0;r<t.length;r++){var n=$r.centroid(t[r]);i[0]+=n[0],i[1]+=n[1]}return i[0]/=e,i[1]/=e,i},$r.signedPolygonRingAreaSum=function(t){for(var e=0,i=t.length,r=0;r<i-1;r++){var n=t[r],o=t[r+1];e+=n[0]*o[1]-o[0]*n[1]}return e+=t[i-1][0]*t[0][1]-t[0][0]*t[i-1][1]},$r.polygonRingArea=function(t){return Math.abs($r.signedPolygonRingAreaSum(t))/2},$r.polygonArea=function(t){if(t)return $r.polygonRingArea(t[0])},$r.multiPolygonArea=function(t){for(var e=0,i=0;i<t.length;i++)e+=$r.polygonArea(t[i]);return e},$r.ringWinding=function(t){var e=$r.signedPolygonRingAreaSum(t);return 0<e?"CW":e<0?"CCW":void 0},$r.getTileBoundingBox=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=$r.wrapTile(t,{x:!0}),n=$r.metersForTile(r),o=$r.metersPerPixel(r.z),a=$r.metersToLatLng([n.x-i*o,n.y+i*o]),s=$r.metersToLatLng([n.x+(e+i)*o,n.y-(e+i)*o]),l=$r.isLastTile(r);return new Qr.H.geo.Rect(0===t.y?90:Jr.clamp(a[1],-90,90),Jr.clamp(a[0],-180,180),l.row?-90:Jr.clamp(s[1],-90,90),l.column?180:Jr.clamp(s[0],-180,180))},$r.isLastTile=function(t){var e=t.x,i=t.y,r=t.z;return{row:i===Math.pow(2,r)-1,column:e===Math.pow(2,r)-1}};var an,sn,ln=function(){Ar(e,Rr(Error));var t=Or(e);function e(i){var r;return _r(this,e),(r=t.call(this)).name="MethodNotImplemented",r.message="Method "+i+" must be implemented in subclass",r}return e}(),un=!1,cn=!1;try{window.document!==HTMLDocument&&(cn=!0)}catch(o){void 0!==self&&(un=!0,self.window={document:{}},self.document=self.window.document)}var hn={get is_fake_worker(){return self.is_fake_worker},get is_worker(){return void 0!==sn?sn:un||self.is_fake_worker},set is_worker(t){sn=t},get is_main(){return void 0!==an?an:cn&&!self.is_fake_worker},set is_main(t){an=t},is_native_worker:un},fn={},pn=0,dn={},yn={},gn={};function vn(t,e,i){var r=2<arguments.length&&void 0!==i?i:yn,n=[];if("string"==typeof t&&(t=(n=t.split(".")).pop()),hn.is_main&&e&&1===n.length&&"self"===n[0])r=e;else for(var o=0;o<n.length;o++){if(!r[n[o]])return[];r=r[n[o]]}return[t,r]}fn.addTarget=function(t,e){hn.is_fake_worker?gn[t]=e:yn[t]=e},fn.removeTarget=function(t){delete yn[t],delete gn[t]};var _n=" No object with that name is registered on main thread.",mn=" Object has no method with that name.",bn="_worker_broker_error_not_set_";function xn(t){Array.isArray(t)&&t.filter(function(t){return t.parent&&t.property}).forEach(function(t){return delete t.parent[t.property]})}fn.withTransferables=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if(!(this instanceof fn.withTransferables))return Sr(fn.withTransferables,e);this.value=e,this.transferables=function t(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];if(!e)return n;if(Array.isArray(e))e.forEach(function(i,r){return t(i,e,r,n)});else if("object"===vr(e))if(e instanceof ArrayBuffer)n.push({object:e,parent:i,property:r});else if(e.buffer instanceof ArrayBuffer)n.push({object:e.buffer,parent:i,property:r});else for(var o in e)t(e[o],e,o,n);return n}(this.value)},hn.is_main&&(fn.postMessage=function(t,e){for(var i=arguments.length,r=new Array(2<i?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];if(Array.isArray(t))return Promise.all(t.map(function(t){return fn.postMessage.apply(fn,[t,e].concat(Ir(r)))}));var o,a={};"object"===vr(e)&&(e=(a=e).method);var s="main_send";"string"==typeof t?(e=t,r=Array.prototype.slice.call(arguments,1),o=!0,s="worker_send"):t.init&&(o=!0);var l,u=[];if(r&&1===r.length&&r[0]instanceof fn.withTransferables&&(u=r[0].transferables,r=r[0].value),l={type:s,message_id:++pn,method:e,message:r},o)return function(t,e){var i=t.type,r=Lr(vn(t.method,e,"main_send"===i?gn:yn),2),n=r[0],o=r[1],a="Worker broker could not dispatch message type ".concat(t.method," on target ").concat(t.target,".");if(!o)throw Error(a+_n);var s="function"==typeof o[n]&&o[n];if(!s)throw Error(a+mn);return new Promise(function(e,i){var r;try{r=s.apply(o,t.message)}catch(r){return void i(r)}r instanceof Promise?r.then(function(t){t instanceof fn.withTransferables&&(t=t.value[0]),e(t)},function(t){i(t instanceof Error?"".concat(t.message,": ").concat(t.stack):t)}):(r instanceof fn.withTransferables&&(r=r.value[0]),e(r))})}(l,t&&t.init?t:void 0);var c=new Promise(function(t,i){dn[pn]={method:e,message:r,resolve:t,reject:i}});return a.stringify&&(l=JSON.stringify(l)),t.postMessage(l,u.map(function(t){return t.object})),xn(u),c},fn.addWorker=function(t){if(!(t instanceof Worker))throw Error("Worker broker could not add non-Worker object",t);t.addEventListener("message",function(e){var i="string"==typeof e.data?JSON.parse(e.data):e.data,r=i.message_id;if("worker_reply"===i.type)dn[r]&&(i.error?dn[r].reject(i.error):dn[r].resolve(i.message),delete dn[r]);else if("worker_send"===i.type&&null!=r){var n=Lr(vn(i.method),2),o=n[0],a=n[1],s="Worker broker could not dispatch message type ".concat(i.method," on target ").concat(i.target,".");if(!a)throw Error(s+_n);var l="function"==typeof a[o]&&a[o];if(!l)throw Error(s+mn);var u,c=bn;try{u=l.apply(a,i.message)}catch(e){c=e}var h,f=[];u&&"function"==typeof u.then?u.then(function(e){e instanceof fn.withTransferables&&(f=e.transferables,e=e.value[0]),h={type:"main_reply",message_id:r,message:e},t.postMessage(h,f.map(function(t){return t.object})),xn(f)},function(e){t.postMessage({type:"main_reply",message_id:r,error:e instanceof Error?"".concat(e.message,": ").concat(e.stack):e})}):(u instanceof fn.withTransferables&&(f=u.transferables,u=u.value[0]),h={type:"main_reply",message_id:r,message:u,error:c instanceof Error?"".concat(c.message,": ").concat(c.stack):c},t.postMessage(h,f.map(function(t){return t.object})),xn(f))}})},fn.getMessages=function(){return dn},fn.getMessageId=function(){return pn}),hn.is_worker&&(fn.postMessage=function(t){for(var e=arguments.length,i=new Array(1<e?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];var n={};"object"===vr(t)&&(t=(n=t).method);var o,a=new Promise(function(e,r){dn[pn]={method:t,message:i,resolve:e,reject:r}}),s=[];return i&&1===i.length&&i[0]instanceof fn.withTransferables&&(s=i[0].transferables,i=i[0].value),o={type:"worker_send",message_id:pn,method:t,message:i},n.stringify&&(o=JSON.stringify(o)),self.postMessage(o,s.map(function(t){return t.object})),xn(s),pn++,a},self.addEventListener("message",function(t){var e="string"==typeof t.data?JSON.parse(t.data):t.data,i=e.message_id;if("main_reply"===e.type)dn[i]&&(e.hasOwnProperty("error")&&e.error!==bn?dn[i].reject(e.error):dn[i].resolve(e.message),delete dn[i]);else if("main_send"===e.type&&null!=i){var r=Lr(vn(e.method),2),n=r[0],o=r[1],a="Worker broker could not dispatch message type ".concat(e.method," on target ").concat(e.target,".");if(!o)throw Error(a+_n);var s,l,u="function"==typeof o[n]&&o[n];if(!u)throw Error(a+mn);try{s=u.apply(o,e.message)}catch(t){l=t}var c,h=[];s instanceof Promise?s.then(function(t){t instanceof fn.withTransferables&&(h=t.transferables,t=t.value[0]),c={type:"worker_reply",message_id:i,message:t},self.postMessage(c,h.map(function(t){return t.object})),xn(h)},function(t){self.postMessage({type:"worker_reply",message_id:i,error:t instanceof Error?"".concat(t.message,": ").concat(t.stack):t})}):(s instanceof fn.withTransferables&&(h=s.transferables,s=s.value[0]),c={type:"worker_reply",message_id:i,message:s,error:l instanceof Error?"".concat(l.message,": ").concat(l.stack):l},self.postMessage(c,h.map(function(t){return t.object})),xn(h))}}));var wn,kn={silent:-1,error:0,warn:1,info:2,debug:3,trace:4},An={},Tn={};function En(t){var e,i="object"===vr(t)?t.level:t;if(kn[i]<=kn[En.level]){for(var r=arguments.length,n=new Array(1<r?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];if(hn.is_native_worker)fn.postMessage.apply(fn,[{method:"_logProxy",stringify:!0},t].concat(n));else{if("object"===vr(t)&&!0===t.once){if(Tn[JSON.stringify(n)])return;Tn[JSON.stringify(n)]=!0}var a=(An[e=i]=An[e]||(console[e]?console[e]:console.log).bind(console),An[e]);1<n.length?a.apply(void 0,["Tangram [".concat(i,"]: ").concat(n[0])].concat(Ir(n.slice(1)))):a("Tangram [".concat(i,"]: ").concat(n[0]))}}}function Mn(t,e,i){var r,n;return i=i||0,function(){var o=this,a=arguments;function s(){n=0,t.apply(o,a)}clearTimeout(r),n&&i&&Date.now()-n>=i?s():(n=n||Date.now(),r=setTimeout(function(){s()},e))}}En.level="info",En.workers=null,En.setLevel=function(t){En.level=t,hn.is_main&&Array.isArray(En.workers)&&fn.postMessage(En.workers,"_logSetLevelProxy",t)},hn.is_main&&(En.setWorkers=function(t){En.workers=t},En.reset=function(){Tn={}}),fn.addTarget("_logProxy",En),fn.addTarget("_logSetLevelProxy",En.setLevel);var Sn=wn={};fn.addTarget("Utils",wn),wn.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},wn.isMicrosoft=function(){return/(Trident\/7.0|Edge[ /](\d+[\.\d]+))/i.test(navigator.userAgent)},wn._requests={},wn._proxy_requests={},wn.io=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:6e4,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"text",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"GET",n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,a=6<arguments.length&&void 0!==arguments[6]&&arguments[6];if(hn.is_worker&&wn.isMicrosoft())return En("debug","Proxying request for URL to worker",t),o&&(wn._proxy_requests[o]=!0),fn.postMessage("Utils.io",t,e,i,r,n,o,!0);var s=new XMLHttpRequest,l=(l=new Promise(function(n,o){s.open(r,t,!0),s.timeout=e,s.responseType=i,s.onload=function(){200===s.status?-1<["text","json"].indexOf(s.responseType)?n(s.responseText):n(s.response):o(Error("Request error with a status of "+s.statusText))},s.onerror=function(t){o(Error("There was a network error"+t.toString()))},s.ontimeout=function(t){o(Error("timeout "+t.toString()))},s.send()})).then(function(t){return o&&delete wn._requests[o],a?fn.withTransferables(t):t});return o&&(wn._requests[o]=s),l},wn.cancelRequest=function(t){if(hn.is_worker&&wn._proxy_requests[t])return fn.postMessage("Utils.cancelRequest",t);wn._requests[t]?(En("trace","Cancelling network request key '".concat(t,"'")),wn._requests[t].abort(),delete wn._requests[t]):En("trace","Could not find network request key '".concat(t,"'"))},wn.requestAnimationFramePolyfill=function(){"function"!=typeof window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)})},wn.serializeWithFunctions=function(t){return"function"==typeof t?t.toString():JSON.stringify(t,function(t,e){return"function"==typeof e?e.toString():e})},wn.stringsToFunctions=function(t,e){if("string"==typeof t)t=wn.stringToFunction(t,e);else if(null!=t&&"object"===vr(t))for(var i in t)t[i]=wn.stringsToFunctions(t[i],e);return t},wn._use_count=0,wn._function_cache={};var Rn,Pn,On=Mn(function(){En("trace","Cleared cached ".concat(Object.keys(wn._function_cache).length," functions (reused ").concat(wn._use_count," times)")),wn._use_count=0,wn._function_cache={}},1e4),Cn=/^\s*function[^(]*\(([^)]*)\)\s*?\{([\s\S]*)\}$/m;function Ln(t){if("string"!=typeof t||-1!==t.search(/^(data|blob):/))return"";var e=t.indexOf("?");-1<e&&(t=t.substr(0,e));var i=t.indexOf("#");return-1<i&&(t=t.substr(0,i)),t.substr(0,t.lastIndexOf("/")+1)||""}function In(t){return"string"==typeof t&&!(-1<t.search(/^(http|https|data|blob):/)||"//"===t.substr(0,2))}function jn(t,e){if(!e||0===Object.keys(e).length)return[t,[]];var i=t.indexOf("?"),r=t.indexOf("#"),n="";-1<r&&(n=t.slice(r),t=t.slice(0,r)),-1===i&&(i=t.length,t+="?"),i++;var o="",a=[];for(var s in e)""===function(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}(s,t)?o+="".concat(s,"=").concat(e[s],"&"):a.push([s,e[s]]);return[t=t.slice(0,i)+o+t.slice(i)+n,a]}function Nn(t){return void 0===Rn&&"function"!=typeof(Rn=window.URL&&window.URL.createObjectURL||window.webkitURL&&window.webkitURL.createObjectURL)&&(Rn=null,En("warn","window.URL.createObjectURL (or vendor prefix) not found, unable to create local blob URLs")),Rn?Rn(t):t}wn.stringToFunction=function(t,e){var i=t;e&&(i+=e.toString());var r=wn._function_cache[i];if(On(),r)return wn._use_count++,r;var n="string"==typeof t&&t.match(Cn);if(n&&2<n.length)try{var o=n[2],a=0<(a=0<n[1].length&&n[1].split(",").map(function(t){return t.trim()}).filter(function(t){return t})).length?a:["context"],s=new Function(a.toString(),"function"==typeof e?e(o):o);return wn._function_cache[i]=s}catch(e){return t}return t},wn.device_pixel_ratio=1,wn.isPowerOf2=function(t){return 0==(t&t-1)},wn.interpolate=function(t,e,i){if(!Array.isArray(e)||!Array.isArray(e[0]))return e;if(e.length<1)return e;var r,n,o,a,s;if(t<=e[0][0])a=e[0][1],"function"==typeof i&&(a=i(a));else if(t>=e[e.length-1][0])a=e[e.length-1][1],"function"==typeof i&&(a=i(a));else for(var l=0;l<e.length-1;l++)if(t>=e[l][0]&&t<e[l+1][0]){if(r=e[l][0],n=e[l+1][0],Array.isArray(e[l][1])){a=[];for(var u=0;u<e[l][1].length;u++)"function"==typeof i?(s=i(e[l][1][u]),o=i(e[l+1][1][u])-s,a[u]=o*(t-r)/(n-r)+s):(o=e[l+1][1][u]-e[l][1][u],a[u]=o*(t-r)/(n-r)+e[l][1][u])}else a="function"==typeof i?(s=i(e[l][1]),(o=i(e[l+1][1])-s)*(t-r)/(n-r)+s):(o=e[l+1][1]-e[l][1])*(t-r)/(n-r)+e[l][1];break}return a},wn.toCSSColor=function(t){return 1===t[3]?"rgb(".concat(t.slice(0,3).map(function(t){return Math.round(255*t)}).join(", "),")"):"rgba(".concat(t.map(function(t,e){return e<3&&Math.round(255*t)||t}).join(", "),")")},wn.pointInTile=function(t){return 0<=t[0]&&t[1]>-en.tile_scale&&t[0]<en.tile_scale&&t[1]<=0},wn.zoomToTileLevel=function(t){return Math.floor(t)};var zn=function(){function t(e,i){var r=this;if(_r(this,t),this.config=e,this.sources=i,this.id=e.id,this.name=e.name,this.pad_scale=e.pad_scale||1e-4,this.default_winding=null,this.rasters=[],Array.isArray(e.rasters)&&e.rasters.forEach(function(t){-1===r.rasters.indexOf(t)&&r.rasters.push(t)}),this.preprocess=e.preprocess,"function"==typeof this.preprocess&&this.preprocess.bind(this),this.transform=e.transform,"function"==typeof this.transform)this.transform=this.transform.bind(this);else if("object"===vr(this.transform))for(var n in this.transform)"function"==typeof this.transform[n]&&(this.transform[n]=this.transform[n].bind(this));this.extra_data=e.extra_data,this.scripts=e.scripts,this.max_zoom=null!=e.max_zoom?e.max_zoom:en.default_source_max_zoom,this.setTileSize(e.tile_size),this.max_coord_zoom=this.max_zoom+this.zoom_bias,this.min_display_zoom=null!=e.min_display_zoom?e.min_display_zoom:0,this.max_display_zoom=null!=e.max_display_zoom?e.max_display_zoom:null,this._has_volatile_data=!!e.has_volatile_data}return br(t,[{key:"hasLabeledData",value:function(){return!0}},{key:"_transformTile",value:function(t){if(t.source_data.layers){var e={coords:t.coords},i=[];if("function"==typeof this.transform)i.push(this.transform);else if("object"===vr(this.transform))for(var r=Object.keys(this.transform).sort(),n=0;n<r.length;n++)i.push(this.transform[r[n]]);for(var o=1===Object.keys(t.source_data.layers).length&&t.source_data.layers._default,a=0;a<i.length;a++)o?t.source_data.layers._default=i[a](t.source_data.layers._default,this.extra_data,e):t.source_data.layers=i[a](t.source_data.layers,this.extra_data,e)}}},{key:"_postProcessTile",value:function(t){var e=this;for(var i in this._transformTile(t),t.source_data.layers){var r=t.source_data.layers[i];r&&r.features&&r.features.forEach(function(t){en.transformGeometry(t.geometry,function(t){t[1]=-t[1],e.pad_scale&&(t[0]=Math.round(t[0]*(1+e.pad_scale)-en.tile_scale*e.pad_scale/2),t[1]=Math.round(t[1]*(1+e.pad_scale)-en.tile_scale*e.pad_scale/2))}),e.updateDefaultWinding(t.geometry)})}t.default_winding=this.default_winding||"CCW"}},{key:"load",value:function(t){return t.source_data={},t.source_data.layers={},t.pad_scale=this.pad_scale,t.rasters=Ir(this.rasters),this._load(t)}},{key:"_load",value:function(){throw new ln("_load")}},{key:"setTileSize",value:function(t){this.tile_size=t||256,("number"!=typeof this.tile_size||this.tile_size<256||!Sn.isPowerOf2(this.tile_size))&&(En({level:"warn",once:!0},"Data source '".concat(this.name,"': 'tile_size' parameter must be a number that is a power of 2 greater than or equal to 256, but was '").concat(t,"'")),this.tile_size=256),this.zoom_bias=Math.log2(this.tile_size)-8}},{key:"updateDefaultWinding",value:function(t){return null==this.default_winding&&("Polygon"===t.type?this.default_winding=en.ringWinding(t.coordinates[0]):"MultiPolygon"===t.type&&(this.default_winding=en.ringWinding(t.coordinates[0][0]))),this.default_winding}},{key:"includesTile",value:function(t,e){if(t.z<this.min_display_zoom||null!=this.max_display_zoom&&e>this.max_display_zoom)return!1;for(var i=0;i<this.rasters.length;i++){var r=this.rasters[i];if(this.sources[r]&&this.sources[r]!==this&&!this.sources[r].includesTile(t,t.z))return!1}return!0}},{key:"has_volatile_data",get:function(){return this._has_volatile_data},set:function(t){var e=0<arguments.length&&void 0!==t&&t;this._has_volatile_data=e}}],[{key:"create",value:function(e,i){for(var r in i)if(!t.changed(i[r],{config:e}))return i[r];if(t.types[e.type])return new t.types[e.type](e,i)}},{key:"changed",value:function(t,e){if(!t||!e)return!0;var i=Object.assign({},t.config,{id:null}),r=Object.assign({},e.config,{id:null});return JSON.stringify(i)!==JSON.stringify(r)}},{key:"coordsToMeters",value:function(t){var e=Lr(en.latLngToMeters(t),2),i=e[0],r=e[1];t[0]=i,t[1]=r}},{key:"projectData",value:function(e){for(var i in e.layers)for(var r=e.layers[i].features.length,n=0;n<r;n++){var o=e.layers[i].features[n];en.transformGeometry(o.geometry,t.coordsToMeters)}}},{key:"metersToTileUnits",value:function(t,e,i){i[0]=Math.round((i[0]-e.x)*t),i[1]=-1*Math.round((i[1]-e.y)*t)}},{key:"scaleData",value:function(e,i){var r=i.coords.z,n=i.min,o=(i.max,t.metersToTileUnits.bind(this,en.unitsPerMeter(r),n));for(var a in e.layers)for(var s=e.layers[a].features.length,l=0;l<s;l++){var u=e.layers[a].features[l];en.transformGeometry(u.geometry,o)}}},{key:"register",value:function(e,i){e&&i&&(t.types[i]=e)}}]),t}();zn.types={};var Dn=0,Fn=function(){Ar(e,zn);var t=Or(e);function e(i,r){var n;_r(this,e),(n=t.call(this,i,r)).response_type="";var o=Lr(jn(i.url,i.url_params),2),a=o[0],s=o[1];if(n.url=a,s.forEach(function(t){var e=Lr(t,2),r=e[0],o=e[1];En({level:"warn",once:!0},"Data source '".concat(n.name,"': parameter '").concat(r,"' already present in URL '").concat(i.url,"', ")+"skipping value '".concat(r,"=").concat(o,"' specified in 'url_params'"))}),"string"!=typeof n.url)throw Error("Network data source must provide a string `url` property");return n}return br(e,[{key:"_load",value:function(t){var e=this,i=this.formatUrl(this.url,t),r=t.source_data;return r.url=i,new Promise(function(n,o){r.error=null;var a=Dn+++"-"+i,s=Sn.io(i,6e4,e.response_type,"GET",{},a);r.request_id=a,s.then(function(i){"function"==typeof e.preprocess&&(i=e.preprocess(i)),(i=i instanceof Promise?i:Promise.resolve(i)).then(function(i){e.parseSourceData(t,r,i),e._postProcessTile(t),n(t)})},function(i){r.error=i.stack,e._postProcessTile(t),n(t)})})}},{key:"formatUrl",value:function(){throw new ln("formatUrl")}},{key:"parseSourceData",value:function(){throw new ln("parseSourceData")}}]),e}(),Un=function(){Ar(e,Fn);var t=Or(e);function e(i,r){var n;return _r(this,e),(n=t.call(this,i,r)).tiled=!0,n.parseBounds(i),n.builds_geometry_tiles=!1,n.tms=!0===i.tms,-1<n.url.search("{s}")&&(Array.isArray(i.url_subdomains)&&0<i.url_subdomains.length?(n.url_subdomains=i.url_subdomains,n.next_url_subdomain=0):En({level:"warn",once:!0},"Data source '".concat(n.name,"': source URL includes '{s}' subdomain marker ('").concat(n.url,"'), but no subdomains ")+"were specified in 'url_subdomains' parameter")),n}return br(e,[{key:"parseBounds",value:function(t){var e,i,r,n,o;Array.isArray(t.bounds)&&4===t.bounds.length&&(this.bounds=t.bounds,i=(e=Lr(this.bounds,4))[0],r=e[1],n=e[2],o=e[3],this.bounds_meters={min:en.latLngToMeters([i,o]),max:en.latLngToMeters([n,r])},this.bounds_tiles={min:{},max:{}})}},{key:"checkBounds",value:function(t){if(this.bounds){t=en.wrapTile(t,{x:!0});var e=(e=this.bounds_tiles.min[t.z])||(this.bounds_tiles.min[t.z]=en.tileForMeters(this.bounds_meters.min,t.z)),i=(i=this.bounds_tiles.max[t.z])||(this.bounds_tiles.max[t.z]=en.tileForMeters(this.bounds_meters.max,t.z));if(t.x<e.x||t.x>i.x||t.y<e.y||t.y>i.y)return!1}return!0}},{key:"includesTile",value:function(t,i){return!!Cr(Tr(e.prototype),"includesTile",this).call(this,t,i)&&!!this.checkBounds(t)}},{key:"formatUrl",value:function(t,e){var i=en.wrapTile(e.coords,{x:!0});this.tms&&(i.y=Math.pow(2,i.z)-1-i.y);var r=t.replace("{x}",i.x).replace("{y}",i.y).replace("{z}",i.z);return null!=this.url_subdomains&&(r=r.replace("{s}",this.url_subdomains[this.next_url_subdomain]),this.next_url_subdomain=(this.next_url_subdomain+1)%this.url_subdomains.length),r}},{key:"urlHasTilePattern",value:function(t){return t&&-1<t.search("{x}")&&-1<t.search("{y}")&&-1<t.search("{z}")}}]),e}(),Bn=function(){Ar(e,zn);var t=Or(e);function e(i,r){var n;return _r(this,e),(n=t.call(this,i,r)).target_name="MapsJsSource"+i.uid,n.tiled=!!i.tiled,fn.addTarget(n.target_name,Pr(n)),hn.is_worker&&fn.postMessage(n.target_name+".onWorkerInitialized"),hn.is_main&&(n._workers_left=0),n}return br(e,[{key:"initialize",value:function(t,e,i,r){this._main_initialized||(this.provider=t,this.worker=r,this._workers_left+=i,this._on_update=e,this._main_initialized=!0,this._onProviderUpdate=this._onProviderUpdate.bind(this),t.addEventListener("update",this._onProviderUpdate),this._isReady()&&this.onReady())}},{key:"onWorkerInitialized",value:function(){--this._workers_left,this._isReady()&&this.onReady()}},{key:"onReady",value:function(){}},{key:"_isReady",value:function(){return this._main_initialized&&!this._workers_left}},{key:"_onProviderUpdate",value:function(t){this._isReady()&&this.onProviderUpdate(t)}},{key:"onProviderUpdate",value:function(t){this.dispatchUpdate(void 0,t.data)}},{key:"dispatchUpdate",value:function(t,e){this._on_update(this.name,t,e)}},{key:"dispose",value:function(){fn.removeTarget(this.target_name),this.provider.removeEventListener("update",this._onProviderUpdate)}}]),e}(),Gn=function(t,e,i,r,n){var o,a,s=8*n-r-1,l=(1<<s)-1,u=l>>1,c=-7,h=i?n-1:0,f=i?-1:1,p=t[e+h];for(h+=f,o=p&(1<<-c)-1,p>>=-c,c+=s;0<c;o=256*o+t[e+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;0<c;a=256*a+t[e+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=u}return(p?-1:1)*a*Math.pow(2,o-r)},Hn=function(t,e,i,r,n,o){var a,s,l,u=8*o-n-1,c=(1<<u)-1,h=c>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),2<=(e+=1<=a+h?f/l:f*Math.pow(2,1-h))*l&&(a++,l/=2),c<=a+h?(s=0,a=c):1<=a+h?(s=(e*l-1)*Math.pow(2,n),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,n),a=0));8<=n;t[i+p]=255&s,p+=d,s/=256,n-=8);for(a=a<<n|s,u+=n;0<u;t[i+p]=255&a,p+=d,a/=256,u-=8);t[i+p-d]|=128*y},Vn=qn;function qn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}qn.Varint=0,qn.Fixed64=1,qn.Bytes=2,qn.Fixed32=5;var Wn=4294967296,Xn=1/Wn;function Yn(t){return t.type===qn.Bytes?t.readVarint()+t.pos:t.pos+1}function Kn(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Zn(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;t<=n;n--)i.buf[n+r]=i.buf[n]}function Qn(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function $n(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Jn(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function to(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function eo(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function io(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function ro(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function no(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function oo(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function ao(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function so(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function lo(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function uo(t){var e={};for(var i in t.layers){for(var r=t.layers[i],n=[],o=en.tile_scale/r.extent,a=0,s=r.length;a<s;a++){var l=r.feature(a),u=Kr.types[l.type],c=l.loadGeometry(o),h=null;switch(u){case"Point":h=function(t){var e=t.coordinates.length;if(1<e){t.type="MultiPoint";for(var i=[],r=0;r<e;r++)i.push(t.coordinates[r][0]);t.coordinates=i}else t.type="Point",t.coordinates=t.coordinates[0][0];return t}({coordinates:c});break;case"LineString":h=1===c.length?{type:u,coordinates:c[0]}:{type:"MultiLineString",coordinates:c};break;case"Polygon":h=fo({coordinates:c})}h&&h.coordinates&&n.push({type:"Feature",geometry:h,properties:l.properties})}e[i]={type:"FeatureCollection",features:n}}return e}qn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ao(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=lo(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ao(this.buf,this.pos)+ao(this.buf,this.pos+4)*Wn;return this.pos+=8,t},readSFixed64:function(){var t=ao(this.buf,this.pos)+lo(this.buf,this.pos+4)*Wn;return this.pos+=8,t},readFloat:function(){var t=Gn(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Gn(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,i=e[this.pos++],r=127&i;return i<128?r:(r|=(127&(i=e[this.pos++]))<<7,i<128?r:(r|=(127&(i=e[this.pos++]))<<14,i<128?r:(r|=(127&(i=e[this.pos++]))<<21,i<128?r:function(t,e,i){var r,n,o=i.buf;if(n=o[i.pos++],r=(112&n)>>4,n<128)return Kn(t,r,e);if(n=o[i.pos++],r|=(127&n)<<3,n<128)return Kn(t,r,e);if(n=o[i.pos++],r|=(127&n)<<10,n<128)return Kn(t,r,e);if(n=o[i.pos++],r|=(127&n)<<17,n<128)return Kn(t,r,e);if(n=o[i.pos++],r|=(127&n)<<24,n<128)return Kn(t,r,e);if(n=o[i.pos++],r|=(1&n)<<31,n<128)return Kn(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(i=e[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,i){var r,n,o,a="",s=e;for(;s<i;){var l=t[s],u=null,c=239<l?4:223<l?3:191<l?2:1;if(i<s+c)break;1===c?l<128&&(u=l):2===c?128==(192&(r=t[s+1]))&&(u=(31&l)<<6|63&r)<=127&&(u=null):3===c?(r=t[s+1],n=t[s+2],128==(192&r)&&128==(192&n)&&((u=(15&l)<<12|(63&r)<<6|63&n)<=2047||55296<=u&&u<=57343)&&(u=null)):4===c&&(r=t[s+1],n=t[s+2],o=t[s+3],128==(192&r)&&128==(192&n)&&128==(192&o)&&((u=(15&l)<<18|(63&r)<<12|(63&n)<<6|63&o)<=65535||1114112<=u)&&(u=null)),null===u?(u=65533,c=1):65535<u&&(u-=65536,a+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),a+=String.fromCharCode(u),s+=c}return a}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var i=Yn(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=Yn(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=Yn(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=Yn(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=Yn(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=Yn(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=Yn(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=Yn(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=Yn(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===qn.Varint)for(;127<this.buf[this.pos++];);else if(e===qn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===qn.Fixed32)this.pos+=4;else{if(e!==qn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e,i=this.length||16;i<this.pos+t;)i*=2;i!==this.length&&((e=new Uint8Array(i)).set(this.buf),this.buf=e,this.length=i)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),so(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),so(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),so(this.buf,-1&t,this.pos),so(this.buf,Math.floor(t*Xn),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),so(this.buf,-1&t,this.pos),so(this.buf,Math.floor(t*Xn),this.pos+4),this.pos+=8},writeVarint:function(t){268435455<(t=+t||0)||t<0?function(t,e){var i,r;0<=t?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:r=r+1|(i=0));if(0x10000000000000000<=t||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e){e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos]=127&t}(i,e),function(t,e){var i=(7&t)<<4;if(e.buf[e.pos++]|=i|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,o=0;o<e.length;o++){if(55295<(r=e.charCodeAt(o))&&r<57344){if(!n){56319<r||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;128<=i&&Zn(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Hn(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Hn(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;128<=r&&Zn(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,qn.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,Qn,e)},writePackedSVarint:function(t,e){this.writeMessage(t,$n,e)},writePackedBoolean:function(t,e){this.writeMessage(t,eo,e)},writePackedFloat:function(t,e){this.writeMessage(t,Jn,e)},writePackedDouble:function(t,e){this.writeMessage(t,to,e)},writePackedFixed32:function(t,e){this.writeMessage(t,io,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,ro,e)},writePackedFixed64:function(t,e){this.writeMessage(t,no,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,oo,e)},writeBytesField:function(t,e){this.writeTag(t,qn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,qn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,qn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,qn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,qn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,qn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,qn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,qn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,qn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,qn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}},Kr.prototype.loadGeometry=function(t){var e=this._pbf;e.pos=this._geometry;for(var i,r,n=e.readVarint()+e.pos,o=1,a=0,s=0,l=0,u=[];e.pos<n;){if(a<=0&&(o=7&(r=e.readVarint()),a=r>>3),a--,1===o||2===o)s+=e.readSVarint(),l+=e.readSVarint(),1===o&&(i&&u.push(i),i=[]),i.push([s*t,l*t]);else{if(7!==o)throw new Error("unknown command "+o);i&&i.push(i[0].slice())}}return i&&u.push(i),u};var co={UNKNOWN:0,POINT:1,LINESTRING:2,POLYGON:3};function ho(t){var e=[],i=t&&t.features;if(i)for(var r=0,n=i.length;r<n;r++){var o=i[r],a=o.type,s=void 0;switch(a){case co.POINT:s={type:"MultiPoint",coordinates:o.geometry.map(function(t){return t.slice()})};break;case co.LINESTRING:case co.POLYGON:if(s={type:"MultiLineString",coordinates:o.geometry.map(function(t){return t.map(function(t){return t.slice()})})},a===co.POLYGON&&null==(s=fo(s)))continue;break;default:continue}e.push({id:o.id,type:"Feature",geometry:s,properties:o.tags})}return{type:"FeatureCollection",features:e}}function fo(t){for(var e,i=[],r=[],n=0,o=t.coordinates.length;n<o;n++){var a=t.coordinates[n],s=en.ringWinding(a);null!=s&&(s===(e=e||s)&&r.length&&(i.push(r),r=[]),r.push(a))}return 0<r.length&&i.push(r),1===i.length?(t.type="Polygon",t.coordinates=i[0]):1<i.length?(t.type="MultiPolygon",t.coordinates=i):t=null,t}var po={type:"FeatureCollection",features:[]},yo=function(){Ar(e,Bn);var t=Or(e);function e(i,r){return _r(this,e),i.tiled=!0,t.call(this,i,r)}return br(e,[{key:"fetchTile",value:function(t,e,i){return this.provider?this.provider.requestTileAsPromise(t,e,i).then(function(t){return t.data}):Promise.resolve()}},{key:"_load",value:function(t){var e=this,i=en.wrapTile(t.coords,{x:!0,y:!0}),r=i.x,n=i.y,o=i.z;return fn.postMessage(this.target_name+".fetchTile",r,n,o).then(function(i){var r;return i instanceof ArrayBuffer?(r=new Vn(new Uint8Array(i)),t.source_data.layers=uo(new Yr(r))):i?t.source_data.error=i:t.source_data.layers={_default:po},e._postProcessTile(t),t})}},{key:"onReady",value:function(){this.dispatchUpdate()}}]),e}();zn.register(yo,"MVT"),zn.register(yo,"OMV");function go(t){return Math.max(t,0)}function vo(t){return isNaN(t)?0:t}function _o(t){return Array.isArray(t)?t.map(parseFloat).map(vo):vo(parseFloat(t))}function mo(t){return Array.isArray(t)?t.map(_o).map(go):go(_o(t))}var bo=a(function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:255<t?255:t}function n(t){return t<0?0:1<t?1:t}function o(t){return"%"===t[t.length-1]?r(parseFloat(t)/100*255):r(parseInt(t))}function a(t){return"%"===t[t.length-1]?n(parseFloat(t)/100):n(parseFloat(t))}function s(t,e,i){return i<0?i+=1:1<i&&--i,6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{e.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in i)return i[n].slice();if("#"===n[0])return 4===n.length?0<=(e=parseInt(n.substr(1),16))&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&0<=(e=parseInt(n.substr(1),16))&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=n.indexOf("("),u=n.indexOf(")");if(-1!==l&&u+1===n.length){var c=n.substr(0,l),h=n.substr(l+1,u-(l+1)).split(","),f=1;switch(c){case"rgba":if(4!==h.length)return null;f=a(h.pop());case"rgb":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),f];case"hsla":if(4!==h.length)return null;f=a(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,d=a(h[1]),y=a(h[2]),g=y<=.5?y*(d+1):y+d-y*d,v=2*y-g;return[r(255*s(v,g,p+1/3)),r(255*s(v,g,p)),r(255*s(v,g,p-1/3)),f];default:return null}}return null}}catch(t){}}),xo=(bo.parseCSSColor,{});Object.assign(xo,{clampPositive:go,noNaN:vo,parseNumber:_o,parsePositiveNumber:mo}),xo.wrapFunction=function(t){return"\n        var feature = context.feature.properties;\n        var global = context.global;\n        var $zoom = context.zoom;\n        var $layer = context.layer;\n        var $source = context.source;\n        var sources = context.sources;\n        var $geometry = context.geometry;\n        var $meters_per_pixel = context.meters_per_pixel;\n\n        var val = (function(){ ".concat(t," }());\n\n        if (typeof val === 'number' && isNaN(val)) {\n            val = null; // convert NaNs to nulls\n        }\n\n        return val;\n    ")},xo.zeroPair=Object.freeze([0,0]),xo.defaults={color:[1,1,1,1],width:1,size:1,extrude:!1,height:20,min_height:0,order:0,z:0,outline:{color:[0,0,0,0],width:0},material:{ambient:1,diffuse:1}},xo.macros={"Style.color.pseudoRandomColor":function(){return[parseInt(feature.id,16)/100%1*.7,parseInt(feature.id,16)/1e4%1*.7,parseInt(feature.id,16)/1e6%1*.7,1]},"Style.color.randomColor":function(){return[.7*Math.random(),.7*Math.random(),.7*Math.random(),1]}},xo.getFeatureParseContext=function(t,e,i,r){return{feature:t,tile:e,global:i,sources:r,zoom:e.style_zoom,geometry:en.geometryType(t.geometry.type),meters_per_pixel:e.meters_per_pixel,meters_per_pixel_sq:e.meters_per_pixel_sq,units_per_meter_overzoom:e.units_per_meter_overzoom}};var wo={STATIC:0,DYNAMIC:1,ZOOM:2};xo.CACHE_TYPE=wo,xo.createPropertyCache=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(null!=t){if(t.value)return{value:t.value,zoom:t.zoom?{}:null,type:t.type};var i={value:t,type:wo.STATIC};return Array.isArray(i.value)&&Array.isArray(i.value[0])?(i.zoom={},i.type=wo.ZOOM):"function"==typeof i.value&&(i.type=wo.DYNAMIC),"function"==typeof e&&(i.zoom?i.value=i.value.map(function(t,i){return[t[0],e(t[1],i)]}):"function"!=typeof i.value&&(i.value=e(i.value,0))),i}},xo.createColorPropertyCache=function(t){return xo.createPropertyCache(t,function(t){return"Style.color.pseudoRandomColor"===t?Sn.stringToFunction(xo.wrapFunction(xo.macros["Style.color.pseudoRandomColor"])):"Style.color.randomColor"===t?xo.macros["Style.color.randomColor"]:t})};function ko(t){return"string"==typeof t&&"%"===t[t.length-1]}function Ao(t){return"auto"===t}function To(t){return ko(t)||Ao(t)}var Eo="'size' can specify either width or height as derived from aspect ratio, but not both";xo.createPointSizePropertyCache=function(t){var e=null,i=null;if(ko(t))e=[!0];else if(Array.isArray(t))if(Array.isArray(t[0])){if(t.some(function(t){return Array.isArray(t[1])?t[1].some(To):ko(t[1])})&&(e=t.map(function(t){return Array.isArray(t[1])?t[1].map(ko):ko(t[1])}),(i=t.map(function(t){return Array.isArray(t[1])&&t[1].map(Ao)})).some(function(t){return Array.isArray(t)&&t.every(function(t){return t})})))throw Eo}else if(t.some(To)&&(e=[t.map(ko)],(i=[t.map(Ao)])[0].every(function(t){return t})))throw Eo;return e?((t={value:t}).has_pct=e,t.has_ratio=i,t.sprites={}):t=xo.createPropertyCache(t,mo),t},xo.evalCachedPointSizeProperty=function(t,e,i){return t.has_pct||t.has_ratio?e?(t.sprites[e.sprite]||(t.sprites[e.sprite]=xo.createPropertyCache(t.value,function(i,r){return Array.isArray(i)?(i=i.map(function(e,i){return t.has_ratio[r][i]?e:mo(e)}).map(function(i,n){return t.has_pct[r][n]?e.css_size[n]*i/100:i}),t.has_ratio[r][0]?i[0]=i[1]*e.aspect:t.has_ratio[r][1]&&(i[1]=i[0]/e.aspect)):(i=mo(i),i=t.has_pct[r]?e.css_size.map(function(t){return t*i/100}):[i,i]),i})),xo.evalCachedProperty(t.sprites[e.sprite],i)):void 0:xo.evalCachedProperty(t,i)},xo.evalCachedProperty=function(t,e){if(null!=t)return t.dynamic?t.dynamic(e):t.static?t.static:t.zoom&&t.zoom[e.zoom]?t.zoom[e.zoom]:"function"!=typeof t.value?Array.isArray(t.value)&&Array.isArray(t.value[0])?(t.zoom=t.zoom||{},t.zoom[e.zoom]=Sn.interpolate(e.zoom,t.value),t.zoom[e.zoom]):(t.static=t.value,t.static):(t.dynamic=t.value,t.dynamic(e))},xo.convertUnits=function(t,e){if(null!=t.val)return"px"===t.units?t.val*en.metersPerPixel(e.zoom):t.val;if("string"==typeof t)"px"===t.trim().slice(-2)?(t=_o(t),t*=en.metersPerPixel(e.zoom)):t=_o(t);else if(Array.isArray(t))return Array.isArray(t[0])?t.map(function(t){return[t[0],xo.convertUnits(t[1],e)]}):t.map(function(t){return xo.convertUnits(t,e)});return t},xo.parseUnits=function(t){var e={val:_o(t)};return 0!==e.val&&"string"==typeof t&&"px"===t.trim().slice(-2)&&(e.units="px"),e},xo.evalCachedDistanceProperty=function(t,e){return t.dynamic?t.dynamic(e):t.zoom&&t.zoom[e.zoom]?t.zoom[e.zoom]:"function"!=typeof t.value?t.zoom?(t.zoom[e.zoom]=Sn.interpolate(e.zoom,t.value,function(t){return xo.convertUnits(t,e)}),t.zoom[e.zoom]):xo.convertUnits(t.value,e):(t.dynamic=t.value,t.dynamic(e))},xo.string_colors={},xo.colorForString=function(t){if(xo.string_colors[t])return xo.string_colors[t];var e=null;return"none"!==t&&((e=bo.parseCSSColor(t))&&4===e.length?(e[0]/=255,e[1]/=255,e[2]/=255):e=xo.defaults.color),xo.string_colors[t]=e},xo.evalCachedColorProperty=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(t.dynamic){var i=t.dynamic(e);return"string"==typeof i&&(i=xo.colorForString(i)),i&&null==i[3]&&(i[3]=1),i}if(t.static)return t.static;if(t.zoom&&t.zoom[e.zoom])return t.zoom[e.zoom];if("function"==typeof t.value){t.dynamic=t.value;var r=t.dynamic(e);return"string"==typeof r&&(r=xo.colorForString(r)),r&&null==r[3]&&(r[3]=1),r}if("string"==typeof t.value)return t.static=xo.colorForString(t.value),t.static;if(t.zoom){if(!t.zoom_preprocessed){for(var n=0;n<t.value.length;n++){var o=t.value[n];o&&"string"==typeof o[1]&&(o[1]=xo.colorForString(o[1]))}t.zoom_preprocessed=!0}return t.zoom[e.zoom]=Sn.interpolate(e.zoom,t.value),t.zoom[e.zoom][3]=t.zoom[e.zoom][3]||1,t.zoom[e.zoom]}return t.static=t.value.map(function(t){return t}),t.static&&null==t.static[3]&&(t.static[3]=1),t.static},xo.parseColor=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("function"==typeof t&&(t=t(e)),"string"==typeof t)t=xo.colorForString(t);else if(Array.isArray(t)&&Array.isArray(t[0])){for(var i=0;i<t.length;i++){var r=t[i];"string"==typeof r[1]&&(r[1]=xo.colorForString(r[1]))}e.zoom&&(t=Sn.interpolate(e.zoom,t))}return Array.isArray(t)?null==(t=t.map(function(t){return t}))[3]&&(t[3]=1):t=[0,0,0,1],t},xo.calculateOrder=function(t,e){return"function"==typeof t?t=t(e):"string"==typeof t&&(t=e.feature.properties[t]?e.feature.properties[t]:mo(t)),t},xo.evalProperty=function(t,e){return"function"==typeof t?t(e):t};var Mo=function(){function t(e,i){_r(this,t),this.key=e,this.repeat_dist=i,this.repeat_dist_sq=this.repeat_dist*this.repeat_dist,this.positions=[]}return br(t,[{key:"check",value:function(t){for(var e=t.position,i=0;i<this.positions.length;i++){var r=this.positions[i],n=e[0]-r[0],o=e[1]-r[1],a=n*n+o*o;if(a<this.repeat_dist_sq)return{dist_sq:a,repeat_dist_sq:this.repeat_dist_sq}}}},{key:"add",value:function(t){t&&t.position&&this.positions.push(t.position)}}],[{key:"clear",value:function(t){this.groups[t]={}}},{key:"check",value:function(t,e,i){if(e.repeat_distance&&e.repeat_group&&this.groups[i][e.repeat_group])return this.groups[i][e.repeat_group].check(t)}},{key:"add",value:function(e,i,r){i.repeat_distance&&i.repeat_group&&(null==this.groups[r][i.repeat_group]&&(this.groups[r][i.repeat_group]=new t(i.repeat_group,i.repeat_distance*i.repeat_scale)),this.groups[r][i.repeat_group].add(e))}}]),t}();Mo.groups={};var So=function(){function t(e,i,r){_r(this,t);var n=this.boxCells=[],o=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(i/r);for(var a=0;a<this.xCellCount*this.yCellCount;a++)n.push([]),o.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}return br(t,[{key:"keysLength",value:function(){return this.boxKeys.length+this.circleKeys.length}},{key:"insert",value:function(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}},{key:"insertCircle",value:function(t,e,i,r){this._forEachCell(e-r,i-r,e+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(r)}},{key:"insertCircleList",value:function(t,e){for(var i=0;i<e.length-2;i+=3)this.insertCircle("".concat(t,"/").concat(i),e[i],e[i+1],e[i+2])}},{key:"_insertBoxCell",value:function(t,e,i,r,n,o){this.boxCells[n].push(o)}},{key:"_insertCircleCell",value:function(t,e,i,r,n,o){this.circleCells[n].push(o)}},{key:"_query",value:function(t,e,i,r,n,o){if(i<0||t>this.width||r<0||e>this.height)return!n&&[];var a=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var u=this.circles[3*l],c=this.circles[3*l+1],h=this.circles[3*l+2];a.push({key:this.circleKeys[l],x1:u-h,y1:c-h,x2:u+h,y2:c+h})}return o?a.filter(o):a}var f={hitTest:n,seenUids:{box:{},circle:{}}};return this._forEachCell(t,e,i,r,this._queryCell,a,f,o),n?0<a.length:a}},{key:"_queryCircle",value:function(t,e,i,r,n){var o=t-i,a=t+i,s=e-i,l=e+i;if(a<0||o>this.width||l<0||s>this.height)return!r&&[];var u=[],c={hitTest:r,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}};return this._forEachCell(o,s,a,l,this._queryCellCircle,u,c,n),r?0<u.length:u}},{key:"query",value:function(t,e,i,r,n){return this._query(t,e,i,r,!1,n)}},{key:"hitTest",value:function(t,e,i,r,n){return this._query(t,e,i,r,!0,n)}},{key:"hitTestCircle",value:function(t,e,i,r){return this._queryCircle(t,e,i,!0,r)}},{key:"hitTestCircleList",value:function(t,e){for(var i=0;i<t.length-2;i+=3)if(this.hitTestCircle(t[i],t[i+1],t[i+2],e))return!0;return!1}},{key:"_queryCell",value:function(t,e,i,r,n,o,a,s){var l=a.seenUids,u=this.boxCells[n];if(null!==u){var c,h=this.bboxes,f=zr(u);try{for(f.s();!(c=f.n()).done;){var p=c.value;if(!l.box[p]){l.box[p]=!0;var d=4*p;if(t<=h[2+d]&&e<=h[3+d]&&i>=h[0+d]&&r>=h[1+d]&&(!s||s(this.boxKeys[p]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[p],x1:h[d],y1:h[1+d],x2:h[2+d],y2:h[3+d]})}}}}catch(t){f.e(t)}finally{f.f()}}var y=this.circleCells[n];if(null!==y){var g,v=this.circles,_=zr(y);try{for(_.s();!(g=_.n()).done;){var m=g.value;if(!l.circle[m]){l.circle[m]=!0;var b=3*m;if(this._circleAndRectCollide(v[b],v[1+b],v[2+b],t,e,i,r)&&(!s||s(this.circleKeys[m]))){if(a.hitTest)return o.push(!0),!0;var x=v[b],w=v[1+b],k=v[2+b];o.push({key:this.circleKeys[m],x1:x-k,y1:w-k,x2:x+k,y2:w+k})}}}}catch(t){_.e(t)}finally{_.f()}}}},{key:"_queryCellCircle",value:function(t,e,i,r,n,o,a,s){var l=a.circle,u=a.seenUids,c=this.boxCells[n];if(null!==c){var h,f=this.bboxes,p=zr(c);try{for(p.s();!(h=p.n()).done;){var d=h.value;if(!u.box[d]){u.box[d]=!0;var y=4*d;if(this._circleAndRectCollide(l.x,l.y,l.radius,f[0+y],f[1+y],f[2+y],f[3+y])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}}catch(t){p.e(t)}finally{p.f()}}var g=this.circleCells[n];if(null!==g){var v,_=this.circles,m=zr(g);try{for(m.s();!(v=m.n()).done;){var b=v.value;if(!u.circle[b]){u.circle[b]=!0;var x=3*b;if(this._circlesCollide(_[x],_[1+x],_[2+x],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[b])))return o.push(!0),!0}}}catch(t){m.e(t)}finally{m.f()}}}},{key:"_forEachCell",value:function(t,e,i,r,n,o,a,s){for(var l=this._convertToXCellCoord(t),u=this._convertToYCellCoord(e),c=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r),f=l;f<=c;f++)for(var p=u;p<=h;p++){var d=this.xCellCount*p+f;if(n.call(this,t,e,i,r,d,o,a,s))return}}},{key:"_convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"_convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}},{key:"_circlesCollide",value:function(t,e,i,r,n,o){var a=r-t,s=n-e,l=i+o;return a*a+s*s<l*l}},{key:"_circleAndRectCollide",value:function(t,e,i,r,n,o,a){var s=(o-r)/2,l=Math.abs(t-(r+s));if(s+i<l)return!1;var u=(a-n)/2,c=Math.abs(e-(n+u));if(u+i<c)return!1;if(l<=s||c<=u)return!0;var h=l-s,f=c-u;return h*h+f*f<=i*i}}]),t}(),Ro=function(t,e,i,r){var n;if(r&&(n=function(t){return t!==r.id}),!e){if("point"===t.type&&!t.angle){var o=t.getAABB(),a=o.left,s=o.top,l=o.right,u=o.bottom;if(i.hitTest(a,-s,l,-u,n)){if(Array.isArray(t.layout.anchor))for(var c=1;c<t.layout.anchor.length;c++){t.setAnchor(t.layout.anchor[c]);var h=t.getAABB(),f=h.left,p=h.top,d=h.right,y=h.bottom;if(!i.hitTest(f,-p,d,-y,n))return!1}return!0}return!1}var g=t.getBoundingCircles();return i.hitTestCircleList(g,n)}if(e){if("point"===t.type&&!t.isFlat()){var v=t.getScreenSpaceBoundingBox(),_=v.left,m=v.top,b=v.right,x=v.bottom;return i.hitTest(_,m,b,x,n)}var w=t.getBoundingCircles();return i.hitTestCircleList(w,n)}return!1},Po=function(t,e,i){var r,n,o,a,s,l,u,c,h,f,p,d,y=t.id;t.placed=!0,e||("point"!==t.type||t.angle?(r=t.getBoundingCircles(),i.insertCircleList(y,r)):(o=(n=t.getAABB()).left,a=n.top,s=n.right,l=n.bottom,i.insert(y,o,-a,s,-l))),e&&("point"!==t.type||t.isFlat()?(u=t.getBoundingCircles(),i.insertCircleList(y,u)):(h=(c=t.getScreenSpaceBoundingBox()).left,f=c.top,p=c.right,d=c.bottom,i.insert(y,h,f,p,d)))},Oo={tiles:{},startTile:function(t,e){var i=1<arguments.length&&void 0!==e?e:{},r=i.apply_repeat_groups,n=void 0===r||r,o=i.return_hidden,a=void 0!==o&&o,s=i.grid_index,l=void 0===s?null:s,u=this.tiles[t]={grid_index:l||new So(en.tile_scale,en.tile_scale,240),objects:{},labels:{},styles:{},repeat:n,return_hidden:a};null==u.complete&&(u.complete=new Promise(function(t,e){u.resolve=t,u.reject=e}))},resetTile:function(t){delete this.tiles[t]},abortTile:function(t){this.tiles[t]&&this.tiles[t].resolve&&this.tiles[t].resolve([]),this.resetTile(t)},addStyle:function(t,e){this.tiles[e].styles[t]=!0},collide:function(t,e,i){var r=this.tiles[i];if(!r)return Promise.resolve([]);for(var n=r.objects,o=0;o<t.length;o++){var a=t[o],s=a.label.layout.priority;n[s]=n[s]||{},n[s][e]=n[s][e]||[],n[s][e].push(a)}return delete r.styles[e],0===Object.keys(r.styles).length&&this.endTile(i),r.complete.then(function(){return r.resolve=null,r.labels[e]||[]})},endTile:function(t){var e=this.tiles[t],i=e.labels;e.repeat&&Mo.clear(t);for(var r=Object.keys(e.objects).sort(function(t,e){return t-e}),n=0;n<r.length;n++){var o=e.objects[r[n]];if(o)for(var a in o){var s=o[a];i[a]=i[a]||[];for(var l=0;l<s.length;l++){var u=s[l];this.canBePlaced(u,t,u.linked,e)?u.linked?this.canBePlaced(u.linked,t,u,e)?(u.show=!0,(u.label.breach||u.linked.label.breach)&&(u.label.breach=!0,u.linked.label.breach=!0),i[a].push(u),this.place(u,t,e),this.place(u.linked,t,e)):e.return_hidden&&(u.show=!1,i[a].push(u)):(u.show=!0,i[a].push(u),this.place(u,t,e)):e.return_hidden&&(u.show=!1,i[a].push(u))}}}delete this.tiles[t],e.resolve()},canBePlaced:function(t,e,i,r){var n=2<arguments.length&&void 0!==i?i:null,o=(3<arguments.length&&void 0!==r?r:{}).repeat,a=void 0===o||o,s=t.label,l=t.label.layout;if(null!==s.placed)return s.placed;var u=this.tiles[e].grid_index;if(l.collide&&Ro(s,"main"===e,u,n&&n.label))l.collide&&(s.placed=!1);else{if(!(a&&Mo.check(s,l,e)))return!0;s.placed=!1}return s.placed},place:function(t,e,i){var r=t.label,n=i.repeat,o=void 0===n||n;null===r.placed&&(o&&Mo.add(r,r.layout,e),Po(r,"main"===e,this.tiles[e].grid_index))}},Co={id:0,queue:[],max_time:20,start_time:null,state:{},add:function(t){t.id=Co.id++,t.max_time=t.max_time||Co.max_time,t.pause_factor=t.pause_factor||1;var e=new Promise(function(e,i){t.resolve=e,t.reject=i});return t.promise=e,t.total_elapsed=0,t.stats={calls:0},this.queue.push(t),this.start_time=this.start_time||performance.now(),this.elapsed=performance.now()-this.start_time,this.elapsed<Co.max_time&&this.process(t),t.promise},remove:function(t){var e=this.queue.indexOf(t);-1<e&&this.queue.splice(e,1)},process:function(t){if(!this.state.user_moving_view||!1!==t.user_moving_view)return t.pause?(t.pause--,!0):(t.stats.calls++,t.start_time=performance.now(),t.run(t))},processAll:function(){this.start_time=this.start_time||performance.now();for(var t=0;t<this.queue.length;t++){var e=this.queue[t];if(!0!==this.process(e)&&(e.pause||(e.pause=e.elapsed>e.max_time?e.pause_factor:0),e.total_elapsed+=e.elapsed),this.elapsed=performance.now()-this.start_time,this.elapsed>=Co.max_time){this.start_time=null;break}}},finish:function(t,e){return t.elapsed=performance.now()-t.start_time,t.total_elapsed+=t.elapsed,this.remove(t),t.resolve(e),t.promise},cancel:function(t){var e;t.cancel instanceof Function&&(e=t.cancel(t)),t.resolve(e||{})},shouldContinue:function(t){return t.elapsed=performance.now()-t.start_time,this.elapsed=performance.now()-this.start_time,t.elapsed<t.max_time&&this.elapsed<Co.max_time},removeForTile:function(t){for(var e=this.queue.length-1;0<=e;e--)this.queue[e].tile_id===t&&(this.cancel(this.queue[e]),this.queue.splice(e,1))},setState:function(t){this.state=t},hasPendingTasks:function(){return!!this.queue.length}};function Lo(t){return{coords:t.coords,uid:t.uid,filtering:t.filtering,sprites:t.sprites,url:t.url,element:t.element,data:t.data,width:t.width,height:t.height,density:t.density,repeat:t.repeat,TEXTURE_WRAP_S:t.TEXTURE_WRAP_S,TEXTURE_WRAP_T:t.TEXTURE_WRAP_T,UNPACK_FLIP_Y_WEBGL:t.UNPACK_FLIP_Y_WEBGL,UNPACK_PREMULTIPLY_ALPHA_WEBGL:t.UNPACK_PREMULTIPLY_ALPHA_WEBGL}}var Io=function(){function t(e,i,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};_r(this,t),n=Lo(n),this.gl=e,this.texture=e.createTexture(),this.texture&&(this.valid=!0),this.manager=r,this.bind(),this.name=i,this.retain_count=0,this.config_type=null,this.loading=null,this.loaded=!1,this.filtering=n.filtering,this.density=n.density||1,this.sprites=n.sprites,this.texcoords={},this.sizes={},this.css_sizes={},this.aspects={},this._byte_length=0,this.setData(1,1,new Uint8Array([0,0,0,0]),{filtering:"nearest"}),this.loaded=!1,this.manager.textures[this.name]&&(this.retain_count=this.manager.textures[this.name].retain_count,this.manager.textures[this.name].retain_count=0,this.manager.textures[this.name].destroy()),(this.manager.textures[this.name]=this).manager.texture_configs[this.name]=JSON.stringify(Object.assign({name:i},n)),this.load(n),En("trace","creating Texture ".concat(this.name))}return br(t,[{key:"destroy",value:function(t){var e=(0<arguments.length&&void 0!==t?t:{}).force;0<this.retain_count&&!e?En("error","Texture '".concat(this.name,"': destroying texture with retain count of '").concat(this.retain_count,"'")):this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,delete this.manager.textures[this.name],delete this.manager.texture_configs[this.name],this.valid=!1,this._byte_length=0,En("trace","destroying Texture ".concat(this.name)))}},{key:"retain",value:function(){this.retain_count++}},{key:"release",value:function(){this.retain_count<=0&&En("error","Texture '".concat(this.name,"': releasing texture with retain count of '").concat(this.retain_count,"'")),this.retain_count--,this.retain_count<=0&&this.destroy()}},{key:"bind",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;this.valid&&(this.manager.activeUnit!==e&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.manager.activeUnit=e,this.manager.boundTexture=null),this.manager.boundTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.manager.boundTexture=this.texture))}},{key:"load",value:function(t){var e=this;return t?(this.loading=null,"string"==typeof t.url?(this.config_type="url",this.setUrl(t.url,t)):t.element?(this.config_type="element",this.setElement(t.element,t)):t.data&&t.width&&t.height&&(this.config_type="data",this.setData(t.width,t.height,t.data,t)),this.loading=this.loading&&this.loading.then(function(){return e.calculateSprites(),e})||Promise.resolve(this),this.loading):this.loading||Promise.resolve(this)}},{key:"setUrl",value:function(t,e){var i=this,r=1<arguments.length&&void 0!==e?e:{};if(this.valid)return this.url=t,this.loading=new Promise(function(t,e){var n=new Image;n.onload=function(){try{i.setElement(n,r)}catch(t){i.loaded=!1,En("warn","Texture '".concat(i.name,"': failed to load url: '").concat(i.url,"'"),t,r),i.manager.trigger("warning",{message:"Failed to load texture from ".concat(i.url),error:t,texture:r})}i.loaded=!0,t(i)},n.onerror=function(e){i.loaded=!1,En("warn","Texture '".concat(i.name,"': failed to load url: '").concat(i.url,"'"),e,r),i.manager.trigger("warning",{message:"Failed to load texture from ".concat(i.url),error:e,texture:r}),t(i)},Sn.isSafari()&&"data:"===i.url.slice(0,5)||(n.crossOrigin="anonymous"),n.src=i.url}),this.loading}},{key:"setData",value:function(t,e,i,r){var n=3<arguments.length&&void 0!==r?r:{};return this.width=t,this.height=e,Array.isArray(i)&&(i=new Uint8Array(i)),this.update(i,n),this.setFiltering(n),this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(t,e){var i,r=t;return"string"==typeof t&&(t=document.querySelector(t)),t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement?(this.update(t,e),this.setFiltering(e)):(this.loaded=!1,i="the 'element' parameter (`element: ".concat(JSON.stringify(r),"`) must be a CSS "),i+="selector string, or a <canvas>, <image> or <video> object",En("warn","Texture '".concat(this.name,"': ").concat(i),e),this.manager.trigger("warning",{message:"Failed to load texture because ".concat(i),texture:e})),this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(t,e){var i=1<arguments.length&&void 0!==e?e:{};this.valid&&(this.bind(),t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof HTMLImageElement&&t.complete?(this.width=t.width,this.height=t.height,this._byte_length=this.width*this.height*4,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==i.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t)):(this._byte_length=t?t.byteLength:0,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t)),this.manager.trigger("update",this))}},{key:"getByteLength",value:function(){return this._byte_length}},{key:"setFiltering",value:function(t){var e,i=0<arguments.length&&void 0!==t?t:{};this.valid&&(i.filtering=i.filtering||"linear",e=this.gl,this.bind(),Sn.isPowerOf2(this.width)&&Sn.isPowerOf2(this.height)?(this.power_of_2=!0,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i.TEXTURE_WRAP_S||i.repeat&&e.REPEAT||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,i.TEXTURE_WRAP_T||i.repeat&&e.REPEAT||e.CLAMP_TO_EDGE),"mipmap"===i.filtering?(this.filtering="mipmap",e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D)):"linear"===i.filtering?(this.filtering="linear",e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):"nearest"===i.filtering&&(this.filtering="nearest",e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST))):(this.power_of_2=!1,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),"nearest"===i.filtering?(this.filtering="nearest",e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)):(this.filtering="linear",e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR))),this.manager.trigger("update",this))}},{key:"calculateSprites",value:function(){if(this.sprites)for(var t in this.sprites){var e=this.sprites[t];this.texcoords[t]=this.manager.getTexcoordsForSprite([e[0],e[1]],[e[2],e[3]],[this.width,this.height]),this.sizes[t]=[e[2],e[3]],this.css_sizes[t]=[e[2]/this.density,e[3]/this.density],this.aspects[t]=e[2]/e[3]}}}]),t}();function jo(t){var e=[];return Object.assign(t,{subscribe:function(t){-1===e.indexOf(t)&&e.push(t)},unsubscribe:function(t){var i=e.indexOf(t);-1<i&&e.splice(i,1)},unsubscribeAll:function(){e=[]},trigger:function(t){for(var i=arguments.length,r=new Array(1<i?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];e.forEach(function(e){if("function"==typeof e[t])try{e[t].apply(e,r)}catch(e){En("warn","Caught exception in listener for event '".concat(t,"':"),e)}})},hasSubscribersFor:function(t){var i=!1;return e.forEach(function(e){"function"==typeof e[t]&&(i=!0)}),i}})}var No=function(){function t(e){_r(this,t),this.default=t.DEFAULT_TEXTURE_NAME,this.textures={},this.texture_configs={},this.boundTexture=null,this.activeUnit=null,this.scene_id=e,fn.addTarget("Texture"+this.scene_id,this),jo(this)}return br(t,[{key:"create",value:function(e,i,r){for(var n=t.matchers_,o=0;o<n.length;o++){var a=n[o][0],s=n[o][1];if(s&&s(r))return new a(e,i,this,r)}return new Io(e,i,this,r)}},{key:"retain",value:function(t){this.textures[t]&&this.textures[t].retain()}},{key:"release",value:function(t){this.textures[t]&&this.textures[t].release()}},{key:"getRetainCount",value:function(t){if(this.textures[t])return this.textures[t].retain_count}},{key:"getByteLength",value:function(t){if(this.textures[t])return this.textures[t].getByteLength()}},{key:"destroy",value:function(t){var e=this;Object.keys(this.textures).forEach(function(i){var r=e.textures[i];i!==e.default&&r.gl===t&&r.destroy({force:!0})})}},{key:"getSpriteInfo",value:function(t,e){var i=this.textures[t];return i&&{size:i.sizes[e],css_size:i.css_sizes[e],aspect:i.aspects[e],texcoords:i.texcoords[e]}}},{key:"getTexcoordsForSprite",value:function(t,e,i){var r=i[1]-t[1]-e[1];return[t[0]/i[0],r/i[1],(e[0]+t[0])/i[0],(e[1]+r)/i[1]]}},{key:"createFromObject",value:function(t,e){var i=[];if(e)for(var r in e){var n,o=e[r];this.changed(r,o)&&(n=this.create(t,r,o),i.push(n.loading))}return Promise.all(i)}},{key:"createDefault",value:function(t){return this.create(t,this.default)}},{key:"changed",value:function(t,e){var i=this.textures[t];if(i){if("element"===i.config_type||null!=e.element)return!0;if(e=Lo(e),this.texture_configs[t]===JSON.stringify(Object.assign({name:t},e)))return!1}return!0}},{key:"getInfo",value:function(t){var e=this;if(t=t||Object.keys(this.textures),Array.isArray(t))return Promise.all(t.map(function(t){return e.getInfo(t)}));var i=this.textures[t];return i?(i.loading||Promise.resolve(i)).then(function(){return{name:i.name,width:i.width,height:i.height,density:i.density,sprites:i.sprites,texcoords:i.texcoords,sizes:i.sizes,css_sizes:i.css_sizes,aspects:i.aspects,filtering:i.filtering,power_of_2:i.power_of_2,valid:i.valid}}):Promise.resolve(null)}},{key:"syncTexturesToWorker",value:function(t){var e=this;return hn.is_main?Promise.all(t.map(function(t){var i=e.textures[t];return i&&i.loading||Promise.resolve()})).then(function(){return e.textures}):fn.postMessage("Texture"+this.scene_id+".getInfo",t).then(function(t){return t.forEach(function(t){e.textures[t.name]=t}),e.textures})}},{key:"getMaxTextureSize",value:function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)}}],[{key:"register",value:function(e,i){var r=t.matchers_;if(!(e instanceof Function&&i instanceof Function))throw"Invalid texture constructor or matcher";this.deRegister(e),r.push([e,i])}},{key:"deRegister",value:function(e){for(var i=t.matchers_,r=0;r<i.length;r++)i[r][0]===e&&i.splice(r,1)}}]),t}();No.DEFAULT_TEXTURE_NAME="__default",No.matchers_=[];var zo={};function Do(t){return zo[t]||(zo[t]=new No(t)),zo[t]}var Fo=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t};var Uo={fromValues:function(t,e,i){var r=new Float64Array(3);return r[0]=t,r[1]=e,r[2]=i,r},transformMat4:function(t,e,i){var r=e[0],n=e[1],o=e[2],a=i[3]*r+i[7]*n+i[11]*o+i[15];return a=a||1,t[0]=(i[0]*r+i[4]*n+i[8]*o+i[12])/a,t[1]=(i[1]*r+i[5]*n+i[9]*o+i[13])/a,t[2]=(i[2]*r+i[6]*n+i[10]*o+i[14])/a,t}},Bo={normalFromMat4:function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],f=e[10],p=e[11],d=e[12],y=e[13],g=e[14],v=e[15],_=i*s-r*a,m=i*l-n*a,b=i*u-o*a,x=r*l-n*s,w=r*u-o*s,k=n*u-o*l,A=c*y-h*d,T=c*g-f*d,E=c*v-p*d,M=h*g-f*y,S=h*v-p*y,R=f*v-p*g,P=_*R-m*S+b*M+x*E-w*T+k*A;return P?(P=1/P,t[0]=(s*R-l*S+u*M)*P,t[1]=(l*E-a*R-u*T)*P,t[2]=(a*S-s*E+u*A)*P,t[3]=(n*S-r*R-o*M)*P,t[4]=(i*R-n*E+o*T)*P,t[5]=(r*E-i*S-o*A)*P,t[6]=(y*k-g*w+v*x)*P,t[7]=(g*b-d*k-v*m)*P,t[8]=(d*w-y*b+v*_)*P,t):null},invert:function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=c*a-s*u,f=-c*o+s*l,p=u*o-a*l,d=i*h+r*f+n*p;return d?(d=1/d,t[0]=h*d,t[1]=(-c*r+n*u)*d,t[2]=(s*r-n*a)*d,t[3]=f*d,t[4]=(c*i-n*l)*d,t[5]=(-s*i+n*o)*d,t[6]=p*d,t[7]=(-u*i+r*l)*d,t[8]=(a*i-r*o)*d,t):null},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}},Go={multiply:function(t,e,i){var r=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],f=e[9],p=e[10],d=e[11],y=e[12],g=e[13],v=e[14],_=e[15],m=i[0],b=i[1],x=i[2],w=i[3];return t[0]=m*r+b*s+x*h+w*y,t[1]=m*n+b*l+x*f+w*g,t[2]=m*o+b*u+x*p+w*v,t[3]=m*a+b*c+x*d+w*_,m=i[4],b=i[5],x=i[6],w=i[7],t[4]=m*r+b*s+x*h+w*y,t[5]=m*n+b*l+x*f+w*g,t[6]=m*o+b*u+x*p+w*v,t[7]=m*a+b*c+x*d+w*_,m=i[8],b=i[9],x=i[10],w=i[11],t[8]=m*r+b*s+x*h+w*y,t[9]=m*n+b*l+x*f+w*g,t[10]=m*o+b*u+x*p+w*v,t[11]=m*a+b*c+x*d+w*_,m=i[12],b=i[13],x=i[14],w=i[15],t[12]=m*r+b*s+x*h+w*y,t[13]=m*n+b*l+x*f+w*g,t[14]=m*o+b*u+x*p+w*v,t[15]=m*a+b*c+x*d+w*_,t},translate:function(t,e,i){var r,n,o,a,s,l,u,c,h,f,p,d,y=i[0],g=i[1],v=i[2];e===t?(t[12]=e[0]*y+e[4]*g+e[8]*v+e[12],t[13]=e[1]*y+e[5]*g+e[9]*v+e[13],t[14]=e[2]*y+e[6]*g+e[10]*v+e[14],t[15]=e[3]*y+e[7]*g+e[11]*v+e[15]):(r=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],f=e[9],p=e[10],d=e[11],t[0]=r,t[1]=n,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=f,t[10]=p,t[11]=d,t[12]=r*y+s*g+h*v+e[12],t[13]=n*y+l*g+f*v+e[13],t[14]=o*y+u*g+p*v+e[14],t[15]=a*y+c*g+d*v+e[15]);return t},scale:function(t,e,i){var r=i[0],n=i[1],o=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},perspective:function(t,e,i,r,n){var o=1/Math.tan(e/2),a=1/(r-n);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*r*a,t[15]=0,t},lookAt:function(t,e,i,r){var n,o,a,s,l,u,c,h,f,p,d=e[0],y=e[1],g=e[2],v=r[0],_=r[1],m=r[2],b=i[0],x=i[1],w=i[2];if(Math.abs(d-b)<1e-6&&Math.abs(y-x)<1e-6&&Math.abs(g-w)<1e-6)return Fo(t);c=d-b,h=y-x,f=g-w,p=1/Math.sqrt(c*c+h*h+f*f),n=_*(f*=p)-m*(h*=p),o=m*(c*=p)-v*f,a=v*h-_*c,(p=Math.sqrt(n*n+o*o+a*a))?(n*=p=1/p,o*=p,a*=p):a=o=n=0;s=h*a-f*o,l=f*n-c*a,u=c*o-h*n,(p=Math.sqrt(s*s+l*l+u*u))?(s*=p=1/p,l*=p,u*=p):u=l=s=0;return t[0]=n,t[1]=s,t[2]=c,t[3]=0,t[4]=o,t[5]=l,t[6]=h,t[7]=0,t[8]=a,t[9]=u,t[10]=f,t[11]=0,t[12]=-(n*d+o*y+a*g),t[13]=-(s*d+l*y+u*g),t[14]=-(c*d+h*y+f*g),t[15]=1,t},identity:Fo,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},invert:function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],f=e[10],p=e[11],d=e[12],y=e[13],g=e[14],v=e[15],_=i*s-r*a,m=i*l-n*a,b=i*u-o*a,x=r*l-n*s,w=r*u-o*s,k=n*u-o*l,A=c*y-h*d,T=c*g-f*d,E=c*v-p*d,M=h*g-f*y,S=h*v-p*y,R=f*v-p*g,P=_*R-m*S+b*M+x*E-w*T+k*A;return P?(P=1/P,t[0]=(s*R-l*S+u*M)*P,t[1]=(n*S-r*R-o*M)*P,t[2]=(y*k-g*w+v*x)*P,t[3]=(f*w-h*k-p*x)*P,t[4]=(l*E-a*R-u*T)*P,t[5]=(i*R-n*E+o*T)*P,t[6]=(g*b-d*k-v*m)*P,t[7]=(c*k-f*b+p*m)*P,t[8]=(a*S-s*E+u*A)*P,t[9]=(r*E-i*S-o*A)*P,t[10]=(d*w-y*b+v*_)*P,t[11]=(h*b-c*w-p*_)*P,t[12]=(s*T-a*M-l*A)*P,t[13]=(i*M-r*T+n*A)*P,t[14]=(y*m-d*x-g*_)*P,t[15]=(c*x-h*m+f*_)*P,t):null}},Ho={transformMat4:function(t,e,i){var r=e[0],n=e[1],o=e[2],a=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*a,t[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*a,t[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*a,t[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*a,t},normalize:function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],a=i*i+r*r+n*n+o*o;0<a&&(a=1/Math.sqrt(a),t[0]=i*a,t[1]=r*a,t[2]=n*a,t[3]=o*a);return t},scale:function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}},Vo=0,qo=0,Wo=function(){function t(e){var i=e.coords,r=e.style_zoom,n=e.source,o=e.worker,a=e.view,s=e.sceneId;_r(this,t),this.textureManager=Do(s),this.id=Vo++,this.worker=o,this.view=a,this.source=n,this.generation=null,this.valid=!0,this.proxy_for=null,this.proxy_depth=0,this.proxied_as=null,this.fade_in=!0,this.loading=!1,this.loaded=!1,this.built=!1,this.labeled=!1,this.error=null,this.style_zoom=r,this.coords=t.normalizedCoordinate(i,this.source,this.style_zoom),this.key=t.key(this.coords,this.source,this.style_zoom),this.overzoom=Math.max(this.style_zoom-this.coords.z,0),this.overzoom2=Math.pow(2,this.overzoom),this.min=en.metersForTile(this.coords),this.max=en.metersForTile({x:this.coords.x+1,y:this.coords.y+1,z:this.coords.z}),this.span={x:this.max.x-this.min.x,y:this.max.y-this.min.y},this.bounds={sw:{x:this.min.x,y:this.max.y},ne:{x:this.max.x,y:this.min.y}},this.center_dist=0,this.meters_per_pixel=en.metersPerPixel(this.style_zoom),this.meters_per_pixel_sq=this.meters_per_pixel*this.meters_per_pixel,this.units_per_pixel=en.units_per_pixel/this.overzoom2,this.units_per_meter_overzoom=en.unitsPerMeter(this.coords.z)*this.overzoom2,this.meshes={},this.new_mesh_styles=[]}return br(t,[{key:"freeResources",value:function(){for(var t in this.meshes)this.meshes[t].forEach(function(t){return t.destroy()});this.meshes={}}},{key:"destroy",value:function(){Co.removeForTile(this.id),this.workerMessage("self.removeTile",this.id),this.freeResources(),this.worker=null,this.valid=!1}},{key:"buildAsMessage",value:function(){return{id:this.id,key:this.key,source:this.source.name,coords:this.coords,min:this.min,max:this.max,units_per_pixel:this.units_per_pixel,meters_per_pixel:this.meters_per_pixel,meters_per_pixel_sq:this.meters_per_pixel_sq,units_per_meter_overzoom:this.units_per_meter_overzoom,style_zoom:this.style_zoom,overzoom:this.overzoom,overzoom2:this.overzoom2,generation:this.generation}}},{key:"workerMessage",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return fn.postMessage.apply(fn,[this.worker].concat(e))}},{key:"build",value:function(t,e){var i=(1<arguments.length&&void 0!==e?e:{}).fade_in,r=void 0===i||i;return this.generation=t,this.fade_in=r,this.loaded||(this.loading=!0,this.built=!1,this.labeled=!1),this.workerMessage("self.buildTile",{tile:this.buildAsMessage()})}},{key:"buildMeshes",value:function(t,e){if(!this.error){this.build_id=qo++;var i={},r=this.mesh_data;if(r)for(var n in r){for(var o in r[n].meshes){var a=r[n].meshes[o];if(a.vertex_data){if(!t[n]){En("warn","Could not create mesh because style '".concat(n,"' not found, for tile ").concat(this.key,", aborting tile"));break}var s=Object.assign({},r[n]);s.uniforms=Object.assign({},s.uniforms,a.uniforms),s.variant=a.variant,a.textures&&(s.textures=a.textures),a.labels&&(s.retain=!0);var l=t[n].makeMesh(a.vertex_data,a.vertex_elements,s);l.variant=s.variant,l.labels=a.labels,i[n]=i[n]||[],i[n].push(l),null==l.variant.order&&(l.variant.order=i[n].length-1)}}i[n]&&i[n].sort(function(t,e){var i=t.variant.order,r=e.variant.order;return null!=i&&(null==r||i<r)?-1:1})}for(var u in delete this.mesh_data,i)this.meshes[u]&&this.meshes[u].forEach(function(t){return t.destroy()}),this.meshes[u]=i[u],this.new_mesh_styles.push(u);if(e.done){for(var c in this.meshes)-1===this.new_mesh_styles.indexOf(c)&&(this.meshes[c].forEach(function(t){return t.destroy()}),delete this.meshes[c]);this.new_mesh_styles=[]}}}},{key:"setProxyFor",value:function(t){t?(this.proxy_for=this.proxy_for||[],this.proxy_for.push(t),this.proxy_depth=1,t.proxied_as=t.style_zoom>this.style_zoom?"child":"parent"):(this.proxy_for=null,this.proxy_depth=0)}},{key:"isProxy",value:function(){return null!=this.proxy_for}},{key:"shouldProxyForStyle",value:function(t){return!this.proxy_for||this.proxy_for.some(function(e){return null==e.meshes[t]})}},{key:"setupProgram",value:function(t,e){var i=t.model,r=t.model32;e.uniform("4fv","u_tile_origin",[this.min.x,this.min.y,this.style_zoom,this.coords.z]),e.uniform("1f","u_tile_proxy_depth",this.proxy_depth),Go.identity(i),Go.translate(i,i,Uo.fromValues(this.min.x,this.min.y,0)),Go.scale(i,i,Uo.fromValues(this.span.x/en.tile_scale,-1*this.span.y/en.tile_scale,1)),Go.copy(r,i),e.uniform("Matrix4fv","u_model",r),e.uniform("1i","u_tile_fade_in",this.fade_in&&"child"!==this.proxied_as)}},{key:"merge",value:function(t){return this.loading=t.loading,this.loaded=t.loaded,this.generation=t.generation,this.error=t.error,this.mesh_data=t.mesh_data,this.selection_data?Object.assign(this.selection_data,t.selection_data):this.selection_data=t.selection_data,this}}],[{key:"coord",value:function(e){return{x:e.x,y:e.y,z:e.z,key:t.coordKey(e)}}},{key:"coordKey",value:function(t){return t.x+"/"+t.y+"/"+t.z}},{key:"key",value:function(t,e,i){if(!(t.y<0||t.y>=1<<t.z||t.z<0))return[e.name,i,t.x,t.y,t.z].join("/")}},{key:"normalizedKey",value:function(e,i,r){return t.key(t.normalizedCoordinate(e,i,r),i,r)}},{key:"normalizedCoordinate",value:function(e,i){return i.zoom_bias&&(e=t.coordinateAtZoom(e,Math.max(0,e.z-i.zoom_bias))),t.coordinateWithMaxZoom(e,i.max_zoom)}},{key:"coordinateAtZoom",value:function(e,i){var r,n=e.x,o=e.y,a=e.z;return a!==i&&(r=Math.pow(2,a-i),n=Math.floor(n/r),o=Math.floor(o/r),a=i),t.coord({x:n,y:o,z:a})}},{key:"coordinateWithMaxZoom",value:function(e,i){var r=e.x,n=e.y,o=e.z;return void 0!==i&&i<o?t.coordinateAtZoom({x:r,y:n,z:o},i):t.coord({x:r,y:n,z:o})}},{key:"childrenForCoordinate",value:function(e){var i=e.x,r=e.y,n=e.z,o=e.key;return t.coord_children[o]||(n++,i*=2,r*=2,t.coord_children[o]=[t.coord({x:i,y:r,z:n}),t.coord({x:i+1,y:r,z:n}),t.coord({x:i,y:r+1,z:n}),t.coord({x:i+1,y:r+1,z:n})]),t.coord_children[o]}},{key:"isDescendant",value:function(e,i){if(i.z>e.z){var r=t.coordinateAtZoom(i,e.z),n=r.x,o=r.y;return e.x===n&&e.y===o}return!1}},{key:"cancel",value:function(e){e&&(e.canceled=!0,e.source_data&&e.source_data.request_id&&(Sn.cancelRequest(e.source_data.request_id),e.source_data.request_id=null),t.abortBuild(e))}},{key:"buildGeometry",value:function(e,i){var r=i.scene_id,n=i.layers,o=i.styles,a=i.global,s=i.sources,l=e.source_data;for(var u in Oo.startTile(e.id,{apply_repeat_groups:!0}),n){var c=n[u];if(c&&c.config_data){if(c.config_data.source===e.source)for(var h=t._getDataForSource(l,c.config_data,u),f=0;f<h.length;f++){var p=h[f],d=p.geom;if(d)for(var y=0;y<d.features.length;y++){var g=d.features[y];if(null!=g.geometry){var v=xo.getFeatureParseContext(g,e,a,s);v.winding=e.default_winding,v.source=e.source,v.layer=p.layer;var _=c.buildDrawGroups(v,!0);if(_)for(var m in _){var b=_[m],x=b.style||m,w=o[x];w?null!=(b=w.preprocess(b,e.source))&&!1!==b.visible&&(v.layers=b.layers,w.addFeature(g,b,v)):En("warn","Style '".concat(x,"' not found, skipping layer '").concat(u,"':"),b,g)}}}}}else En("warn","Layer ".concat(u," was defined without a geometry data source and will not be rendered."))}var k=t._stylesForTile(e,o);t._sendStyleGroups(e,k,{scene_id:r},function(t){return t.collision?"collision":"non-collision"})}},{key:"_stylesForTile",value:function(t,e){var i=[];for(var r in e)e[r].hasDataForTile(t)&&i.push(e[r]);return i}},{key:"_sendStyleGroups",value:function(e,i,r,n){var o=r.scene_id,a={};i.forEach(function(t){var e=n(t);a[e]=a[e]||[],a[e].push(t)}),0<Object.keys(a).length?function(){var i={start:!0};e.mesh_data={};for(var r in a)!function(r){var n=a[r];Promise.all(n.map(function(t){return t.endData(e)})).then(function(){En("trace","Finished style group '".concat(r,"' for tile ").concat(e.key)),a[r]=[],Object.keys(a).every(function(t){return 0===a[t].length})&&(i.done=!0),fn.postMessage("TileManager_".concat(o,".buildTileStylesCompleted"),fn.withTransferables({tile:t.slice(e,["mesh_data","selection_data"]),progress:i})),i.start=null,e.mesh_data={},e.selection_data={},i.done&&Oo.resetTile(e.id)},function(t){En("error","Error for style group '".concat(r,"' for tile ").concat(e.key),t)})}(r)}():(fn.postMessage("TileManager_".concat(o,".buildTileStylesCompleted"),fn.withTransferables({tile:t.slice(e),progress:{start:!0,done:!0}})),Oo.resetTile(e.id))}},{key:"_getDataForSource",value:function(t,e,i){var r=2<arguments.length&&void 0!==i?i:null,n=[];return null!=e&&null!=t&&null!=t.layers&&(!e.layer&&t.layers._default||"string"==typeof e.layer&&!t.layers[e.layer]&&new RegExp("^\\d+_"+e.layer+"$").test(r)&&t.layers._default?n.push({geom:t.layers._default}):!e.layer&&r?n.push({layer:r,geom:t.layers[r]}):"string"==typeof e.layer?n.push({layer:e.layer,geom:t.layers[e.layer]}):Array.isArray(e.layer)&&e.layer.forEach(function(e){t.layers[e]&&t.layers[e].features&&n.push({layer:e,geom:t.layers[e]})})),n}},{key:"abortBuild",value:function(t,e){if(Co.removeForTile(t.id),Oo.abortTile(t.id),t.mesh_data)for(var i in t.mesh_data){var r=t.mesh_data[i].textures;r&&r.forEach(function(i){var r=Do(e).textures[i];r&&(En("trace","releasing texture ".concat(i," for tile ").concat(t.key)),r.release())})}}},{key:"slice",value:function(t,e){var i=["id","key","loading","loaded","generation","error","debug"];Array.isArray(e)&&i.push.apply(i,Ir(e));for(var r={},n=0;n<i.length;n++){var o=i[n];r[o]=t[o]}return r}}]),t}();Wo.coord_children={};var Xo,Yo=function(){Ar(e,Un);var t=Or(e);function e(i,r){var n;return _r(this,e),-1===(n=t.call(this,i,r)).rasters.indexOf(n.name)&&n.rasters.unshift(n.name),n.filtering=i.filtering,n.textures={},n}return br(e,[{key:"load",value:function(t){t.source_data={},t.source_data.layers={},t.pad_scale=this.pad_scale,t.rasters=Ir(this.rasters);var e=en.tile_scale;return t.source_data.layers={_default:{type:"FeatureCollection",features:[{geometry:{type:"Polygon",coordinates:[[[0,0],[e,0],[e,-e],[0,-e],[0,0]]]},properties:{}}]}},t.default_winding="CW",Promise.resolve(t)}},{key:"tileTexture",value:function(t){var e,i,r=t.coords.key;return this.textures[r]||(e=Wo.coordinateWithMaxZoom(t.coords,this.max_zoom),i=this.formatUrl(this.url,{coords:e}),this.textures[r]={url:i,filtering:this.filtering,coords:e}),this.textures[r]}}]),e}();zn.register(Yo,"Raster");var Ko=Xo={};function Zo(t,e,i,r){for(var n,o=r,a=i-e>>1,s=i-e,l=t[e],u=t[e+1],c=t[i],h=t[i+1],f=e+3;f<i;f+=3){var p,d=function(t,e,i,r,n,o){var a=n-i,s=o-r;{var l;0===a&&0===s||(1<(l=((t-i)*a+(e-r)*s)/(a*a+s*s))?(i=n,r=o):0<l&&(i+=a*l,r+=s*l))}return(a=t-i)*a+(s=e-r)*s}(t[f],t[f+1],l,u,c,h);o<d?(n=f,o=d):d!==o||(p=Math.abs(f-a))<s&&(n=f,s=p)}r<o&&(3<n-e&&Zo(t,e,n,r),t[n+2]=o,3<i-n&&Zo(t,n,i,r))}function Qo(t,e,i,r){var n={id:void 0===t?null:t,type:e,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)$o(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<e.length;r++)$o(t,e[r]);else if("MultiPolygon"===i)for(r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)$o(t,e[r][n])}(n),n}function $o(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function Jo(t,e){var i=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)ta(i,t.features[r],e,r);else"Feature"===t.type?ta(i,t,e):ta(i,{geometry:t},e);return i}function ta(t,e,i,r){if(e.geometry){var n=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),s=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)ea(n,s);else if("MultiPoint"===o)for(var u=0;u<n.length;u++)ea(n[u],s);else if("LineString"===o)ia(n,s,a,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(u=0;u<n.length;u++)s=[],ia(n[u],s,a,!1),t.push(Qo(l,"LineString",s,e.properties));return}ra(n,s,a,!1)}else if("Polygon"===o)ra(n,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"!==o)throw new Error("Input data is not a valid GeoJSON object.");for(u=0;u<e.geometry.geometries.length;u++)ta(t,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},i,r);return}for(u=0;u<n.length;u++){var c=[];ra(n[u],c,a,!0),s.push(c)}}t.push(Qo(l,o,s,e.properties))}}function ea(t,e){e.push(na(t[0])),e.push(oa(t[1])),e.push(0)}function ia(t,e,i,r){for(var n,o,a=0,s=0;s<t.length;s++){var l=na(t[s][0]),u=oa(t[s][1]);e.push(l),e.push(u),e.push(0),0<s&&(a+=r?(n*u-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(u-o,2))),n=l,o=u}var c=e.length-3;e[2]=1,Zo(e,0,c,i),e[2+c]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function ra(t,e,i,r){for(var n=0;n<t.length;n++){var o=[];ia(t[n],o,i,r),e.push(o)}}function na(t){return t/360+.5}function oa(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:1<i?1:i}function aa(t,e,i,r,n,o,a,s){if(r/=e,(i/=e)<=o&&a<r)return t;if(a<i||r<=o)return null;for(var l=[],u=0;u<t.length;u++){var c=t[u],h=c.geometry,f=c.type,p=0===n?c.minX:c.minY,d=0===n?c.maxX:c.maxY;if(i<=p&&d<r)l.push(c);else if(!(d<i||r<=p)){var y=[];if("Point"===f||"MultiPoint"===f)!function(t,e,i,r,n){for(var o=0;o<t.length;o+=3){var a=t[o+n];i<=a&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}(h,y,i,r,n);else if("LineString"===f)sa(h,y,i,r,n,!1,s.lineMetrics);else if("MultiLineString"===f)ua(h,y,i,r,n,!1);else if("Polygon"===f)ua(h,y,i,r,n,!0);else if("MultiPolygon"===f)for(var g=0;g<h.length;g++){var v=[];ua(h[g],v,i,r,n,!0),v.length&&y.push(v)}if(y.length){if(s.lineMetrics&&"LineString"===f){for(g=0;g<y.length;g++)l.push(Qo(c.id,f,y[g],c.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===y.length?(f="LineString",y=y[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===y.length?"Point":"MultiPoint"),l.push(Qo(c.id,f,y,c.tags))}}}return l.length?l:null}function sa(t,e,i,r,n,o,a){for(var s,l,u=la(t),c=0===n?ha:fa,h=t.start,f=0;f<t.length-3;f+=3){var p=t[f],d=t[f+1],y=t[f+2],g=t[f+3],v=t[f+4],_=0===n?p:d,m=0===n?g:v,b=!1;a&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(d-v,2))),_<i?i<m&&(l=c(u,p,d,g,v,i),a&&(u.start=h+s*l)):r<_?m<r&&(l=c(u,p,d,g,v,r),a&&(u.start=h+s*l)):ca(u,p,d,y),m<i&&i<=_&&(l=c(u,p,d,g,v,i),b=!0),r<m&&_<=r&&(l=c(u,p,d,g,v,r),b=!0),!o&&b&&(a&&(u.end=h+s*l),e.push(u),u=la(t)),a&&(h+=s)}var x=t.length-3,p=t[x],d=t[x+1],y=t[x+2];i<=(_=0===n?p:d)&&_<=r&&ca(u,p,d,y),x=u.length-3,o&&3<=x&&(u[x]!==u[0]||u[x+1]!==u[1])&&ca(u,u[0],u[1],u[2]),u.length&&e.push(u)}function la(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function ua(t,e,i,r,n,o){for(var a=0;a<t.length;a++)sa(t[a],e,i,r,n,o,!1)}function ca(t,e,i,r){t.push(e),t.push(i),t.push(r)}function ha(t,e,i,r,n,o){var a=(o-e)/(r-e);return t.push(o),t.push(i+(n-i)*a),t.push(1),a}function fa(t,e,i,r,n,o){var a=(o-i)/(n-i);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function pa(t,e){var i=e.buffer/e.extent,r=t,n=aa(t,1,-1-i,i,0,-1,2,e),o=aa(t,1,1-i,2+i,0,-1,2,e);return(n||o)&&(r=aa(t,1,-i,1+i,0,-1,2,e)||[],n&&(r=da(n,1).concat(r)),o&&(r=r.concat(da(o,-1)))),r}function da(t,e){for(var i=[],r=0;r<t.length;r++){var n,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)n=ya(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){n=[];for(var s=0;s<o.geometry.length;s++)n.push(ya(o.geometry[s],e))}else if("MultiPolygon"===a)for(n=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(ya(o.geometry[s][u],e));n.push(l)}i.push(Qo(o.id,a,n,o.tags))}return i}function ya(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var r=0;r<t.length;r+=3)i.push(t[r]+e,t[r+1],t[r+2]);return i}function ga(t,e){if(t.transformed)return t;for(var i,r=1<<t.z,n=t.x,o=t.y,a=0;a<t.features.length;a++){var s=t.features[a],l=s.geometry,u=s.type;if(s.geometry=[],1===u)for(i=0;i<l.length;i+=2)s.geometry.push(va(l[i],l[i+1],e,r,n,o));else for(i=0;i<l.length;i++){for(var c=[],h=0;h<l[i].length;h+=2)c.push(va(l[i][h],l[i][h+1],e,r,n,o));s.geometry.push(c)}}return t.transformed=!0,t}function va(t,e,i,r,n,o){return[Math.round(i*(t*r-n)),Math.round(i*(e*r-o))]}function _a(t,e,i,r,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,function(t,e,i,r){var n=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<n.length;s+=3)a.push(n[s]),a.push(n[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)ma(a,n,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<n.length;s++)ma(a,n[s],t,i,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var u=n[l];for(s=0;s<u.length;s++)ma(a,u[s],t,i,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=n.start/n.size,c.mapbox_clip_end=n.end/n.size}var f={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(f.id=e.id),t.features.push(f)}}(a,t[s],o,n);var l=t[s].minX,u=t[s].minY,c=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function ma(t,e,i,r,n,o){var a=r*r;if(0<r&&e.size<(n?a:r))i.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===r||e[l+2]>a)&&(i.numSimplified++,s.push(e[l]),s.push(e[l+1])),i.numPoints++;n&&function(t,e){for(var i=0,r=0,n=t.length,o=n-2;r<n;o=r,r+=2)i+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(0<i===e)for(r=0,n=t.length;r<n/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[n-2-r],t[r+1]=t[n-1-r],t[n-2-r]=a,t[n-1-r]=s}}(s,o),t.push(s)}}var ba={maxZoom:14,tolerance:3,extent:4096,buffer:64,lineMetrics:!(Xo.deepClone=function(t){return Array.isArray(t)?t.map(Xo.deepClone):t}),promoteId:null,generateId:!1};function xa(t,e,i,r,n){var o=Object.assign({},ba,n),a=Jo(t,o),s=function(t){var e,i=2,r=-1,n=1,o=0,a=zr(t);try{for(a.s();!(e=a.n()).done;){var s=e.value;s.minX<i&&(i=s.minX),s.maxX>r&&(r=s.maxX),s.minY<n&&(n=s.minY),s.maxY>o&&(o=s.maxY)}}catch(t){a.e(t)}finally{a.f()}return{minX:i,maxX:r,minY:n,maxY:o}}(a=pa(a,o)),l=s.minX,u=s.minY,c=s.maxX,h=s.maxY,f=1<<e,p=o.buffer/o.extent,d=1+p;return a=aa(a,f,i-p,i+d,0,l,c,o)||[],ga(_a(a=aa(a,f,r-p,r+d,1,u,h,o)||[],e,i,r,o),o.extent)}function wa(t,e){this.items=[],this.algorithm=t;var i=void 0===(e=e||{}).sort||e.sort;this.sort=i}wa.prototype={addItem:function(t){this.items.push(t)},normalizeCoordinates:function(){var t=this.items,e=1/0,i=1/0;t.forEach(function(t){var r=t;e=Math.min(e,r.x),i=Math.min(i,r.y)}),t.forEach(function(t){var r=t;r.x-=e,r.y-=i})},getStats:function(){var t=this.items.map(function(t){return t}),e=t.map(function(t){return t.x}),i=t.map(function(t){return t.y}),r=t.map(function(t){return t.x+t.width}),n=t.map(function(t){return t.y+t.height});return{minX:Math.max.apply(Math,e),minY:Math.max.apply(Math,i),maxX:Math.max.apply(Math,r),maxY:Math.max.apply(Math,n)}},getItems:function(){return this.items},processItems:function(){var t=this.items;return this.sort&&(t=this.algorithm.sort(t)),t=this.algorithm.placeItems(t),this.items=t},exportItems:function(){return this.processItems(),this.normalizeCoordinates(),this.items},export:function(){var t=this.exportItems(),e=this.getStats();return{height:e.maxY,width:e.maxX,items:t}}};var ka=wa,Aa=[],Ta=[],Ea="undefined"!=typeof Uint8Array?Uint8Array:Array,Ma=!1;function Sa(){Ma=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,i=t.length;e<i;++e)Aa[e]=t[e],Ta[t.charCodeAt(e)]=e;Ta["-".charCodeAt(0)]=62,Ta["_".charCodeAt(0)]=63}function Ra(t){var e,i,r,n;Ma||Sa();var o=t.length;if(0<o%4)throw new Error("Invalid string. Length must be a multiple of 4");r="="===t[o-2]?2:"="===t[o-1]?1:0,n=new Ea(3*o/4-r),e=0<r?o-4:o;for(var a=0,s=0;s<e;s+=4,0)i=Ta[t.charCodeAt(s)]<<18|Ta[t.charCodeAt(s+1)]<<12|Ta[t.charCodeAt(s+2)]<<6|Ta[t.charCodeAt(s+3)],n[a++]=i>>16&255,n[a++]=i>>8&255,n[a++]=255&i;return 2==r?(i=Ta[t.charCodeAt(s)]<<2|Ta[t.charCodeAt(s+1)]>>4,n[a++]=255&i):1==r&&(i=Ta[t.charCodeAt(s)]<<10|Ta[t.charCodeAt(s+1)]<<4|Ta[t.charCodeAt(s+2)]>>2,n[a++]=i>>8&255,n[a++]=255&i),n}function Pa(t,e,i){for(var r,n,o=[],a=e;a<i;a+=3)r=(t[a]<<16)+(t[a+1]<<8)+t[a+2],o.push(Aa[(n=r)>>18&63]+Aa[n>>12&63]+Aa[n>>6&63]+Aa[63&n]);return o.join("")}function Oa(t){var e;Ma||Sa();for(var i=t.length,r=i%3,n="",o=[],a=0,s=i-r;a<s;a+=16383)o.push(Pa(t,a,s<a+16383?s:a+16383));return 1==r?(e=t[i-1],n+=Aa[e>>2],n+=Aa[e<<4&63],n+="=="):2==r&&(e=(t[i-2]<<8)+t[i-1],n+=Aa[e>>10],n+=Aa[e>>4&63],n+=Aa[e<<2&63],n+="="),o.push(n),o.join("")}function Ca(t,e,i,r,n){var o,a,s=8*n-r-1,l=(1<<s)-1,u=l>>1,c=-7,h=i?n-1:0,f=i?-1:1,p=t[e+h];for(h+=f,o=p&(1<<-c)-1,p>>=-c,c+=s;0<c;o=256*o+t[e+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;0<c;a=256*a+t[e+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=u}return(p?-1:1)*a*Math.pow(2,o-r)}function La(t,e,i,r,n,o){var a,s,l,u=8*o-n-1,c=(1<<u)-1,h=c>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),2<=(e+=1<=a+h?f/l:f*Math.pow(2,1-h))*l&&(a++,l/=2),c<=a+h?(s=0,a=c):1<=a+h?(s=(e*l-1)*Math.pow(2,n),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,n),a=0));8<=n;t[i+p]=255&s,p+=d,s/=256,n-=8);for(a=a<<n|s,u+=n;0<u;t[i+p]=255&a,p+=d,a/=256,u-=8);t[i+p-d]|=128*y}var Ia={}.toString,ja=Array.isArray||function(t){return"[object Array]"==Ia.call(t)};Fa.TYPED_ARRAY_SUPPORT=void 0===Zr.TYPED_ARRAY_SUPPORT||Zr.TYPED_ARRAY_SUPPORT;var Na=za();function za(){return Fa.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Da(t,e){if(za()<e)throw new RangeError("Invalid typed array length");return Fa.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=Fa.prototype:(null===t&&(t=new Fa(e)),t.length=e),t}function Fa(t,e,i){if(!(Fa.TYPED_ARRAY_SUPPORT||this instanceof Fa))return new Fa(t,e,i);if("number"!=typeof t)return Ua(this,t,e,i);if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return Ga(this,t)}function Ua(t,e,i,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,r){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===i&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,i):new Uint8Array(e,i,r);Fa.TYPED_ARRAY_SUPPORT?(t=e).__proto__=Fa.prototype:t=Ha(t,e);return t}(t,e,i,r):"string"==typeof e?function(t,e,i){"string"==typeof i&&""!==i||(i="utf8");if(!Fa.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var r=0|Wa(e,i),n=(t=Da(t,r)).write(e,i);n!==r&&(t=t.slice(0,n));return t}(t,e,i):function(t,e){if(qa(e)){var i=0|Va(e.length);return 0===(t=Da(t,i)).length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?Da(t,0):Ha(t,e);if("Buffer"===e.type&&ja(e.data))return Ha(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function Ba(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function Ga(t,e){if(Ba(e),t=Da(t,e<0?0:0|Va(e)),!Fa.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function Ha(t,e){var i=e.length<0?0:0|Va(e.length);t=Da(t,i);for(var r=0;r<i;r+=1)t[r]=255&e[r];return t}function Va(t){if(t>=za())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+za().toString(16)+" bytes");return 0|t}function qa(t){return null!=t&&t._isBuffer}function Wa(t,e){if(qa(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return us(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return cs(t).length;default:if(r)return us(t).length;e=(""+e).toLowerCase(),r=!0}}function Xa(t,e,i){var r,n,o,a=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t=t||"utf8";;)switch(t){case"hex":return function(t,e,i){var r=t.length;(!e||e<0)&&(e=0);(!i||i<0||r<i)&&(i=r);for(var n="",o=e;o<i;++o)n+=function(t){return t<16?"0"+t.toString(16):t.toString(16)}(t[o]);return n}(this,e,i);case"utf8":case"utf-8":return Ja(this,e,i);case"ascii":return function(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(127&t[n]);return r}(this,e,i);case"latin1":case"binary":return function(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(t[n]);return r}(this,e,i);case"base64":return r=this,o=i,0===(n=e)&&o===r.length?Oa(r):Oa(r.slice(n,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,i){for(var r=t.slice(e,i),n="",o=0;o<r.length;o+=2)n+=String.fromCharCode(r[o]+256*r[o+1]);return n}(this,e,i);default:if(a)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),a=!0}}function Ya(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function Ka(t,e,i,r,n){if(0===t.length)return-1;if("string"==typeof i?(r=i,i=0):2147483647<i?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=n?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(n)return-1;i=t.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof e&&(e=Fa.from(e,r)),qa(e))return 0===e.length?-1:Za(t,e,i,r,n);if("number"==typeof e)return e&=255,Fa.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):Za(t,[e],i,r,n);throw new TypeError("val must be string, number or Buffer")}function Za(t,e,i,r,n){var o=1,a=t.length,s=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;a/=o=2,s/=2,i/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(n)for(var u=-1,c=i;c<a;c++)if(l(t,c)===l(e,-1===u?0:c-u)){if(-1===u&&(u=c),c-u+1===s)return u*o}else-1!==u&&(c-=c-u),u=-1;else for(a<i+s&&(i=a-s),c=i;0<=c;c--){for(var h=!0,f=0;f<s;f++)if(l(t,c+f)!==l(e,f)){h=!1;break}if(h)return c}return-1}function Qa(t,e,i,r){return hs(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,r)}function $a(t,e,i,r){return hs(function(t,e){for(var i,r,n,o=[],a=0;a<t.length&&!((e-=2)<0);++a)i=t.charCodeAt(a),r=i>>8,n=i%256,o.push(n),o.push(r);return o}(e,t.length-i),t,i,r)}function Ja(t,e,i){i=Math.min(t.length,i);for(var r=[],n=e;n<i;){var o,a,s,l,u=t[n],c=null,h=239<u?4:223<u?3:191<u?2:1;if(n+h<=i)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(o=t[n+1]))&&127<(l=(31&u)<<6|63&o)&&(c=l);break;case 3:o=t[n+1],a=t[n+2],128==(192&o)&&128==(192&a)&&2047<(l=(15&u)<<12|(63&o)<<6|63&a)&&(l<55296||57343<l)&&(c=l);break;case 4:o=t[n+1],a=t[n+2],s=t[n+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&65535<(l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)&&l<1114112&&(c=l)}null===c?(c=65533,h=1):65535<c&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),n+=h}return function(t){var e=t.length;if(e<=ts)return String.fromCharCode.apply(String,t);var i="",r=0;for(;r<e;)i+=String.fromCharCode.apply(String,t.slice(r,r+=ts));return i}(r)}Fa.poolSize=8192,Fa._augment=function(t){return t.__proto__=Fa.prototype,t},Fa.from=function(t,e,i){return Ua(null,t,e,i)},Fa.TYPED_ARRAY_SUPPORT&&(Fa.prototype.__proto__=Uint8Array.prototype,Fa.__proto__=Uint8Array),Fa.alloc=function(t,e,i){return r=null,o=e,a=i,Ba(n=t),n<=0||void 0===o?Da(r,n):"string"==typeof a?Da(r,n).fill(o,a):Da(r,n).fill(o);var r,n,o,a},Fa.allocUnsafe=function(t){return Ga(null,t)},Fa.allocUnsafeSlow=function(t){return Ga(null,t)},Fa.isBuffer=fs,Fa.compare=function(t,e){if(!qa(t)||!qa(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,r=e.length,n=0,o=Math.min(i,r);n<o;++n)if(t[n]!==e[n]){i=t[n],r=e[n];break}return i<r?-1:r<i?1:0},Fa.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Fa.concat=function(t,e){if(!ja(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Fa.alloc(0);if(void 0===e)for(n=e=0;n<t.length;++n)e+=t[n].length;for(var i=Fa.allocUnsafe(e),r=0,n=0;n<t.length;++n){var o=t[n];if(!qa(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},Fa.byteLength=Wa,Fa.prototype._isBuffer=!0,Fa.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)Ya(this,e,e+1);return this},Fa.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)Ya(this,e,e+3),Ya(this,e+1,e+2);return this},Fa.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)Ya(this,e,e+7),Ya(this,e+1,e+6),Ya(this,e+2,e+5),Ya(this,e+3,e+4);return this},Fa.prototype.toString=function(){var t=0|this.length;return 0==t?"":0===arguments.length?Ja(this,0,t):Xa.apply(this,arguments)},Fa.prototype.equals=function(t){if(!qa(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Fa.compare(this,t)},Fa.prototype.inspect=function(){var t="";return 0<this.length&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(t+=" ... ")),"<Buffer "+t+">"},Fa.prototype.compare=function(t,e,i,r,n){if(!qa(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),e<0||i>t.length||r<0||n>this.length)throw new RangeError("out of range index");if(n<=r&&i<=e)return 0;if(n<=r)return-1;if(i<=e)return 1;if(this===t)return 0;for(var o=(n>>>=0)-(r>>>=0),a=(i>>>=0)-(e>>>=0),s=Math.min(o,a),l=this.slice(r,n),u=t.slice(e,i),c=0;c<s;++c)if(l[c]!==u[c]){o=l[c],a=u[c];break}return o<a?-1:a<o?1:0},Fa.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},Fa.prototype.indexOf=function(t,e,i){return Ka(this,t,e,i,!0)},Fa.prototype.lastIndexOf=function(t,e,i){return Ka(this,t,e,i,!1)},Fa.prototype.write=function(t,e,i,r){if(void 0===e)r="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)r=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-e;if((void 0===i||n<i)&&(i=n),0<t.length&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r=r||"utf8";for(var o,a,s,l,u,c,h=!1;;)switch(r){case"hex":return function(t,e,i,r){i=Number(i)||0;var n=t.length-i;(!r||n<(r=Number(r)))&&(r=n);var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");o/2<r&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[i+a]=s}return a}(this,t,e,i);case"utf8":case"utf-8":return u=e,c=i,hs(us(t,(l=this).length-u),l,u,c);case"ascii":return Qa(this,t,e,i);case"latin1":case"binary":return Qa(this,t,e,i);case"base64":return o=this,a=e,s=i,hs(cs(t),o,a,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $a(this,t,e,i);default:if(h)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),h=!0}},Fa.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ts=4096;function es(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(i<t+e)throw new RangeError("Trying to access beyond buffer length")}function is(t,e,i,r,n,o){if(!qa(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(n<e||e<o)throw new RangeError('"value" argument is out of bounds');if(i+r>t.length)throw new RangeError("Index out of range")}function rs(t,e,i,r){e<0&&(e=65535+e+1);for(var n=0,o=Math.min(t.length-i,2);n<o;++n)t[i+n]=(e&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function ns(t,e,i,r){e<0&&(e=4294967295+e+1);for(var n=0,o=Math.min(t.length-i,4);n<o;++n)t[i+n]=e>>>8*(r?n:3-n)&255}function os(t,e,i,r){if(i+r>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function as(t,e,i,r,n){return n||os(t,0,i,4),La(t,e,i,r,23,4),i+4}function ss(t,e,i,r,n){return n||os(t,0,i,8),La(t,e,i,r,52,8),i+8}Fa.prototype.slice=function(t,e){var i=this.length;if((t=~~t)<0?(t+=i)<0&&(t=0):i<t&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):i<e&&(e=i),e<t&&(e=t),Fa.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=Fa.prototype;else for(var r=e-t,n=new Fa(r,void 0),o=0;o<r;++o)n[o]=this[o+t];return n},Fa.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||es(t,e,this.length);for(var r=this[t],n=1,o=0;++o<e&&(n*=256);)r+=this[t+o]*n;return r},Fa.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||es(t,e,this.length);for(var r=this[t+--e],n=1;0<e&&(n*=256);)r+=this[t+--e]*n;return r},Fa.prototype.readUInt8=function(t,e){return e||es(t,1,this.length),this[t]},Fa.prototype.readUInt16LE=function(t,e){return e||es(t,2,this.length),this[t]|this[t+1]<<8},Fa.prototype.readUInt16BE=function(t,e){return e||es(t,2,this.length),this[t]<<8|this[t+1]},Fa.prototype.readUInt32LE=function(t,e){return e||es(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Fa.prototype.readUInt32BE=function(t,e){return e||es(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Fa.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||es(t,e,this.length);for(var r=this[t],n=1,o=0;++o<e&&(n*=256);)r+=this[t+o]*n;return(n*=128)<=r&&(r-=Math.pow(2,8*e)),r},Fa.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||es(t,e,this.length);for(var r=e,n=1,o=this[t+--r];0<r&&(n*=256);)o+=this[t+--r]*n;return(n*=128)<=o&&(o-=Math.pow(2,8*e)),o},Fa.prototype.readInt8=function(t,e){return e||es(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Fa.prototype.readInt16LE=function(t,e){e||es(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},Fa.prototype.readInt16BE=function(t,e){e||es(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},Fa.prototype.readInt32LE=function(t,e){return e||es(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Fa.prototype.readInt32BE=function(t,e){return e||es(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Fa.prototype.readFloatLE=function(t,e){return e||es(t,4,this.length),Ca(this,t,!0,23,4)},Fa.prototype.readFloatBE=function(t,e){return e||es(t,4,this.length),Ca(this,t,!1,23,4)},Fa.prototype.readDoubleLE=function(t,e){return e||es(t,8,this.length),Ca(this,t,!0,52,8)},Fa.prototype.readDoubleBE=function(t,e){return e||es(t,8,this.length),Ca(this,t,!1,52,8)},Fa.prototype.writeUIntLE=function(t,e,i,r){t=+t,e|=0,i|=0,r||is(this,t,e,i,Math.pow(2,8*i)-1,0);var n=1,o=0;for(this[e]=255&t;++o<i&&(n*=256);)this[e+o]=t/n&255;return e+i},Fa.prototype.writeUIntBE=function(t,e,i,r){t=+t,e|=0,i|=0,r||is(this,t,e,i,Math.pow(2,8*i)-1,0);var n=i-1,o=1;for(this[e+n]=255&t;0<=--n&&(o*=256);)this[e+n]=t/o&255;return e+i},Fa.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||is(this,t,e,1,255,0),Fa.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Fa.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||is(this,t,e,2,65535,0),Fa.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):rs(this,t,e,!0),e+2},Fa.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||is(this,t,e,2,65535,0),Fa.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):rs(this,t,e,!1),e+2},Fa.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||is(this,t,e,4,4294967295,0),Fa.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):ns(this,t,e,!0),e+4},Fa.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||is(this,t,e,4,4294967295,0),Fa.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):ns(this,t,e,!1),e+4},Fa.prototype.writeIntLE=function(t,e,i,r){var n;t=+t,e|=0,r||is(this,t,e,i,(n=Math.pow(2,8*i-1))-1,-n);var o=0,a=1,s=0;for(this[e]=255&t;++o<i&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+i},Fa.prototype.writeIntBE=function(t,e,i,r){var n;t=+t,e|=0,r||is(this,t,e,i,(n=Math.pow(2,8*i-1))-1,-n);var o=i-1,a=1,s=0;for(this[e+o]=255&t;0<=--o&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+i},Fa.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||is(this,t,e,1,127,-128),Fa.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Fa.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||is(this,t,e,2,32767,-32768),Fa.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):rs(this,t,e,!0),e+2},Fa.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||is(this,t,e,2,32767,-32768),Fa.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):rs(this,t,e,!1),e+2},Fa.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||is(this,t,e,4,2147483647,-2147483648),Fa.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):ns(this,t,e,!0),e+4},Fa.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||is(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Fa.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):ns(this,t,e,!1),e+4},Fa.prototype.writeFloatLE=function(t,e,i){return as(this,t,e,!0,i)},Fa.prototype.writeFloatBE=function(t,e,i){return as(this,t,e,!1,i)},Fa.prototype.writeDoubleLE=function(t,e,i){return ss(this,t,e,!0,i)},Fa.prototype.writeDoubleBE=function(t,e,i){return ss(this,t,e,!1,i)},Fa.prototype.copy=function(t,e,i,r){if(i=i||0,r||0===r||(r=this.length),e>=t.length&&(e=t.length),e=e||0,0<r&&r<i&&(r=i),r===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-i&&(r=t.length-e+i);var n,o=r-i;if(this===t&&i<e&&e<r)for(n=o-1;0<=n;--n)t[n+e]=this[n+i];else if(o<1e3||!Fa.TYPED_ARRAY_SUPPORT)for(n=0;n<o;++n)t[n+e]=this[n+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+o),e);return o},Fa.prototype.fill=function(t,e,i,r){if("string"==typeof t){var n;if("string"==typeof e?(r=e,e=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1!==t.length||(n=t.charCodeAt(0))<256&&(t=n),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Fa.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;if(e>>>=0,i=void 0===i?this.length:i>>>0,"number"==typeof(t=t||0))for(s=e;s<i;++s)this[s]=t;else for(var o=qa(t)?t:us(new Fa(t,r).toString()),a=o.length,s=0;s<i-e;++s)this[s+e]=o[s%a];return this};var ls=/[^+\/0-9A-Za-z-_]/g;function us(t,e){var i;e=e||1/0;for(var r=t.length,n=null,o=[],a=0;a<r;++a){if(55295<(i=t.charCodeAt(a))&&i<57344){if(!n){if(56319<i){-1<(e-=3)&&o.push(239,191,189);continue}if(a+1===r){-1<(e-=3)&&o.push(239,191,189);continue}n=i;continue}if(i<56320){-1<(e-=3)&&o.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&-1<(e-=3)&&o.push(239,191,189);if(n=null,i<128){if(--e<0)break;o.push(i)}else if(i<2048){if((e-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function cs(t){return Ra(function(t){var e;if((t=((e=t).trim?e.trim():e.replace(/^\s+|\s+$/g,"")).replace(ls,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function hs(t,e,i,r){for(var n=0;n<r&&!(n+i>=e.length||n>=t.length);++n)e[n+i]=t[n];return n}function fs(t){return null!=t&&(!!t._isBuffer||ps(t)||"function"==typeof(e=t).readFloatLE&&"function"==typeof e.slice&&ps(e.slice(0,0)));var e}function ps(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var ds=Object.freeze({INSPECT_MAX_BYTES:50,kMaxLength:Na,Buffer:Fa,SlowBuffer:function(t){return+t!=t&&(t=0),Fa.alloc(+t)},isBuffer:fs});Zr.setTimeout,Zr.clearTimeout;Zr.performance;var ys="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t},gs=ys;function vs(t,e){var i={seen:[],stylize:ms};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),ks(e)?i.showHidden=e:e&&function(t,e){if(!e||!Ss(e))return;var i=Object.keys(e),r=i.length;for(;r--;)t[i[r]]=e[i[r]]}(i,e),Es(i.showHidden)&&(i.showHidden=!1),Es(i.depth)&&(i.depth=2),Es(i.colors)&&(i.colors=!1),Es(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=_s),bs(i,t,i.depth)}function _s(t,e){var i=vs.styles[e];return i?"["+vs.colors[i][0]+"m"+t+"["+vs.colors[i][1]+"m":t}function ms(t,e){return t}function bs(t,e,i){if(t.customInspect&&e&&Os(e.inspect)&&e.inspect!==vs&&(!e.constructor||e.constructor.prototype!==e)){var r=e.inspect(i,t);return Ts(r)||(r=bs(t,r,i)),r}var n=function(t,e){if(Es(e))return t.stylize("undefined","undefined");if(Ts(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if("number"==typeof e)return t.stylize(""+e,"number");if(ks(e))return t.stylize(""+e,"boolean");if(As(e))return t.stylize("null","null")}(t,e);if(n)return n;var o,a=Object.keys(e),s=(o={},a.forEach(function(t,e){o[t]=!0}),o);if(t.showHidden&&(a=Object.getOwnPropertyNames(e)),Ps(e)&&(0<=a.indexOf("message")||0<=a.indexOf("description")))return xs(e);if(0===a.length){if(Os(e)){var l=e.name?": "+e.name:"";return t.stylize("[Function"+l+"]","special")}if(Ms(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(Rs(e))return t.stylize(Date.prototype.toString.call(e),"date");if(Ps(e))return xs(e)}var u,c,h="",f=!1,p=["{","}"];return u=e,Array.isArray(u)&&(f=!0,p=["[","]"]),Os(e)&&(h=" [Function"+(e.name?": "+e.name:"")+"]"),Ms(e)&&(h=" "+RegExp.prototype.toString.call(e)),Rs(e)&&(h=" "+Date.prototype.toUTCString.call(e)),Ps(e)&&(h=" "+xs(e)),0!==a.length||f&&0!=e.length?i<0?Ms(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),c=f?function(t,e,i,r,n){for(var o=[],a=0,s=e.length;a<s;++a)Is(e,String(a))?o.push(ws(t,e,i,r,String(a),!0)):o.push("");return n.forEach(function(n){n.match(/^\d+$/)||o.push(ws(t,e,i,r,n,!0))}),o}(t,e,i,s,a):a.map(function(r){return ws(t,e,i,s,r,f)}),t.seen.pop(),function(t,e,i){if(60<t.reduce(function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0))return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(c,h,p)):p[0]+h+p[1]}function xs(t){return"["+Error.prototype.toString.call(t)+"]"}function ws(t,e,i,r,n,o){var a,s,l=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]};if(l.get?s=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(s=t.stylize("[Setter]","special")),Is(r,n)||(a="["+n+"]"),s||(t.seen.indexOf(l.value)<0?-1<(s=As(i)?bs(t,l.value,null):bs(t,l.value,i-1)).indexOf("\n")&&(s=o?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n")):s=t.stylize("[Circular]","special")),Es(a)){if(o&&n.match(/^\d+$/))return s;a=(a=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(a,"string"))}return a+": "+s}function ks(t){return"boolean"==typeof t}function As(t){return null===t}function Ts(t){return"string"==typeof t}function Es(t){return void 0===t}function Ms(t){return Ss(t)&&"[object RegExp]"===Ls(t)}function Ss(t){return"object"==typeof t&&null!==t}function Rs(t){return Ss(t)&&"[object Date]"===Ls(t)}function Ps(t){return Ss(t)&&("[object Error]"===Ls(t)||t instanceof Error)}function Os(t){return"function"==typeof t}function Cs(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function Ls(t){return Object.prototype.toString.call(t)}function Is(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function js(t,e){if(t===e)return 0;for(var i=t.length,r=e.length,n=0,o=Math.min(i,r);n<o;++n)if(t[n]!==e[n]){i=t[n],r=e[n];break}return i<r?-1:r<i?1:0}vs.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},vs.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var Ns,zs=Object.prototype.hasOwnProperty,Ds=Object.keys||function(t){var e=[];for(var i in t)zs.call(t,i)&&e.push(i);return e},Fs=Array.prototype.slice;function Us(){return void 0!==Ns?Ns:Ns="foo"===function(){}.name}function Bs(t){return Object.prototype.toString.call(t)}function Gs(t){if(!fs(t)&&"function"==typeof Zr.ArrayBuffer){if("function"==typeof ArrayBuffer.isView)return ArrayBuffer.isView(t);if(t)return t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer)}}function Hs(t,e){t||Ks(t,!0,e,"==",Zs)}var Vs=/\s*function\s+([^\(\s]*)\s*/;function qs(t){if(Os(t)){if(Us())return t.name;var e=t.toString().match(Vs);return e&&e[1]}}function Ws(t){var e;this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=Xs(Ys((e=this).actual),128)+" "+e.operator+" "+Xs(Ys(e.expected),128),this.generatedMessage=!0);var i,r,n,o,a,s=t.stackStartFunction||Ks;Error.captureStackTrace?Error.captureStackTrace(this,s):(i=new Error).stack&&(a=i.stack,r=qs(s),0<=(n=a.indexOf("\n"+r))&&(o=a.indexOf("\n",n+1),a=a.substring(o+1)),this.stack=a)}function Xs(t,e){return"string"!=typeof t||t.length<e?t:t.slice(0,e)}function Ys(t){if(Us()||!Os(t))return vs(t);var e=qs(t);return"[Function"+(e?": "+e:"")+"]"}function Ks(t,e,i,r,n){throw new Ws({message:i,actual:t,expected:e,operator:r,stackStartFunction:n})}function Zs(t,e){t||Ks(t,!0,e,"==",Zs)}function Qs(t,e,i,r){if(t===e)return!0;if(fs(t)&&fs(e))return 0===js(t,e);if(Rs(t)&&Rs(e))return t.getTime()===e.getTime();if(Ms(t)&&Ms(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(Gs(t)&&Gs(e)&&Bs(t)===Bs(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===js(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(fs(t)!==fs(e))return!1;var n=(r=r||{actual:[],expected:[]}).actual.indexOf(t);return-1!==n&&n===r.expected.indexOf(e)||(r.actual.push(t),r.expected.push(e),function(t,e,i,r){if(null==t||null==e)return!1;if(Cs(t)||Cs(e))return t===e;if(i&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var n=$s(t),o=$s(e);if(n&&!o||!n&&o)return!1;if(n)return t=Fs.call(t),e=Fs.call(e),Qs(t,e,i);var a,s,l=Ds(t),u=Ds(e);if(l.length!==u.length)return!1;for(l.sort(),u.sort(),s=l.length-1;0<=s;s--)if(l[s]!==u[s])return!1;for(s=l.length-1;0<=s;s--)if(a=l[s],!Qs(t[a],e[a],i,r))return!1;return!0}(t,e,i,r))}return i?t===e:t==e}function $s(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function Js(t,e){if(t&&e){if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return 1}catch(t){}if(!Error.isPrototypeOf(e))return!0===e.call({},t)}}function tl(t,e,i,r){var n;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(r=i,i=null),n=function(t){var e;try{t()}catch(t){e=t}return e}(e),r=(i&&i.name?" ("+i.name+").":".")+(r?" "+r:"."),t&&!n&&Ks(n,i,"Missing expected exception"+r);var o="string"==typeof r,a=!t&&n&&!i;if((!t&&Ps(n)&&o&&Js(n,i)||a)&&Ks(n,i,"Got unwanted exception"+r),t&&n&&i&&!Js(n,i)||!t&&n)throw n}gs(Hs.AssertionError=Ws,Error),Hs.fail=Ks,Hs.ok=Zs,Hs.equal=function t(e,i,r){e!=i&&Ks(e,i,r,"==",t)},Hs.notEqual=function t(e,i,r){e==i&&Ks(e,i,r,"!=",t)},Hs.deepEqual=function t(e,i,r){Qs(e,i,!1)||Ks(e,i,r,"deepEqual",t)},Hs.deepStrictEqual=function t(e,i,r){Qs(e,i,!0)||Ks(e,i,r,"deepStrictEqual",t)},Hs.notDeepEqual=function t(e,i,r){Qs(e,i,!1)&&Ks(e,i,r,"notDeepEqual",t)},Hs.notDeepStrictEqual=function t(e,i,r){Qs(e,i,!0)&&Ks(e,i,r,"notDeepStrictEqual",t)},Hs.strictEqual=function t(e,i,r){e!==i&&Ks(e,i,r,"===",t)},Hs.notStrictEqual=function t(e,i,r){e===i&&Ks(e,i,r,"!==",t)},Hs.throws=function(t,e,i){tl(!0,t,e,i)},Hs.doesNotThrow=function(t,e,i){tl(!1,t,e,i)},Hs.ifError=function(t){if(t)throw t};function el(){}var il={sort:function(t){return t.sort(function(t,e){return t.height-e.height}),t},placeItems:function(t){var e=0;return t.forEach(function(t){t.x=0,t.y=e,e+=t.height}),t}},rl={sort:function(t){return t.sort(function(t,e){return t.width-e.width}),t},placeItems:function(t){var e=0;return t.forEach(function(t){t.x=e,t.y=0,e+=t.width}),t}},nl={sort:function(t){return t.sort(function(t,e){return Math.sqrt(Math.pow(t.height,2)+Math.pow(t.width,2))-Math.sqrt(Math.pow(e.height,2)+Math.pow(e.width,2))}),t},placeItems:function(t){var e=0,i=0;return t.forEach(function(t){t.x=e,t.y=i,e+=t.width,i+=t.height}),t}},ol={sort:function(t){return t.sort(function(t,e){return Math.sqrt(Math.pow(t.height,2)+Math.pow(t.width,2))-Math.sqrt(Math.pow(e.height,2)+Math.pow(e.width,2))}),t},placeItems:function(t){var e=0,i=0;return t.forEach(function(t){var r=t.width;t.x=e-r,t.y=i,e-=r,i+=t.height}),t}};el.prototype={fit:function(t){var e,i,r,n,o=t.length,a=0<o?t[0].width:0,s=0<o?t[0].height:0;for(this.root={x:0,y:0,width:a,height:s},e=0;e<o;e++)r=t[e],n=(i=this.findNode(this.root,r.width,r.height))?this.splitNode(i,r.width,r.height):this.growNode(r.width,r.height),r.x=n.x,r.y=n.y},findNode:function(t,e,i){return t.used?this.findNode(t.right,e,i)||this.findNode(t.down,e,i):e<=t.width&&i<=t.height?t:null},splitNode:function(t,e,i){return t.used=!0,t.down={x:t.x,y:t.y+i,width:t.width,height:t.height-i},t.right={x:t.x+e,y:t.y,width:t.width-e,height:i},t},growNode:function(t,e){var i=t<=this.root.width,r=e<=this.root.height,n=r&&this.root.height>=this.root.width+t,o=i&&this.root.width>=this.root.height+e;return n?this.growRight(t,e):o?this.growDown(t,e):r?this.growRight(t,e):i?this.growDown(t,e):null},growRight:function(t,e){var i;return this.root={used:!0,x:0,y:0,width:this.root.width+t,height:this.root.height,down:this.root,right:{x:this.root.width,y:0,width:t,height:this.root.height}},(i=this.findNode(this.root,t,e))?this.splitNode(i,t,e):null},growDown:function(t,e){var i;return this.root={used:!0,x:0,y:0,width:this.root.width,height:this.root.height+e,down:{x:0,y:this.root.height,width:this.root.width,height:e},right:this.root},(i=this.findNode(this.root,t,e))?this.splitNode(i,t,e):null}};var al=el,sl={sort:function(t){return t},placeItems:function(t){return function(t,e){e=e||{};var i=new al,r=e.inPlace||!1,n=(n=t.map(function(t){return r?t:{width:t.width,height:t.height,item:t}})).sort(function(t,e){return e.width*e.height-t.width*t.height});i.fit(n);var o={width:n.reduce(function(t,e){return Math.max(t,e.x+e.width)},0),height:n.reduce(function(t,e){return Math.max(t,e.y+e.height)},0)};r||(o.items=n)}(t,{inPlace:!0}),t}},ll={};function ul(t,e){var i=t||"top-down";return"string"==typeof i&&Hs(i=ll[t],"Sorry, the '"+t+"' algorithm could not be loaded."),new ka(i,e)}function cl(t,e){ll[t]=e}ul.PackingSmith=ka,ul.addAlgorithm=cl,ul.algorithms=ll,cl("top-down",il),cl("left-right",rl),cl("diagonal",nl),cl("alt-diagonal",ol),cl("binary-tree",sl);var hl=ul;function fl(t){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++){var i=e+1<1||arguments.length<=e+1?void 0:arguments[e+1];if(i)for(var r in i){var n=i[r];null===n||"object"!==vr(n)||Array.isArray(n)?void 0!==n&&(t[r]=n):null===t[r]||"object"!==vr(t[r])||Array.isArray(t[r])?t[r]=fl({},n):t[r]=fl(t[r],n)}}return t}function pl(t){var e;try{t.getContext("2d").getImageData(0,0,1,1)}catch(t){e=t.message}return e}function dl(t,e,i){var r;return t instanceof HTMLImageElement&&((r=t.ownerDocument.createElement("canvas")).width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,e,i),t=r),t}var yl=en.metersToLatLng([en.half_circumference_meters,en.half_circumference_meters]),gl=Math.log(en.tile_size)/Math.LN2,vl=function(){Ar(e,Bn);var t=Or(e);function e(i,r){var n;return _r(this,e),n=t.call(this,i,r),hn.is_worker&&(n._quad_tree=new Qr.H.geo.QuadTree,n._marker_quad_tree=new Qr.H.geo.QuadTree,n._tree_entries_by_object_id={},n._groups_by_id={},n._layersCache=new Qr.H.util.Cache(100)),hn.is_main&&(n._objects_by_id={},n._commands=[],n._sendCommands=Mn(n._sendCommands,100,200),n.dispatchUpdate=n.dispatchUpdate.bind(Pr(n))),n}return br(e,[{key:"hasLabeledData",value:function(){return!1}},{key:"onReady",value:function(){this._synced_at=this.provider.getInvalidations().getMark();var t,e,i=this.provider.getRootGroup(),r=i.getObjects(!0),n=[];for(r.push(i),t=r.length;t--;)e=r[t],this._isObjectSupported(e)&&this._shouldBeStored(e)&&(this._objects_by_id[e.getId()]=e,n.push(e.forWorkerMessage()));var o=[{method_name:"addObjects",arguments:[n]}];this._sendImmediateCommands(o)}},{key:"onProviderUpdate",value:function(t){var e,i,r,n,o=t.target,a=t.currentTarget.getInvalidations(o.type);this._isObjectSupported(o)&&(e=this._synced_at,i=o.getId(),a.isRemove(e)?(delete this._objects_by_id[i],this._commands.push({method_name:"removeObjectsByIds",arguments:[[i],!0]})):a.isAdd(e)?this._shouldBeStored(o)&&(this._objects_by_id[i]=o,this._commands.push({method_name:"addObjects",arguments:[[o.forWorkerMessage()]]})):a.isSpatial(e)||a.isZOrder(e)?this._shouldBeStored(o)&&(r=[{method_name:"removeObjectsByIds",arguments:[[i],!0]},{method_name:"addObjects",arguments:[[(this._objects_by_id[i]=o).forWorkerMessage()]]}],this.has_volatile_data&&!this.hasPendingCommands()?this._sendImmediateCommands(r):this._commands.push(r[0],r[1])):a.isVisual(e)?this._shouldBeStored(o)&&(n={method_name:"updateObjectProperties",arguments:[(this._objects_by_id[i]=o).forWorkerMessage()]},this.has_volatile_data&&!this.hasPendingCommands()?this._sendImmediateCommands([n]):this._commands.push(n)):a.isVolatility(e)&&(delete this._objects_by_id[i],this._commands.push({method_name:"removeObjectsByIds",arguments:[[i],!0]}),this._shouldBeStored(o)&&(this._objects_by_id[i]=o,this._commands.push({method_name:"addObjects",arguments:[[o.forWorkerMessage()]]}))),this._commands.length&&this._sendCommands()),this._synced_at=a.getMark()}},{key:"_shouldBeStored",value:function(t){return 16===t.type||(!t.getIcon||1===t.getIcon().getState())&&this._hasSameVolatility(t)}},{key:"_hasSameVolatility",value:function(t){return t.getVolatility(!0)===this.has_volatile_data}},{key:"hasPendingCommands",value:function(){return 0<this._commands.length}},{key:"_sendCommands",value:function(){this._sendImmediateCommands(this._commands),this._commands=[]}},{key:"_sendImmediateCommands",value:function(t){t.length&&fn.postMessage(this.worker,this.target_name+".executeCommands",t).then(this.dispatchUpdate)}},{key:"_isObjectSupported",value:function(t){return t.forWorkerMessage&&8!==t.type}},{key:"getSyncedAt",value:function(){return this._synced_at}},{key:"getMapObjectById",value:function(t){return this._objects_by_id[t]}},{key:"getIconBitmapByObjectId",value:function(t,e){var i=this.getMapObjectById(t);if(i){var r=i.getIcon();if(r.uid===e&&1===r.getState()){var n=r.getSize();return dl(r.getBitmap(),n.w,n.h)}}}},{key:"_getRastersForMarkers",value:function(t){for(var e={},i=hl("binary-tree"),r=0;r<t.length;r++){var n=t[r],o=n.properties.icon;e[o.id]||(i.addItem({width:o.size.w,height:o.size.h,meta:{objectId:n.id,id:o.id}}),e[o.id]=!0)}return i.export()}},{key:"fetchFeaturesForTile",value:function(t){var i=[],r=[],n=[],o=[],a=[],s=this._marker_quad_tree.intersectBoundingBox(en.getTileBoundingBox(t.coords,this.tile_size));t.source_data.error=null;for(var l=0;l<s.length;l++){var u={id:s[l].$feature$.id,properties:Object.assign({},s[l].$feature$.properties),geometry:{type:s[l].$feature$.geometry.type,coordinates:Ko.deepClone(s[l].$feature$.geometry.coordinates)}};i.push(u)}s=this._quad_tree.intersectBoundingBox(en.getTileBoundingBox(t.coords,this.tile_size,100));for(var c=0;c<s.length;c++){var h,f={id:s[c].$feature$.id,properties:Object.assign({},s[c].$feature$.properties),geometry:{type:s[c].$feature$.geometry.type,coordinates:Ko.deepClone(s[c].$feature$.geometry.coordinates)}};f.properties.overlay?r.push(f):f.geometry.type.includes("LineString")?n.push(f):f.geometry.type.includes("Polygon")&&(o.push(f),h={id:f.id,properties:f.properties,geometry:{type:f.geometry.type,coordinates:Ko.deepClone(f.geometry.coordinates)}},a.push(h))}i.sort(function(t,i){return e._compareZInfo(i,t)}),o.sort(e._compareZInfo),r.sort(e._compareZInfo);var p=this.has_volatile_data?4096:0;a.sort(e._compareZInfo);for(var d=0;d<a.length;d++)a[d].properties.effectiveZIdx=p++;n.sort(e._compareZInfo);for(var y=0;y<n.length;y++)n[y].properties.effectiveZIdx=p++;t.source_data.layers.markers={type:"FeatureCollection",features:i},t.source_data.layers.polylines={type:"FeatureCollection",features:n},t.source_data.layers.polygons={type:"FeatureCollection",features:o},t.source_data.layers.outlines={type:"FeatureCollection",features:a},t.source_data.layers.overlays={type:"FeatureCollection",features:r}}},{key:"tileTexture",value:function(t){var e=t.source_data.layers.overlays;if(e){var i=this.name+"_"+t.coords.key,r=Wo.coordinateWithMaxZoom(t.coords,this.max_zoom),n=e.features[0].properties.overlays_config;return{name:i,filtering:this.filtering,coords:r,width:en.tile_size,height:en.tile_size,overlays_config:n,source:this.name}}}},{key:"_load",value:function(t){var e=en.wrapTile(t.coords,{x:!0}),i=e.z,r=e.x,n=e.y,o="".concat(i,"_").concat(r,"_").concat(n),a=this._layersCache.get(o),s=!1;if(a)t.source_data.layers=a;else{this.fetchFeaturesForTile(t);var l={maxZoom:this.max_zoom,tolerance:1.5,extent:en.tile_scale},u=t.source_data.layers.overlays;u.features.length&&delete t.source_data.layers.overlays;var c=t.source_data.layers.markers;for(var h in c.features.length&&delete t.source_data.layers.markers,t.source_data.layers){var f,p=t.source_data.layers[h];p.features.length&&(l.buffer=h.includes("lines")?100*en.units_per_pixel:0,f=xa(p,i,r,n,l),t.source_data.layers[h]=ho(f))}t.source_data.layers.overlays=this._processOverlays(t,u);for(var d=t.source_data.layers.overlays.features.length;d--;)if(!t.source_data.layers.overlays.features[d].id){s=!0,this._layersCache.drop(o);break}t.source_data.layers.markers=this._processMarkers(t,c),this._postProcessTile(t),s||this._layersCache.add(o,t.source_data.layers,1)}return t.rasters=this._getRastersForMarkers(t.source_data.layers.markers.features),Promise.resolve(t)}},{key:"_processMarkers",value:function(t,e){var i=e.features.length;if(i){for(var r=en.unitsPerMeter(t.coords.z),n=en.wrapTile(t.coords,{x:!0}),o=en.metersForTile(n),a=en.isLastTile(n),s=en.tile_scale,l=function(t){zn.coordsToMeters(t),zn.metersToTileUnits(r,o,t);var e=Lr(t,2),i=e[0],n=e[1];return 0<=i&&(a.column||i<s)&&0<=n&&(a.row||n<s)},u=[],c=0;c<i;c++){var h,f=e.features[c].geometry,p=!1;"Point"===f.type?l(h=f.coordinates)?f.coordinates=h:p=!0:"MultiPoint"===f.type&&(f.coordinates=f.coordinates.filter(l),0===f.coordinates.length&&(p=!0)),p||u.push(e.features[c])}e.features=u}return e}},{key:"_processOverlays",value:function(t,e){var i=this;if(!e.features.length)return e;var r={coords:t.coords,min:en.metersForTile(en.wrapTile(t.coords,{x:!0}))},n={coords:t.coords,source_data:{layers:{_default:{type:"FeatureCollection",features:e.features}}}},o=Math.pow(2,t.coords.z+gl);Bn.projectData(n.source_data),Bn.scaleData(n.source_data,r);var a=e.features.map(function(t){var e=t.geometry.coordinates[0],i=e[0],r=e[5===e.length?2:3],n=Math.floor(i[0]/en.tile_scale*en.tile_size),a=Math.floor(i[1]/en.tile_scale*en.tile_size),s=Math.floor(r[0]/en.tile_scale*en.tile_size),l=Math.floor(r[1]/en.tile_scale*en.tile_size)-a,u=s<=n,c=u?o-(n-s):s-n,h=[];return n<=en.tile_size&&h.push([n,a,c,l]),u&&0<s&&h.push([n-o,a,c,l]),{id:t.id,properties:t.properties,texcoords:h}}).filter(function(e){return i._isVisible(e.properties)&&i.isInMinMaxRange(e.properties,t.style_zoom)}),s=en.tile_scale;return t.pad_scale=this.pad_scale,t.default_winding="CW",e.features=a.length?[{geometry:{type:"Polygon",coordinates:[[[0,0],[s,0],[s,s],[0,s],[0,0]]]},properties:{overlays_config:a}}]:a,e}},{key:"executeCommands",value:function(t){for(var e,i=t.length<10,r=0;r<t.length;r++){var n=t[r];n.arguments.push(i);var o=this[n.method_name].apply(this,n.arguments);i&&(o&&e?e.mergeRect(o,!0,e):o&&(e=o))}return e?e.forWorkerMessage():void 0}},{key:"_getClampedGeoRectForFeature",value:function(t){var e=t.geometry.boundingBox;return new Qr.H.geo.Rect(Jr.clamp(e[0],-yl[1],yl[1]),e[1],Jr.clamp(e[2],-yl[1],yl[1]),e[3])}},{key:"addObjects",value:function(t,i){for(var r,n=1<arguments.length&&void 0!==i&&i,o=0;o<t.length;o++){var a,s,l,u=t[o];"Group"===u.type?(u.$children_ids$={},this._groups_by_id[u.id]=u):(e._preprocessGeometry(u.geometry),a=this._getClampedGeoRectForFeature(u),n&&(r?r.mergeRect(a,!0,r):r=a),(l=(s=-1!==u.geometry.type.indexOf("Point")?this._marker_quad_tree:this._quad_tree).insertBoundingBox(a)).$tree=s,l.$feature$=u,this._tree_entries_by_object_id[u.id]=l)}for(var c=0;c<t.length;c++){var h=t[c];h.properties.parent&&(this._groups_by_id[h.properties.parent].$children_ids$[h.id]=h.id),h.properties.ref={effectiveVisibility:this._isVisible(h.properties),zInfo:this._getZInfo([],h)}}return this._layersCache.removeAll(),r}},{key:"removeObjectsByIds",value:function(t,e,i){for(var r,n=2<arguments.length&&void 0!==i&&i,o=0;o<t.length;o++){var a,s=t[o],l=void 0,u=void 0;(l=this._tree_entries_by_object_id[s])?(n&&(a=this._getClampedGeoRectForFeature(l.$feature$),r?r.mergeRect(a,!0,r):r=a),delete this._groups_by_id[l.$feature$.properties.parent].$children_ids$[s],l.$tree.remove(l),delete this._tree_entries_by_object_id[s]):(u=this._groups_by_id[s])&&(u.properties.parent&&delete this._groups_by_id[u.properties.parent].$children_ids$[s],e&&this.removeObjectsByIds(Object.keys(u.$children_ids$),!0),delete this._groups_by_id[s])}return this._layersCache.removeAll(),r}},{key:"updateObjectProperties",value:function(t,e){var i,r=1<arguments.length&&void 0!==e&&e;return"Group"===t.type?(fl(this._groups_by_id[t.id].properties,t.properties),this._groups_by_id[t.id].properties.ref.effectiveVisibility=this._isVisible(t.properties)):(this._tree_entries_by_object_id[t.id]||this.addObjects([t]),fl(this._tree_entries_by_object_id[t.id].$feature$.properties,t.properties),this._tree_entries_by_object_id[t.id].$feature$.properties.ref.effectiveVisibility=this._isVisible(t.properties),r&&(i=this._getClampedGeoRectForFeature(t))),i}},{key:"_getZInfo",value:function(t,e){var i=e.properties.zIdx,r=e.properties.sIdx;return t[0]|=void 0!==i,t.splice(1,0,i||0,r<0?e.id:r),0===e.properties.parent?t:this._getZInfo(t,this._groups_by_id[e.properties.parent])}},{key:"_isVisible",value:function(t){var e=t.visible,i=!t.parent||this._isVisible(this._groups_by_id[t.parent].properties);return e&&i}},{key:"isInMinMaxRange",value:function(t,e){var i=t.min<=e&&t.max>=e,r=!t.parent||this.isInMinMaxRange(this._groups_by_id[t.parent].properties,e);return i&&r}},{key:"dispose",value:function(){this._commands=[],Cr(Tr(e.prototype),"dispose",this).call(this)}}],[{key:"_compareZInfo",value:function(t,e){for(var i,r=t.properties.ref.zInfo,n=e.properties.ref.zInfo,o=r.length,a=n.length,s=Math.min(o,a),l=1;l<s;l++)if(i=r[l]-n[l])return i;return o-a}},{key:"_preprocessGeometry",value:function(t){var i=t.type;t.coordinates="Point"===i?e._processPointCoordinates(t.coordinates):"MultiPoint"===i?t.coordinates.map(e._processPointCoordinates):"LineString"===i?e._processLineStringCoordinates(t.coordinates):"MultiLineString"===i?t.coordinates.map(e._processLineStringCoordinates):"Polygon"===i?t.coordinates.map(e._processPolygonCoordinates):"MultiPolygon"===i?t.coordinates.map(e._processMultiPolygonCoordinates):[]}},{key:"_processPointCoordinates",value:function(t){return[t[1],t[0],t[2]]}},{key:"_processLineStringCoordinates",value:function(t){return e._latLngAltArrayToLineString(t,!1)}},{key:"_processPolygonCoordinates",value:function(t){return e._latLngAltArrayToLineString(t,!0)}},{key:"_processMultiPolygonCoordinates",value:function(t){return t.map(e._processPolygonCoordinates)}},{key:"_latLngAltArrayToLineString",value:function(t,e){for(var i=[],r=t.length,n=0;n<r;n+=3)i.push([t[n+1],t[n]]);return e&&i.push([t[1],t[0]]),i}}]),e}();Bn.register(vl,"ObjectSource");var _l=1,ml=2,bl=3,xl=function(){function t(){_r(this,t),this._map={}}return br(t,[{key:"set",value:function(t,e,i){var r;this._map[t]?this._map[t].accumulator.add(i):((r=new Set).add(i),this._map[t]={value:e,accumulator:r})}},{key:"get",value:function(t){return this._map[t]&&this._map[t].value}},{key:"delete",value:function(t,e){var i=this._map[t];i&&i.accumulator&&(i.accumulator.delete(e),0===i.accumulator.size&&delete this._map[t])}}]),t}(),wl=function(){Ar(e,Bn);var t=Or(e);function e(i,r){var n;return _r(this,e),n=t.call(this,i,r),hn.is_worker||(n._icons=new xl),n}return br(e,[{key:"onProviderUpdate",value:function(t){t.target instanceof H.map.provider.Tile?this.dispatchUpdate(t.target,t.data):this.dispatchUpdate(void 0,t.data)}},{key:"onReady",value:function(){var t=this.provider;t.setTileCanvasRendering&&t.setTileCanvasRendering(!1),t.providesMarkers()&&(this._onCacheDrop=this._onCacheDrop.bind(this),t.getCache().registerOnDrop(this._onCacheDrop)),this.dispatchUpdate()}},{key:"dispose",value:function(){Cr(Tr(e.prototype),"dispose",this).call(this);var t=this.provider;t.providesMarkers()&&t.getCache().deRegisterOnDrop(this._onCacheDrop)}},{key:"_onCacheDrop",value:function(t,e){this.provider.cacheFilter(t)&&this._deleteIcons(t,e.data)}},{key:"_deleteIcons",value:function(t,e){for(var i=0,r=e.length;i<r;i++){var n=e[i].getIcon();this._icons.delete(n.uid,t)}}},{key:"getIconBitmapByObjectId",value:function(t,e){var i=this._icons.get(e);return i&&i.getBitmap()}},{key:"requestMarkerTile",value:function(t){var e=this;return new Promise(function(i,r){e.provider?e.provider.requestTileAsPromise(t.x,t.y,t.z,!1).then(function(t){var r,n,o=[];if(t.data)for(n=(r=t.data).length;n--;){var a=r[n],s=a.getIcon();e._icons.set(s.uid,s,t.key),o.push(a.forWorkerMessage())}i(o)}):i([])})}},{key:"requestSpatialTile",value:function(t){var e=this;return new Promise(function(i,r){e.provider?e.provider.requestTileAsPromise(t.x,t.y,t.z,!1).then(function(t){var e,r=[];if(t.getObjects){e=t.getObjects();for(var n=0;n<e.length;n++){var o=e[n];r.push({id:o.getId(),geometries:o.getGeometriesForTile(t),isClosed:o.isClosed(),style:o.getStyle().forWorkerMessage()})}}i(r)}):i([])})}},{key:"_pointToArray",value:function(t){var e=en.tile_scale/this.tile_size;return[t.x*e,t.y*e]}},{key:"_getGeoJsonMultiPolygon",value:function(t){for(var e=t.geometries,i=e.length,r=[],n={coordinates:r,type:"MultiPolygon"},o=0;o<i;o++){for(var a=e[o],s=a.paths,l=s.length,u=a.interiorsIndex,c=a.outlinesIndex,h=Math.min(u,c,l),f=void 0,p=void 0,p=0;p<h;p++)f=[s[p].map(this._pointToArray,this)],r.push(f);if(1===h)for(h=Math.min(c,l),p=u;p<h;p++)f.push(s[p].map(this._pointToArray,this))}return n}},{key:"_getGeoJsonMultiLineString",value:function(t,e){for(var i=1<arguments.length&&void 0!==e&&e,r={coordinates:[],type:"MultiLineString"},n=t.geometries,o=0;o<n.length;o++)for(var a=n[o],s=i?a.outlinesIndex:0,l=i?a.paths.length:Math.min(a.interiorsIndex,a.outlinesIndex,a.paths.length),u=s;u<l;u++){var c=a.paths[u].map(this._pointToArray,this);r.coordinates.push(c)}return r}},{key:"_getGeoJsonGeometry",value:function(t,e){var i=e===_l?this._getGeoJsonMultiPolygon(t):this._getGeoJsonMultiLineString(t,e===bl);return i.coordinates.length?i:null}},{key:"_load",value:function(t){var e=this;return new Promise(function(i,r){var n=fn.postMessage(e.target_name+".requestMarkerTile",t.coords).then(e._prepareTileData.bind(e,t)),o=new Promise(function(i,r){fn.postMessage(e.target_name+".requestSpatialTile",t.coords).then(function(r){for(var n=[],o=[],a=[],s=0;s<r.length;s++){var l,u=r[s],c=void 0,h=void 0,h=u.isClosed?(c=o,_l):(c=n,ml),f=e._getGeoJsonGeometry(u,h);f&&(l={id:u.id,type:"Feature",properties:{height:0,style:u.style},geometry:f},h===ml&&(l.properties.effectiveZIdx=n.length),c.push(l));var p=e._getGeoJsonGeometry(u,bl);p&&a.push({id:u.id,type:"Feature",properties:{height:0,style:u.style,effectiveZIdx:a.length},geometry:p})}t.source_data.layers.polylines={type:"FeatureCollection",features:n},t.source_data.layers.polygons={type:"FeatureCollection",features:o},t.source_data.layers.outlines={type:"FeatureCollection",features:a},i(t)})});Promise.all([n,o]).then(function(r){e._postProcessTile(t),i(t)})})}},{key:"_prepareTileData",value:function(t,e){var i=en.wrapTile(t.coords,{x:!0,y:!0}),r=en.metersForTile(i);t.source_data.layers={markers:{features:e,type:"FeatureCollection"}};var n={coords:i,min:r},o=t.source_data,a=hl("binary-tree"),s={};for(var l in o.layers)for(var u=o.layers[l].features.length,c=0;c<u;c++){var h=o.layers[l].features[c],f=h.properties.icon;s[f.id]||(a.addItem({width:f.size.w,height:f.size.h,meta:{objectId:h.id,id:f.id}}),s[f.id]=!0),en.transformGeometry(h.geometry,function(t){var e=t[0];t[0]=t[1],t[1]=e})}return t.rasters=a.export(),Bn.projectData(t.source_data),Bn.scaleData(t.source_data,n),t}}]),e}();Bn.register(wl,"ObjectTileSource");var kl=function(){Ar(e,Yo);var t=Or(e);function e(i,r){var n;return _r(this,e),(n=t.call(this,i,r)).uid_=i.uid,n}return br(e,[{key:"initialize",value:function(t,e){this.provider=t,this._on_update=e,this._onProviderUpdate=this._onProviderUpdate.bind(this),t.addEventListener("update",this._onProviderUpdate)}},{key:"_onProviderUpdate",value:function(){this._on_update(this.name)}},{key:"tileTexture",value:function(t){return Object.assign(Cr(Tr(e.prototype),"tileTexture",this).call(this,t),{uid:this.uid_,url:this.uid_+"_"+t.coords.key,coords:t.coords})}},{key:"dispose",value:function(){this.provider.removeEventListener("update",this._onProviderUpdate)}}]),e}();function Al(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||24<e.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=Jo(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=pa(r,e)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Tl(t,e,i){return 32*((1<<t)*i+e)+t}zn.register(kl,"RemoteRasterTileSource"),Al.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Al.prototype.splitTile=function(t,e,i,r,n,o,a){for(var s=[t,e,i,r],l=this.options,u=l.debug;s.length;){r=s.pop(),i=s.pop(),e=s.pop(),t=s.pop();var c,h,f,p,d,y,g,v,_,m,b,x=1<<e,w=Tl(e,i,r),k=this.tiles[w];if(k||(1<u&&console.time("creation"),k=this.tiles[w]=_a(t,e,i,r,l),this.tileCoords.push({z:e,x:i,y:r}),u&&(1<u&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,r,k.numFeatures,k.numPoints,k.numSimplified),console.timeEnd("creation")),c="z"+e,this.stats[c]=(this.stats[c]||0)+1,this.total++)),k.source=t,n){if(e===l.maxZoom||e===n)continue;var A=1<<n-e;if(i!==Math.floor(o/A)||r!==Math.floor(a/A))continue}else if(e===l.indexMaxZoom||k.numPoints<=l.indexMaxPoints)continue;k.source=null,0!==t.length&&(1<u&&console.time("clipping"),f=.5-(h=.5*l.buffer/l.extent),d=1+h,_=y=g=v=null,m=aa(t,x,i-h,i+(p=.5+h),0,k.minX,k.maxX,l),b=aa(t,x,i+f,i+d,0,k.minX,k.maxX,l),t=null,m&&(_=aa(m,x,r-h,r+p,1,k.minY,k.maxY,l),y=aa(m,x,r+f,r+d,1,k.minY,k.maxY,l),m=null),b&&(g=aa(b,x,r-h,r+p,1,k.minY,k.maxY,l),v=aa(b,x,r+f,r+d,1,k.minY,k.maxY,l),b=null),1<u&&console.timeEnd("clipping"),s.push(_||[],e+1,2*i,2*r),s.push(y||[],e+1,2*i,2*r+1),s.push(g||[],e+1,2*i+1,2*r),s.push(v||[],e+1,2*i+1,2*r+1))}},Al.prototype.getTile=function(t,e,i){var r=this.options,n=r.extent,o=r.debug;if(t<0||24<t)return null;var a=1<<t,s=Tl(t,e=(e%a+a)%a,i);if(this.tiles[s])return ga(this.tiles[s],n);1<o&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,u=t,c=e,h=i;!l&&0<u;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[Tl(u,c,h)];return l&&l.source?(1<o&&console.log("found parent tile z%d-%d-%d",u,c,h),1<o&&console.time("drilling down"),this.splitTile(l.source,u,c,h,t,e,i),1<o&&console.timeEnd("drilling down"),this.tiles[s]?ga(this.tiles[s],n):null):null};var El={type:"FeatureCollection",features:[]},Ml=function(){Ar(e,Bn);var t=Or(e);function e(i,r){return _r(this,e),i.tiled=!0,i.url="",t.call(this,i,r)}return br(e,[{key:"fetchTile",value:function(t,e,i){return this.provider?this.provider.requestTileAsPromise(t,e,i).then(function(t){return t.data}):Promise.resolve(El)}},{key:"_load",value:function(t){var e=this,i=en.wrapTile(t.coords,{x:!0,y:!0}),r={indexMaxZoom:0,maxZoom:this.max_zoom,tolerance:1.5,extent:en.tile_scale};return fn.postMessage(this.target_name+".fetchTile",i.x,i.y,i.z).then(function(n){for(var o in t.source_data.layers="FeatureCollection"===n.type?{_default:n}:n,t.source_data.layers){var a=new Al(t.source_data.layers[o],r).getTile(i.z,i.x,i.y);t.source_data.layers[o]=ho(a)}return e._postProcessTile(t),t})}},{key:"onReady",value:function(){this.dispatchUpdate()}}]),e}();zn.register(Ml,"GeoJSONTileSource");var Sl,Rl={layers:{_default:{type:"FeatureCollection",features:[{type:"Point",geometry:{}}]}}},Pl=function(){Ar(e,zn);var t=Or(e);function e(i,r){return _r(this,e),i.max_zoom=0,t.call(this,i,r)}return br(e,[{key:"load",value:function(t){return t.source_data="0/0/0"===t.coords.key?Rl:void 0,Promise.resolve(t)}}]),e}();zn.register(Pl,"SkyBox");var Ol=Sl={draw_label_collision_boxes:!1,draw_label_texture_boxes:!1,suppress_label_fade_in:!1,suppress_snap_animation:!1,show_hidden_labels:!1,layer_stats:!1};var Cl,Ll=0,Il=1;function jl(t,e){var i={};return e.forEach(function(e){return i[e]=t[e]}),i}var Nl=Cl={},zl=0;Cl.getContext=function(t,e){var i=!1;null==t&&((t=document.createElement("canvas")).style.position="absolute",t.style.top=0,t.style.left=0,t.style.zIndex=-1,document.body.appendChild(t),i=!0);var r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(!r)throw new Error("Couldn't create WebGL context.");return r._tangram_id=zl++,i?(Cl.resize(r,window.innerWidth,window.innerHeight,e.device_pixel_ratio),window.addEventListener("resize",function(){Cl.resize(r,window.innerWidth,window.innerHeight,e.device_pixel_ratio)})):Cl.resize(r,parseFloat(t.style.width),parseFloat(t.style.height),e.device_pixel_ratio),r},Cl.resize=function(t,e,i,r){t.canvas.style.width=e+"px",t.canvas.style.height=i+"px",t.canvas.width=Math.round(e*r),t.canvas.height=Math.round(i*r),t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.canvas.width,t.canvas.height)};var Dl={parseUniforms:function(t){var e=[];for(var i in t){var r,n=i,o=t[i];if("number"==typeof o)e.push({type:"float",method:"1f",name:i,value:o,key:n,uniforms:t});else if(Array.isArray(o)){if("number"==typeof o[0])2<=o.length&&o.length<=4?e.push({type:"vec"+o.length,method:o.length+"fv",name:i,value:o,key:n,uniforms:t}):4<o.length&&e.push({type:"float[]",method:"1fv",name:i+"[0]",value:o,key:n,uniforms:t});else if("string"==typeof o[0])for(r=0;r<o.length;r++)e.push({type:"sampler2D",method:"1i",name:i+"["+r+"]",value:o[r],key:r,uniforms:o});else if(Array.isArray(o[0])&&"number"==typeof o[0][0]&&2<=o[0].length&&o[0].length<=4)for(r=0;r<o.length;r++)e.push({type:"vec"+o[0].length,method:o[r].length+"fv",name:i+"["+r+"]",value:o[r],key:r,uniforms:o})}else"boolean"==typeof o?e.push({type:"bool",method:"1i",name:i,value:o,key:n,uniforms:t}):"string"==typeof o&&e.push({type:"sampler2D",method:"1i",name:i,value:o,key:n,uniforms:t})}return e},defineVariable:function(t,e){var i,r;if("number"==typeof e)i="float";else if(Array.isArray(e))"number"==typeof e[0]?2<=e.length&&e.length<=4?i="vec"+e.length:(i="float",r=e.length):"string"==typeof e[0]&&(i="sampler2D",r=e.length);else if("boolean"==typeof e)i="bool";else{if("string"!=typeof e)return;i="sampler2D"}var n="";return n+="".concat(i," ").concat(t),r&&(n+="[".concat(r,"]")),n+=";\n"},defineUniform:function(t,e){var i=Dl.defineVariable(t,e);if(i)return"uniform "+i},isUniformDefined:function(t,e){var i=new RegExp("uniform[^;]+(?:{[\\s\\S]*})?[^;]*\\b"+t+"\\b","g");return!!e.match(i)},isSymbolReferenced:function(t,e){var i=new RegExp("\\b"+t+"\\b","g");return 0<=e.search(i)},expandVec3:function(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;if(Array.isArray(t)){if(2!==t.length)return t;e=[].concat(Ir(t),[i]).map(parseFloat)}else e=[t,t,t].map(parseFloat);if(e&&e.every(function(t){return"number"==typeof t&&!isNaN(t)}))return e},expandVec4:function(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;if(Array.isArray(t)){if(3!==t.length)return t;e=[].concat(Ir(t),[i]).map(parseFloat)}else e=[t,t,t,i].map(parseFloat);if(e&&e.every(function(t){return"number"==typeof t&&!isNaN(t)}))return e}},Fl=[];function Ul(t,e){var i=Fl.filter(function(e){return e[0]===t})[0];return(i=i&&i[1])||(Fl.push([t,{}]),i=Fl[Fl.length-1][1]),i[e]||(i[e]=t.getExtension(e)),i[e]}function Bl(t){var e,i,r=0;if(0===t.length)return r;for(e=0,i=t.length;e<i;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return r}var Gl=a(function(t){var e="(.|[\\r\\n]|\\n)*?\\*\\/\\n?\\n?",i=/(^|[^\S\n])(?:\/\/)([\s\S]+?)$/gm,r=/(^|[^\S\n])(?:\/\/[^!])([\s\S]+?)$/gm,n=t.exports=function(t,e){return t?n.block(n.line(t,e),e):""};n.block=function(t,i){i=i||{};var r=new RegExp("\\/\\*"+e,"gm");return i.safe&&(r=new RegExp("\\/\\*(?!\\*?\\!)"+e,"gm")),t?t.replace(r,""):""},n.line=function(t,e){var n=i;return(e=e||{}).safe&&(n=r),t?t.replace(n,""):""}}),Hl=function(t){t=String(t);var e,i=[];for(;e=t.match(/ERROR\:([^\n]+)/);){t=t.slice(e.index+1);var r=(a=e[1].trim()).split(":"),n=r.slice(2).join(":").trim(),o=parseInt(r[0],10),a=parseInt(r[1],10);i.push({message:n,file:o,line:a})}return i};var Vl=/^\s*#pragma.*$/gm,ql=/\\\s*\n/gm,Wl=function(){function t(e,i,r,n,o){if(_r(this,t),o=o||{},this.textureManager=Do(n),this.gl=e,this.program=null,this.compiled=!1,this.compiling=!1,this.error=null,!t.polyfills[n]){t.polyfills[n]={};try{this.gl.uniformMatrix3fv(null,!1,new Float64Array(9))}catch(e){t.polyfills[n].uniformMatrix3fv=this.gl.uniformMatrix3fv,this.gl.uniformMatrix3fv=function(e,i,r){t.polyfills[n].uniformMatrix3fv.call(this,e,i,new Float32Array(r))}}try{this.gl.uniformMatrix4fv(null,!1,new Float64Array(16))}catch(e){t.polyfills[n].uniformMatrix4fv=this.gl.uniformMatrix4fv,this.gl.uniformMatrix4fv=function(e,i,r){t.polyfills[n].uniformMatrix4fv.call(this,e,i,new Float32Array(r))}}}this.defines=Object.assign({},o.defines||{}),this.blocks=Object.assign({},o.blocks||{}),this.block_scopes=Object.assign({},o.block_scopes||{}),this.extensions=o.extensions||[],this.dependent_uniforms=o.uniforms,this.uniforms={},this.attribs={},this.vertex_source=i,this.fragment_source=r,this.id=t.id++,this.name=o.name}return br(t,[{key:"destroy",value:function(){this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.uniforms={},this.attribs={},this.compiled=!1}},{key:"use",value:function(){this.compiled&&(t.current!==this&&this.gl.useProgram(this.program),t.current=this)}},{key:"compile",value:function(){var e=this;if(this.compiling)throw new Error("ShaderProgram.compile(): skipping for ".concat(this.id," (").concat(this.name,") because already compiling"));this.compiling=!0,this.compiled=!1,this.error=null,this.computed_vertex_source=this.vertex_source,this.computed_fragment_source=this.fragment_source;var i,r=this.checkExtensions(),n=this.buildDefineList(),o=this.buildShaderBlockList();for(var a in o){var s,l,u,c=o[a];!c||Array.isArray(c)&&0===c.length||(i=new RegExp("^\\s*#pragma\\s+tangram:\\s+"+a+"\\s*$","m"),s=this.computed_vertex_source.match(i),l=this.computed_fragment_source.match(i),null==s&&null==l||(u="",c.forEach(function(t){var e="".concat(t.scope,", ").concat(t.key,", ").concat(t.num);u+="\n// tangram-block-start: ".concat(e,"\n"),u+=t.source,u+="\n// tangram-block-end: ".concat(e,"\n")}),null!=s&&(this.computed_vertex_source=this.computed_vertex_source.replace(i,u)),null!=l&&(this.computed_fragment_source=this.computed_fragment_source.replace(i,u)),n["TANGRAM_BLOCK_"+a.replace(/[\s-]+/g,"_").toUpperCase()]=!0))}this.computed_vertex_source=this.computed_vertex_source.replace(Vl,""),this.computed_fragment_source=this.computed_fragment_source.replace(Vl,""),this.ensureUniforms(this.dependent_uniforms);var h="",f=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT),h=f&&0<f.precision?"precision highp float;\n":"precision mediump float;\n";n.TANGRAM_VERTEX_SHADER=!0,n.TANGRAM_FRAGMENT_SHADER=!1,this.computed_vertex_source=h+t.buildDefineString(n)+this.computed_vertex_source,n.TANGRAM_VERTEX_SHADER=!1,n.TANGRAM_FRAGMENT_SHADER=!0,this.computed_fragment_source=t.buildExtensionString(r)+h+t.buildDefineString(n)+this.computed_fragment_source,this.computed_vertex_source=this.computed_vertex_source.replace(ql,""),this.computed_fragment_source=this.computed_fragment_source.replace(ql,"");try{this.program=t.updateProgram(this.gl,this.program,this.computed_vertex_source,this.computed_fragment_source),this.compiled=!0,this.compiling=!1}catch(r){throw this.program=null,this.compiled=!1,this.compiling=!1,"vertex"!==(this.error=r).type&&"fragment"!==r.type||(this.shader_errors=r.errors,this.shader_errors.forEach(function(t){t.type=r.type,t.block=e.block(r.type,t.line)})),r}this.computed_vertex_source=null,this.computed_fragment_source=null,this.use(),this.refreshUniforms(),this.refreshAttributes()}},{key:"buildDefineList",value:function(){var e,i={};for(e in t.defines)i[e]=t.defines[e];for(e in this.defines)i[e]=this.defines[e];return i}},{key:"buildShaderBlockList",value:function(){var e,i,r={};for(e in t.blocks){r[e]=[],Array.isArray(t.blocks[e])?(i=r[e]).push.apply(i,Ir(t.blocks[e].map(function(t,i){return{key:e,source:t,num:i,scope:"ShaderProgram"}}))):r[e]=[{key:e,source:t.blocks[e],num:0,scope:"ShaderProgram"}]}for(e in this.blocks)if(r[e]=r[e]||[],Array.isArray(this.blocks[e]))for(var n=this.block_scopes&&this.block_scopes[e]||[],o=null,a=0,s=0;s<this.blocks[e].length;s++)n[s]!==o&&(o=n[s],a=0),r[e].push({key:e,source:this.blocks[e][s],num:a,scope:o||this.name}),a++;else r[e].push({key:e,source:this.blocks[e],num:0,scope:this.name});return r}},{key:"ensureUniforms",value:function(t){if(t){var e,i=Gl(this.computed_vertex_source),r=Gl(this.computed_fragment_source),n=[],o=[];for(var a in t){var s=Dl.isUniformDefined(a,i),l=Dl.isUniformDefined(a,r);if(!s||!l){if(!(e=Dl.defineUniform(a,t[a])))continue;s||(En("trace","Program ".concat(this.name,": ").concat(a," not defined in vertex shader, injecting: '").concat(e,"'")),n.push(e)),l||(En("trace","Program ".concat(this.name,": ").concat(a," not defined in fragment shader, injecting: '").concat(e,"'")),o.push(e))}}0<n.length&&(this.computed_vertex_source=n.join("\n")+this.computed_vertex_source),0<o.length&&(this.computed_fragment_source=o.join("\n")+this.computed_fragment_source)}}},{key:"setUniforms",value:function(t,e){var i=!(1<arguments.length&&void 0!==e)||e;if(this.compiled){i&&(this.texture_unit=0);for(var r=Dl.parseUniforms(t),n=0;n<r.length;n++){var o=r[n];"sampler2D"===o.type?this.setTextureUniform(o.name,o.value):this.uniform(o.method,o.name,o.value)}}}},{key:"saveUniforms",value:function(t){var e=t||this.uniforms;for(var i in e){var r=this.uniforms[i];r&&(r.saved_value=r.value)}this.saved_texture_unit=this.texture_unit||0}},{key:"restoreUniforms",value:function(t){var e=t||this.uniforms;for(var i in e){var r=this.uniforms[i];r&&r.saved_value&&(r.value=r.saved_value,this.updateUniform(r))}this.texture_unit=this.saved_texture_unit||0}},{key:"setTextureUniform",value:function(t,e){var i=this.textureManager.textures[e];null!=i?(i.bind(this.texture_unit),this.uniform("1i",t,this.texture_unit),this.texture_unit++):En("warn","Cannot find texture '".concat(e,"'"))}},{key:"uniform",value:function(t,e,i){var r;this.compiled&&(this.uniforms[e]=this.uniforms[e]||{},r=this.uniforms[e],r.name=e,void 0===r.location&&(r.location=this.gl.getUniformLocation(this.program,e)),r.method=t,r.value=i,this.updateUniform(r))}},{key:"updateUniform",value:function(t){this.compiled&&t&&null!=t.location&&(this.use(),this.commitUniform(t))}},{key:"commitUniform",value:function(t){var e=t.location,i=t.value;switch(t.method){case"1i":this.gl.uniform1i(e,i);break;case"1f":this.gl.uniform1f(e,i);break;case"2f":this.gl.uniform2f(e,i[0],i[1]);break;case"3f":this.gl.uniform3f(e,i[0],i[1],i[2]);break;case"4f":this.gl.uniform4f(e,i[0],i[1],i[2],i[3]);break;case"1iv":this.gl.uniform1iv(e,i);break;case"3iv":this.gl.uniform3iv(e,i);break;case"1fv":this.gl.uniform1fv(e,i);break;case"2fv":this.gl.uniform2fv(e,i);break;case"3fv":this.gl.uniform3fv(e,i);break;case"4fv":this.gl.uniform4fv(e,i);break;case"Matrix3fv":this.gl.uniformMatrix3fv(e,!1,i);break;case"Matrix4fv":this.gl.uniformMatrix4fv(e,!1,i)}}},{key:"refreshUniforms",value:function(){if(this.compiled)for(var t in this.uniforms){var e=this.uniforms[t];e.location=this.gl.getUniformLocation(this.program,t),this.updateUniform(e)}}},{key:"refreshAttributes",value:function(){this.attribs={}}},{key:"attribute",value:function(t){if(this.compiled){var e=this.attribs[t]=this.attribs[t]||{};return null!=e.location?e:(e.name=t,e.location=this.gl.getAttribLocation(this.program,t),e)}}},{key:"source",value:function(t){return"vertex"===t?this.computed_vertex_source:"fragment"===t?this.computed_fragment_source:void 0}},{key:"lines",value:function(t){var e=this.source(t);return e?e.split("\n"):[]}},{key:"line",value:function(t,e){var i=this.lines(t);if(i)return i[e]}},{key:"block",value:function(t,e){for(var i,r=this.lines(t),n=0;n<e&&n<r.length;n++){var o=r[n],a=o.match(/\/\/ tangram-block-start: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/);a&&1<a.length?i={scope:a[1],name:a[2],num:a[3]}:(a=o.match(/\/\/ tangram-block-end: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/))&&1<a.length&&(i=null),i&&(i.line=null==i.line?-1:i.line+1,i.source=o)}return i}},{key:"checkExtensions",value:function(){var t=this,e=[];return this.extensions.forEach(function(i){var r=Ul(t.gl,i),n="TANGRAM_EXTENSION_".concat(i);t.defines[n]=null!=r,r?e.push(i):En("debug","Could not enable extension '".concat(i,"'"))}),e}}]),t}();Wl.polyfills={},Wl.id=0,Wl.current=null,Wl.defines={},Wl.blocks={},Wl.reset=function(){Wl.programs_by_source={},Wl.shaders_by_source={}},Wl.reset(),Wl.buildDefineString=function(t){var e="";for(var i in t)null!=t[i]&&!1!==t[i]&&("boolean"==typeof t[i]&&!0===t[i]?e+="#define "+i+"\n":"number"==typeof t[i]&&Math.floor(t[i])===t[i]?e+="#define "+i+" "+t[i].toFixed(1)+"\n":e+="#define "+i+" "+t[i]+"\n");return e},Wl.buildExtensionString=function(t){var e="";return(t=t||[]).forEach(function(t){e+="#ifdef GL_".concat(t,"\n#extension GL_").concat(t," : enable\n#endif\n")}),e},Wl.addBlock=function(t){var e;Wl.blocks[t]=Wl.blocks[t]||[];for(var i=arguments.length,r=new Array(1<i?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];(e=Wl.blocks[t]).push.apply(e,r)},Wl.removeBlock=function(t){Wl.blocks[t]=[]},Wl.replaceBlock=function(t){Wl.removeBlock(t);for(var e=arguments.length,i=new Array(1<e?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];Wl.addBlock.apply(Wl,[t].concat(i))},Wl.updateProgram=function(t,e,i,r){var n=Bl(t._tangram_id+"::"+i+"::"+r);if(Wl.programs_by_source[n])return En("trace","Reusing identical source GL program object"),Wl.programs_by_source[n];var o=Wl.createShader(t,i,t.VERTEX_SHADER),a=Wl.createShader(t,r,t.FRAGMENT_SHADER);if(t.useProgram(null),null!=e)for(var s=t.getAttachedShaders(e),l=0;l<s.length;l++)t.detachShader(e,s[l]);else e=t.createProgram();if(null==o||null==a)return e;if(t.attachShader(e,o),t.attachShader(e,a),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS))return Wl.programs_by_source[n]=e;var u=new Error("WebGL program error:\n            VALIDATE_STATUS: ".concat(t.getProgramParameter(e,t.VALIDATE_STATUS),"\n            ERROR: ").concat(t.getError(),"\n            --- Vertex Shader ---\n            ").concat(i,"\n            --- Fragment Shader ---\n            ").concat(r));throw Object.assign(new Error(u),{type:"program"})};var Xl={disabled:!(Wl.createShader=function(t,e,i){var r=Bl(t._tangram_id+"::"+e);if(Wl.shaders_by_source[r])return En("trace","Reusing identical source GL shader object"),Wl.shaders_by_source[r];var n=t.createShader(i);if(t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS))return Wl.shaders_by_source[r]=n;var o=i===t.VERTEX_SHADER?"vertex":"fragment",a=t.getShaderInfoLog(n),s=Hl(a);throw Object.assign(new Error(a),{type:o,errors:s})}),bound_vao:[],init:function(t){var e;!0!==this.disabled&&(e=Ul(t,"OES_vertex_array_object")),null!=e?En("info","Vertex Array Object extension available"):!0!==this.disabled?En("warn","Vertex Array Object extension NOT available"):En("warn","Vertex Array Object extension force disabled")},create:function(t,e,i){var r={};r.setup=e,r.teardown=i;var n=Ul(t,"OES_vertex_array_object");return null!=n&&(r._vao=n.createVertexArrayOES(),n.bindVertexArrayOES(r._vao)),r.setup(!0),r},getCurrentBinding:function(t){var e=this.bound_vao.filter(function(e){return e[0]===t})[0];return e&&e[1]},setCurrentBinding:function(t,e){var i=this.bound_vao,r=i.filter(function(e){return e[0]===t})[0];null==r?i.push([t,e]):r[1]=e},bind:function(t,e){var i,r=Ul(t,"OES_vertex_array_object");null!=e?null!=r&&null!=e._vao?(r.bindVertexArrayOES(e._vao),this.setCurrentBinding(t,e)):e.setup(!1):(i=this.getCurrentBinding(t),null!=r?r.bindVertexArrayOES(null):null!=i&&"function"==typeof i.teardown&&i.teardown(),this.setCurrentBinding(t,null))},destroy:function(t,e){var i=Ul(t,"OES_vertex_array_object");null!=i&&null!=e&&null!=e._vao&&(i.deleteVertexArrayOES(e._vao),e._vao=null)}},Yl=function(){function t(e,i){_r(this,t),this._gl=e,this._requests={},this._pixels=null,this._has_dirty_buffer=!1,this._fbo=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._fbo_size={width:256,height:256};var r=Do(i).create(this._gl,"selection_fbo",{filtering:"nearest"});r.setData(this._fbo_size.width,this._fbo_size.height,null,{filtering:"nearest"}),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,r.texture,0);var n=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,n),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_COMPONENT16,this._fbo_size.width,this._fbo_size.height),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,n),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}return br(t,[{key:"destroy",value:function(){this._gl&&this._fbo&&(this._gl.deleteFramebuffer(this._fbo),this._fbo=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null))}},{key:"bind",value:function(){var e;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._gl.viewport(0,0,this._fbo_size.width,this._fbo_size.height),(e=this._gl).clearColor.apply(e,Ir(t.defaultColor))}},{key:"getFeatureAt",value:function(e,i,r){var n=i.radius,o=i.top_most_only,a=void 0===o||o;!e||e.x<0||e.y<0||1<e.x||1<e.y?r({features:null}):(this.selection_request_id=this.selection_request_id+1||0,this._requests[this.selection_request_id]={id:this.selection_request_id,point:e,radius:n,top_most_only:a,ttl:a?1:t.MAX_PICKING_TRIES,callback:r})}},{key:"hasPendingRequests",value:function(){return 0<Object.keys(this._requests).length}},{key:"clearPendingRequests",value:function(){for(var t in this._requests){this._requests[t].callback(new Error("cleared")),delete this._requests[t]}this._pending_deep_request=null}},{key:"read",value:function(t){if(this.hasPendingRequests()){var e=this._gl;for(var i in e.bindFramebuffer(e.FRAMEBUFFER,this._fbo),this._pending_deep_request&&this.processRequest(this._pending_deep_request,t),this._requests)if(this.processRequest(this._requests[i],t))break;e.bindFramebuffer(e.FRAMEBUFFER,null)}}},{key:"processRequest",value:function(e,i){var r,n,o,a=this._gl,s=255,l=e.point,u=e.radius,c=(o=u?(n=Math.min(this._fbo_size.width,this._fbo_size.height),{x:Math.min(Math.ceil(2*u.x*this._fbo_size.width),n),y:Math.min(Math.ceil(2*u.y*this._fbo_size.height),n)}):(u={x:0,y:0},{x:1,y:1})).x*o.y*4;if(null==this._pixels||this._pixels.byteLength<c)this._pixels=new Uint8Array(c);else if(this._pixels.fill instanceof Function)this._pixels.fill(0,0,c);else for(var h=0;h<c;h++)this._pixels[h]=0;a.readPixels(Math.round((l.x-u.x)*this._fbo_size.width),Math.round((1-l.y-u.y)*this._fbo_size.height),o.x,o.y,a.RGBA,a.UNSIGNED_BYTE,this._pixels),e.ttl--;var f=Math.floor(o.x/2),p=Math.floor(o.y/2),d=4*(p*o.x+f),y=this._pixels.slice(d,d+4),g=y[0]+(y[1]<<8)+(y[2]<<16);if(0<g)r=g+(y[3]<<24)>>>0,s=y[3];else if(4<c)for(var v=1/0,d=0,_=0;_<o.y;_++)for(var m,b=0;b<o.x;b++,d+=4){0<(g=(y=this._pixels.slice(d,d+4))[0]+(y[1]<<8)+(y[2]<<16))&&((m=Math.pow(b-f,2)+Math.pow(_-p,2))<v&&(r=g+(y[3]<<24)>>>0,s=y[3],v=m))}if(255!==s){var x=this._getFeatureByKey(r,i);if(e.features||(e.features=[]),!x)return void this._finishRead(e);if(e.features.every(function(t){return t.id!==x.id})&&e.features.push(x),e.ttl)return this._pending_deep_request=e,t._discardColor(y),this._has_dirty_buffer=!0;this._finishRead(e)}else this._finishRead(e)}},{key:"_finishRead",value:function(e){var i=e.features||t.EMPTY_ARRAY;e.top_most_only||(this._pending_deep_request=null,t._resetDiscardedColors()),delete this._requests[e.id],e.callback({features:i})}},{key:"_getFeatureByKey",value:function(t,e){for(var i=null,r=0;r<e.length;r++){var n=e[r];if(n.selection_data&&(i=n.selection_data[t])){i.tile={coords:n.coords};break}}return i}},{key:"setupDiscards",value:function(e){for(var i=t.MAX_PICKING_TRIES;i--;)e.uniform("4fv","u_selection_discard".concat(i),t._discarded_colors[i]||t.defaultColor)}},{key:"has_dirty_buffer",get:function(){return this._has_dirty_buffer},set:function(){this._has_dirty_buffer=!!this._pending_deep_request}}],[{key:"makeEntry",value:function(){this.map_entry++;var t=255&this.map_entry,e=this.map_entry>>8&255,i=this.map_entry>>16&255,r=this.map_prefix;return{key:t+(e<<8)+(i<<16)+(r<<24)>>>0,color:[t/255,e/255,i/255,r/255]}}},{key:"reset",value:function(){this.map_entry=0}},{key:"setPrefix",value:function(t){this.map_prefix=t}},{key:"_discardColor",value:function(t){this._discarded_colors.push([t[0]/255,t[1]/255,t[2]/255,t[3]/255])}},{key:"_resetDiscardedColors",value:function(){this._discarded_colors.length=0}}]),t}();Yl._discarded_colors=[],Yl.map_entry=0,Yl.map_prefix=0,Yl.defaultColor=[0,0,0,1],Yl.MAX_PICKING_TRIES=10,Yl.EMPTY_ARRAY=Object.freeze([]);var Kl,Zl=function(){function t(e,i,r,n,o,a){_r(this,t),a=a||{},this.textureManager=Do(o),this.gl=e,this.vertex_data=i,this.element_data=r,this.vertex_layout=n,this.vertex_buffer=this.gl.createBuffer(),this.buffer_size=this.vertex_data.byteLength,this.draw_mode=a.draw_mode||this.gl.TRIANGLES,this.data_usage=a.data_usage||this.gl.STATIC_DRAW,this.vertices_per_geometry=3,this.uniforms=a.uniforms,this.textures=a.textures,this.retain=a.retain||!1,this.created_at=+new Date,this.fade_in_time=a.fade_in_time||0,this.vertex_count=this.vertex_data.byteLength/this.vertex_layout.stride,this.element_count=0,this.vaos={},this.toggle_element_array=!1,this.element_data?(this.toggle_element_array=!0,this.element_count=this.element_data.length,this.geometry_count=this.element_count/this.vertices_per_geometry,this.element_type=this.element_data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT,this.element_buffer=this.gl.createBuffer(),this.buffer_size+=this.element_data.byteLength,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.element_buffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.element_data,this.data_usage)):this.geometry_count=this.vertex_count/this.vertices_per_geometry,this.upload(),this.retain||(delete this.vertex_data,delete this.element_data),this.valid=!0}return br(t,[{key:"render",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};if(!this.valid)return!1;var i=e.program||Wl.current;i.use(),this.uniforms&&(i.saveUniforms(this.uniforms),i.setUniforms(this.uniforms,!1));var r=(new Date-this.created_at)/1e3;return i.uniform("1f","u_visible_time",r),this.bind(i),this.toggle_element_array?this.gl.drawElements(this.draw_mode,this.element_count,this.element_type,0):this.gl.drawArrays(this.draw_mode,0,this.vertex_count),Xl.bind(this.gl,null),this.uniforms&&i.restoreUniforms(this.uniforms),r<this.fade_in_time}},{key:"bind",value:function(t){var e=this,i=this.vaos[t.id];i?Xl.bind(this.gl,i):this.vaos[t.id]=Xl.create(this.gl,function(i){e.gl.bindBuffer(e.gl.ARRAY_BUFFER,e.vertex_buffer),e.toggle_element_array&&e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,e.element_buffer),e.vertex_layout.enable(e.gl,t,i)})}},{key:"upload",value:function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertex_data,this.data_usage)}},{key:"destroy",value:function(){var t=this;if(!this.valid)return!1;for(var e in this.valid=!1,this.vaos)Xl.destroy(this.gl,this.vaos[e]);return this.gl.deleteBuffer(this.vertex_buffer),this.vertex_buffer=null,this.element_buffer&&(this.gl.deleteBuffer(this.element_buffer),this.element_buffer=null),delete this.vertex_data,delete this.element_data,this.textures&&this.textures.forEach(function(e){return t.textureManager.release(e)}),!0}}]),t}(),Ql=["emission","ambient","diffuse","specular"],$l=function(){function t(e){var i=this;_r(this,t),e=e||{},Ql.forEach(function(t){var r=e[t];null!=r&&(r.texture?i[t]={texture:r.texture,mapping:r.mapping||"spheremap",scale:Dl.expandVec3(null!=r.scale?r.scale:1),amount:Dl.expandVec4(null!=r.amount?r.amount:1)}:"number"==typeof r||Array.isArray(r)?i[t]={amount:Dl.expandVec4(r)}:i[t]="string"==typeof r?{amount:xo.parseColor(r)}:r)}),this.specular&&(this.specular.shininess=e.shininess?parseFloat(e.shininess):.2),null!=e.normal&&(this.normal={texture:e.normal.texture,mapping:e.normal.mapping||"triplanar",scale:Dl.expandVec3(null!=e.normal.scale?e.normal.scale:1),amount:null!=e.normal.amount?e.normal.amount:1})}return br(t,[{key:"inject",value:function(e){var i=this;Ql.forEach(function(t){var r="TANGRAM_MATERIAL_".concat(t.toUpperCase()),n=r+"_TEXTURE";e.defines[r]=null!=i[t],i[t]&&i[t].texture&&(e.defines[n]=!0,e.defines[n+"_"+i[t].mapping.toUpperCase()]=!0,e.defines["TANGRAM_MATERIAL_TEXTURE_".concat(i[t].mapping.toUpperCase())]=!0,e.texcoords=e.texcoords||"uv"===i[t].mapping)}),this.normal&&this.normal.texture&&(e.defines.TANGRAM_MATERIAL_NORMAL_TEXTURE=!0,e.defines["TANGRAM_MATERIAL_NORMAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,e.defines["TANGRAM_MATERIAL_TEXTURE_".concat(this.normal.mapping.toUpperCase())]=!0,e.texcoords=e.texcoords||"uv"===this.normal.mapping),e.replaceShaderBlock(t.block,"/*Defines globals:materiallight_accumulator_**/struct Material{\n#ifdef TANGRAM_MATERIAL_EMISSION\nvec4 emission;\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nvec3 emissionScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT\nvec4 ambient;\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nvec3 ambientScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nvec4 diffuse;\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nvec3 diffuseScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nvec4 specular;float shininess;\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nvec3 specularScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvec3 normalScale;float normalAmount;\n#endif\n};uniform Material u_material;Material material;\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nuniform sampler2D u_material_emission_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nuniform sampler2D u_material_ambient_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nuniform sampler2D u_material_diffuse_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nuniform sampler2D u_material_specular_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nuniform sampler2D u_material_normal_texture;\n#endif\nvec4 light_accumulator_ambient=vec4(vec3(0.0),1.);vec4 light_accumulator_diffuse=vec4(vec3(0.0),1.);\n#ifdef TANGRAM_MATERIAL_SPECULAR\nvec4 light_accumulator_specular=vec4(vec3(0.0),1.);\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_SPHEREMAP\nvec4 getSphereMap(in sampler2D _tex,in vec3 _eyeToPoint,in vec3 _normal,in vec2 _skew){vec3 eye=normalize(_eyeToPoint);eye.xy-=_skew;eye=normalize(eye);vec3 r=reflect(eye,_normal);r.z+=1.0;float m=2.*length(r);vec2 uv=r.xy/m+.5;return texture2D(_tex,uv);}\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_TRIPLANAR\nvec3 getTriPlanarBlend(in vec3 _normal){vec3 blending=abs(_normal);blending=normalize(max(blending,0.00001));float b=(blending.x+blending.y+blending.z);return blending/b;}vec4 getTriPlanar(in sampler2D _tex,in vec3 _pos,in vec3 _normal,in vec3 _scale){vec3 blending=getTriPlanarBlend(_normal);vec4 xaxis=texture2D(_tex,fract(_pos.yz*_scale.x));vec4 yaxis=texture2D(_tex,fract(_pos.xz*_scale.y));vec4 zaxis=texture2D(_tex,fract(_pos.xy*_scale.z));return xaxis*blending.x+yaxis*blending.y+zaxis*blending.z;}\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_PLANAR\nvec4 getPlanar(in sampler2D _tex,in vec3 _pos,in vec2 _scale){return texture2D(_tex,fract(_pos.xy*_scale.x));}\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvoid calculateNormal(inout vec3 _normal){\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_UV\n_normal+=texture2D(u_material_normal_texture,fract(v_texcoord*material.normalScale.xy)).rgb*2.0-1.0;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_PLANAR\nvec3 normalTex=getPlanar(u_material_normal_texture,v_world_position.xyz,material.normalScale.xy).rgb*2.0-1.0;_normal+=normalTex;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_TRIPLANAR\nvec3 normalTex=getTriPlanar(u_material_normal_texture,v_world_position.xyz,_normal,material.normalScale).rgb*2.0-1.0;_normal+=normalTex;\n#endif\n_normal=normalize(_normal);}\n#endif\nvoid calculateMaterial(in vec3 _eyeToPoint,inout vec3 _normal){\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_UV\nmaterial.emission*=texture2D(u_material_emission_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_PLANAR\nmaterial.emission*=getPlanar(u_material_emission_texture,v_world_position.xyz,material.emissionScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_TRIPLANAR\nmaterial.emission*=getTriPlanar(u_material_emission_texture,v_world_position.xyz,_normal,material.emissionScale);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_SPHEREMAP\nmaterial.emission*=getSphereMap(u_material_emission_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_UV\nmaterial.ambient*=texture2D(u_material_ambient_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_PLANAR\nmaterial.ambient*=getPlanar(u_material_ambient_texture,v_world_position.xyz,material.ambientScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_TRIPLANAR\nmaterial.ambient*=getTriPlanar(u_material_ambient_texture,v_world_position.xyz,_normal,material.ambientScale);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_SPHEREMAP\nmaterial.ambient*=getSphereMap(u_material_ambient_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_UV\nmaterial.diffuse*=texture2D(u_material_diffuse_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_PLANAR\nmaterial.diffuse*=getPlanar(u_material_diffuse_texture,v_world_position.xyz,material.diffuseScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_TRIPLANAR\nmaterial.diffuse*=getTriPlanar(u_material_diffuse_texture,v_world_position.xyz,_normal,material.diffuseScale);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_SPHEREMAP\nmaterial.diffuse*=getSphereMap(u_material_diffuse_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_UV\nmaterial.specular*=texture2D(u_material_specular_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_PLANAR\nmaterial.specular*=getPlanar(u_material_specular_texture,v_world_position.xyz,material.specularScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_TRIPLANAR\nmaterial.specular*=getTriPlanar(u_material_specular_texture,v_world_position.xyz,_normal,material.specularScale);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_SPHEREMAP\nmaterial.specular*=getSphereMap(u_material_specular_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n}","Material"),e.addShaderBlock("setup","\nmaterial = u_material;\n","Material")}},{key:"setupProgram",value:function(t){var e=this;Ql.forEach(function(i){e[i]&&(e[i].texture?(t.setTextureUniform("u_material_".concat(i,"_texture"),e[i].texture),t.uniform("3fv","u_material.".concat(i,"Scale"),e[i].scale),t.uniform("4fv","u_material.".concat(i),e[i].amount)):e[i].amount&&t.uniform("4fv","u_material.".concat(i),e[i].amount))}),this.specular&&t.uniform("1f","u_material.shininess",this.specular.shininess),this.normal&&this.normal.texture&&(t.setTextureUniform("u_material_normal_texture",this.normal.texture),t.uniform("3fv","u_material.normalScale",this.normal.scale),t.uniform("1f","u_material.normalAmount",this.normal.amount))}}],[{key:"isValid",value:function(t){return null!=t&&(null!=t.emission||null!=t.ambient||null!=t.diffuse||null!=t.specular)}}]),t}();$l.block="material";var Jl=Kl={};Kl.copy=function(t){for(var e=[],i=t.length,r=0;r<i;r++)e[r]=t[r];return e},Kl.neg=function(t){for(var e=[],i=t.length,r=0;r<i;r++)e[r]=-t[r];return e},Kl.add=function(t,e){for(var i=[],r=Math.min(t.length,e.length),n=0;n<r;n++)i[n]=t[n]+e[n];return i},Kl.sub=function(t,e){for(var i=[],r=Math.min(t.length,e.length),n=0;n<r;n++)i[n]=t[n]-e[n];return i},Kl.signed_area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},Kl.mult=function(t,e){var i,r=[],n=t.length;if("number"==typeof e)for(i=0;i<n;i++)r[i]=t[i]*e;else for(n=Math.min(t.length,e.length),i=0;i<n;i++)r[i]=t[i]*e[i];return r},Kl.multMatrix=function(t,e){return[t[0][0]*e[0]+t[0][1]*e[1],t[1][0]*e[0]+t[1][1]*e[1]]},Kl.div=function(t,e){var i=[];if("number"==typeof e)for(n=0;n<t.length;n++)i[n]=t[n]/e;else for(var r=Math.min(t.length,e.length),n=0;n<r;n++)i[n]=t[n]/e[n];return i},Kl.perp=function(t,e){return[e[1]-t[1],t[0]-e[0]]},Kl.rot=function(t,e){var i=Math.cos(e),r=Math.sin(e);return[t[0]*i-t[1]*r,t[0]*r+t[1]*i]},Kl.angle=function(t){var e=Lr(t,2),i=e[0],r=e[1];return Math.atan2(r,i)},Kl.angleBetween=function(t,e){var i=Kl.dot(Kl.normalize(Kl.copy(t)),Kl.normalize(Kl.copy(e)));return 1<i&&(i=1),Math.acos(i)},Kl.signedAngleBetween=function(t,e){return Math.atan2(t[0]*e[1]-t[1]*e[0],t[0]*e[0]+t[1]*e[1])},Kl.isEqual=function(t,e){for(var i=t.length,r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0},Kl.lengthSq=function(t){return 2===t.length?t[0]*t[0]+t[1]*t[1]:3<=t.length?t[0]*t[0]+t[1]*t[1]+t[2]*t[2]:0},Kl.length=function(t){return Math.sqrt(Kl.lengthSq(t))},Kl.normalize=function(t){var e;if(2===t.length){if(1===(e=t[0]*t[0]+t[1]*t[1]))return t;0!==(e=Math.sqrt(e))?(t[0]/=e,t[1]/=e):(t[0]=0,t[1]=0)}else if(3<=t.length){if(1===(e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2]))return t;0!==(e=Math.sqrt(e))?(t[0]/=e,t[1]/=e,t[2]/=e):(t[0]=0,t[1]=0,t[2]=0)}return t},Kl.cross=function(t,e){return 2===t.length?t[0]*e[1]-t[1]*e[0]:3===t.length?[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]:void 0},Kl.dot=function(t,e){for(var i=0,r=Math.min(t.length,e.length),n=0;n<r;n++)i+=t[n]*e[n];return i};var tu=function(){function t(e,i){_r(this,t),this.name=i.name,this.view=e,null==i.ambient||"number"==typeof i.ambient?this.ambient=Dl.expandVec3(i.ambient||0):this.ambient=xo.parseColor(i.ambient).slice(0,3),null==i.diffuse||"number"==typeof i.diffuse?this.diffuse=Dl.expandVec3(null!=i.diffuse?i.diffuse:1):this.diffuse=xo.parseColor(i.diffuse).slice(0,3),null==i.specular||"number"==typeof i.specular?this.specular=Dl.expandVec3(i.specular||0):this.specular=xo.parseColor(i.specular).slice(0,3)}return br(t,[{key:"inject",value:function(){var e="\n            uniform ".concat(this.struct_name," u_").concat(this.name,";\n            ").concat(this.struct_name," ").concat(this.name,";\n            "),i="\n            ".concat(this.name," = u_").concat(this.name,";\n\n        ");Wl.addBlock(t.block,e),Wl.addBlock("setup",i)}},{key:"update",value:function(){}},{key:"setupProgram",value:function(t){t.uniform("3fv","u_".concat(this.name,".ambient"),this.ambient),t.uniform("3fv","u_".concat(this.name,".diffuse"),this.diffuse),t.uniform("3fv","u_".concat(this.name,".specular"),this.specular)}}],[{key:"create",value:function(e,i){if(t.types[i.type])return new t.types[i.type](e,i)}},{key:"setMode",value:function(e,i){!0===e&&(e="fragment"),e=t.enabled&&(null!=e?e:"fragment"),i.defines.TANGRAM_LIGHTING_FRAGMENT="fragment"===e,i.defines.TANGRAM_LIGHTING_VERTEX="vertex"===e}},{key:"inject",value:function(e){if(Wl.removeBlock(t.block),t.enabled){var i="";if(e&&0<Object.keys(e).length){var r={};for(var n in e)r[e[n].type]=!0;for(var o in r)t.types[o].inject();for(var a in e)e[a].inject(),i+="calculateLight(".concat(a,", _eyeToPoint, _normal);\n")}var s="\n            vec4 calculateLighting(in vec3 _eyeToPoint, in vec3 _normal, in vec4 _color) {\n\n                // Do initial material calculations over normal, emission, ambient, diffuse and specular values\n                calculateMaterial(_eyeToPoint,_normal);\n\n                // Un roll the loop of individual ligths to calculate\n                ".concat(i,"\n\n                //  Final light intensity calculation\n                vec4 color = vec4(vec3(0.), _color.a); // start with vertex color alpha\n\n                #ifdef TANGRAM_MATERIAL_EMISSION\n                    color.rgb = material.emission.rgb;\n                    color.a *= material.emission.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_AMBIENT\n                    color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.ambient.rgb;\n                    color.a *= material.ambient.a;\n                #else\n                    #ifdef TANGRAM_MATERIAL_DIFFUSE\n                        color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.diffuse.rgb;\n                    #endif\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_DIFFUSE\n                    color.rgb += light_accumulator_diffuse.rgb * _color.rgb * material.diffuse.rgb;\n                    color.a *= material.diffuse.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_SPECULAR\n                    color.rgb += light_accumulator_specular.rgb * material.specular.rgb;\n                    color.a *= material.specular.a;\n                #endif\n\n                // Clamp final color\n                color = clamp(color, 0.0, 1.0);\n\n                return color;\n            }");Wl.addBlock(t.block,s)}}}]),t}();tu.types={},tu.block="lighting",tu.enabled=!0;var eu=function(){Ar(e,tu);var t=Or(e);function e(i,r){var n;return _r(this,e),(n=t.call(this,i,r)).type="ambient",n.struct_name="AmbientLight",n}return br(e,[{key:"setupProgram",value:function(t){t.uniform("3fv","u_".concat(this.name,".ambient"),this.ambient)}}],[{key:"inject",value:function(){Wl.addBlock(tu.block,"/*Expected globals:light_accumulator_**/struct AmbientLight{vec3 ambient;};void calculateLight(in AmbientLight _light,in vec3 _eyeToPoint,in vec3 _normal){light_accumulator_ambient.rgb+=_light.ambient;}")}}]),e}();tu.types.ambient=eu;var iu=function(){Ar(e,tu);var t=Or(e);function e(i,r){var n,o;return _r(this,e),(n=t.call(this,i,r)).type="directional",n.struct_name="DirectionalLight",r.direction?n._direction=r.direction:(o=Math.sin(60*Math.PI/180),n._direction=[Math.cos(135*Math.PI/180)*o,Math.sin(135*Math.PI/180)*o,-.5]),null==r.ambient&&(n.ambient=Dl.expandVec3(.5)),n.direction=n._direction.map(parseFloat),n._initial_direction=[n.direction[0],n.direction[1],n.direction[2]],n}return br(e,[{key:"update",value:function(){Uo.transformMat4(this.direction,this._initial_direction,this.view.lookAtManipulator.getTransformationMatrix())}},{key:"setupProgram",value:function(t){Cr(Tr(e.prototype),"setupProgram",this).call(this,t),t.uniform("3fv","u_".concat(this.name,".direction"),this.direction)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction=Jl.normalize(Jl.copy(t))}}],[{key:"inject",value:function(){Wl.addBlock(tu.block,"/*Expected globals:materiallight_accumulator_**/struct DirectionalLight{vec3 ambient;vec3 diffuse;vec3 specular;vec3 direction;};void calculateLight(in DirectionalLight _light,in vec3 _eyeToPoint,in vec3 _normal){light_accumulator_ambient.rgb+=_light.ambient;float nDotVP=clamp(dot(_normal,-_light.direction),0.0,1.0);\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(_light.direction,_normal);float eyeDotR=max(dot(normalize(_eyeToPoint),reflectVector),0.0);pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf;\n#endif\n}")}}]),e}();tu.types.directional=iu;var ru=function(){Ar(e,tu);var t=Or(e);function e(i,r){var n;return _r(this,e),(n=t.call(this,i,r)).type="point",n.struct_name="PointLight",n.position=r.position||[0,0,"100px"],n.position_eye=[],n.origin=r.origin||"ground",n.attenuation=isNaN(parseFloat(r.attenuation))?0:parseFloat(r.attenuation),r.radius?Array.isArray(r.radius)&&2===r.radius.length?n.radius=r.radius:n.radius=[null,r.radius]:n.radius=null,n}return br(e,[{key:"inject",value:function(){Cr(Tr(e.prototype),"inject",this).call(this),Wl.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT=0!==this.attenuation,Wl.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS=null!=this.radius&&null!=this.radius[0],Wl.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS=null!=this.radius}},{key:"update",value:function(){var t,e,i,r=this.view.lookAtManipulator.getLookAtData().zoom;"world"===this.origin?(e=(t=Lr(en.latLngToMeters(this.position),2))[0],i=t[1],this.position_eye[0]=e-this.view.lookAtManipulator.getLookAtData().position[0],this.position_eye[1]=i-this.view.lookAtManipulator.getLookAtData().position[1],this.position_eye[2]=xo.convertUnits(this.position[2],{zoom:r,meters_per_pixel:en.metersPerPixel(r)}),this.position_eye[2]=this.position_eye[2]-this.view.lookAtManipulator.getLookAtData().distance):"ground"!==this.origin&&"camera"!==this.origin||(this.position_eye=xo.convertUnits(this.position,{zoom:r,meters_per_pixel:en.metersPerPixel(r)}),"ground"===this.origin&&(this.position_eye[2]=this.position_eye[2]-this.view.lookAtManipulator.getLookAtData().distance)),this.position_eye[3]=1}},{key:"setupProgram",value:function(t){Cr(Tr(e.prototype),"setupProgram",this).call(this,t),t.uniform("4fv","u_".concat(this.name,".position"),this.position_eye),Wl.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT&&t.uniform("1f","u_".concat(this.name,".attenuationExponent"),this.attenuation);var i=this.view.lookAtManipulator.getLookAtData().zoom;Wl.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS&&t.uniform("1f","u_".concat(this.name,".innerRadius"),xo.convertUnits(this.radius[0],{zoom:i,meters_per_pixel:en.metersPerPixel(i)})),Wl.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS&&t.uniform("1f","u_".concat(this.name,".outerRadius"),xo.convertUnits(this.radius[1],{zoom:i,meters_per_pixel:en.metersPerPixel(i)}))}}],[{key:"inject",value:function(){Wl.addBlock(tu.block,"/*Expected globals:materiallight_accumulator_**/struct PointLight{vec3 ambient;vec3 diffuse;vec3 specular;vec4 position;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat attenuationExponent;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nfloat innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat outerRadius;\n#endif\n};void calculateLight(in PointLight _light,in vec3 _eyeToPoint,in vec3 _normal){float dist=length(_light.position.xyz-_eyeToPoint);vec3 VP=(_light.position.xyz-_eyeToPoint)/dist;float nDotVP=clamp(dot(VP,_normal),0.0,1.0);float attenuation=1.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat Rin=1.0;float e=_light.attenuationExponent;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-(pow(d,e));\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/(pow(d,e)),0.0,1.0);\n#endif\n#else\nfloat Rin=0.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-d*d;\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/d,0.0,1.0);\n#endif\n#else\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat d=clamp(dist/_light.outerRadius,0.0,1.0);attenuation=1.0-d*d;\n#else\nattenuation=1.0;\n#endif\n#endif\n#endif\nlight_accumulator_ambient.rgb+=_light.ambient*attenuation;\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP*attenuation;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(-VP,_normal);float eyeDotR=max(0.0,dot(-normalize(_eyeToPoint),reflectVector));pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf*attenuation;\n#endif\n}")}}]),e}();tu.types.point=ru;var nu=function(){Ar(e,ru);var t=Or(e);function e(i,r){var n;return _r(this,e),(n=t.call(this,i,r)).type="spotlight",n.struct_name="SpotLight",n.direction=n._direction=(r.direction||[0,0,-1]).map(parseFloat),n._initial_direction=[n.direction[0],n.direction[1],n.direction[2]],n.exponent=r.exponent?parseFloat(r.exponent):.2,n.angle=r.angle?parseFloat(r.angle):20,n}return br(e,[{key:"setupProgram",value:function(t){Cr(Tr(e.prototype),"setupProgram",this).call(this,t),t.uniform("3fv","u_".concat(this.name,".direction"),this.direction),t.uniform("1f","u_".concat(this.name,".spotCosCutoff"),Math.cos(3.14159*this.angle/180)),t.uniform("1f","u_".concat(this.name,".spotExponent"),this.exponent)}},{key:"update",value:function(){Cr(Tr(e.prototype),"update",this).call(this),Uo.transformMat4(this.direction,this._initial_direction,this.view.lookAtManipulator.getTransformationMatrix())}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction=Jl.normalize(Jl.copy(t))}}],[{key:"inject",value:function(){Wl.addBlock(tu.block,"/*Expected globals:materiallight_accumulator_**/struct SpotLight{vec3 ambient;vec3 diffuse;vec3 specular;vec4 position;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat attenuationExponent;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nfloat innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat outerRadius;\n#endif\nvec3 direction;float spotCosCutoff;float spotExponent;};void calculateLight(in SpotLight _light,in vec3 _eyeToPoint,in vec3 _normal){float dist=length(_light.position.xyz-_eyeToPoint);vec3 VP=(_light.position.xyz-_eyeToPoint)/dist;float nDotVP=clamp(dot(_normal,VP),0.0,1.0);float attenuation=1.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat Rin=1.0;float e=_light.attenuationExponent;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-(pow(d,e));\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/(pow(d,e)),0.0,1.0);\n#endif\n#else\nfloat Rin=0.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-d*d;\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/d,0.0,1.0);\n#endif\n#else\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat d=clamp(dist/_light.outerRadius,0.0,1.0);attenuation=1.0-d*d;\n#else\nattenuation=1.0;\n#endif\n#endif\n#endif\nfloat spotAttenuation=0.0;float spotDot=clamp(dot(-VP,_light.direction),0.0,1.0);if(spotDot>=_light.spotCosCutoff){spotAttenuation=pow(spotDot,_light.spotExponent);}light_accumulator_ambient.rgb+=_light.ambient*attenuation*spotAttenuation;\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP*attenuation*spotAttenuation;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(-VP,_normal);float eyeDotR=max(dot(-normalize(_eyeToPoint),reflectVector),0.0);pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf*attenuation*spotAttenuation;\n#endif\n}")}}]),e}();tu.types.spotlight=nu;var ou,au="#ifdef TANGRAM_FRAGMENT_SHADER\nuniform sampler2D u_raster;uniform vec3 u_raster_offset;\n#define sampleRaster() (texture2D(u_raster, v_modelpos_base_zoom.xy * u_raster_offset.z + u_raster_offset.xy))\n#endif\n",su={init:function(t){var e=0<arguments.length&&void 0!==t?t:{},i=e.generation,r=e.styles,n=e.sources,o=void 0===n?{}:n,a=e.introspection,s=e.id,l=void 0!==s?s+"/":"";this.scene_id=s,this.textureManager=Do(s),this.main_thread_target="".concat(l,"Style/").concat(this.name),this.setGeneration(i),this.styles=r,this.sources=o,this.defines=this.hasOwnProperty("defines")&&this.defines||{},this.shaders=this.hasOwnProperty("shaders")&&this.shaders||{},this.introspection=a||!1,this.selection=this.selection||this.introspection||!1,this.compile_setup=!1,this.program=null,this.selection_program=null,this.feature_style={},this.vertex_template=[],this.tile_data={},this.defines.TANGRAM_WORLD_POSITION_WRAP=1e5,this.blend=this.blend||"opaque",this.defines["TANGRAM_BLEND_".concat(this.blend.toUpperCase())]=!0,null==this.blend_order&&(this.blend_order=-1),this.removeShaderBlock("setup"),this.material instanceof $l||($l.isValid(this.material)||(this.material=xo.defaults.material),this.material=new $l(this.material)),this.material.inject(this),tu.setMode(this.lighting,this),this.setupRasters(),this.initialized=!0},destroy:function(){this.program&&(this.program.destroy(),this.program=null),this.selection_program&&(this.selection_program.destroy(),this.selection_program=null),fn.removeTarget(this.main_thread_target),this.gl=null,this.initialized=!1},reset:function(){},baseStyle:function(){return this.base||this.name},setGeneration:function(t){this.generation=t,hn.is_main&&fn.addTarget(this.main_thread_target,this)},fillVertexTemplate:function(t,e,i,r){var n=r.size,o=void 0===(o=r.offset)?0:o,a=t.index[e];if(void 0!==a)for(var s=0;s<n;++s){var l=i.length>s?i[s]:i;this.vertex_template[a+s+o]=l}else En("warn","Style: in style '".concat(this.name,"', no index found in vertex layout for attribute '").concat(e,"'"))},startData:function(t){this.tile_data[t.id]=this.tile_data[t.id]||{meshes:{},uniforms:{},textures:[]}},endData:function(t){var e=this.tile_data[t.id];if(this.tile_data[t.id]=null,e&&0<Object.keys(e.meshes).length){for(var i in e.meshes){var r=e.meshes[i];0!==r.vertex_data.vertex_count?(r.vertex_data.end(),r.vertex_elements=r.vertex_data.element_buffer,r.vertex_data=r.vertex_data.vertex_buffer):delete e.meshes[i]}return t.mesh_data[this.name]=e,this.buildRasterTextures(t,e).then(function(t){return t})}return Promise.resolve(null)},hasDataForTile:function(t){return null!=this.tile_data[t.id]},getTileMesh:function(t,e){var i=this.tile_data[t.id].meshes;return null==i[e.key]&&(i[e.key]={variant:e,vertex_data:this.vertexLayoutForMeshVariant(e).createVertexData()}),i[e.key]},vertexLayoutForMeshVariant:function(){return this.vertex_layout},default_mesh_variant:{key:0},meshVariantTypeForDraw:function(){return this.default_mesh_variant},addFeature:function(t,e,i){var r=i.tile;this.tile_data[r.id]||this.startData(r);var n,o,a,s=this.parseFeature(t,e,i);s&&(o=(n=this.getTileMesh(r,this.meshVariantTypeForDraw(s))).vertex_data.offset,a=n.vertex_data.vertex_count,0<this.buildGeometry(t.geometry,s,n,i)?t.generation=this.generation:n.vertex_data.vertex_count>a&&(n.vertex_data.vertex_buffer.fill(0,o,n.vertex_data.offset),n.vertex_data.vertex_count=a,n.vertex_data.offset=o))},buildGeometry:function(t,e,i,r){var n;return"Polygon"===t.type?n=this.buildPolygons([t.coordinates],e,i,r):"MultiPolygon"===t.type?n=this.buildPolygons(t.coordinates,e,i,r):"LineString"===t.type?n=this.buildLines([t.coordinates],e,i,r):"MultiLineString"===t.type?n=this.buildLines(t.coordinates,e,i,r):"Point"===t.type?n=this.buildPoints([t.coordinates],e,i,r):"MultiPoint"===t.type&&(n=this.buildPoints(t.coordinates,e,i,r)),n},parseFeature:function(t,e,i){try{var r,n,o,a=this.feature_style;if(a.order=this.parseOrder(e.order,i),null==a.order&&"overlay"!==this.blend){var s="Layer '".concat(e.layers.join(", "),"', draw group '").concat(e.group,"': ");return s+="'order' parameter is required unless blend mode is 'overlay'",null!=e.order&&(s+="; 'order' was set to a dynamic value (e.g. string tied to feature property, ",s+="or JS function), but evaluated to null for one or more features"),void En({level:"warn",once:!0},s)}if(!(a=this._parseFeature(t,e,i)))return;return this.selection?a.interactive=xo.evalProperty(this.introspection||e.interactive,i):a.interactive=!1,!0===a.interactive?(n=(r=Yl.makeEntry()).color,o=r.key,a.selection_color=n,i.tile.selection_data||(i.tile.selection_data={}),i.tile.selection_data[o]={id:t.id||o,properties:t.properties,source_name:i.source,source_layer:i.layer,layers:i.layers}):a.selection_color=Yl.defaultColor,a}catch(e){En("error","Style.parseFeature: style parsing error",t,a,e.stack)}},_parseFeature:function(){return this.feature_style},preprocess:function(t,e){if(!t.preprocessed){if(this.draw)for(var i in this.draw){var r=this.draw[i];"object"!==vr(r)||Array.isArray(r)?null==t[i]&&(t[i]=r):t[i]=fl({},r,t[i])}var n=e||"";if(!(t=this._preprocess(t,n)))return;t.preprocessed=!0}return t},_preprocess:function(t){return t},parseOrder:function(t,e){return"number"!=typeof t?xo.calculateOrder(t,e):t},scaleOrder:function(t){return 2*t},parseColor:function(t,e){return t?xo.evalCachedColorProperty(t,e):this.shaders.blocks.color||this.shaders.blocks.filter?xo.defaults.color:void 0},buildPolygons:function(){return 0},buildLines:function(){return 0},buildPoints:function(){return 0},setGL:function(t){this.gl=t,this.max_texture_size=this.textureManager.getMaxTextureSize(this.gl)},makeMesh:function(t,e,i){var r=2<arguments.length&&void 0!==i?i:{},n=this.vertexLayoutForMeshVariant(r.variant);return new Zl(this.gl,t,e,n,this.scene_id,r)},render:function(t){return t.render()},getProgram:function(t){var e=0<arguments.length&&void 0!==t?t:"program";this.compileSetup();var i=this[e];if(i&&!i.error){if(!i.compiled)try{i.compile()}catch(t){En("error","Style: error compiling program for style '".concat(this.name,"' (program key '").concat(e,"')"),this,t.stack)}return i}},compileSetup:function(){if(!this.compile_setup){if(!this.gl)throw new Error("style.compile(): skipping for ".concat(this.name," because no GL context"));var t,e=this.buildDefineList();this.selection&&((t=Object.assign({},e)).TANGRAM_FEATURE_SELECTION=!0);var i=this.shaders&&this.shaders.blocks,r=this.shaders&&this.shaders.block_scopes,n=Object.assign({},this.shaders&&this.shaders.uniforms);for(var o in n)null==n[o]&&En({level:"warn",once:!0},"Style '".concat(this.name,"' has invalid uniform '").concat(o,"': uniform values must be non-null"));var a=this.shaders&&this.shaders.extensions;"string"==typeof a&&(a=[a]),this.program=new Wl(this.gl,this.vertex_shader_src,this.fragment_shader_src,this.scene_id,{name:this.name,defines:e,uniforms:n,blocks:i,block_scopes:r,extensions:a}),this.selection?this.selection_program=new Wl(this.gl,this.vertex_shader_src,this.crop_by_tile?"\n#pragma tangram: utils\n#ifdef TANGRAM_FEATURE_SELECTION\nuniform float u_meters_per_pixel;varying vec4 v_selection_color;varying vec4 v_local_space_position;\n#endif\nvoid main(void){\n#ifdef TANGRAM_FEATURE_SELECTION\nif(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}else{gl_FragColor=v_selection_color;}\n#else\ngl_FragColor=vec4(0.,0.,0.,1.);\n#endif\n}":"\n#ifdef TANGRAM_FEATURE_SELECTION\nvarying vec4 v_selection_color;\n#endif\nvoid main(void){\n#ifdef TANGRAM_FEATURE_SELECTION\ngl_FragColor=v_selection_color;\n#else\ngl_FragColor=vec4(0.,0.,0.,1.);\n#endif\n}",this.scene_id,{name:this.name+" (selection)",defines:t,uniforms:n,blocks:i,block_scopes:r,extensions:a}):this.selection_program=null,this.compile_setup=!0}},addShaderBlock:function(t,e,i){var r=2<arguments.length&&void 0!==i?i:null;this.shaders.blocks=this.shaders.blocks||{},this.shaders.blocks[t]=this.shaders.blocks[t]||[],this.shaders.blocks[t].push(e),this.shaders.block_scopes=this.shaders.block_scopes||{},this.shaders.block_scopes[t]=this.shaders.block_scopes[t]||[],this.shaders.block_scopes[t].push(r)},removeShaderBlock:function(t){this.shaders.blocks&&(this.shaders.blocks[t]=null)},replaceShaderBlock:function(t,e,i){var r=2<arguments.length&&void 0!==i?i:null;this.removeShaderBlock(t),this.addShaderBlock(t,e,r)},buildDefineList:function(){var t={};if(null!=this.defines)for(var e in this.defines)t[e]=this.defines[e];if(null!=this.shaders&&null!=this.shaders.defines)for(e in this.shaders.defines)t[e]=this.shaders.defines[e];return t},hasRasters:function(){return-1<["color","normal","custom"].indexOf(this.raster)},setupRasters:function(){if(!hn.is_main)return!1;if(!this.hasRasters())return!1;"color"===this.raster?this.defines.TANGRAM_RASTER_TEXTURE_COLOR=!0:"normal"===this.raster&&(this.defines.TANGRAM_RASTER_TEXTURE_NORMAL=!0);var t=!1;for(var e in this.sources)if(this.sources[e]instanceof Yo){t=!0;break}return!!t&&(this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster",au,"Raster"),!0)},buildRasterTextures:function(t,e){var i=this;if(!this.hasRasters())return Promise.resolve(e);var r={};return t.rasters.map(function(t){return i.sources[t]}).filter(function(t){return t}).forEach(function(e,i){var n;e instanceof Yo&&(n=e.tileTexture(t),r[n.url]=n)}),0===Object.keys(r).length?Promise.resolve(e):fn.postMessage(this.main_thread_target+".loadTextures",r).then(function(i){if(!i||i.length<1)return En("trace","Missing texture info for tile ".concat(t.key)),null;if(i.some(function(t){return!t.loaded}))return null;e.uniforms=e.uniforms||{},e.textures=e.textures||[];var n,o,a=i[0].name,s=r[a].coords;return e.uniforms.u_raster=a,e.textures.push(a),t.coords.z>s.z?(n=t.coords.z-s.z,o=Math.pow(2,n),e.uniforms.u_raster_offset=[(t.coords.x%o+o)%o/o,(o-1-t.coords.y%o)/o,1/o]):e.uniforms.u_raster_offset=[0,0,1],e})},loadTextures:function(t){var e=this;return this.textureManager.createFromObject(this.gl,t).then(function(){return Promise.all(Object.keys(t).map(function(t){return e.textureManager.textures[t]&&e.textureManager.textures[t].load()}).filter(function(t){return t}))}).then(function(t){return t.forEach(function(t){return t.retain()}),t.map(function(t){return{name:t.name,width:t.width,height:t.height,loaded:t.loaded}})})},setup:function(){this.setUniforms(),this.material.setupProgram(Wl.current)},setUniforms:function(){var t=Wl.current;t&&t.setUniforms(this.shaders&&this.shaders.uniforms,!0)},render_states:{opaque:{depth_test:!0,depth_write:!0},translucent:{depth_test:!0,depth_write:!0},add:{depth_test:!0,depth_write:!1},multiply:{depth_test:!0,depth_write:!1},inlay:{depth_test:!0,depth_write:!1},overlay:{depth_test:!1,depth_write:!1}},default_blend_orders:{opaque:0,add:1,multiply:2,inlay:3,translucent:4,overlay:5},sortByBlendOrderWithinLayers:function(t){var e=[],i={};for(var r in t.forEach(function(t){var e=parseInt(t.name,10)||0;i[e]||(i[e]=[]),i[e].push(t)}),i)e.push.apply(e,Ir(i[r].sort(su.blendOrderSort)));return e},blendOrderSort:function(t,e){return"opaque"===t.blend||"opaque"===e.blend?"opaque"===t.blend&&"opaque"===e.blend?t.name<e.name?-1:1:"opaque"===t.blend?-1:1:t.blend_order<e.blend_order||!(t.blend_order>e.blend_order)&&(su.default_blend_orders[t.blend]<su.default_blend_orders[e.blend]||!(su.default_blend_orders[t.blend]>su.default_blend_orders[e.blend])&&t.name<e.name)?-1:1}},lu=ou={};ou.BYTE=5120,ou.UNSIGNED_BYTE=5121,ou.SHORT=5122,ou.UNSIGNED_SHORT=5123,ou.INT=5124,ou.UNSIGNED_INT=5125,ou.FLOAT=5126;var uu,cu=Math.pow(2,16)-1,hu=1024,fu=!1,pu=function(){function t(e){_r(this,t),this.size_=e||hu,this.position_=0,this.ArrayType_=Uint16Array,this.buffer_=new this.ArrayType_(this.size_),this.overflows_=!1}return br(t,[{key:"push",value:function(t){if(!this.overflows_||fu){if(cu<t){if(this.overflows_=!0,!fu)return;this.ArrayType_===Uint16Array&&(this.ArrayType_=Uint32Array,this.buffer_=new this.ArrayType_(this.buffer_))}this.position_===this.size_&&this.expand_(),this.buffer_[this.position_]=t,this.position_+=1}}},{key:"end",value:function(){if(0===this.position_)return!1;var t=this.buffer_,e=this.position_;return this.buffer_=new this.ArrayType_(this.size_),this.position_=0,this.overflows_=!1,t.subarray(0,e)}},{key:"expand_",value:function(){this.size_=this.size_<<1;var t=new this.ArrayType_(this.size_);t.set(this.buffer_),this.buffer_=t}}]),t}();pu.setElementIndexUint=function(t){fu=t};var du=(xr(uu={},lu.FLOAT,Float32Array),xr(uu,lu.BYTE,Int8Array),xr(uu,lu.UNSIGNED_BYTE,Uint8Array),xr(uu,lu.INT,Int32Array),xr(uu,lu.UNSIGNED_INT,Uint32Array),xr(uu,lu.SHORT,Int16Array),xr(uu,lu.UNSIGNED_SHORT,Uint16Array),uu),yu=function(){function t(e){var i=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).prealloc,r=void 0===i?500:i;_r(this,t),this.vertex_layout=e,this.vertex_elements=new pu,this.stride=this.vertex_layout.stride,0<t.array_pool.length?(this.vertex_buffer=t.array_pool.pop(),this.byte_length=this.vertex_buffer.byteLength,this.size=Math.floor(this.byte_length/this.stride),En("trace","VertexData: reused buffer of bytes ".concat(this.byte_length,", ").concat(this.size," vertices"))):(this.size=r,this.byte_length=this.stride*this.size,this.vertex_buffer=new Uint8Array(this.byte_length)),this.offset=0,this.vertex_count=0,this.realloc_count=0,this.setBufferViews(),this.setAddVertexFunction()}return br(t,[{key:"setBufferViews",value:function(){var t=this;this.views={},this.views[lu.UNSIGNED_BYTE]=this.vertex_buffer,this.vertex_layout.dynamic_attribs.forEach(function(e){var i;null==t.views[e.type]&&(i=du[e.type],t.views[e.type]=new i(t.vertex_buffer.buffer))})}},{key:"checkBufferSize",value:function(){var e;this.offset+this.stride>this.byte_length&&(this.size=Math.floor(1.5*this.size),this.size-=this.size%4,this.byte_length=this.stride*this.size,(e=new Uint8Array(this.byte_length)).set(this.vertex_buffer),t.array_pool.push(this.vertex_buffer),this.vertex_buffer=e,this.setBufferViews(),this.realloc_count++)}},{key:"setAddVertexFunction",value:function(){this.vertexLayoutAddVertex=this.vertex_layout.getAddVertexFunction()}},{key:"addVertex",value:function(t){this.checkBufferSize(),this.vertexLayoutAddVertex(t,this.views,this.offset),this.offset+=this.stride,this.vertex_count++}},{key:"end",value:function(){return this.vertex_buffer=this.vertex_buffer.subarray(0,this.offset),this.element_buffer=this.vertex_elements.end(),En("trace","VertexData: ".concat(this.size," vertices total, realloc count ").concat(this.realloc_count)),this}}]),t}();yu.array_pool=[];var gu=function(){function t(e){_r(this,t),this.attribs=e,this.dynamic_attribs=this.attribs.filter(function(t){return!t.static}),this.components=[],this.index={},this.offset={};for(var i=this.stride=0,r=0,n=0;n<this.attribs.length;n++){var o=this.attribs[n];if(null==o.static){o.offset=this.stride,o.byte_size=o.size;var a=0;switch(o.type){case lu.FLOAT:case lu.INT:case lu.UNSIGNED_INT:o.byte_size*=4,a=2;break;case lu.SHORT:case lu.UNSIGNED_SHORT:o.byte_size*=2,a=1}3&o.byte_size&&(o.byte_size+=4-(3&o.byte_size)),this.stride+=o.byte_size;for(var s=o.offset>>a,l=0;l<o.size;l++)this.components.push({type:o.type,shift:a,offset:s++,index:r++});this.index[o.name]=i,i+=o.size,this.offset[o.name]=o.offset}else o.static=Array.isArray(o.static)?o.static:[o.static],o.method="vertexAttrib".concat(o.static.length,"fv")}}return br(t,[{key:"enable",value:function(e,i,r){for(var n,o,a=0;a<this.attribs.length;a++)n=this.attribs[a],-1!==(o=i.attribute(n.name).location)&&(null==n.static?(t.enabled_attribs[o]&&!r||e.enableVertexAttribArray(o),e.vertexAttribPointer(o,n.size,n.type,n.normalized,this.stride,n.offset),t.enabled_attribs[o]=i):e[n.method]instanceof Function&&(e.enableVertexAttribArray(o),e[n.method](o,n.static),e.disableVertexAttribArray(o),delete t.enabled_attribs[o]));for(o in t.enabled_attribs)this.disableUnusedAttribute(e,o,i)}},{key:"disableUnusedAttribute",value:function(e,i,r){t.enabled_attribs[i]!==r&&(e.disableVertexAttribArray(i),delete t.enabled_attribs[i])}},{key:"createVertexData",value:function(){return new yu(this)}},{key:"getAddVertexFunction",value:function(){return null==this.addVertex&&this.createAddVertexFunction(),this.addVertex}},{key:"createAddVertexFunction",value:function(){var e=Bl(JSON.stringify(this.attribs));if(null==t.add_vertex_funcs[e]){var i,r=["var t, o;"],n=Ir(this.components);n.sort(function(t,e){return t.type!==e.type?t.type-e.type:t.index-e.index});for(var o=0;o<n.length;o++){var a=n[o];i!==a.type&&(r.push("t = vs[".concat(a.type,"];")),r.push("o = off".concat(a.shift?" >> "+a.shift:"",";")),i=a.type),r.push("t[o + ".concat(a.offset,"] = v[").concat(a.index,"];"))}r=r.join("\n");var s=new Function("v","vs","off",r);t.add_vertex_funcs[e]=s}this.addVertex=t.add_vertex_funcs[e]}}]),t}();gu.enabled_attribs={},gu.add_vertex_funcs={};var vu=[{x:0,y:0},{x:en.tile_scale,y:-en.tile_scale}],_u=[0,0,1,1];function mu(t,e,i){var r=vu[0],n=vu[1];return t[0]<=r.x+i&&e[0]<=r.x+i||t[0]>=n.x-i&&e[0]>=n.x-i||t[1]>=r.y-i&&e[1]>=r.y-i||t[1]<=n.y+i&&e[1]<=n.y+i}function bu(t,e){e=e||0;var i=vu[0],r=vu[1];return t[0]<=i.x+e||t[0]>=r.x-e||t[1]>=i.y-e||t[1]<=r.y+e}var xu=wu;function wu(t,e,i){i=i||2;var r,n,o,a,s,l,u,c=e&&e.length,h=c?e[0]*i:t.length,f=ku(t,0,h,i,!0),p=[];if(!f)return p;if(c&&(f=function(t,e,i,r){var n,o,a,s,l,u=[];for(n=0,o=e.length;n<o;n++)a=e[n]*r,s=n<o-1?e[n+1]*r:t.length,(l=ku(t,a,s,r,!1))===l.next&&(l.steiner=!0),u.push(function(t){var e=t,i=t;for(;e.x<i.x&&(i=e),e=e.next,e!==t;);return i}(l));for(u.sort(Eu),n=0;n<u.length;n++)!function(t,e){{var i;(e=function(t,e){var i,r=e,n=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&a<s){if((a=s)===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===a)return i.prev;var l,u=i,c=i.x,h=i.y,f=1/0;r=i.next;for(;r!==u;)n>=r.x&&r.x>=c&&Su(o<h?n:a,o,c,h,o<h?a:n,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(n-r.x))<f||l===f&&r.x>i.x)&&Cu(r,t)&&(i=r,f=l),r=r.next;return i}(t,e))&&Au(i=Lu(e,t),i.next)}}(u[n],i),i=Au(i,i.next);return i}(t,e,f,i)),t.length>80*i){r=o=t[0],n=a=t[1];for(var d=i;d<h;d+=i)(s=t[d])<r&&(r=s),(l=t[d+1])<n&&(n=l),o<s&&(o=s),a<l&&(a=l);u=Math.max(o-r,a-n)}return Tu(f,p,i,r,n,u),p}function ku(t,e,i,r,n){var o,a;if(n===0<zu(t,e,i,r))for(o=e;o<i;o+=r)a=Iu(o,t[o],t[o+1],a);else for(o=i-r;e<=o;o-=r)a=Iu(o,t[o],t[o+1],a);return a&&Pu(a,a.next)&&(ju(a),a=a.next),a}function Au(t,e){if(!t)return t;e=e||t;var i,r=t;do{if(i=!1,r.steiner||!Pu(r,r.next)&&0!==Ru(r.prev,r,r.next))r=r.next;else{if(ju(r),(r=e=r.prev)===r.next)return null;i=!0}}while(i||r!==e);return e}function Tu(t,e,i,r,n,o,a){if(t){!a&&o&&function(t,e,i,r){var n=t;for(;null===n.z&&(n.z=Mu(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next,n!==t;);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,a,s,l,u=1;do{for(i=t,o=t=null,a=0;i;){for(a++,r=i,e=s=0;e<u&&(s++,r=r.nextZ);e++);for(l=u;0<s||0<l&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(i=(n=i).nextZ,s--):(r=(n=r).nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(1<a)}(n)}(t,r,n,o);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?function(t,e,i,r){var n=t.prev,o=t,a=t.next;if(0<=Ru(n,o,a))return!1;var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,u=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,c=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,h=Mu(s,l,e,i,r),f=Mu(u,c,e,i,r),p=t.nextZ;for(;p&&p.z<=f;){if(p!==t.prev&&p!==t.next&&Su(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=Ru(p.prev,p,p.next))return!1;p=p.nextZ}p=t.prevZ;for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&Su(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=Ru(p.prev,p,p.next))return!1;p=p.prevZ}return!0}(t,r,n,o):function(t){var e=t.prev,i=t,r=t.next;if(0<=Ru(e,i,r))return!1;var n=t.next.next;for(;n!==t.prev;){if(Su(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&0<=Ru(n.prev,n,n.next))return!1;n=n.next}return!0}(t))e.push(s.i/i),e.push(t.i/i),e.push(l.i/i),ju(t),t=l.next,u=l.next;else if((t=l)===u){a?1===a?Tu(t=function(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!Pu(n,o)&&Ou(n,r,r.next,o)&&Cu(n,o)&&Cu(o,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(o.i/i),ju(r),ju(r.next),r=t=o),r=r.next}while(r!==t);return r}(t,e,i),e,i,r,n,o,2):2===a&&function(t,e,i,r,n,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Ou(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&Cu(t,e)&&Cu(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;for(;i.y>o!=i.next.y>o&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next,i!==t;);return r}(t,e)}(a,s)){var l=Lu(a,s);return a=Au(a,a.next),l=Au(l,l.next),Tu(a,e,i,r,n,o),Tu(l,e,i,r,n,o)}s=s.next}a=a.next}while(a!==t)}(t,e,i,r,n,o):Tu(Au(t),e,i,r,n,o,1);break}}}function Eu(t,e){return t.x-e.x}function Mu(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)/n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Su(t,e,i,r,n,o,a,s){return 0<=(n-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(r-s)-(i-a)*(e-s)&&0<=(i-a)*(o-s)-(n-a)*(r-s)}function Ru(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Pu(t,e){return t.x===e.x&&t.y===e.y}function Ou(t,e,i,r){return Pu(t,e)&&Pu(i,r)||Pu(t,r)&&Pu(i,e)||0<Ru(t,e,i)!=0<Ru(t,e,r)&&0<Ru(i,r,t)!=0<Ru(i,r,e)}function Cu(t,e){return Ru(t.prev,t,t.next)<0?0<=Ru(t,e,t.next)&&0<=Ru(t,t.prev,e):Ru(t,e,t.prev)<0||Ru(t,t.next,e)<0}function Lu(t,e){var i=new Nu(t.i,t.x,t.y),r=new Nu(e.i,e.x,e.y),n=t.next,o=e.prev;return(t.next=e).prev=t,(i.next=n).prev=i,(r.next=i).prev=r,(o.next=r).prev=o,r}function Iu(t,e,i,r){var n=new Nu(t,e,i);return r?(n.next=r.next,(n.prev=r).next.prev=n,r.next=n):(n.prev=n).next=n,n}function ju(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Nu(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zu(t,e,i,r){for(var n=0,o=e,a=i-r;o<i;o+=r)n+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return n}wu.deviation=function(t,e,i,r){var n=e&&e.length,o=n?e[0]*i:t.length,a=Math.abs(zu(t,0,o,i));if(n)for(var s=0,l=e.length;s<l;s++){var u=e[s]*i,c=s<l-1?e[s+1]*i:t.length;a-=Math.abs(zu(t,u,c,i))}for(var h=0,s=0;s<r.length;s+=3){var f=r[s]*i,p=r[s+1]*i,d=r[s+2]*i;h+=Math.abs((t[f]-t[d])*(t[1+p]-t[1+f])-(t[f]-t[p])*(t[1+d]-t[1+f]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},wu.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var a=0;a<e;a++)i.vertices.push(t[n][o][a]);0<n&&(r+=t[n-1].length,i.holes.push(r))}return i};var Du=[0,0,1];function Fu(t,e,i,r){var n,o,a,s,l,u=r.texcoord_index,c=r.texcoord_scale,h=r.texcoord_normalize,f=e.vertex_elements;u&&(h=h||1,o=(n=Lr(c||_u,4))[0],a=n[1],s=n[2],l=n[3]);for(var p,d=0,y=t.length,g=0;g<y;g++){var v,_,m,b,x,w=e.vertex_count,k=t[g];u&&(_=(v=Lr(en.findBoundingBox(k),4))[0],m=v[1],b=(s-o)/(v[2]-_),x=(l-a)/(v[3]-m));for(var A=0;A<k.length;A++)for(var T=k[A],E=0;E<T.length;E++){var M=T[E];i[0]=M[0],i[1]=M[1],u&&(i[u+0]=((M[0]-_)*b+o)*h,i[u+1]=((M[1]-m)*x+a)*h),e.addVertex(i)}for(var S=(p=xu.flatten(k),xu(p.vertices,p.holes,p.dimensions)),R=0;R<S.length;R++)f.push(w+S[R]);d+=S.length/3}return d}var Uu="uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;attribute vec4 a_position;attribute vec4 a_color;\n#ifdef TANGRAM_NORMAL_ATTRIBUTE\nattribute vec3 a_normal;\n#define TANGRAM_NORMAL a_normal\n#else\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#endif\n#ifdef TANGRAM_EXTRUDE_LINES\nattribute vec2 a_extrude;attribute vec2 a_offset;attribute vec2 a_scaling;uniform float u_v_scale_adjust;\n#endif\nvarying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\nattribute vec2 a_texcoord;varying vec2 v_texcoord;\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#define UNPACK_SCALING(x) (x / 1024.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\nvoid main(){\n#pragma tangram: setup\n#ifdef TANGRAM_TEXTURE_COORDS\nv_texcoord=a_texcoord;\n#ifdef TANGRAM_EXTRUDE_LINES\nv_texcoord.y*=u_v_scale_adjust;\n#endif\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nv_modelpos_base_zoom=modelPositionBaseZoom();\n#endif\nvec4 position=vec4(a_position.xy,a_position.z/TANGRAM_HEIGHT_SCALE,1.);\n#ifdef TANGRAM_EXTRUDE_LINES\nvec2 extrude=a_extrude.xy;vec2 offset=a_offset.xy;float dz=clamp(u_map_position.z-u_tile_origin.z,0.,4.);dz+=step(1.,dz)*(1.-dz)+mix(0.,2.,clamp((dz-2.)/2.,0.,1.));float mdz=(dz-0.5)*2.;extrude-=extrude*UNPACK_SCALING(a_scaling.x)*mdz;float dwdz=UNPACK_SCALING(a_scaling.y);float sdwdz=sign(step(0.,dwdz)-0.5);offset-=offset*abs(dwdz)*((1.-step(0.,sdwdz))-(dz*-sdwdz));float ssz=exp2(-dz-(u_tile_origin.z-u_tile_origin.w));extrude*=ssz;offset*=ssz;\n#ifdef TANGRAM_BLOCK_WIDTH\nfloat width=1.;\n#pragma tangram: width\nextrude*=width;\n#endif\nposition.xy+=extrude+offset;\n#endif\nv_world_position=wrapWorldPosition(u_model*position);v_local_space_position=position;position=u_modelView*position;\n#pragma tangram: position\nv_position=position;v_normal=normalize(u_normalMatrix*TANGRAM_NORMAL);v_color=a_color;\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvec3 normal=v_normal;\n#pragma tangram: normal\nv_lighting=calculateLighting(position.xyz-u_eye,normal,vec4(1.));\n#endif\ncameraProjection(position);applyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);\n#if defined(SNAP_TO_PIXEL_GRID)\nsnapToPixelGrid(position);\n#endif\ngl_Position=position;}",Bu="uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#ifdef TANGRAM_EXTRUDE_LINES\nuniform bool u_has_line_texture;uniform sampler2D u_texture;uniform float u_texture_ratio;uniform vec4 u_dash_background_color;\n#endif\n#define TANGRAM_NORMAL v_normal\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\nvarying vec2 v_texcoord;\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n#pragma tangram: utils\nvoid main(void){\n#pragma tangram: setup\nvec4 color=v_color;vec3 normal=TANGRAM_NORMAL;\n#ifdef TANGRAM_CROP_BY_TILE\nif(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}\n#endif\n#ifdef TANGRAM_RASTER_TEXTURE_COLOR\ncolor*=sampleRaster();\n#endif\n#ifdef TANGRAM_EXTRUDE_LINES\nif(u_has_line_texture){vec2 _line_st=vec2(v_texcoord.x,fract(v_texcoord.y/u_texture_ratio));vec4 _line_color=texture2D(u_texture,_line_st);if(_line_color.a<TANGRAM_ALPHA_TEST){\n#if !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY)\nif(u_dash_background_color.a==0.){discard;}color=u_dash_background_color;\n#else\ncolor=vec4(u_dash_background_color.rgb,color.a*step(TANGRAM_EPSILON,u_dash_background_color.a));\n#endif\n}else{color*=_line_color;}}\n#endif\n#ifdef TANGRAM_RASTER_TEXTURE_NORMAL\nnormal=normalize(sampleRaster().rgb*2.-1.);\n#endif\n#if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\ncalculateNormal(normal);\n#endif\n#if !defined(TANGRAM_LIGHTING_VERTEX)\n#pragma tangram: normal\n#endif\n#pragma tangram: color\n#if defined(TANGRAM_LIGHTING_FRAGMENT)\ncolor=calculateLighting(v_position.xyz-u_eye,normal,color);\n#elif defined(TANGRAM_LIGHTING_VERTEX)\ncolor*=v_lighting;\n#endif\n#pragma tangram: filter\ngl_FragColor=color;}",Gu=Object.create(su);Object.assign(Gu,{name:"polygons",built_in:!0,vertex_shader_src:Uu,fragment_shader_src:Bu,selection:!0,init:function(){su.init.apply(this,arguments),this.defines.TANGRAM_NORMAL_ATTRIBUTE=!0,this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.texcoords&&(this.defines.TANGRAM_TEXTURE_COORDS=!0)},vertexLayoutForMeshVariant:function(){var t;return this.vertex_layout||(t=[{name:"a_position",size:4,type:lu.SHORT,normalized:!1},{name:"a_normal",size:3,type:lu.BYTE,normalized:!0},{name:"a_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0}],this.texcoords&&t.push({name:"a_texcoord",size:2,type:lu.UNSIGNED_SHORT,normalized:!0}),this.vertex_layout=new gu(t)),this.vertex_layout},_parseFeature:function(t,e,i){var r=this.feature_style;return r.color=this.parseColor(e.color,i),r.color?(r.z=e.z&&xo.evalCachedDistanceProperty(e.z,i)||xo.defaults.z,r.z*=en.height_scale,r.extrude=xo.evalProperty(e.extrude,i),r.extrude&&(!0===r.extrude?(r.height=void 0!==t.properties.height?t.properties.height:xo.defaults.height,r.min_height=void 0!==t.properties.min_height?t.properties.min_height:xo.defaults.min_height):"number"==typeof r.extrude?(r.height=r.extrude,r.min_height=0):Array.isArray(r.extrude)&&(r.min_height=r.extrude[0],r.height=r.extrude[1]),r.height*=en.height_scale,r.min_height*=en.height_scale),r.tile_edges=e.tile_edges,r):null},_preprocess:function(t){return t.color=xo.createColorPropertyCache(t.color),t.z=xo.createPropertyCache(t.z,xo.parseUnits),t},makeVertexTemplate:function(t){var e=0;return this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=t.z||0,this.vertex_template[e++]=this.scaleOrder(t.order),this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=127,this.vertex_template[e++]=255*t.color[0],this.vertex_template[e++]=255*t.color[1],this.vertex_template[e++]=255*t.color[2],this.vertex_template[e++]=255*t.color[3],this.selection&&(this.vertex_template[e++]=255*t.selection_color[0],this.vertex_template[e++]=255*t.selection_color[1],this.vertex_template[e++]=255*t.selection_color[2],this.vertex_template[e++]=255*t.selection_color[3]),this.texcoords&&(this.vertex_template[e++]=0,this.vertex_template[e++]=0),this.vertex_template},buildPolygons:function(t,e,i,r){var n=this.makeVertexTemplate(e),o={texcoord_index:this.vertex_layout.index.a_texcoord,texcoord_normalize:65535,remove_tile_edges:!e.tile_edges,tile_edge_tolerance:en.tile_scale*r.tile.pad_scale*4,winding:r.winding};return e.extrude&&e.height?function(t,e,i,r,n,o,a,s,l){var u=l.remove_tile_edges,c=l.tile_edge_tolerance,h=l.texcoord_index,f=l.texcoord_scale,p=l.texcoord_normalize,d=l.winding,y=e+(r||0),g=e+i;o[2]=g;var v,_,m,b,x,w,k=Fu(t,n,o,{texcoord_index:h,texcoord_scale:f,texcoord_normalize:p}),A=n.vertex_elements,T=n.vertex_count;h&&(p=p||1,_=(v=Lr(f||_u,4))[0],m=v[1],b=v[2],w=[[_,x=v[3]],[_,m],[b,m],[b,x]]);for(var E=t.length,M=0;M<E;M++)for(var S=t[M],R=0;R<S.length;R++)for(var P=S[R],O=0;O<P.length-1;O++)if(!u||!mu(P[O],P[O+1],c)){var C=void 0,L=void 0,I=[[P[L="CCW"===d?(C=O)+1:(C=O+1,O)][0],P[L][1],g],[P[L][0],P[L][1],y],[P[C][0],P[C][1],y],[P[C][0],P[C][1],g]],j=Jl.normalize([P[L][0]-P[C][0],P[L][1]-P[C][1],0]),N=Jl.cross(Du,j);o[a+0]=N[0]*s,o[a+1]=N[1]*s,o[a+2]=N[2]*s;for(var z=0;z<I.length;z++)o[0]=I[z][0],o[1]=I[z][1],o[2]=I[z][2],h&&(o[h+0]=w[z][0]*p,o[h+1]=w[z][1]*p),n.addVertex(o);A.push(T+0),A.push(T+1),A.push(T+2),A.push(T+2),A.push(T+3),A.push(T+0),T+=4,k+=2}return k}(t,e.z,e.height,e.min_height,i.vertex_data,n,this.vertex_layout.index.a_normal,127,o):Fu(t,i.vertex_data,n,o)}});var Hu=[0,0],Vu={butt:0,square:1,round:2},qu={miter:0,bevel:1,round:2},Wu={MITER_LIMIT:3,TEXCOORD_NORMALIZE:1,TEXCOORD_RATIO:1,MIN_FAN_WIDTH:5},Xu=en.tile_scale,Yu=[0,0],Ku=[1,0],Zu=[.5,0];function Qu(t,e){if(!(t.length<2)){var i,r,n=e.join_type,o=e.cap_type,a=e.closed_polygon,s=e.remove_tile_edges,l=e.tile_edge_tolerance,u=e.v_scale,c=e.miter_len_sq,h=e.crop_by_tile,f=null!=e.texcoord_index,p=0;if(a&&n===qu.miter){var d=function(t){if(bu(t[0]))return 0;for(var e=0;e<t.length;e++){if(bu(t[t.length-1-e]))return t.length-1-e}return 0}(t);if(0!==d){var y=function(t,e){for(var i=[],r=0;r<t.length;r++){var n=(r+e)%t.length;0!=n&&i.push(t[n])}return i.push(i[0]),i}(t,d);return e.extra_lines=e.extra_lines||[],void e.extra_lines.push(y)}}var g=0,v=t.length-1,_=0;for(k=t[g],A=t[g+1];Jl.isEqual(k,A);)if(k=A,A=t[++g+1],_++,g===t.length-1)return;for(;Jl.isEqual(t[v],t[v-1]);)if(_++,0===--v)return;if(!(t.length<2+_))if(r=Jl.normalize(Jl.perp(k,A)),s&&mu(k,A,l)){var m=$u(t,g,l);m&&(e.extra_lines=e.extra_lines||[],e.extra_lines.push(m))}else{a?function(t,e,i,r,n){{void 0===r||bu(t)&&!n.crop_by_tile?(rc(t,i,i,1,0,n,1),rc(t,i,i,0,0,n,-1)):r===qu.miter?tc(0,t,e,i,n.miter_len_sq,!0,n):ec(r,0,t,e,i,!0,n)}}(k,i=Jl.normalize(Jl.perp(t[v-1],k)),r,n,e):(!h&&bu(k)||(ac(k,p,r,o,!0,e),f&&o!==Vu.butt&&(p+=.5*u*e.texcoord_width)),rc(k,r,r,1,p,e,1),rc(k,r,r,0,p,e,-1)),f&&(p+=u*Jl.length(Jl.sub(A,k)));for(var b=g+1;b<v;b++){var x=b,w=b+1,k=t[x],A=t[w];if(!Jl.isEqual(k,A)){if(s&&mu(k,A,l)){rc(k,r,r,1,p,e,1),rc(k,r,r,0,p,e,-1),ic(1,e);var T=$u(t,x+1,l);return void(T&&(e.extra_lines=e.extra_lines||[],e.extra_lines.push(T)))}i=r,r=Jl.normalize(Jl.perp(k,A)),n===qu.miter?tc(p,k,i,r,c,!1,e):ec(n,p,k,i,r,!1,e),f&&(p+=u*Jl.length(Jl.sub(A,k)))}}k=A,i=r,a?function(t,e,i,r,n,o){{var a;bu(t)&&!o.crop_by_tile?(rc(t,e,e,1,n,o,1),rc(t,e,e,0,n,o,-1)):(a=Ju(e,i),r===qu.miter&&Jl.lengthSq(a)>o.miter_len_sq&&(r=qu.bevel),r===qu.miter?(rc(t,a,e,1,n,o,1),rc(t,a,e,0,n,o,-1)):(rc(t,e,e,1,n,o,1),rc(t,e,e,0,n,o,-1))),ic(1,o)}}(k,i,r=Jl.normalize(Jl.perp(k,t[1])),n,p,e):(rc(k,i,r,1,p,e,1),rc(k,i,r,0,p,e,-1),ic(1,e),!h&&bu(k)||ac(k,p,i,o,!1,e))}}}function $u(t,e,i){for(var r=e;t[r+1]&&mu(t[r],t[r+1],i);)r++;return 2<=t.length-r&&t.slice(r)}function Ju(t,e){var i=Jl.normalize(Jl.add(t,e)),r=2/(1+Math.abs(Jl.dot(t,i)));return Jl.mult(i,r*r)}function tc(t,e,i,r,n,o,a){var s=Ju(i,r);Jl.lengthSq(s)>n?ec(qu.bevel,t,e,i,r,o,a):(rc(e,s,s,1,t,a,1),rc(e,s,s,0,t,a,-1),o||ic(1,a))}function ec(t,e,i,r,n,o,a){var s=Ju(r,n),l=0<n[0]*r[1]-n[1]*r[0];null!=a.texcoord_index&&(Yu[1]=e,Ku[1]=e),l?(rc(i,s,s,1,e,a,1),rc(i,r,s,0,e,a,-1),o||ic(1,a),oc(i,Jl.neg(r),s,Jl.neg(n),s,Yu,Ku,Yu,!1,t===qu.bevel,a),rc(i,s,s,1,e,a,1),rc(i,n,s,0,e,a,-1)):(rc(i,r,s,1,e,a,1),rc(i,s,s,0,e,a,-1),o||ic(1,a),oc(i,r,Jl.neg(s),n,s,Ku,Yu,Ku,!1,t===qu.bevel,a),rc(i,n,s,1,e,a,1),rc(i,s,s,0,e,a,-1))}function ic(t,e){for(var i=e.vertex_data.vertex_elements,r=e.vertex_data.vertex_count-2*t-2,n=0;n<t;n++)i.push(r+2*n+2),i.push(r+2*n+1),i.push(r+2*n),i.push(r+2*n+2),i.push(r+2*n+3),i.push(r+2*n+1),e.geom_count+=2}function rc(t,e,i,r,n,o,a){var s=o.vertex_template,l=o.vertex_data;s[0]=t[0],s[1]=t[1];var u=o.half_width*a;s[o.extrude_index+0]=e[0]*u,s[o.extrude_index+1]=e[1]*u,o.offset&&(s[o.offset_index+0]=i[0]*o.offset,s[o.offset_index+1]=i[1]*o.offset),null!=o.texcoord_index&&(s[o.texcoord_index+0]=r*o.texcoord_normalize,s[o.texcoord_index+1]=n*o.texcoord_normalize),l.addVertex(s)}var nc=[0,0];function oc(t,e,i,r,n,o,a,s,l,u,c){for(var h=e[0]*r[1]-e[1]*r[0],f=Jl.dot(e,r),p=Math.atan2(h,f);p>=Math.PI;)p-=2*Math.PI;if(u)d=1;else{var d=function(t,e){t<0&&(t=-t);var i=e>2*Wu.MIN_FAN_WIDTH?Math.log2(e/Wu.MIN_FAN_WIDTH):1;return Math.ceil(t/Math.PI*i)}(p,c.half_width);if(d<1)return}var y=c.vertex_data.vertex_count,g=c.vertex_data.vertex_elements;rc(t,i,n,a[0],a[1],c,1),rc(t,e,n,o[0],o[1],c,1);var v,_,m=e,b=null!=c.texcoord_index;b&&(l?v=Jl.sub(o,a):(nc=Jl.copy(o),_=Jl.div(Jl.sub(s,o),d)));for(var x,w=p/d,k=p<0?-1:1,A=0<h?(x=2,1):(x=1,2),T=0;T<d;T++)0===T&&p<0&&(m=Jl.neg(m)),m=Jl.rot(m,w),b&&(l?(v=Jl.rot(v,w),nc[0]=v[0]+a[0],nc[1]=v[1]*c.texcoord_width*c.v_scale+a[1]):nc=Jl.add(nc,_)),rc(t,m,n,nc[0],nc[1],c,k),g.push(y+T+x),g.push(y),g.push(y+T+A)}function ac(t,e,i,r,n,o){var a,s=Jl.neg(i),l=null!=o.texcoord_index;switch(r){case Vu.square:n?(a=[i[1],-i[0]],rc(t,Jl.add(i,a),i,1,e,o,1),rc(t,Jl.add(s,a),i,0,e,o,1),l&&(e+=.5*o.texcoord_width*o.v_scale),rc(t,i,i,1,e,o,1),rc(t,s,i,0,e,o,1)):(a=[-i[1],i[0]],rc(t,i,i,1,e,o,1),rc(t,s,i,0,e,o,1),l&&(e+=.5*o.texcoord_width*o.v_scale),rc(t,Jl.add(i,a),i,1,e,o,1),rc(t,Jl.add(s,a),i,0,e,o,1)),ic(1,o);break;case Vu.round:var u,c,h=Yu,f=Ku,p=Zu;n?(u=i,c=s,l&&(e+=.5*o.texcoord_width*o.v_scale,h=Ku,f=Yu,p=Zu)):(u=s,c=i),l&&(Yu[1]=e,Ku[1]=e,Zu[1]=e),oc(t,u,Hu,c,i,h,p,f,!0,!1,o);break;case Vu.butt:return}}var sc=[255,255,255,255],lc=[0,0,0,0];var uc=Object.create(su);uc.vertex_layouts=[[],[]],uc.variants={},uc.dash_textures={};function cc(t,e,i,r,n,o){for(var a={closed:o,vertex_data:i,vertex_template:r,half_width:e/2,vertex_layout_index:n,geom_count:0},s=0,l=t.length;s<l;s++)!function(t,e){if(t.length<2)return;for(var i=[t[0]],r=0,n=[],o=[],a=1,s=t.length;a<s;a++){var l,u;t[a][0]===t[a-1][0]&&t[a][1]===t[a-1][1]||(i.push(t[a]),l=Jl.sub(t[a],t[a-1]),u=Jl.length(l),n.push(l),o.push([r,r+u]),r+=u)}if(i.length<2)return;var c=0,h=n[n.length-1],f=n[0],p=n[1],d=[0,0];2<i.length&&(e.closed&&(d[0]=Jl.signedAngleBetween(h,f)),d[1]=Jl.signedAngleBetween(f,p));var y=i[0],g=o[0];e.closed?(pc(y,e,c++,g,r,d,[h,f]),pc(y,e,c++,g,r,d,[h,f])):(pc(y,e,c++,g,r,d,[f,f]),pc(y,e,c++,g,r,d,[f,f]));for(var v=1,_=i.length-1;v<_;v++)y=i[v],h=n[v-1],f=n[v],p=n[v+1],g=o[v-1],pc(y,e,c++,g,r,d,[h,f]),pc(y,e,c++,g,r,d,[h,f]),hc(e),g=o[v],d[0]=d[1],d[1]=v!==_-1?Jl.signedAngleBetween(f,p):e.closed?Jl.signedAngleBetween(f,n[0]):0,pc(y,e,c++,g,r,d,[h,f]),pc(y,e,c++,g,r,d,[h,f]);y=i[i.length-1],g=o[o.length-1],f=n[n.length-1],e.closed?(pc(y,e,c++,g,r,d,[f,n[0]]),pc(y,e,c++,g,r,d,[f,n[0]])):(pc(y,e,c++,g,r,d,[f,f]),pc(y,e,c++,g,r,d,[f,f]));hc(e)}(t[s],a);return a.geom_count}function hc(t){var e=t.vertex_data.vertex_elements,i=t.vertex_data.vertex_count-4;e.push(2+i),e.push(1+i),e.push(i),e.push(2+i),e.push(3+i),e.push(1+i),t.geom_count+=2}Object.assign(uc,{name:"lines",built_in:!0,vertex_shader_src:Uu,fragment_shader_src:Bu,selection:!0,init:function(){su.init.apply(this,arguments),this.styles=this.styles||{},this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_EXTRUDE_LINES=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.defines.TANGRAM_TEXTURE_COORDS=!0,this.outline_feature_style={},this.inline_feature_style=this.feature_style},calcDistance:function(t,e){return t&&xo.evalCachedDistanceProperty(t,e)||0},calcDistanceNextZoom:function(t,e){e.zoom++;var i=this.calcDistance(t,e);return e.zoom--,i},calcWidth:function(t,e,i){var r=this.calcDistance(t.width,i);if(!(r<0)){var n,o=t.next_width?this.calcDistanceNextZoom(t.next_width,i):r/2;return 0===r&&0===o||o<0?!1:(e.width_unscaled=r,e.next_width_unscaled=o,t.next_width?(n=.5*(r+(o*=2)),e.width=n*i.units_per_meter_overzoom,e.width_scale=1-o/n):(e.width=r*i.units_per_meter_overzoom,e.width_scale=0),t.texcoords&&(t.inline_texcoord_width?e.texcoord_width=t.inline_texcoord_width:e.texcoord_width=(e.width_unscaled||e.next_width_unscaled)*i.units_per_meter_overzoom/i.tile.overzoom2),!0)}},calcOffset:function(t,e,i){var r,n;t.offset_precalc?(e.offset=t.offset_precalc,e.offset_scale=t.offset_scale_precalc):t.offset?(r=this.calcDistance(t.offset,i),t.next_offset?(n=2*this.calcDistanceNextZoom(t.next_offset,i),Math.abs(r)>=Math.abs(n)?(e.offset=r*i.units_per_meter_overzoom,e.offset_scale=0!==r?1-n/r:0):(e.offset=n*i.units_per_meter_overzoom,e.offset_scale=0!=n?-1*(1-r/n):0)):(e.offset=r*i.units_per_meter_overzoom,e.offset_scale=0)):(e.offset=0,e.offset_scale=0),xo.evalProperty(t.offset_reverse,i)&&(e.offset*=-1)},_parseFeature:function(t,e,i){var r,n,o=this.feature_style;if(!1!==this.calcWidth(e,o,i)&&(this.calcOffset(e,o,i),o.color=this.parseColor(e.color,i),o.color))return o.variant=e.variant,o.z=e.z&&xo.evalCachedDistanceProperty(e.z||0,i)||xo.defaults.z,o.height=t.properties.height||xo.defaults.height,o.extrude=xo.evalProperty(e.extrude,i),o.extrude&&("number"==typeof o.extrude?o.height=o.extrude:Array.isArray(o.extrude)&&(o.height=o.extrude[1])),o.extrude&&o.height&&(o.z+=o.height),o.z*=en.height_scale,o.height*=en.height_scale,o.cap=xo.evalProperty(e.cap,i),o.join=xo.evalProperty(e.join,i),o.miter_limit=xo.evalProperty(e.miter_limit,i),o.tile_edges=e.tile_edges,o.outline=o.outline||{width:{},next_width:{},preprocessed:!0},e.outline&&!1!==e.outline.visible&&e.outline.color&&e.outline.width?(r=2*this.calcDistance(e.outline.width,i),n=2*this.calcDistanceNextZoom(e.outline.next_width,i),0==r&&0==n||r<0||n<0?(o.outline.width.value=null,o.outline.next_width.value=null,o.outline.color=null,o.outline.inline_texcoord_width=null,o.outline.texcoords=!1):(o.outline.width.value=r+o.width_unscaled,o.outline.next_width.value=n+o.next_width_unscaled,o.outline.inline_texcoord_width=o.texcoord_width,o.outline.offset_precalc=o.offset,o.outline.offset_scale_precalc=o.offset_scale,o.outline.color=e.outline.color,o.outline.cap=e.outline.cap,o.outline.join=e.outline.join,o.outline.miter_limit=e.outline.miter_limit,o.outline.texcoords=e.outline.texcoords,o.outline.style=e.outline.style,o.outline.variant=e.outline.variant,e.outline.order?o.outline.order=this.parseOrder(e.outline.order,i):o.outline.order=o.order,o.outline.order>o.order&&(o.outline.order=o.order),o.outline.order-=.5,o.outline.variant_order=0)):(o.outline.width.value=null,o.outline.next_width.value=null,o.outline.color=null,o.outline.inline_texcoord_width=null),o},_preprocess:function(t,e){var i,r=this.sources[e]?this.sources[e].config.uid:"";return t.color=xo.createColorPropertyCache(t.color),t.width=xo.createPropertyCache(t.width,xo.parseUnits),t.width&&t.width.type!==xo.CACHE_TYPE.STATIC&&(t.next_width=xo.createPropertyCache(t.width,xo.parseUnits)),t.offset=t.offset&&xo.createPropertyCache(t.offset,xo.parseUnits),t.offset&&t.offset.type!==xo.CACHE_TYPE.STATIC&&(t.next_offset=xo.createPropertyCache(t.offset,xo.parseUnits)),t.z=xo.createPropertyCache(t.z,xo.parseUnits),t.dash=void 0!==t.dash?t.dash:this.dash,t.dash_key=t.dash&&this.dashTextureKey(t.dash,r),t.dash_background_color=void 0!==t.dash_background_color?t.dash_background_color:this.dash_background_color,t.dash_background_color=t.dash_background_color&&xo.parseColor(t.dash_background_color),t.texture_merged=t.dash_key||(void 0!==t.texture?t.texture:this.texture),t.texcoords=this.texcoords||t.texture_merged?1:0,this.computeVariant(t),t.outline&&(t.outline.style=t.outline.style||this.name,t.outline.color=xo.createColorPropertyCache(t.outline.color),t.outline.width=xo.createPropertyCache(t.outline.width,xo.parseUnits),t.outline.next_width=xo.createPropertyCache(t.outline.width,xo.parseUnits),t.outline.cap=t.outline.cap||t.cap,t.outline.join=t.outline.join||t.join,t.outline.miter_limit=t.outline.miter_limit||t.miter_limit,t.outline.offset=t.offset,(i=this.styles[t.outline.style])?(t.outline.dash=void 0!==t.outline.dash?t.outline.dash:i.dash,t.outline.texture=void 0!==t.outline.texture?t.outline.texture:i.texture,null!=t.outline.dash?(t.outline.dash_key=t.outline.dash&&this.dashTextureKey(t.outline.dash,r),t.outline.texture_merged=t.outline.dash_key):null===t.outline.dash||null!=t.outline.texture?(t.outline.dash_key=null,t.outline.texture_merged=t.outline.texture):(t.outline.dash=t.dash,t.outline.dash_key=t.outline.dash&&this.dashTextureKey(t.outline.dash,r),t.outline.texture_merged=t.outline.dash_key),t.outline.dash_background_color=void 0!==t.outline.dash_background_color?t.outline.dash_background_color:i.dash_background_color,t.outline.dash_background_color=void 0!==t.outline.dash_background_color?t.outline.dash_background_color:t.dash_background_color,t.outline.dash_background_color=t.outline.dash_background_color&&xo.parseColor(t.outline.dash_background_color),t.outline.texcoords=i.texcoords||t.outline.texture_merged?1:0,this.computeVariant(t.outline)):(En({level:"warn",once:!0},"Layer '".concat(t.layers[t.layers.length-1],"': ")+"line 'outline' specifies non-existent draw style '".concat(t.outline.style,"' (or maybe the style is ")+"defined but is missing a 'base' or has another error), skipping outlines in layer"),t.outline=null)),t},dashTextureKey:function(t,e){return"__dash_"+e+"_"+this.scene_id+"_"+JSON.stringify(t)},getDashTexture:function(t,e){var i,r=this.dashTextureKey(t,this.sources[e].config.uid);null==uc.dash_textures[r]&&(uc.dash_textures[r]=!0,i=function(t,e){var i=1<arguments.length&&void 0!==e?e:{},r=i.dash_color||sc,n=i.background_color||lc,o=t,a=i.scale||1;o.length%2==1&&Array.prototype.push.apply(o,o);for(var s=!0,l=[],u=0;u<o.length;u++){for(var c=Math.floor(o[u]*a),h=0;h<c;h++)Array.prototype.push.apply(l,s?r:n);s=!s}return{pixels:l=new Uint8Array(l),length:l.length/4}}(t,{scale:20}),this.textureManager.create(this.gl,r,{data:i.pixels,height:i.length,width:1,filtering:"nearest"}))},endData:function(t){var e=this;return su.endData.call(this,t).then(function(i){if(i){i.uniforms.u_has_line_texture=!1,i.uniforms.u_texture=e.textureManager.default,i.uniforms.u_v_scale_adjust=en.tile_scale;var r=[];for(var n in i.meshes)!function(n){var o,a,s=i.meshes[n].variant;s.texture&&((o=i.meshes[n].uniforms=i.meshes[n].uniforms||{}).u_has_line_texture=!0,o.u_texture=s.texture,o.u_texture_ratio=1,s.dash&&(o.u_v_scale_adjust=20*en.tile_scale,o.u_dash_background_color=s.dash_background_color||[0,0,0,0]),s.dash_key&&null==uc.dash_textures[s.dash_key]&&(uc.dash_textures[s.dash_key]=!0,fn.postMessage(e.main_thread_target+".getDashTexture",s.dash,t.source)),null==e.textureManager.textures[s.texture]?r.push(e.textureManager.syncTexturesToWorker([s.texture]).then(function(t){var e=t[s.texture];e&&(o.u_texture_ratio=e.height/e.width)})):(a=e.textureManager.textures[s.texture],o.u_texture_ratio=a.height/a.width))}(n);return t.mesh_data[e.name]=i,Promise.all(r).then(function(){return i})}return i})},computeVariant:function(t){var e=t.offset?1:0;t.dash_key&&(e+=t.dash_key,t.dash_background_color&&(e+=t.dash_background_color)),t.texture_merged&&(e+=t.texture_merged),e=Bl(e+="/"+t.texcoords),t.variant=e,null==uc.variants[e]&&(uc.variants[e]={key:e,order:t.variant_order,offset:t.offset?1:0,texcoords:t.texcoords,texture:t.texture_merged,dash:t.dash,dash_key:t.dash_key,dash_background_color:t.dash_background_color})},vertexLayoutForMeshVariant:function(t){var e;return null==uc.vertex_layouts[t.key]&&(e=[{name:"a_position",size:4,type:lu.SHORT,normalized:!1},{name:"a_extrude",size:2,type:lu.SHORT,normalized:!1},{name:"a_offset",size:2,type:lu.SHORT,normalized:!1,static:t.offset?null:[0,0]},{name:"a_scaling",size:2,type:lu.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:lu.UNSIGNED_SHORT,normalized:!0,static:t.texcoords?null:[0,0]},{name:"a_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0}],uc.vertex_layouts[t.key]=new gu(e)),uc.vertex_layouts[t.key]},meshVariantTypeForDraw:function(t){return uc.variants[t.variant]},makeVertexTemplate:function(t,e){var i=0;return this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=t.z||0,this.vertex_template[i++]=this.scaleOrder(t.order),this.vertex_template[i++]=0,this.vertex_template[i++]=0,e.variant.offset&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0),this.vertex_template[i++]=1024*t.width_scale,this.vertex_template[i++]=1024*t.offset_scale,e.variant.texcoords&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0),this.vertex_template[i++]=255*t.color[0],this.vertex_template[i++]=255*t.color[1],this.vertex_template[i++]=255*t.color[2],this.vertex_template[i++]=255*t.color[3],this.selection&&(this.vertex_template[i++]=255*t.selection_color[0],this.vertex_template[i++]=255*t.selection_color[1],this.vertex_template[i++]=255*t.selection_color[2],this.vertex_template[i++]=255*t.selection_color[3]),this.vertex_template},buildLines:function(t,e,i,r,n){var o;this.feature_style=this.outline_feature_style,!e.outline||null==e.outline.color||null==e.outline.width.value||(o=this.styles[e.outline.style])&&o.addFeature(r.feature,e.outline,r),this.feature_style=this.inline_feature_style;var a=i.vertex_data,s=a.vertex_layout,l=this.makeVertexTemplate(e,i);return function(t,e,i,r,n){var o,a,s=n.closed_polygon,l=n.remove_tile_edges,u=n.tile_edge_tolerance,c=n.texcoord_index,h=(n.texcoord_scale,n.texcoord_width),f=n.texcoord_ratio,p=n.texcoord_normalize,d=n.extrude_index,y=n.offset_index,g=n.join,v=n.cap,_=n.miter_limit,m=n.offset,b=n.crop_by_tile,x=v?Vu[v]:Vu.butt,w=g?qu[g]:qu.miter;w===qu.miter&&(o=(_=_||Wu.MITER_LIMIT)*_),c&&(p=p||Wu.TEXCOORD_NORMALIZE,a=1/(h*(f=f||Wu.TEXCOORD_RATIO)*Xu));for(var k={closed_polygon:s,remove_tile_edges:l,tile_edge_tolerance:u,miter_len_sq:o,join_type:w,cap_type:x,vertex_data:i,vertex_template:r,half_width:e/2,extrude_index:d,offset_index:y,v_scale:a,texcoord_index:c,texcoord_width:h,texcoord_normalize:p,offset:m,geom_count:0,crop_by_tile:b},A=0;A<t.length;A++)Qu(t[A],k);if(k.extra_lines)for(var T=0;T<k.extra_lines.length;T++)Qu(k.extra_lines[T],k);return k.geom_count}(t,e.width,a,l,{cap:e.cap,join:e.join,miter_limit:e.miter_limit,extrude_index:s.index.a_extrude,offset_index:s.index.a_offset,texcoord_index:s.index.a_texcoord,texcoord_width:e.texcoord_width,texcoord_normalize:65535,closed_polygon:n&&n.closed_polygon,remove_tile_edges:!e.tile_edges&&n&&n.remove_tile_edges,tile_edge_tolerance:en.tile_scale*r.tile.pad_scale*2,offset:e.offset,crop_by_tile:this.crop_by_tile})},buildPolygons:function(t,e,i,r){for(var n=0,o=0;o<t.length;o++)n+=this.buildLines(t[o],e,i,r,{closed_polygon:!0,remove_tile_edges:!this.crop_by_tile});return n}});var fc=[[1,1],[1,-1],[-1,1],[-1,-1]];function pc(t,e,i,r,n,o,a){var s,l=e.vertex_template,u=e.vertex_data;dc(e,"a_position",t),dc(e,"a_width",e.half_width),e.vertex_layout_index.a_barycentric&&((s=[0,0,0])[i%3]=1,dc(e,"a_barycentric",s)),dc(e,"a_tangents",a[0].concat(a[1])),dc(e,"a_segment",r),dc(e,"a_texcoord",fc[i%4]),dc(e,"a_length",n),dc(e,"a_closed",e.closed?1:0),dc(e,"a_angles",o),u.addVertex(l)}function dc(t,e,i){var r=i.length,n=t.vertex_template,o=t.vertex_layout_index[e],a=0;if(r)for(;a!==r;)n[o+a]=i[a],a++;else n[o+a]=i}function yc(t,e){for(var i=t.reduce(function(t,e){return t+e}),r=0,n=[],o=0,a=t.length;o<=a;o+=2){var s=Math.max(1e-4,t[o%a]),l=Math.max(1e-4,t[(o+1)%a]);n.push(r,r+s),r+=s+l}for(var u=new Uint8Array(4*e),c=0,h=0;h<e;h++)!function(t){var r=i*t/(e-1),o=function(t){for(var e=t[0],i=0,r=1,n=t.length;r<n;r++)t[r]<e&&(e=t[i=r]);return i}(n.map(function(t){return Math.abs(t-r)})),a=void 0,s=void 0,l=void 0,l=o%2==0?(a=r<=n[o]?1:0,s=n[o],n[o+1]):(a=r>n[o]?2:0,s=n[o-1],n[o]);u[c++]=n[o],u[c++]=a,u[c++]=s,u[c++]=l}(h);return u}var gc=Object.create(su),vc={round:1,"arrow-tail":2,"arrow-head":3,square:4,butt:5},_c={miter:0,round:1,bevel:2},mc=vc.round,bc=_c.miter,xc=[0,0],wc="antialias join linecaps miter_limit dash_index dash dash_caps dash_phase".split(" ");Object.assign(gc,{name:"pattern-lines",built_in:!0,vertex_shader_src:"uniform vec2 u_resolution;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform sampler2D u_uniforms;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform vec3 u_map_position;uniform float u_antialias;uniform vec2 u_linecaps;uniform float u_linejoin;uniform float u_miter_limit;uniform float u_dash_index;uniform vec2 u_dash_caps;uniform float u_dash_phase;uniform float u_dash_period;attribute vec4 a_position;attribute vec4 a_color;attribute float a_width;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nattribute vec3 a_barycentric;\n#endif\nattribute vec2 a_normal;attribute float a_length;attribute vec2 a_segment;attribute vec2 a_texcoord;attribute vec2 a_angles;attribute vec4 a_tangents;attribute float a_closed;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nvarying vec3 v_barycentric;\n#endif\nvarying vec2 v_segment;varying vec2 v_angles;varying vec2 v_texcoord;varying vec2 v_distances;varying vec2 v_miter;varying float v_length;varying float v_linewidth_and_closed;varying float v_joinIndicator;\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#ifndef TANGRAM_HEIGHT_SCALE\nfloat TANGRAM_HEIGHT_SCALE=16.0;\n#endif\n#define UNPACK_SCALING(x) (x / 1024.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: global\nconst float PI=3.141592653589793;const float THETA=15.0*PI/180.0;float cross(in vec2 v1,in vec2 v2){return v1.x*v2.y-v1.y*v2.x;}float signed_distance(in vec2 v1,in vec2 v2,in vec2 v3){return cross(v2-v1,v1-v3)/length(v2-v1);}void rotate(in vec2 v,in float angle,out vec2 result){float cosine=cos(angle);float sine=sin(angle);result=vec2(cosine*v.x-sine*v.y,sine*v.x+cosine*v.y);}void main(){\n#pragma tangram: setup\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nv_modelpos_base_zoom=modelPositionBaseZoom();\n#endif\nfloat linewidth=a_width*2.0;v_angles=a_angles;v_segment=a_segment;v_color=a_color;v_length=a_length;v_texcoord=a_texcoord;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nv_barycentric=a_barycentric;\n#endif\nv_color.a=min(linewidth,v_color.a);linewidth=max(linewidth,1.0);linewidth/=exp2(u_map_position.z-u_tile_origin.w);v_linewidth_and_closed=linewidth*(a_closed>0.0 ?-1.0 : 1.0);if(v_color.a<=0.0){gl_Position=vec4(0.0,0.0,0.0,1.0);return;}float width=ceil(1.25*u_antialias+linewidth)/2.0;vec2 t1=normalize(a_tangents.xy);vec2 t2=normalize(a_tangents.zw);float u=a_texcoord.x;u*=-1.0;float v=a_texcoord.y;vec4 position=vec4(a_position.xy,a_position.z/TANGRAM_HEIGHT_SCALE,1.0);if(t1!=t2){float angle=a_texcoord.x==1.0 ? a_angles.x : a_angles.y;vec2 t=normalize(t1+t2);vec2 o=vec2(+t.y,-t.x);float segmentLength=a_segment.y-a_segment.x;float magnitude=width/cos(angle/2.0);float sqMagnitude=magnitude*magnitude;float seg1SqMagnitude=dot(a_tangents.xy,a_tangents.xy);float seg2SqMagnitude=dot(a_tangents.zw,a_tangents.zw);if((abs(magnitude)>linewidth)&&(sqMagnitude>=min(seg1SqMagnitude,seg2SqMagnitude))){if(u==1.0){o=vec2(-t2.y,+t2.x);}else{o=vec2(-t1.y,+t1.x);}magnitude=width;angle=0.0;v_angles.x=0.0;v_angles.y=0.0;}if(u_dash_index>0.0){if((abs(angle)>THETA)){position.xy+=v*width*o/cos(angle/2.0);float s=sign(angle);if(angle<0.0){if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);if(v==1.0){position.xy-=2.0*width*t1/sin(angle);u-=2.0*width/sin(angle);}}else{u=v_segment.x-v*width*tan(angle/2.0);if(v==1.0){position.xy+=2.0*width*t2/sin(angle);u+=2.0*width/sin(angle);}}}else{if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);if(v==-1.0){position.xy+=2.0*width*t1/sin(angle);u+=2.0*width/sin(angle);}}else{u=v_segment.x-v*width*tan(angle/2.0);if(v==-1.0){position.xy-=2.0*width*t2/sin(angle);u-=2.0*width/sin(angle);}}}}else{position.xy+=v*width*o/cos(angle/2.0);if(u==+1.0){u=v_segment.y;}else{u=v_segment.x;}}}else{position.xy+=v*o*magnitude;if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);}else{u=v_segment.x-v*width*tan(angle/2.0);}}v_joinIndicator=(segmentLength+v*width*tan(angle/2.0))/segmentLength;}else{v_joinIndicator=-1.0;vec2 o=vec2(+t1.y,-t1.x);position.xy+=v*width*o;if(u==-1.0){u=v_segment.x-width;position.xy-=width*t1;}else{u=v_segment.y+width;position.xy+=width*t2;}}vec2 t;vec2 curr=a_position.xy;if(a_texcoord.x>=0.0){vec2 next=curr+t2*(v_segment.y-v_segment.x);rotate(t1,+a_angles.x/2.0,t);v_miter.x=signed_distance(curr,curr+t,position.xy);rotate(t2,+a_angles.y/2.0,t);v_miter.y=signed_distance(next,next+t,position.xy);}else{vec2 prev=curr-t1*(v_segment.y-v_segment.x);rotate(t1,-a_angles.x/2.0,t);v_miter.x=signed_distance(prev,prev+t,position.xy);rotate(t2,-a_angles.y/2.0,t);v_miter.y=signed_distance(curr,curr+t,position.xy);}v_distances=vec2(u,v*width);v_world_position=wrapWorldPosition(u_model*position);v_local_space_position=position;position=u_modelView*position;\n#pragma tangram: position\nv_position=position;v_normal=normalize(u_normalMatrix*TANGRAM_NORMAL);\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvec3 normal=v_normal;\n#pragma tangram: normal\nv_lighting=calculateLighting(position.xyz-u_eye,normal,vec4(1.));\n#endif\ncameraProjection(position);\n#ifdef TANGRAM_LAYER_ORDER\napplyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);\n#endif\ngl_Position=position;}",fragment_shader_src:"uniform vec2 u_resolution;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform sampler2D u_dash_atlas;uniform float u_antialias;uniform vec2 u_linecaps;uniform float u_linejoin;uniform float u_miter_limit;uniform float u_dash_phase;uniform float u_dash_period;uniform float u_dash_index;uniform vec2 u_dash_caps;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nvarying vec3 v_barycentric;\n#endif\nvarying vec2 v_segment;varying vec2 v_angles;varying vec2 v_texcoord;varying vec2 v_distances;varying vec2 v_miter;varying float v_length;varying float v_linewidth_and_closed;varying float v_joinIndicator;\n#define TANGRAM_NORMAL v_normal\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: global\n#pragma tangram: utils\nconst float PI=3.141592653589793;const float HALF_PI=PI/2.0;const float THETA=15.0*PI/180.0;/***Compute distance to cap.*@param{int}type The Type of the cap(see CAP_TYPE in pattern_lines)*@param{float}dx The distance of the pixel from the beginning of the line(not straight distance,but along the legs)*@param{float}dy The distance of the pixel from the midline(see v_distances in vertex shader,aka ±1*half_line_width)*@param{float}aa_radius The distance from the mid-line from where antialiasing starts.*For example for a linewidth 10px width and 2px filter radius it is 10px/2-2px=3px.*@return{float}distance*/float cap(int type,float dx,float dy,float aa_radius){float dist=0.0;dx=abs(dx);dy=abs(dy);if(type==1)dist=sqrt(dx*dx+dy*dy);else if(type==3)dist=(dx+abs(dy));else if(type==2)dist=max(abs(dy),(aa_radius+dx-abs(dy)));else if(type==4)dist=max(dx,dy);else if(type==5)dist=max(dx+aa_radius,dy);return dist;}/***Compute distance to join.*@param{int}type The type of the join(see JOIN_TYPE in pattern_lines)*@param{vec2}segment Interpolated a_segment attribute from the vertex shader*@param{vec2}texcoord Pair of u/v coordinates to identify the 4 different extruded points of the segment.*@param{vec2}distances 2 component vector where:*x is the distance of the pixel from the beginning of the line(along the legs)*y is the  distance of the pixel from the midline(see v_distances in vertex shader,±1*half_line_width)*@param{vec2}miter Miter point coordiante*@param{float}miter_limit The miter limit*@param{float}linewidth The width of the line*@return{float}computed distance*/float join(in int type,in vec2 segment,in vec2 texcoord,in vec2 distances,in vec2 miter,in float miter_limit,in float linewidth){float dx=distances.x;float result=abs(distances.y);if((dx<segment.x)||(dx>segment.y)){if(type==1){float s=dx<segment.x ? segment.x : segment.y;result=max(result,length(distances-vec2(s,0.0)));}else{float m=abs(texcoord.x>=0.0 ? miter.x : miter.y);if(type==2){result=max(result,m);}else if(type==0){result=max(result,m-miter_limit*linewidth/2.0);}}}return result;}void main(void){\n#pragma tangram: setup\nvec4 color=v_color;vec3 normal=TANGRAM_NORMAL;\n#ifdef TANGRAM_CROP_BY_TILE\nif(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}\n#endif\n#if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\ncalculateNormal(normal);\n#endif\n#if !defined(TANGRAM_LIGHTING_VERTEX)\n#pragma tangram: normal\n#endif\n#pragma tangram: color\n#if defined(TANGRAM_LIGHTING_FRAGMENT)\ncolor=calculateLighting(v_position.xyz-u_eye,normal,color);\n#elif defined(TANGRAM_LIGHTING_VERTEX)\ncolor*=v_lighting;\n#endif\n#pragma tangram: filter\nif(v_color.a<=0.0){discard;}bool solid=(u_dash_index==0.0);bool closed=v_linewidth_and_closed<0.0;float dx=v_distances.x;float dy=v_distances.y;float linewidth=abs(v_linewidth_and_closed);float aa_radius=linewidth/2.0-u_antialias;float dist=0.0;vec2 linecaps=u_linecaps;vec2 dash_caps=u_dash_caps;float line_start=0.0;float line_stop=v_length;if(solid){dist=abs(dy);bool potentialCap=!closed&&v_joinIndicator<0.0;if(potentialCap&&dx<line_start){dist=cap(int(u_linecaps.x),abs(dx),abs(dy),aa_radius);}else if(potentialCap&&dx>line_stop){dist=cap(int(u_linecaps.y),abs(dx)-line_stop,abs(dy),aa_radius);}else{dist=join(int(u_linejoin),v_segment,v_texcoord,v_distances,v_miter,u_miter_limit,linewidth);}}else{float segment_start=v_segment.x;float segment_stop=v_segment.y;float segment_center=(segment_start+segment_stop)/2.0;float freq=u_dash_period*linewidth;float dash_phase=u_dash_phase-1e-5;float u=mod(dx+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));float dash_center=float(tex.x)*255.0*linewidth;float dash_type=floor(float(tex.y)*255.0+0.5);float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;float dash_start=dx-u+_start;float dash_stop=dx-u+_stop;if((dash_stop<segment_start)&&(dash_caps.x!=5.0)){float u=mod(segment_start+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));dash_center=float(tex.x)*255.0*linewidth;float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;dash_start=segment_start-u+_start;dash_stop=segment_start-u+_stop;}else if((dash_start>segment_stop)&&(dash_caps.y!=5.0)){float u=mod(segment_stop+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));dash_center=float(tex.x)*255.0*linewidth;float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;dash_start=segment_stop-u+_start;dash_stop=segment_stop-u+_stop;}bool discontinuous=((dx<segment_center)&&abs(v_angles.x)>THETA)||((dx>=segment_center)&&abs(v_angles.y)>THETA);float d_join=join(int(u_linejoin),v_segment,v_texcoord,v_distances,v_miter,u_miter_limit,linewidth);if(closed){line_start+=linewidth/2.0;line_stop-=linewidth/2.0;}if(dash_stop<=line_start){discard;}if(dash_start>=line_stop){discard;}if(discontinuous){if((dash_start>segment_stop)){discard;}if((dash_stop<segment_start)){discard;}if(dash_caps.x==1.0){if((u>_stop)&&(dash_stop>segment_stop)&&(abs(v_angles.y)<HALF_PI)){discard;}}if(dash_caps.y==1.0){if((u<_start)&&(dash_start<segment_start)&&(abs(v_angles.x)<HALF_PI)){discard;}}if((dash_caps.x!=1.0)&&(dash_caps.x!=5.0)){if((dash_start<segment_start)&&(abs(v_angles.x)<HALF_PI)){float a=v_angles.x/2.0;float cos_a=cos(a);float sin_a=sin(a);float x=(segment_start-dx)*cos_a-dy*sin_a;float y=(segment_start-dx)*sin_a+dy*cos_a;if(x>0.0){discard;}dash_caps.x=4.0;}}if((dash_caps.y!=1.0)&&(dash_caps.y!=5.0)){if((dash_stop>segment_stop)&&(abs(v_angles.y)<HALF_PI)){float a=v_angles.y/2.0;float cos_a=cos(a);float sin_a=sin(a);float x=(dx-segment_stop)*cos_a-dy*sin_a;float y=(dx-segment_stop)*sin_a+dy*cos_a;if(x>0.0){discard;}dash_caps.y=4.0;}}}if((dx<line_start)&&(dash_start<=line_start)&&(dash_stop>line_start)){dist=cap(int(linecaps.x),dx-line_start,dy,aa_radius);}else if((dx>line_stop)&&(dash_stop>line_stop)&&(dash_start<line_stop)){dist=cap(int(linecaps.y),dx-line_stop,dy,aa_radius);}else if(dash_type==1.0){dist=cap(int(dash_caps.x),abs(dash_center-u),dy,aa_radius);if((dx>line_start)&&(dx<line_stop)){dist=max(dist,d_join);}}else if(dash_type==0.0){dist=abs(dy);}else if(dash_type==2.0){dist=cap(int(dash_caps.y),abs(u-dash_center),dy,aa_radius);if((dx>line_start)&&(dx<line_stop)){dist=max(dist,d_join);}}if((dx>line_start)&&(dx<line_stop)){if((dx<=segment_start)&&(dash_start<=segment_start)&&(dash_stop>=segment_start)){dist=d_join;float angle=HALF_PI+v_angles.x;float f=abs((segment_start-dx)*cos(angle)-dy*sin(angle));dist=max(f,dist);}else if((dx>segment_stop)&&(dash_start<=segment_stop)&&(dash_stop>=segment_stop)){dist=d_join;float angle=HALF_PI+v_angles.y;float f=abs((dx-segment_stop)*cos(angle)-dy*sin(angle));dist=max(f,dist);}else if(dx<(segment_start-linewidth/2.)){discard;}else if(dx>(segment_stop+linewidth/2.)){discard;}}else if(dx<(segment_start-linewidth/2.)){discard;}else if(dx>(segment_stop+linewidth/2.)){discard;}}dist=dist-aa_radius;if(dist>=0.0){if(u_antialias==0.0){discard;}else{color=vec4(color.rgb,exp(-dist*dist)*color.a);}}\n#ifdef TANGRAM_DEBUG_TRIANGLES\nif(any(lessThan(v_barycentric,vec3(0.0085)))){color=vec4(0.0,1.0,0.0,1.0);}\n#endif\ngl_FragColor=color;}",selection:!0,init:function(){su.init.apply(this,arguments),this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.defines.TANGRAM_DEBUG_TRIANGLES=!1,this.defines.TANGRAM_DEBUG_NO_TEXTURE_FLOAT_SUPPORT=!1,this.styles=this.styles||{},gc.vertex_layouts=[],gc.variants={}},calcDistance:function(t,e){return t&&xo.evalCachedDistanceProperty(t,e)||0},calcDash:function(t,e){var i=xo.evalProperty(t.dash,e),r=0;return i&&((i=Array.isArray(i)&&i.length?i:xc).length%2==1&&(i=i.concat(i)),r=+(r=i.reduce(function(t,e){return t+e}))||0),{dash:i,dash_period:r}},calcWidth:function(t,e,i){var r=this.calcDistance(t.width,i);return!(r<0)&&(e.width=r*i.units_per_meter_overzoom,!0)},getCapType:function(t,e,i){var r=xo.evalProperty(t,e);return void 0!==vc[r]?vc[r]:i},_parseFeature:function(t,e,i){if(!1!==this.calcWidth(e,this.feature_style,i)){var r=this.parseColor(e.color,i);if(r&&0!==r[3]){var n=this.getCapType(e.cap,i,mc),o=xo.evalProperty(e.join,i),a=+xo.evalProperty(e.miter_limit,i),s=this.calcDash(e,i),l=s.dash,u=s.dash_period,c=Object.assign({color:r,antialias:e.antialias,linecaps:[this.getCapType(e.tail_cap,i,n),this.getCapType(e.head_cap,i,n)],join:void 0!==_c[o]?_c[o]:bc,miter_limit:0<=a?a:3,dash_index:0===u?0:1,dash:l,dash_caps:[this.getCapType(e.tail_cap,i,n),this.getCapType(e.head_cap,i,n)],dash_phase:+xo.evalProperty(e.dash_phase,i)||0,dash_period:u},this.feature_style);return c.z=e.z&&xo.evalCachedDistanceProperty(e.z||0,i)||xo.defaults.z,c.z*=en.height_scale,c.extrude=xo.evalProperty(e.extrude,i),c.extrude&&(!0===c.extrude?(c.height=void 0!==t.properties.height?t.properties.height:xo.defaults.height,c.min_height=void 0!==t.properties.min_height?t.properties.min_height:xo.defaults.min_height):"number"==typeof c.extrude?(c.height=c.extrude,c.min_height=0):Array.isArray(c.extrude)&&(c.min_height=c.extrude[0],c.height=c.extrude[1]),c.height*=en.height_scale,c.min_height*=en.height_scale),this.computeVariant(c),c}}},_preprocess:function(t){t.color=xo.createColorPropertyCache(t.color),t.width=xo.createPropertyCache(t.width,xo.parseUnits),t.width&&t.width.type!==xo.CACHE_TYPE.STATIC&&(t.next_width=xo.createPropertyCache(t.width,xo.parseUnits)),t.z=xo.createPropertyCache(t.z,xo.parseUnits);var e=+t.antialias;return t.antialias=isNaN(e)?0:e,t},buildRasterTextures:function(t,e){var i=[];for(var r in e.meshes){var n,o=gc.variants[r],a=o.uniforms,s=o.pattern;a.u_dash_index&&(n="__dash_"+s.join("_")+"_"+t.key+"_"+t.id,i.push({name:n,data:yc(s,1024)}),a.u_dash_atlas=n,e.meshes[r].textures=[n]),e.meshes[r].uniforms=a}return e.uniforms=e.uniforms||{},i.length?fn.postMessage(this.main_thread_target+".loadTextures",i).then(function(t){return e}):Promise.resolve(e)},loadTextures:function(t){for(var e=[],i=0;i<t.length;i++){var r=t[i],n=(n=this.textureManager.textures[r.name])||this.textureManager.create(this.gl,r.name,{filtering:"nearest",repeat:!0,width:1024,height:1,data:r.data});e.push(n.loading)}return Promise.all(e).then(function(t){return t.map(function(t){return t.retain(),t.name})})},computeVariant:function(t){var e=function(t){for(var e=[],i=0,r=wc.length;i<r;i++){var n=t[wc[i]];Array.isArray(n)?e.push(n.join("_")):"boolean"==typeof n?e.push(n?1:0):n&&e.push(n.toString())}return e.join("/")}(t);t.variant=e,null==gc.variants[e]&&(gc.variants[e]={key:e,order:t.variant_order,uniforms:{u_antialias:t.antialias,u_linecaps:t.linecaps,u_linejoin:t.join,u_miter_limit:t.miter_limit,u_dash_index:t.dash_index,u_dash_caps:t.dash_caps,u_dash_phase:t.dash_phase,u_dash_period:t.dash_period},pattern:t.dash})},vertexLayoutForMeshVariant:function(t){var e;return null==gc.vertex_layouts[t.key]&&(e=[{name:"a_position",size:4,type:lu.SHORT,normalized:!1},{name:"a_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0},{name:"a_width",size:1,type:lu.FLOAT,normalized:!1},{name:"a_tangents",size:4,type:lu.FLOAT,normalized:!1},{name:"a_segment",size:2,type:lu.FLOAT,normalized:!1},{name:"a_angles",size:2,type:lu.FLOAT,normalized:!1},{name:"a_texcoord",size:2,type:lu.FLOAT,normalized:!0},{name:"a_length",size:1,type:lu.FLOAT,normalized:!1},{name:"a_closed",size:1,type:lu.FLOAT,normalized:!1},{name:"a_selection_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0}],this.defines.TANGRAM_DEBUG_TRIANGLES&&e.push({name:"a_barycentric",size:3,type:lu.SHORT,normalized:!1}),gc.vertex_layouts[t.key]=new gu(e)),gc.vertex_layouts[t.key]},meshVariantTypeForDraw:function(t){return gc.variants[t.variant]},makeVertexTemplate:function(t){var e=0;return this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=t.z+t.height||0,this.vertex_template[e++]=this.scaleOrder(t.order),this.vertex_template[e++]=255*t.color[0],this.vertex_template[e++]=255*t.color[1],this.vertex_template[e++]=255*t.color[2],this.vertex_template[e++]=255*t.color[3],this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.selection&&(this.vertex_template[e++]=255*t.selection_color[0],this.vertex_template[e++]=255*t.selection_color[1],this.vertex_template[e++]=255*t.selection_color[2],this.vertex_template[e++]=255*t.selection_color[3]),this.defines.TANGRAM_DEBUG_TRIANGLES&&(this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=0),this.vertex_template},buildLines:function(t,e,i,r,n){var o=4<arguments.length&&void 0!==n&&n,a=i.vertex_data,s=a.vertex_layout,l=this.makeVertexTemplate(e,i);return cc(t,e.width,a,l,s.index,o)},buildPolygons:function(t,e,i,r){for(var n=0,o=0,a=t.length;o<a;o++)n+=this.buildLines(t[o],e,i,r,!0);return n}});var kc=0,Ac={id_prefix:"",nextLabelId:function(){return"".concat(Ac.id_prefix,"/").concat(kc++)}};function Tc(t){return{priority:t.priority,collide:t.collide,repeat_distance:t.repeat_distance,repeat_group:t.repeat_group,buffer:t.buffer,italic:t.italic}}var Ec=["left","top-left","bottom-left"],Mc=["right","top-right","bottom-right"],Sc=["top","top-left","top-right"],Rc=["bottom","bottom-left","bottom-right"],Pc={computeOffset:function(t,e,i,r){var n=3<arguments.length&&void 0!==r?r:null;if(!i||"center"===i)return t;var o=[t[0],t[1]],n=n||this.default_buffer;return this.isLeftAnchor(i)?(o[0]-=e[0]/2,"left"===i&&(o[0]-=n[0])):this.isRightAnchor(i)&&(o[0]+=e[0]/2,"right"===i&&(o[0]+=n[1])),this.isTopAnchor(i)?(o[1]-=e[1]/2,"top"===i&&(o[1]-=n[2])):this.isBottomAnchor(i)&&(o[1]+=e[1]/2,"bottom"===i&&(o[1]+=n[3])),o},alignForAnchor:function(t){if(t&&"center"!==t){if(this.isLeftAnchor(t))return"right";if(this.isRightAnchor(t))return"left"}return"center"},isLeftAnchor:function(t){return-1<Ec.indexOf(t)},isRightAnchor:function(t){return-1<Mc.indexOf(t)},isTopAnchor:function(t){return-1<Sc.indexOf(t)},isBottomAnchor:function(t){return-1<Rc.indexOf(t)},default_buffer:[2.5,2.5,1.5,.75],zero_buffer:[0,0,0,0]};function Oc(t,e,i,r,n){var o=[],a=i-t,s=r-e,l=Jr.getLineLength(t,e,i,r),u=2*n;if((c=l/u)<=1)o.push(t+a/2,e+s/2,n);else{var c,h=u/l,f=a*h,p=s*h;(c=l/n/2)%1&&o.push(i-f/2,r-p/2,n),c|=0;for(var d=t+f/2,y=e+p/2;c--;)o.push(d,y,n),d+=f,y+=p}return o}var Cc=function(){function t(e,i,r,n){_r(this,t),this.id=Ac.nextLabelId(),this.position=[e[0],e[1]],void 0!==e[2]&&this.position.push(e[2]),this.size=i,this.layout=n,this.anchor=Array.isArray(this.layout.anchor)?this.layout.anchor[0]:this.layout.anchor,this.placed=null,this.type="point",this.parent=this.layout.parent,this.offset=this.computeOffset(),this.align=this.layout.align||Pc.alignForAnchor(this.anchor),this._is_flat=r}return br(t,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,size:this.size,offset:this.offset,align:this.align,sides:this.getSides(),breach:!this.inTileBounds(),layout:Tc(this.layout)}}},{key:"inTileBounds",value:function(){var t=this.getAABB(),e=t.left,i=t.top,r=t.right,n=t.bottom;return Sn.pointInTile([e,i])&&Sn.pointInTile([r,n])}},{key:"isFlat",value:function(){return this._is_flat}},{key:"setAnchor",value:function(t){this._circles=void 0,this._aabb=void 0,this.anchor=t,this.offset=this.computeOffset()}},{key:"computeOffset",value:function(){var t,e=[this.layout.offset[0],this.layout.offset[1]];return this.parent&&(t=this.parent,e=Pc.computeOffset(e,t.size,t.anchor,Pc.zero_buffer),e=Pc.computeOffset(e,t.size,this.anchor,Pc.zero_buffer),t.offset!==xo.zeroPair&&(e===xo.zeroPair?e=t.offset:(e[0]+=t.offset[0],e[1]+=t.offset[1]))),Pc.computeOffset(e,this.size,this.anchor)}},{key:"getBoundingCircles",value:function(){return this.angle?(this._circles||(t=this.layout.units_per_pixel,n=-(i=(e=this.size[0]/2*t)*Math.cos(this.angle)),o=-(r=e*Math.sin(this.angle)),s=(a=Lr(this.position,2))[0],l=a[1],i+=s,r+=l*=-1,n+=s,o+=l,u=this.size[1]/2*t,this._circles=Oc(i,r,n,o,u)),this._circles):[];var t,e,i,r,n,o,a,s,l,u}},{key:"getAABB",value:function(){var t,e,i,r,n;return this._aabb||(t=this.layout.units_per_pixel,e=(this.size[0]/2+this.layout.buffer[0])*t,i=(this.size[1]/2+this.layout.buffer[1])*t,r=this.position[0]+this.offset[0]*t,n=this.position[1]-this.offset[1]*t,this._aabb={left:r-e,top:n+i,right:r+e,bottom:n-i}),this._aabb}},{key:"getSides",value:function(){var t=this.getAABB(),e=t.left,i=t.top,r=t.right,n=(i+t.bottom)/2;return[e,n,r,n]}}]),t}();Cc.PLACEMENT={VERTEX:0,MIDPOINT:1,SPACED:2,CENTROID:3};var Lc=Cc.PLACEMENT,Ic=80;function jc(t,e,i,r){var n=[],o=r.placement,a=Math.max(e[0],e[1])*r.placement_min_length_ratio*r.units_per_pixel;switch(o){case Lc.SPACED:var s=function(t,e,i){var r=i.units_per_pixel,n=(i.placement_spacing||Ic)*r,o=function(t){for(var e=0,i=0;i<t.length-1;i++)e+=zc(t[i],t[i+1]);return e}(t);if(o<=e)return!1;for(var a=Math.max(Math.floor(o/n),1),s=[],l=[],u=.5*(o-(a-1)*n),c=0;c<a;c++){var h=function(t,e,i,r){for(var n,o,a=0,s=0;s<t.length-1;s++){var l=t[s],u=t[s+1],c=zc(l,u);if(!(c<=i)&&e<(a+=c)){n=function(t,e,i){var r=zc(t,e),n=i/r;return[n*t[0]+(1-n)*e[0],n*t[1]+(1-n)*e[1]]}(l,u,a-e),o=Nc(l,u,r.angle);break}}return{position:n,angle:o}}(t,u,e,i),f=h.position,p=h.angle;null!=f&&null!=p&&(s.push(f),l.push(p)),u+=n}return{positions:s,angles:l}}(t,a,r);if(!s)return[];for(var l=s.positions,u=s.angles,c=0;c<l.length;c++){var h,f=l[c],p=u[c];!0!==r.tile_edges&&bu(f)||((h=new Cc(f,e,i,r)).angle=p,n.push(h))}break;case Lc.VERTEX:for(var d,y,g,v=0;v<t.length-1;v++)d=t[v],y=t[v+1],!0!==r.tile_edges&&bu(d)||((g=new Cc(d,e,i,r)).angle=Nc(d,y,r.angle),n.push(g));(g=new Cc(y,e,i,r)).angle=Nc(d,y,r.angle),n.push(g);break;case Lc.MIDPOINT:for(var _=0;_<t.length-1;_++){var m,b=t[_],x=t[_+1],w=[.5*(b[0]+x[0]),.5*(b[1]+x[1])];!0!==r.tile_edges&&bu(w)||(!a||zc(b,x)>a)&&((m=new Cc(w,e,i,r)).angle=Nc(b,x,r.angle),n.push(m))}}return n}function Nc(t,e,i){var r=2<arguments.length&&void 0!==i?i:0;return"auto"===r?Math.atan2(e[0]-t[0],e[1]-t[1]):r}function zc(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}var Dc={key:function(t){return[t.style,t.weight,t.family,t.px_size,t.fill,t.stroke,t.stroke_width,t.transform,t.text_wrap,t.max_lines,t.supersample,t.background_color,t.outline_color,t.outline_width,t.padding,Sn.device_pixel_ratio].join("/")},defaults:{style:"normal",weight:null,size:"12px",px_size:12,family:"Helvetica",fill:"white",text_wrap:15,max_lines:5,align:"center",stroke:null,stroke_width:0,background_color:null,outline_color:null,outline_width:0,padding:[0,0,0,0]},compute:function(t,e,i){var r={};e.font=e.font||this.defaults,r.can_articulate=e.can_articulate,r.fill=e.font.fill&&Sn.toCSSColor(xo.evalCachedColorProperty(e.font.fill,i))||this.defaults.fill,r.style=e.font.style||this.defaults.style,r.weight=e.font.weight||this.defaults.weight,e.font.family?(r.family=e.font.family,r.family!==this.defaults.family&&(r.family+=", "+this.defaults.family)):r.family=this.defaults.family,r.transform=e.font.transform,r.size=e.font.size||this.defaults.size,r.supersample=e.supersample_text?1.5:1,r.px_size=xo.evalCachedProperty(e.font.px_size,i)*r.supersample,e.font.stroke&&e.font.stroke.color&&(r.stroke=Sn.toCSSColor(xo.evalCachedColorProperty(e.font.stroke.color,i)||this.defaults.stroke),r.stroke_width=xo.evalCachedProperty(e.font.stroke.width,i)||this.defaults.stroke_width),r.font_css=this.fontCSS(r);var n=e.text_wrap;return null==n&&"line"!==en.geometryType(t.geometry.type)&&(n=!0),!0===n&&(n=this.defaults.text_wrap),r.text_wrap=n,r.max_lines=e.max_lines||this.defaults.max_lines,r.background_color=e.background&&e.background.color&&!e.can_articulate?Sn.toCSSColor(xo.evalCachedColorProperty(e.background.color,i)):this.defaults.background_color,r.outline_color=e.outline&&e.outline.color&&!e.can_articulate?Sn.toCSSColor(xo.evalCachedColorProperty(e.outline.color,i)):this.defaults.outline_color,r.outline_width=e.outline&&e.outline.width&&!e.can_articulate?xo.evalCachedProperty(e.outline.width,i):this.defaults.outline_width,r.padding=e.padding&&!e.can_articulate?xo.evalCachedProperty(e.padding,i):this.defaults.padding,r},fontCSS:function(t){return[t.style,t.weight,t.px_size+"px",t.family].filter(function(t){return t}).join(" ")}},Fc=a(function(t){function e(t,e){document.addEventListener?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function i(t){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(t)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function r(t,e){t.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+e+";"}function n(t){var e=t.a.offsetWidth,i=e+100;return t.f.style.width=i+"px",t.c.scrollLeft=i,t.b.scrollLeft=t.b.scrollWidth+100,t.g!==e&&(t.g=e,1)}function o(t,i){function r(){var t=o;n(t)&&t.a.parentNode&&i(t.g)}var o=t;e(t.b,r),e(t.c,r),n(t)}function a(t,e){var i=e||{};this.family=t,this.style=i.style||"normal",this.weight=i.weight||"normal",this.stretch=i.stretch||"normal"}function s(t,e){return[t.style,t.weight,function(){if(null===c){var t=document.createElement("div");try{t.style.font="condensed 100px sans-serif"}catch(t){}c=""!==t.style.font}return c}()?t.stretch:"","100px",e].join(" ")}var l,u,c,h;h=c=u=l=null,a.prototype.load=function(t,e){var n=this,a=t||"BESbswy",c=0,f=e||3e3,p=(new Date).getTime();return new Promise(function(t,e){var d,y,g;null===h&&(h=!!document.fonts),(d=h)&&(null===u&&(u=/OS X.*Version\/10\..*Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),d=!u),d?(d=new Promise(function(t,e){!function i(){(new Date).getTime()-p>=f?e():document.fonts.load(s(n,'"'+n.family+'"'),a).then(function(e){1<=e.length?t():setTimeout(i,25)},function(){e()})}()}),y=new Promise(function(t,e){c=setTimeout(e,f)}),Promise.race([y,d]).then(function(){clearTimeout(c),t(n)},function(){e(n)})):(g=function(){function u(){var e;(e=-1!=g&&-1!=v||-1!=g&&-1!=_||-1!=v&&-1!=_)&&((e=g!=v&&g!=_&&v!=_)||(null===l&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),l=!!e&&(parseInt(e[1],10)<536||536===parseInt(e[1],10)&&parseInt(e[2],10)<=11)),e=l&&(g==m&&v==m&&_==m||g==b&&v==b&&_==b||g==x&&v==x&&_==x)),e=!e),e&&(w.parentNode&&w.parentNode.removeChild(w),clearTimeout(c),t(n))}var h=new i(a),d=new i(a),y=new i(a),g=-1,v=-1,_=-1,m=-1,b=-1,x=-1,w=document.createElement("div");w.dir="ltr",r(h,s(n,"sans-serif")),r(d,s(n,"serif")),r(y,s(n,"monospace")),w.appendChild(h.a),w.appendChild(d.a),w.appendChild(y.a),document.body.appendChild(w),m=h.a.offsetWidth,b=d.a.offsetWidth,x=y.a.offsetWidth,function t(){var i;(new Date).getTime()-p>=f?(w.parentNode&&w.parentNode.removeChild(w),e(n)):(!0!==(i=document.hidden)&&void 0!==i||(g=h.a.offsetWidth,v=d.a.offsetWidth,_=y.a.offsetWidth,u()),c=setTimeout(t,50))}(),o(h,function(t){g=t,u()}),r(h,s(n,'"'+n.family+'",sans-serif')),o(d,function(t){v=t,u()}),r(d,s(n,'"'+n.family+'",serif')),o(y,function(t){_=t,u()}),r(y,s(n,'"'+n.family+'",monospace'))},document.body?g():document.addEventListener?document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t),g()}):document.attachEvent("onreadystatechange",function t(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",t),g())}))})},t.exports=a}),Uc={fonts_loaded:Promise.resolve(),last_loaded:null,loadFonts:function(t){var e=this,i=JSON.stringify(t)===this.last_loaded;return t&&!i&&function(){var i=[];for(var r in t)!function(r){Array.isArray(t[r])?t[r].forEach(function(t){return i.push(e.loadFontFace(r,t))}):i.push(e.loadFontFace(r,t[r]))}(r);e.last_loaded=JSON.stringify(t),e.fonts_loaded=Promise.all(i.filter(function(t){return t}))}(),this.fonts_loaded},loadFontFace:function(t,e){if(null!=e&&("object"===vr(e)||"external"===e)){var i={family:t},r=Promise.resolve();"object"===vr(e)&&(Object.assign(i,e),"string"==typeof e.url&&(r=this.injectFontFace(i)));var n=new Fc(t,i);return r.then(function(){return n.load()}).then(function(){En("debug","Font face '".concat(t,"' is available"),i)},function(){En("debug","Font face '".concat(t,"' is NOT available"),i)})}},injectFontFace:function(t){var e=this,i=t.family,r=t.url,n=t.weight,o=t.style;void 0===this.supports_native_font_loading&&(this.supports_native_font_loading=void 0!==window.FontFace);var a=Promise.resolve(r);return"blob:"===r.slice(0,5)&&(a=Sn.io(r,6e4,"arraybuffer").then(function(t){var i=new Uint8Array(t);if(e.supports_native_font_loading)return i;for(var r="",n=0;n<i.length;n++)r+=String.fromCharCode(i[n]);return"data:font/opentype;base64,"+btoa(r)})),a.then(function(t){var r,a,s;e.supports_native_font_loading?("string"==typeof t?r=new FontFace(i,"url(".concat(encodeURI(t),")"),{weight:n,style:o}):t instanceof Uint8Array&&(r=new FontFace(i,t,{weight:n,style:o})),document.fonts.add(r),En("trace","Adding FontFace to document.fonts:",r)):(a="\n                    @font-face {\n                        font-family: '".concat(i,"';\n                        font-weight: ").concat(n||"normal",";\n                        font-style: ").concat(o||"normal",";\n                        src: url(").concat(encodeURI(t),");\n                    }\n                "),(s=document.createElement("style")).appendChild(document.createTextNode("")),document.head.appendChild(s),s.sheet.insertRule(a,0),En("trace","Injecting CSS font face:",a))})}},Bc=function(){function t(){_r(this,t),this.vertical_text_buffer=1,this.horizontal_text_buffer=1,this.layout=hl("binary-tree")}return br(t,[{key:"createCanvas",value:function(t,e){var i=document.createElement("canvas");return t&&e&&(i.width=t,i.height=e),i.style.backgroundColor="transparent",i}},{key:"setFont",value:function(t,e){var i=e.font_css,r=e.fill,n=e.stroke,o=e.stroke_width,a=e.px_size,s=e.supersample;this.px_size=a;var l=Sn.device_pixel_ratio*s;n&&0<o&&(t.strokeStyle=n,t.lineWidth=o*l),t.fillStyle=r,t.textBaseline="bottom",t.font=i,t.miterLimit=2}},{key:"textSizes",value:function(t,e,i){var r=this;return Uc.loadFonts().then(function(){return Co.add({type:"textSizes",run:r.processTextSizesTask.bind(r),texts:e,tile_id:t,cursor:{ctx:i,styles:Object.keys(e),texts:null,style_idx:null,text_idx:null}})})}},{key:"processTextSizesTask",value:function(t){var e,i=t.cursor,r=t.texts,n=i.ctx;for(i.style_idx=i.style_idx||0;i.style_idx<i.styles.length;){var o=i.styles[i.style_idx];null==i.text_idx&&(i.text_idx=0,i.texts=Object.keys(r[o]));for(var a=r[o],s=!0;i.text_idx<i.texts.length;){var l=i.texts[i.text_idx],u=a[l],c=u.text_settings;if(s&&(this.setFont(n,c),s=!1),u.size=this.textSize(n,o,l,c).size,c.can_articulate){var h=!1,f=!1;if(Hc(l)&&(Wc(l)?h=!0:f=!0),u.isRTL=h,u.no_curving=f||(e=l,th.test(e)),u.vertical_buffer=this.vertical_text_buffer+c.outline_width+(c.padding[0]+c.padding[2])/2,u.segment_sizes=[],!u.no_curving){var p=function(t,e){var i=e?1:eh;if(t.length<i)return[t];var r=t;if(Bc.cache.segment[r])return Bc.cache.stats.segment_hits++,Bc.cache.segment[r];var n=[];if(Xc.exec(t)){n=t.split(Yc);for(var o,a=-1,s=0;s<n.length-1;s++){0<s&&((o=Kc.exec(n[s]))&&(n[s]=n[s].substring(o[0].length),n[s-1]+=o[0],a+=o[0].length)),a+=1+n[s].length,n[s]+=t.slice(a,a+1)}t=""}for(;t.length;){for(var l="",u=t,c=0;c<i&&u.length;c++){var h=(Qc.exec(u)||u)[0];l+=h,u=u.substring(h.length)}n.push(l),t=t.substring(l.length)}e&&n.reverse();return Bc.cache.stats.segment_misses++,Bc.cache.segment[r]=n}(l,h);u.segments=p;for(var d=0;d<p.length;d++)u.segment_sizes.push(this.textSize(n,o,p[d],c).size)}}if(i.text_idx++,!Co.shouldContinue(t))return!1}i.text_idx=null,i.style_idx++}return Co.finish(t,{texts:r}),!0}},{key:"textSize",value:function(e,i,r,n){var o=n.transform,a=n.text_wrap,s=n.max_lines,l=n.stroke_width,u=void 0===l?0:l,c=n.supersample,h=n.padding,f=n.outline_width,p=n.can_articulate;if(t.cache.text[i]=t.cache.text[i]||{},t.cache.text[i][r])return t.cache.stats.text_hits++,t.cache.text[i][r];t.cache.stats.text_misses++,t.cache.text_count++;var d=Sn.device_pixel_ratio*c,y=this.applyTextTransform(r,o),g=d*(this.vertical_text_buffer+f+(h[0]+h[2])/2),v=d*(this.horizontal_text_buffer+f+u+(h[1]+h[3])/2),_=2*d,m=this.px_size+_,b=ih.parse(y,a,s,m,e),x=b.height,w=b.width,k=b.lines,A=[w/d,x/d];p||(A[0]+=2*v/d,A[1]+=2*g/d);var T=[w+2*v,x+2*g],E=[T[0]/d,T[1]/d];return t.cache.text[i][r]={lines:k,size:{collision_size:A,texture_size:T,logical_size:E,line_height:m}},t.cache.text[i][r]}},{key:"drawTextMultiLine",value:function(t,e,i,r,n,o){var a=Lr(i,2),s=a[0],l=a[1],u=Sn.device_pixel_ratio*n.supersample,c=n.stroke_width||0,h=n.stroke;n.background_color&&(t.fillStyle=n.background_color,t.fillRect(s,l,r.texture_size[0],r.texture_size[1]));var f=n.outline_width*u,p=n.outline_color;f&&p&&(t.strokeStyle=p,t.lineWidth=f,t.strokeRect(s+f/2,l+f/2,r.texture_size[0]-f,r.texture_size[1]-f)),(n.background_color||f&&p)&&this.setFont(t,n);for(var d,y,g,v,_=r.line_height,m=l,b=0;b<e.length;b++){var x=e[b];this.drawTextLine(t,x,[s,m],r,n,o),m+=_}Ol.draw_label_collision_boxes&&(t.save(),d=u*(this.horizontal_text_buffer+n.outline_width+c+(n.padding[1]+n.padding[3])/2),y=u*(this.vertical_text_buffer+n.outline_width+(n.padding[0]+n.padding[2])/2),g=r.collision_size,t.strokeStyle="blue",t.lineWidth=2,t.strokeRect(s+d,l+y,u*g[0],u*g[1]),"curved"===o&&h&&0<c&&t.strokeRect(s+r.texture_size[0]+d,l+y,u*g[0],u*g[1]),t.restore()),Ol.draw_label_texture_boxes&&(t.save(),v=r.texture_size,t.strokeStyle="green",t.lineWidth=2,t.strokeRect(s+2,l+2,v[0]-4,v[1]-4),"curved"===o&&h&&0<c&&t.strokeRect(s+2+r.texture_size[0],l+2,v[0]-4,v[1]-4),t.restore())}},{key:"drawTextLine",value:function(t,e,i,r,n,o){var a,s=Lr(i,2),l=s[0],u=s[1],c=n.stroke,h=n.stroke_width,f=void 0===h?0:h,p=n.transform,d=n.align,y=n.supersample,g=n.padding,v=n.outline_width,_=Sn.device_pixel_ratio*y,d=d||"center",m=r.texture_size,b=r.line_height,x=_*(this.vertical_text_buffer+v),w=_*(this.horizontal_text_buffer+v+f),k=this.applyTextTransform(e.text,p);"left"===d?a=l+w+g[3]*_:"center"===d?a=l+m[0]/2-e.width/2-(g[1]-g[3])*_/2:"right"===d&&(a=l+m[0]-e.width-w-g[1]*_);var A,T=u+x+b+g[0]*_;c&&0<f&&(A="curved"===o?m[0]:0,t.strokeText(k,a+A,T)),t.fillText(k,a,T)}},{key:"rasterize",value:function(e,i,r,n,o,a){return Co.add({type:"rasterizeLabels",run:this.processRasterizeTask.bind(this),cancel:t.returnNoTextures,pause_factor:2,user_moving_view:!1,texts:e,textures:i,texture_prefix:n,gl:o,tile_id:r,texture_manager:a,cursor:{styles:Object.keys(e),texts:null,style_idx:0,text_idx:null,texture_idx:0,texture_names:[]}})}},{key:"processRasterizeTask",value:function(t){if(!Co.shouldContinue(t))return!1;for(var e=t.cursor,i=t.texts,r=t.textures;e.texture_idx<t.textures.length;){for(var n=!1,o=r[e.texture_idx],a=this.createCanvas.apply(this,Ir(o.texture_size)),s=a.getContext("2d");e.style_idx<e.styles.length;){var l=e.styles[e.style_idx];null==e.text_idx&&(e.text_idx=0,e.texts=Object.keys(i[l]));for(var u=i[l],c=!0;e.text_idx<e.texts.length;){var h=e.texts[e.text_idx],f=u[h],p=f.text_settings;if(c&&(this.setFont(s,p),c=!1),p.can_articulate){f.texcoords=f.texcoords||{};for(var d=0;d<f.type.length;d++){var y=f.type[d];switch(y){case"straight":if(f.textures[d]!==e.texture_idx)continue;var g,v,_,m,b=f.isRTL?h.split().reverse().join():h,x=o.texcoord_cache[l][b],w=void 0;x.texcoord?w=x.texcoord:(g=x.texture_position,_=(v=this.textSize(s,l,b,p)).size,m=v.lines,this.drawTextMultiLine(s,m,g,_,p,y),w=t.texture_manager.getTexcoordsForSprite(g,_.texture_size,o.texture_size),x.texcoord=w),f.texcoords[y]={texcoord:w,texture_id:x.texture_id};break;case"curved":var k=f.segments;f.texcoords.curved=[],f.texcoords_stroke=[];for(var A,T,E,M,S,R,P,O,C=0;C<k.length;C++){f.textures[d][C]===e.texture_idx&&(A=k[C],M=E=void 0,(T=o.texcoord_cache[l][A]).texcoord&&T.texcoord_stroke?(E=T.texcoord,M=T.texcoord_stroke):(S=T.texture_position,P=(R=this.textSize(s,l,A,p)).size,O=R.lines,this.drawTextMultiLine(s,O,S,P,p,y),E=t.texture_manager.getTexcoordsForSprite(S,P.texture_size,o.texture_size),M=p.stroke&&0<p.stroke_width?t.texture_manager.getTexcoordsForSprite([S[0]+P.texture_size[0],S[1]],P.texture_size,o.texture_size):(n=!0,t.texture_manager.getTexcoordsForSprite([o.texture_size[0],o.texture_size[1]],[0,0],o.texture_size)),T.texcoord=E,T.texcoord_stroke=M),f.texcoords_stroke.push(M),f.texcoords.curved.push({texcoord:E,texture_id:T.texture_id}))}}}}else{var L=this.textSize(s,l,h,p).lines;for(var I in f.align)f.align[I].texture_id===e.texture_idx&&(this.drawTextMultiLine(s,L,f.align[I].texture_position,f.size,{stroke:p.stroke,stroke_width:p.stroke_width,transform:p.transform,supersample:p.supersample,align:I,background_color:p.background_color,outline_width:p.outline_width,outline_color:p.outline_color,padding:p.padding,fill:p.fill,font_css:p.font_css,px_size:p.px_size}),f.align[I].texcoords=t.texture_manager.getTexcoordsForSprite(f.align[I].texture_position,f.size.texture_size,o.texture_size))}e.text_idx++}e.text_idx=null,e.style_idx++}!0===n&&(s.fillStyle="rgba(0, 0, 0, 0)",s.fillRect(a.width-1,a.height-1,1,1));var j=t.texture_prefix+e.texture_idx;t.texture_manager.create(t.gl,j,{element:a,filtering:"linear",UNPACK_PREMULTIPLY_ALPHA_WEBGL:!0}),e.texture_names.push(j),e.texture_idx++,e.style_idx=0,a.width=0,a.height=0}return Co.finish(t,e.texture_names),!0}},{key:"setTextureTextPositions",value:function(t){var e={texture_id:0,texcoord_cache:{}},i=[];for(var r in t){var n=t[r];for(var o in n){var a=n[o],s=a.text_settings,l=s.can_articulate,u=s.stroke,c=s.stroke_width;if(l){a.textures=[],e.texcoord_cache[r]=e.texcoord_cache[r]||{};for(var h=0;h<a.type.length;h++){switch(a.type[h]){case"straight":var f,p=a.isRTL?o.split().reverse().join():o;e.texcoord_cache[r][p]||(f=a.size.texture_size,e.texcoord_cache[r][p]={},this.placeText(f[0],f[1],{can_articulate:l,style:r,word:p})),a.textures[h]=e.texture_id;break;case"curved":a.textures[h]=[];for(var d=0;d<a.segment_sizes.length;d++){var y,g,v=a.segments[d];e.texcoord_cache[r][v]||(g=(y=a.segment_sizes[d].texture_size)[0],u&&0<c&&(g*=2),e.texcoord_cache[r][v]={},this.placeText(g,y[1],{can_articulate:l,style:r,word:v})),a.textures[h].push(e.texture_id)}}}}else{var _=a.size.texture_size;this.placeText(_[0],_[1],{can_articulate:l,text_info:a})}}}var m=this.layout.export(),b=m.items,x=m.width,w=m.height;e.texcoord_cache={};for(var k=0,A=b.length;k<A;k++){var T=b[k],E=T.x,M=T.y;if(!T.meta.can_articulate){var S=T.meta.text_info;for(var R in S.align)S.align[R].texture_id=e.texture_id,S.align[R].texture_position=[E,M]}else{var P=T.meta,O=P.style,C=P.word;e.texcoord_cache[O]=e.texcoord_cache[O]||{},e.texcoord_cache[O][C]||(e.texcoord_cache[O][C]={texture_id:e.texture_id,texture_position:[E,M]})}}return 0<x&&0<w&&(i[e.texture_id]={texture_size:[x,w],texcoord_cache:e.texcoord_cache}),i}},{key:"placeText",value:function(t,e,i){this.layout.addItem({width:t+1,height:e+1,meta:i})}},{key:"applyTextTransform",value:function(t,e){return"capitalize"===e?t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1)}):"uppercase"===e?t.toUpperCase():"lowercase"===e?t.toLowerCase():t}}],[{key:"fontPixelSize",value:function(e){if(null!=e){var i=Lr((e="string"==typeof e?e:String(e)).match(t.font_size_re)||[],3),r=i[1],n=i[2];return"em"===(n=n||"px")?r*=16:"pt"===n?r/=.75:"%"===n&&(r/=6.25),r=xo.parsePositiveNumber(r),r*=Sn.device_pixel_ratio}}},{key:"pruneTextCache",value:function(){t.cache.text_count>t.cache.text_count_max&&(t.cache.text={},t.cache.text_count=0,En("debug","CanvasText: pruning text cache")),Object.keys(t.cache.segment).length>t.cache.segment_count_max&&(t.cache.segment={},En("debug","CanvasText: pruning segment cache"))}}]),t}();Bc.font_size_re=/((?:[0-9]*\.)?[0-9]+)\s*(px|pt|em|%)?/,Bc.cache={text:{},text_count:0,text_count_max:2e3,segment:{},segment_count_max:2e3,stats:{text_hits:0,text_misses:0,segment_hits:0,segment_misses:0}},Bc.EMPTY_TEXTURES_ARR=[],Bc.returnNoTextures=function(){return Bc.EMPTY_TEXTURES_ARR};var Gc=new RegExp("[֑-߿‏‫‮יִ-﷽ﹰ-ﻼ]");function Hc(t){return Gc.test(t)}var Vc="\0-/:-@[-`{-¿×÷ʹ-˿ -⯿‐-\u2029‬ -⯿",qc=new RegExp("["+Vc+"]+");function Wc(t){return qc.test(t)}var Xc=new RegExp("^["+Vc+"؀-ۿ]+"),Yc=new RegExp("["+Vc+"آ-إاد-زوٱ-ٷڈ-ڙۄ-ۋۏےۓۮۯ]"),Kc=new RegExp("^[ؐ-ًؚ-ٰٟۖ-ۜ۟-۪ۤۧۨ-ۭ]+"),Zc="[̀-֑ͯ-ׇֽֿׁׂׅׄަ-ްऀ-ःऺ-ौॎॏ॑-ॗॢॣঁ-ঃ়া-ৌৗৢৣਁ-ਃ਼-ੌੑઁ-ઃ઼ા-ૌૢૣଁ-ଃ଼ା-ୌୖୗୢୣஂா-்ௗఀ-ఃా-ౌౕౖౢౣಁ-ಃ಼ಾ-ೌೕೖೢೣഁ-ഃാ-ൌൎൗൢൣංඃ්-ෟෲෳัิ-ฺ็-๎ັິ-ຼ່-ໍ༹༘༙༵༷༾༿ཱ-ྃ྆྇ྍ-ྼ࿆ါ-း်-ှၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏႚ-ႝ឴-៑៓ᩕ-ᩞᩡ-᩼᷀-᷿⃐-⃿]",Qc=new RegExp("^.(?:"+Zc+"+)?([्্੍્୍్್്྄္្᩠᩿]\\W(?:"+Zc+"+)?)*"),$c={Mongolian:"᠀-᢯"},Jc=Object.keys($c).map(function(t){return $c[t]}).join(""),th=new RegExp("["+Jc+"]");var eh=2;var ih=function(){function t(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1/0;_r(this,t),this.width=0,this.height=0,this.lines=[],this.max_lines=i,this.text_wrap=r,this.context=e}return br(t,[{key:"createLine",value:function(t){return this.lines.length<this.max_lines&&new rh(t,this.text_wrap)}},{key:"push",value:function(t){if(this.lines.length<this.max_lines){var e=this.context.measureText(t.text).width;return(t.width=e)>this.width&&(this.width=Math.ceil(e)),this.lines.push(t),this.height+=t.height,!0}return this.addEllipsis(),!1}},{key:"advance",value:function(t,e){return!!this.push(t)&&this.createLine(e)}},{key:"addEllipsis",value:function(){var e=this.lines[this.lines.length-1],i=Math.ceil(this.context.measureText(t.ellipsis).width);e.append(t.ellipsis),e.width+=i,e.width>this.width&&(this.width=e.width)}},{key:"finish",value:function(t){t?this.push(t):this.addEllipsis()}}],[{key:"parse",value:function(e,i,r,n,o){for(var a="number"==typeof i?e.split(" "):[e],s=new t(o,r,i),l=s.createLine(n),u=0;u<a.length;u++){for(var c=a[u].split("\n"),h=0===u,f=0;f<c.length&&l;f++){var p=c[f];Hc(p)&&Wc(p[p.length-1])&&(p+="‏");var d=h?p:" "+p;if(i&&0<u&&l.exceedsTextwrap(d)){if(!(l=s.advance(l,n)))break;l.append(p),h=!0}else l.append(d);f<c.length-1&&(l=s.advance(l,n),h=!0)}u===a.length-1&&s.finish(l)}return s}}]),t}();ih.ellipsis="...";var rh=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;_r(this,t),this.chars=0,this.text="",this.height=Math.ceil(e),this.text_wrap=i}return br(t,[{key:"append",value:function(t){this.chars+=t.length,this.text+=t}},{key:"exceedsTextwrap",value:function(t){return t.length+this.chars>this.text_wrap}}]),t}(),nh={resetText:function(){this.texts={}},freeText:function(t){delete this.texts[t.id]},parseTextFeature:function(t,e,i,r){var n=this.parseTextSource(t,e,i);if(null!=n&&""!==n){var o=Dc.compute(t,e,i),a=Dc.key(o);this.texts[r.id]=this.texts[r.id]||{};var s=this.texts[r.id][a]=this.texts[r.id][a]||{};if(n instanceof Object){var l=[],u=n.left+"-"+n.right;for(var c in n){var h,f=n[c];f&&(h=this.computeTextLayout({},t,e,i,r,f,o,u,c),s[f]||(s[f]={text_settings:o,ref:0}),l.push({draw:e,text:f,text_settings_key:a,layout:h}))}return 0<l.length&&l}var p=this.computeTextLayout({},t,e,i,r,n,o);return s[n]||(s[n]={text_settings:o,ref:0}),{draw:e,text:n,text_settings_key:a,layout:p}}},parseTextSource:function(t,e,i){var r,n=e.text_source||"name";if(null!=n&&"object"===vr(n))for(var o in r={},n)r[o]=this.parseTextSourceValue(n[o],t,i);else r=this.parseTextSourceValue(n,t,i);return r},parseTextSourceValue:function(t,e,i){var r;if(Array.isArray(t)){for(var n=0;n<t.length;n++)if("string"==typeof t[n]?r=e.properties[t[n]]:"function"==typeof t[n]&&(r=t[n](i)),r)return r}else"string"==typeof t?r=e.properties[t]:t instanceof Function&&(r=t(i));return r},prepareTextLabels:function(t,e,i){var r=this;return 0===Object.keys(this.texts[t.id]||{}).length?Promise.resolve([]):fn.postMessage(this.main_thread_target+".calcTextSizes",t.id,this.texts[t.id]).then(function(e){var n=e.texts;return t.canceled?(En("trace","Style ".concat(r.name,": stop tile build because tile was canceled: ").concat(t.key,", post-calcTextSizes()")),[]):(r.texts[t.id]=n||[],n?r.buildTextLabels(t,i):(Oo.abortTile(t.id),[]))})},collideAndRenderTextLabels:function(t,e,i){var r=this;return this.prepareTextLabels(t,e,i).then(function(i){return 0===i.length?(Oo.collide([],e,t.id),Promise.resolve({})):Oo.collide(i,e,t.id).then(function(e){if(t.canceled)return En("trace","stop tile build because tile was canceled: ".concat(t.key,", post-collide()")),{};var i=r.texts[t.id];return null==i||0===e.length?{}:(r.cullTextStyles(i,e),e.forEach(function(t){var e=t.text_settings_key,r=i[e]&&i[e][t.text];r.text_settings.can_articulate?(r.type||(r.type=[]),-1===r.type.indexOf(t.label.type)&&r.type.push(t.label.type)):(r.align=r.align||{},r.align[t.label.align]={})}),{labels:e,texts:i,textures:[]})})})},cullTextStyles:function(t,e){for(var i=0;i<e.length;i++){var r=e[i];t[r.text_settings_key][r.text].ref++}for(var n in t)for(var o in t[n])t[n][o].ref<1&&delete t[n][o];for(var a in t)0===Object.keys(t[a]).length&&delete t[a]},calcTextSizes:function(t,e){return this._canvas_text||(this._canvas_text=new Bc,this._canvas_ctx_for_sizes=this._canvas_text.createCanvas().getContext("2d")),this._canvas_text.textSizes(t,e,this._canvas_ctx_for_sizes)},preprocessText:function(t){if(t&&t.font&&"object"===vr(t.font))return t.font.fill=xo.createPropertyCache(t.font.fill),t.font.stroke&&(t.font.stroke.color=xo.createPropertyCache(t.font.stroke.color)),t.background&&t.background.color&&(t.background.color=xo.createPropertyCache(t.background.color)),t.outline&&(t.outline.color&&(t.outline.color=xo.createPropertyCache(t.outline.color)),t.outline.width&&(t.outline.width=xo.createPropertyCache(t.outline.width,xo.parsePositiveNumber))),t.padding&&(Array.isArray(t.padding)?2===t.padding.length&&(t.padding=[t.padding[0],t.padding[1],t.padding[0],t.padding[1]]):t.padding=Array(4).fill(t.padding),t.padding=xo.createPropertyCache(t.padding,function(t){return t.map(xo.parsePositiveNumber)})),t.font.px_size=xo.createPropertyCache(t.font.size||Dc.defaults.size,Bc.fontPixelSize),t.font.stroke&&null!=t.font.stroke.width&&(t.font.stroke.width=xo.createPropertyCache(t.font.stroke.width,xo.parsePositiveNumber)),t.offset=xo.createPropertyCache(t.offset,function(t){return Array.isArray(t)&&t.map(xo.parseNumber)}),t.buffer=xo.createPropertyCache(t.buffer,function(t){return(Array.isArray(t)?t:[t,t]).map(xo.parsePositiveNumber)}),t.repeat_distance=xo.createPropertyCache(t.repeat_distance||en.tile_size,xo.parsePositiveNumber),t},computeTextLayout:function(t,e,i,r,n,o,a,s,l){var u=t||{};return(u=this.computeLayout(u,e,i,r,n)).repeat_distance&&(s&&(u.repeat_group+="/"+s),u.repeat_group+="/"+o),u.subdiv=n.overzoom2,u.align=i.align,u.italic="normal"!==a.style,"right"===l?u.orientation=1:"left"===l&&(u.orientation=-1),u}};var oh=Math.PI/180,ah=function(){function t(e,i){_r(this,t),this._min_zoom=H.util.constants.DEFAULT_MIN_ZOOM_LEVEL,this._max_zoom=H.util.constants.DEFAULT_MAX_ZOOM_LEVEL,this._viewport=e,this._center_offset=[],this._center_offset_normalized=[],this._viewport_aspect_ratio=1,this._focal_length=[[16,2],[17,2.5],[18,3],[19,4],[20,6]],this._view_matrix=new Float64Array(16),this._projection_matrix=new Float64Array(16),this._heading_matrix=new Float64Array(16),this._tilt_matrix=new Float64Array(16),this._transformation_matrix=new Float64Array(16),this._camera_matrix=new Float64Array(16),this._lookAtData={position:[0,0,0],zoom:0,tile_level:0,tetragon:void 0,bounds:void 0,unpadded_bounds:void 0,distance:void 0,tilt:0,incline:0,heading:180},this._zoom_direction=0,this._horizon=0,this.handleViewportUpdate(!0),i?this.setLookAtData(i):this._updateMatrices(),Wl.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_center_offset;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n            }")}return br(t,[{key:"_getZoomForBounds",value:function(t,e,i,r){for(var n=this.clone(),o=this._max_zoom;o>=this._min_zoom;){if(n.setLookAtData({zoom:o-=.1,position:e,tilt:i,heading:r}),t.every(function(t){return Jr.isPointInsidePolygon(t,n.getLookAtData().bounds)}))break}return n.getLookAtData().zoom}},{key:"setZoomConstraints",value:function(t,e){this._min_zoom=t,this._max_zoom=e,this.setLookAtData(this.getLookAtData())}},{key:"setLookAtData",value:function(t,e){var i,r,n,o,a,s=t.position,l=t.zoom;s===i&&t.bounds!==i&&(s=Jr.getBBoxCenter(Jr.getBBox(t.bounds))),l===i&&t.bounds!==i&&(l=this._getZoomForBounds(t.bounds,s,t.tilt,t.heading)),e!==i&&(r=s||this.screenToWorld(e)),l!==i&&(l=Jr.clamp(l,this._min_zoom,this._max_zoom),(n=Sn.zoomToTileLevel(l))!==(o=this._lookAtData.tile_level)&&(this._zoom_direction=o<n?1:-1),this._lookAtData.zoom=l,this._lookAtData.tile_level=n),t.tilt!==i&&(this._lookAtData.tilt=t.tilt),t.heading!==i&&(this._lookAtData.heading=t.heading),e!==i?(this._updateMatrices(),a=this.screenToWorld(e),this._lookAtData.position[0]-=a[0]-r[0],this._lookAtData.position[1]-=a[1]-r[1]):s&&(this._lookAtData.position=s),this._lookAtData.position[2]=0,this._lookAtData.position[1]=Jr.clamp(this._lookAtData.position[1],-en.half_circumference_meters,en.half_circumference_meters),this._updateMatrices(),this._updateVisibleBounds()}},{key:"getZoomDirection",value:function(){return this._zoom_direction}},{key:"resetZoomDirection",value:function(){this._zoom_direction=0}},{key:"getLookAtData",value:function(){return this._lookAtData}},{key:"handleViewportUpdate",value:function(t){var e=0<arguments.length&&void 0!==t&&t,i=this._viewport,r=i.width,n=i.height;this._viewport_aspect_ratio=r/n;var o=this._viewport.center.x-(r/2<<0),a=this._viewport.center.y-(n/2<<0);this._center_offset[0]=o,this._center_offset[1]=a,this._center_offset_normalized[0]=o/r,this._center_offset_normalized[1]=a/-n,e||(this._updateMatrices(),this._updateVisibleBounds())}},{key:"setupMatrices",value:function(t,e){Go.multiply(t.model_view32,this._view_matrix,t.model),e.uniform("Matrix4fv","u_modelView",t.model_view32),Bo.normalFromMat4(t.normal32,t.model_view32),Bo.invert(t.inverse_normal32,t.normal32),e.uniform("Matrix3fv","u_normalMatrix",t.normal32),e.uniform("Matrix3fv","u_inverseNormalMatrix",t.inverse_normal32)}},{key:"_updateMatrices",value:function(){var t=this._viewport.height*en.metersPerPixel(this._lookAtData.zoom),e=Sn.interpolate(this._lookAtData.zoom,this._focal_length);this._lookAtData.distance=t/2*e;var i=this._lookAtData.position[0],r=this._lookAtData.position[1];Go.lookAt(this._view_matrix,Uo.fromValues(i,r,0),Uo.fromValues(i,r,-1),Uo.fromValues(0,1,0)),this._heading_matrix=Go.identity(this._heading_matrix);var n=180-this._lookAtData.heading;n*=oh,this._heading_matrix[0]=Math.cos(n),this._heading_matrix[1]=-Math.sin(n),this._heading_matrix[4]=Math.sin(n),this._heading_matrix[5]=Math.cos(n),this._tilt_matrix=Go.identity(this._tilt_matrix),n=0<(n=this._lookAtData.tilt?this._lookAtData.tilt*oh:0)?-n:n,this._tilt_matrix[5]=Math.cos(n),this._tilt_matrix[6]=Math.sin(n),this._tilt_matrix[9]=-Math.sin(n),this._tilt_matrix[10]=Math.cos(n),Go.multiply(this._transformation_matrix,this._tilt_matrix,this._heading_matrix),Go.multiply(this._view_matrix,this._transformation_matrix,this._view_matrix);var o=2*Math.atan(1/e),a=2*this._lookAtData.distance;this._depth_buffer_adjustment=2/Math.log(a),Go.perspective(this._projection_matrix,o,this._viewport_aspect_ratio,1,a),this._projection_matrix[8]=2*-this._center_offset_normalized[0],this._projection_matrix[9]=2*-this._center_offset_normalized[1],Go.translate(this._projection_matrix,this._projection_matrix,Uo.fromValues(0,0,-this._lookAtData.distance)),this._camera_matrix=Go.multiply(this._camera_matrix,this._projection_matrix,this._view_matrix)}},{key:"_updateVisibleBounds",value:function(){var t,e,i,r,n,o=this._viewport,a=o.width,s=o.height,l=o.padding,u=this._lookAtData.tilt*Math.PI/180;this._horizon=Math.max((l.top+s)/2-Math.cos(u)*(l.top*(1-Math.sin(u))+.75*s),0),this._lookAtData.tetragon=[this.screenToWorld([0,this._horizon]),this.screenToWorld([a,this._horizon]),this.screenToWorld([a,s]),this.screenToWorld([0,s])],this._lookAtData.unpadded_bounds=this._clipAgainstGeoBounds(this._lookAtData.tetragon),0===l.left&&0===l.top&&0===l.right&&0===l.bottom?this._lookAtData.bounds=this._lookAtData.unpadded_bounds:(t=l.left,e=Math.max(this._horizon,l.top),i=a-l.right,r=s-l.bottom,n=[this.screenToWorld([t,e]),this.screenToWorld([i,e]),this.screenToWorld([i,r]),this.screenToWorld([t,r])],this._lookAtData.bounds=this._clipAgainstGeoBounds(n))}},{key:"_clipAgainstGeoBounds",value:function(t){var e=Lr(Jr.getBBox(t),4),i=e[0],r=e[1],n=e[2],o=e[3],a=[[i,en.half_circumference_meters],[n,en.half_circumference_meters],[n,-en.half_circumference_meters],[i,-en.half_circumference_meters]],s=Jr.clipPolygon(a,t)[0],l=Lr(Jr.getBBox(s),4),i=l[0],r=l[1],n=l[2],o=l[3];n-i>=en.circumference_meters&&(s=[[-en.half_circumference_meters,o],[en.half_circumference_meters,o],[en.half_circumference_meters,r],[-en.half_circumference_meters,r]]);var u=[];return s&&(u=Jr.splitLegs(s,en.half_circumference_meters)),u}},{key:"applyPxOffset",value:function(t){var e=Lr(t,2),i=e[0],r=e[1],n=Math.PI-this._lookAtData.heading*oh,o=en.metersPerPixel(this._lookAtData.zoom);this._lookAtData.position[0]+=(i*Math.cos(n)+r*Math.sin(n))*o,this._lookAtData.position[1]-=(r*Math.cos(n)-i*Math.sin(n))*o,this._lookAtData.position[1]=Jr.clamp(this._lookAtData.position[1],-en.half_circumference_meters,en.half_circumference_meters),this._updateMatrices(),this._updateVisibleBounds()}},{key:"screenToWorld",value:function(t){var e=Lr(t,2),i=e[0],r=e[1],n=this._viewport,o=n.width,a=n.height;return 0===o||0===a?[0,0]:(i-=o/2,r-=a/2,this._clipCoordsToWorldPlaneCoords([2*(i+o/2)/o-1,1-2*(r+a/2)/a,-1,1]))}},{key:"_clipToScreenCoords",value:function(t){var e=this._viewport,i=e.width,r=e.height;return[(.5*t[0]+.5)*i,r-(.5*t[1]+.5)*r]}},{key:"_isScreenPointInViewPort",value:function(t){var e=this._viewport,i=e.width,r=e.height;return 0<=t[0]&&t[0]<=i&&0<=t[1]&&t[1]<=r}},{key:"worldToScreen",value:function(t,e){var i,r,n,o,a,s,l=1<arguments.length&&void 0!==e&&e;return t[2]||(t[2]=0),l?(i=this._worldToClipCoords(t),a=this._clipToScreenCoords(i)):(r=Math.sign(this._lookAtData.position[0]),n=Math.trunc(this._lookAtData.position[0]/en.circumference_meters+r/2),t[0]+=en.circumference_meters*n,o=this._worldToClipCoords(t),s=a=this._clipToScreenCoords(o),this._isScreenPointInViewPort(a)||(o=this._worldToClipCoords([t[0]+en.circumference_meters,t[1],t[2]]),a=this._clipToScreenCoords(o),this._isScreenPointInViewPort(a)||(o=this._worldToClipCoords([t[0]-en.circumference_meters,t[1],t[2]]),a=this._clipToScreenCoords(o)),this._isScreenPointInViewPort(a)||(a=s))),a}},{key:"getHorizon",value:function(){return this._horizon}},{key:"_clipCoordsToWorldPlaneCoords",value:function(t){var e=[],i=this._lookAtData.distance,r=this._lookAtData.position,n=[0,0,i,0],o=0,a=i*Math.sin(oh*this._lookAtData.tilt)*Math.cos(oh*this._lookAtData.heading),s=i*Math.sin(oh*this._lookAtData.tilt)*Math.sin(oh*this._lookAtData.heading),l=new Float64Array(16),u=new Float64Array(16);return Go.invert(l,this._projection_matrix),Ho.transformMat4(e,t,l),e[2]=-1,e[3]=0,Go.invert(u,this._view_matrix),Ho.transformMat4(e,e,u),Ho.normalize(e,e),Ho.transformMat4(n,n,this._transformation_matrix),0!==e[2]&&(o=-n[2]/e[2]),Ho.scale(e,e,o),[r[0]+(e[0]+s),r[1]+(e[1]+a)]}},{key:"_worldToClipCoords",value:function(t){var e=[t[0],t[1],t[2],1];return Ho.transformMat4(e,e,this._view_matrix),Ho.transformMat4(e,e,this._projection_matrix),Ho.scale(e,e,1/e[3]),e}},{key:"setupProgram",value:function(t){t.uniform("Matrix4fv","u_projection",this._projection_matrix),t.uniform("3f","u_eye",[0,0,this._lookAtData.distance]),t.uniform("2fv","u_center_offset",this._center_offset_normalized),t.uniform("1f","u_tilt",this._lookAtData.tilt*oh),t.uniform("1f","u_heading",this._lookAtData.heading*oh),t.uniform("1f","u_near_plane",1),t.uniform("1f","u_depth_buffer_adjustment",this._depth_buffer_adjustment)}},{key:"getTransformationMatrix",value:function(){return this._transformation_matrix}},{key:"getCameraMatrix",value:function(){return this._camera_matrix}},{key:"clone",value:function(){var e=new t(this._viewport,this._lookAtData);return e.setZoomConstraints(this._min_zoom,this._max_zoom),e}},{key:"getViewport",value:function(){return this._viewport}}]),t}();function sh(t){return void 0===t.x?t[0]:t.x}function lh(t){return void 0===t.y?t[1]:t.y}function uh(t,e){return sh(t)-sh(e)}function ch(t,e){return lh(t)-lh(e)}function hh(t){return t.sort(uh)}function fh(t,e){for(var i,r=t[0],n=r,o=0;o<t.length;o+=1)e(i=t[o],r)<0?r=i:0<e(i,n)&&(n=i);return[r,n]}function ph(t,e){return Object.values(e.reduce(function(e,i){var r=i[+t];return e[r]||(e[r]=[]),e[r].push(i),e},{}))}function dh(t,e,i){var r=+t,n=e[r],o=i[r];if(o<n)return[];var a=[e];if(o<n)return a;for(var s=e[(1+r)%2],l=t?function(t){return a.push([s,t])}:function(t){return a.push([t,s])},u=n+1;u<o;u+=1)l(u);return a.push(i),a}function yh(t,e){return dh(!1,t,e)}function gh(t,e){return dh(!0,t,e)}function vh(t){var e={},i=[];return t.forEach(function(t){var r=t.key||(Array.isArray(t)?"".concat(t[0],"/").concat(t[1]):"".concat(t.x,"/").concat(t.y));e[r]||(e[r]=!0,i.push(t))}),i}function _h(t){return t.reduce(function(t,e){return t.concat(e)})}function mh(t,e){if(e<=0)return t;var i,r,n=function(t){var i=Lr(fh(t,uh),2),r=i[0],n=i[1],o=[r[0]-e,r[1]],a=[n[0]+e,n[1]];return t.concat(yh(o,r),yh(n,a))},o=function(t){var i=Lr(fh(t,ch),2),r=i[0],n=i[1],o=[r[0],r[1]-e],a=[n[0],n[1]+e];return t.concat(gh(o,r),gh(n,a))};return vh((r=ph(!1,t),i=_h(r.map(o)),_h(ph(!0,i).map(n))))}function bh(t,e,i){function r(e){return Object.values(en.metersToExactTileCoords(e,t.tile_level))}var n,o,a,s,l,u,c,h,f;return vh((n=mh((s=r(t.tetragon[0]),l=r(t.tetragon[1]),u=r(t.tetragon[3]),c=r(t.tetragon[2]),h=xh(l,s,u),f=xh(u,c,l),vh(h.concat(f))),e),o=t.tile_level,a=i,n.map(function(t){var e=Lr(t,2),i=e[0],r=e[1];return Wo.coord(en.wrapTile({x:i,y:r,z:o},{x:!a,y:!0}))})))}function xh(t,e,i){var r=function(t,e,i){var r=Lr(t,2),n=r[0],o=r[1],a=Lr(e,2),s=a[0],l=a[1],u=Lr(i,2),c=u[0],h=u[1],f=n+(l-o)/(h-o)*(c-n);return[[[n,o]].concat(Ir(hh([[s,l],[f,l]]))),[].concat(Ir(hh([[s,l],[f,l]])),[[c,h]])]}.apply(void 0,Ir([t,e,i].sort(ch))),n=Lr(r,2),o=n[0],a=n[1];return vh(function(t,e,i){var r=Lr(t,2),n=r[0],o=r[1],a=Lr(e,2),s=a[0],l=a[1],u=Lr(i,1)[0];return kh(n,s,u,o,l)}.apply(void 0,Ir(o)).concat(function(t,e,i){var r=Lr(t,2),n=r[0],o=r[1],a=Lr(e,1)[0],s=Lr(i,2),l=s[0],u=s[1];return kh(l,n,a,u,o)}.apply(void 0,Ir(a))))}var wh=.125;function kh(t,e,i,r,n){var o,a,s,l,u,c,h,f,p,d,y=Math.min(t,e),g=Math.max(t,i),v=Math.min(r,n),_=Math.max(r,n);if(Math.floor(r)===Math.floor(n))return Eh(y,g,r);if(_-v<wh)return o=[g,_],a=Lr([y,v],2),s=a[0],l=a[1],u=Lr(o,2),c=u[0],h=u[1],f=Th(s,c),p=Ah(f,l),d=Ah(f,h),p.concat(d);function m(t){E=E.concat(Eh(M,S,Math.floor(t))),M+=A,S+=T}var b,x,w=wh*((x=_)-(b=v))/(Math.ceil(x)-Math.floor(b)),k=(_-v)/w,A=(e-t)/k,T=(i-t)/k,E=[],M=t,S=t;if(r<n)for(var R=v;R<=_;R+=w)m(R);else for(var P=_;v<=P;P-=w)m(P);return vh(E)}function Ah(t,e){return t.map(function(t){return[t,e]})}function Th(t,e){var i=Math.floor(t),r=Math.floor(e);if(r<i)return[];if(i===r)return[i];for(var n=[],o=i;o<=r;o+=1)n.push(o);return n}function Eh(t,e,i){return Ah(Th(t,e),i)}var Mh=function(){function t(e,i){_r(this,t),jo(this),this.scene=e,this.createMatrices(),this.bounds=null,this.center_tile=null,this.panning=!1,this.panning_stop_at=0,this.pan_snap_timer=0,this.user_input_at=0,this.user_input_timeout=50,this.user_input_active=!1,this.size={},this.buffer=0,this.wrap=!1!==i.wrapView,this.preserve_tiles_within_zoom=1,this.lookAtManipulator=new ah(i.viewport),this._viewport=i.viewport,this._offset_buffer=[0,0],this.handleViewportUpdate(!0)}return br(t,[{key:"update",value:function(){this.pan_snap_timer=(new Date-this.panning_stop_at)/1e3,this.user_input_active=new Date-this.user_input_at<this.user_input_timeout,this.scene.tile_manager.updateTilesVisibilityCounters()}},{key:"handleViewportUpdate",value:function(t){var e=0<arguments.length&&void 0!==t&&t,i=this._viewport,r=i.width,n=i.height;this.size.css={width:r,height:n},this.size.device={width:Math.round(r*Sn.device_pixel_ratio),height:Math.round(n*Sn.device_pixel_ratio)},this.lookAtManipulator.handleViewportUpdate(),e||this.updateBounds()}},{key:"setLookAtData",value:function(t,e){var i,r,n=t.position,o=t.zoom,a=t.tilt,s=t.heading,l=t.bounds,u={zoom:o,tilt:a,heading:s};n&&"number"==typeof n.lng&&"number"==typeof n.lat&&(u.position=en.latLngToMeters([n.lng,n.lat])),l&&(i=[],r=l.getBoundingBox(),i.push(en.latLngToMeters([r.getLeft(),r.getTop()])),i.push(en.latLngToMeters([r.getRight(),r.getTop()])),i.push(en.latLngToMeters([r.getRight(),r.getBottom()])),i.push(en.latLngToMeters([r.getLeft(),r.getBottom()])),u.bounds=i),this.lookAtManipulator.setLookAtData(u,e),this.updateBounds()}},{key:"getLookAtData",value:function(t){var e=0<arguments.length&&void 0!==t&&t,i=this.lookAtManipulator.getLookAtData(),r=i.heading,n=i.incline,o=i.tilt,a=i.zoom,s=i.position,l=i.bounds,u=i.unpadded_bounds,c=Lr(en.metersToLatLng(s),2),h=c[0],f=c[1],p=new H.geo.LineString;return(e?u:l).forEach(function(t){var e=en.metersToLatLng(t);p.pushLatLngAlt(e[1],e[0],0)}),{heading:r,incline:n,tilt:o,zoom:a,bounds:new H.geo.Polygon(p),position:{lat:f,lng:h,alt:s[2]}}}},{key:"getTileLevel",value:function(){return this.lookAtManipulator.getLookAtData().tile_level}},{key:"applyPxOffset",value:function(t){var e=this._offset_buffer;e[0]+=t[0],e[1]+=t[1];var i,r,n=Math.abs(e[0]),o=Math.abs(e[1]);(1<=n||1<=o)&&(i=~~e[0],r=~~e[1],this.lookAtManipulator.applyPxOffset([n<1?0:i,o<1?0:r]),1<=n&&(e[0]-=i),1<=o&&(e[1]-=r),this.updateBounds())}},{key:"setPanning",value:function(t){this.panning=t,this.panning||(this.panning_stop_at=+new Date)}},{key:"markUserInput",value:function(){this.user_input_at=+new Date}},{key:"ready",value:function(){return"number"==typeof this.size.css.width&&"number"==typeof this.size.css.height}},{key:"updateBounds",value:function(){var t,e;this.markUserInput(),this.ready()&&(this.center_tile=en.tileForMeters(this.lookAtManipulator.getLookAtData().position,this.lookAtManipulator.getLookAtData().tile_level),t=this.lookAtManipulator.screenToWorld([0,this.size.css.height]),e=this.lookAtManipulator.screenToWorld([this.size.css.width,0]),this.bounds={sw:{x:t[0],y:t[1]},ne:{x:e[0],y:e[1]}},this.scene.tile_manager.updateTilesForView(!0),this.trigger("move"),this.scene.requestRedraw())}},{key:"getTileGridFlatForBBox",value:function(t,e,i,r,n,o){var a,s=4<arguments.length&&void 0!==n?n:0,l=!(5<arguments.length&&void 0!==o)||o,u=this.lookAtManipulator.getLookAtData().tile_level,c=en.tileForMeters([e,t],u),h=en.tileForMeters([r,i],u);c.x-=s,c.y-=s,h.x+=s,h.y+=s,!1===l&&(a=(1<<u)-1,c.x=Math.min(Math.max(0,c.x),a),c.y=Math.min(Math.max(0,c.y),a),h.x=Math.min(Math.max(0,h.x),a),h.y=Math.min(Math.max(0,h.y),a));for(var f=[],p={},d=c.x;d<=h.x;d++)for(var y=c.y;y<=h.y;y++){var g=Wo.coord(en.wrapTile({x:d,y:y,z:u},{x:!l,y:!0}));p[g.key]||(p[g.key]=!0,f.push(g))}return f}},{key:"getTileGridFlat",value:function(){return this.getTileGridFlatForBBox(this.bounds.ne.y,this.bounds.sw.x,this.bounds.sw.y,this.bounds.ne.x,this.buffer,this.wrap)}},{key:"getTileGridDistorted",value:function(){return bh(this.lookAtManipulator.getLookAtData(),this.buffer,this.wrap)}},{key:"findVisibleTileCoordinates",value:function(){if(!this.bounds)return[];var t=this.lookAtManipulator.getLookAtData(),e=t.tilt,i=t.heading;return 0===e&&180===i?this.getTileGridFlat():this.getTileGridDistorted()}},{key:"createMatrices",value:function(){this.matrices={},this.matrices.model=new Float64Array(16),this.matrices.model32=new Float32Array(16),this.matrices.model_view=new Float64Array(16),this.matrices.model_view32=new Float32Array(16),this.matrices.normal=new Float64Array(9),this.matrices.normal32=new Float32Array(9),this.matrices.inverse_normal32=new Float32Array(9)}},{key:"setupTile",value:function(t,e){t.setupProgram(this.matrices,e),this.lookAtManipulator.setupMatrices(this.matrices,e)}},{key:"setupProgram",value:function(t){var e=this.lookAtManipulator.getLookAtData();t.uniform("2fv","u_resolution",[this.size.device.width,this.size.device.height]),t.uniform("3fv","u_map_position",[e.position[0],e.position[1],Math.trunc(1e5*e.zoom)/1e5]),t.uniform("1f","u_meters_per_pixel",en.metersPerPixel(e.zoom)),t.uniform("1f","u_device_pixel_ratio",Sn.device_pixel_ratio),t.uniform("1f","u_view_pan_snap_timer",this.pan_snap_timer),t.uniform("1i","u_view_panning",this.panning),t.uniform("1f","u_horizon",this.lookAtManipulator.getHorizon()/(this.size.css.height/2)),this.lookAtManipulator.setupProgram(t)}},{key:"isAnimating",value:function(){return this.pan_snap_timer<=.5}},{key:"xyToGeo",value:function(t,e){var i=this.lookAtManipulator.screenToWorld([t,e]),r=Lr(en.metersToLatLng(i),2),n=r[0];return{lat:r[1],lng:n}}},{key:"geoToPixel",value:function(t){var e=en.latLngToMeters([t.lng,t.lat]);e.push(t.alt||0);var i=this.lookAtManipulator.worldToScreen(e);return{x:Math.floor(i[0]),y:Math.floor(i[1])}}},{key:"geoToMeters",value:function(t){var e=Lr(en.latLngToMeters([t.lng,t.lat]),2);return{x:e[0],y:e[1],z:t.alt||0}}},{key:"metersToGeo",value:function(t){var e=Lr(en.metersToLatLng([t.x,t.y]),2),i=e[0];return{lat:e[1],lng:i,alt:t.z||0}}},{key:"setZoomConstraints",value:function(t,e){this.lookAtManipulator.setZoomConstraints(t,e)}}]),t}(),Sh=Cc.PLACEMENT,Rh=128/Math.PI,Ph=16384/Math.PI,Oh=Object.create(su);Oh.variants={};Object.assign(Oh,nh),Object.assign(Oh,{name:"points",built_in:!0,vertex_shader_src:"uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform bool u_tile_fade_in;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform float u_visible_time;uniform bool u_view_panning;uniform float u_tilt;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform float u_heading;uniform float u_near_plane;uniform float u_depth_buffer_adjustment;attribute vec4 a_position;attribute vec4 a_shape;attribute vec4 a_color;attribute vec2 a_texcoord;attribute vec2 a_offset;uniform float u_point_type;attribute float a_is_flat;\n#ifdef TANGRAM_IS_TEXT_STYLE\nattribute vec4 a_offsets_alt;attribute vec4 a_pre_angles_alt;attribute vec4 a_angles_alt;attribute vec4 a_offsets;attribute vec4 a_pre_angles;attribute vec4 a_angles;\n#endif\n#ifdef TANGRAM_POINT_DRAW_STICK\nattribute float a_is_stick;attribute float a_stick_height;varying float v_is_stick;\n#endif\nvarying vec4 v_color;varying vec2 v_texcoord;varying vec4 v_world_position;varying float v_alpha_factor;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nattribute float a_outline_edge;attribute vec4 a_outline_color;varying float v_outline_edge;varying vec4 v_outline_color;varying float v_aa_offset;\n#endif\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nvarying float v_label_hidden;\n#endif\n#define PI 3.14159265359\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\nvec2 rotate2D(vec2 _st,float _angle){return mat2(cos(_angle),-sin(_angle),sin(_angle),cos(_angle))*_st;}vec3 rotateX3D(vec3 _st,float _angle){return mat3(1.,0.,0.,0.,cos(_angle),sin(_angle),0.,-sin(_angle),cos(_angle))*_st;}vec3 rotateZ3D(vec3 _st,float _angle){return mat3(cos(_angle),sin(_angle),0.,-sin(_angle),cos(_angle),0.,0.,0.,1.)*_st;}\n#ifdef TANGRAM_IS_TEXT_STYLE\nfloat mix4linear(float a,float b,float c,float d,float x){return mix(mix(a,b,3.*x),mix(b,mix(c,d,3.*(max(x,.66)-.66)),3.*(clamp(x,.33,.66)-.33)),step(0.33,x));}\n#endif\nvoid main(){\n#pragma tangram: setup\n#ifndef TANGRAM_SHOW_HIDDEN_LABELS\nif(a_shape.w==0.){gl_Position=vec4(0.,0.,0.,1.);return;}\n#else\nif(a_shape.w==0.){v_label_hidden=1.;}else{v_label_hidden=0.;}\n#endif\nv_alpha_factor=1.0;v_color=a_color;v_texcoord=a_texcoord;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nv_outline_color=a_outline_color;v_outline_edge=a_outline_edge;if(u_point_type==TANGRAM_POINT_TYPE_SHADER){v_outline_color=a_outline_color;v_outline_edge=a_outline_edge;float size=abs(a_shape.x/128.);v_texcoord=sign(a_shape.xy)*(size+1.0)/size;size+=2.0;v_aa_offset=2.0/size;}\n#endif\nvec4 position=u_modelView*vec4(a_position.xyz,1.);vec4 shape=vec4(a_shape.xy,0.,0.);vec2 offset=vec2(a_offset.x,-a_offset.y);\n#ifdef TANGRAM_POINT_DRAW_STICK\nv_is_stick=a_is_stick;float scaled_stick_height=(sin(u_tilt+(1.5*PI))+1.0)*a_stick_height;offset.y+=(1.0-a_is_stick)*scaled_stick_height;\n#endif\nfloat zoom=clamp(u_map_position.z-u_tile_origin.z,0.,1.);float theta=a_shape.z/4096.;float heading=u_heading;float delta=(heading-PI);float new_theta=theta-delta;float reversed=abs(new_theta)>PI/2. ? 1. : 0.;if(a_is_flat==1.0){\n#ifdef TANGRAM_IS_TEXT_STYLE\nif(a_offsets[0]!=0.){vec4 angles_scaled;vec4 pre_angles_scaled;vec4 offsets_scaled;if(reversed==1.){offsets_scaled=a_offsets_alt*4.;angles_scaled=(PI/16384.)*a_angles_alt;pre_angles_scaled=(PI/128.)*a_pre_angles_alt;}else{offsets_scaled=a_offsets*4.;angles_scaled=(PI/16384.)*a_angles;pre_angles_scaled=(PI/128.)*a_pre_angles;}float pre_angle=mix4linear(pre_angles_scaled[0],pre_angles_scaled[1],pre_angles_scaled[2],pre_angles_scaled[3],zoom);float angle=mix4linear(angles_scaled[0],angles_scaled[1],angles_scaled[2],angles_scaled[3],zoom);float offset_curve=mix4linear(offsets_scaled[0],offsets_scaled[1],offsets_scaled[2],offsets_scaled[3],zoom);shape.xy=rotate2D(shape.xy,pre_angle+PI*reversed);shape.x+=offset_curve;shape.xy=rotate2D(shape.xy,angle);shape.xy+=rotate2D(offset,theta);}else{shape.xy=rotate2D(shape.xy+offset*256.,theta+(PI*reversed));}\n#else\nshape.xy=rotate2D(shape.xy+offset*256.,theta);\n#endif\nshape.xy/=pow(2.,4.+(u_map_position.z-u_tile_origin.w));shape=u_modelView*shape;position+=shape;}else{shape.xy/=256.;\n#ifdef TANGRAM_POINT_DRAW_STICK\nshape.y*=1.0+(scaled_stick_height-1.0)*a_is_stick;\n#endif\nshape.xy=rotate2D(shape.xy+offset,theta);}\n#ifdef TANGRAM_FADE_IN_RATE\nif(u_tile_fade_in){v_alpha_factor*=clamp(u_visible_time*TANGRAM_FADE_IN_RATE,0.,1.);}\n#endif\n#ifdef TANGRAM_FADE_ON_ZOOM_OUT\nv_alpha_factor*=clamp(1.+TANGRAM_FADE_ON_ZOOM_OUT_RATE*(u_map_position.z-u_tile_origin.z),0.,1.);\n#endif\nv_world_position=u_model*position;v_world_position.xy+=shape.xy*u_meters_per_pixel;v_world_position=wrapWorldPosition(v_world_position);\n#pragma tangram: position\ncameraProjection(position);\n#ifdef TANGRAM_LAYER_ORDER\napplyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);/***Due to the precision loss on depth buffer,we had a z-fighting of translucent points when the distance to the camera was big.*For more information about the problem see: https:*For more information about the fix see: https:*position.z=(2.0*log(position.w/u_near_plane)/log(u_far_plane/u_near_plane)-1.0)*position.w;*/position.z=(log(position.w/u_near_plane)*u_depth_buffer_adjustment-1.0)*position.w;\n#endif\nif(a_is_flat!=1.){position.xy+=shape.xy*position.w*2.*u_device_pixel_ratio/u_resolution;}\n#ifdef TANGRAM_HAS_SHADER_POINTS\nif(u_point_type==TANGRAM_POINT_TYPE_SHADER){position.xy+=sign(shape.xy)*position.w*u_device_pixel_ratio/u_resolution;}\n#endif\nif(!u_view_panning){snapToPixelGrid(position);}gl_Position=position;}",fragment_shader_src:"uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform float u_visible_time;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform sampler2D u_texture;uniform float u_point_type;uniform bool u_apply_color_blocks;varying vec4 v_color;varying vec2 v_texcoord;varying vec4 v_world_position;varying float v_alpha_factor;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nvarying vec4 v_outline_color;varying float v_outline_edge;varying float v_aa_offset;\n#endif\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nvarying float v_label_hidden;\n#endif\n#ifdef TANGRAM_POINT_DRAW_STICK\nvarying float v_is_stick;\n#endif\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n#ifdef TANGRAM_HAS_SHADER_POINTS\nfloat _tangram_antialias(float l,float R){float low=R-v_aa_offset;float high=R+v_aa_offset;return 1.-smoothstep(low,high,l);}\n#endif\nvoid mixTextureColor(inout vec4 color){\n#ifdef TANGRAM_HAS_SHADER_POINTS\nif(u_point_type==TANGRAM_POINT_TYPE_TEXTURE){color*=texture2D(u_texture,v_texcoord);}else if(u_point_type==TANGRAM_POINT_TYPE_LABEL){color=texture2D(u_texture,v_texcoord);color.rgb/=max(color.a,0.001);}else if(u_point_type==TANGRAM_POINT_TYPE_SHADER){float outline_edge=v_outline_edge;vec4 outlineColor=v_outline_color;float l=length(v_texcoord);float outer_alpha=_tangram_antialias(l,1.);float fill_alpha=_tangram_antialias(l,1.-v_outline_edge*0.5)*color.a;float stroke_alpha=(outer_alpha-_tangram_antialias(l,1.-v_outline_edge))*outlineColor.a;\n#ifdef TANGRAM_BLEND_ADD\ncolor.a=stroke_alpha+fill_alpha;color.rgb=color.rgb*fill_alpha+outlineColor.rgb*stroke_alpha;\n#else\ncolor.a=stroke_alpha+fill_alpha*(1.-stroke_alpha);color.rgb=mix(color.rgb*fill_alpha,outlineColor.rgb,stroke_alpha)/max(color.a,0.001);\n#endif\n}\n#else\ncolor=texture2D(u_texture,v_texcoord);color.rgb/=max(color.a,0.001);\n#endif\nif(u_apply_color_blocks){\n#pragma tangram: color\n#pragma tangram: filter\n}color.a*=v_alpha_factor;\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nif(v_label_hidden>0.){color.a*=0.5;color.rgb=vec3(1.,0.,0.);}\n#endif\n#if !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY) && !defined(TANGRAM_BLEND_ADD)\nif(color.a<TANGRAM_ALPHA_TEST){discard;}\n#endif\n}void main(void){\n#pragma tangram: setup\nvec4 color=v_color;\n#ifdef TANGRAM_POINT_DRAW_STICK\nif(v_is_stick==0.0){mixTextureColor(color);}\n#else\nmixTextureColor(color);\n#endif\ngl_FragColor=color;}",selection:!0,collision:!0,blend:"overlay",init:function(t){var e=0<arguments.length&&void 0!==t?t:{};su.init.call(this,e),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!0,this.defines.TANGRAM_POINT_TYPE_TEXTURE=1,this.defines.TANGRAM_POINT_TYPE_LABEL=2,this.defines.TANGRAM_POINT_TYPE_SHADER=3,this.defines.TANGRAM_POINT_DRAW_STICK=!!this.stick,this.collision_group_points=this.name+"-points",this.collision_group_text=this.name+"-text",this.reset()},setupDefines:function(){"overlay"!==this.blend&&(this.defines.TANGRAM_LAYER_ORDER=!0),this.defines.TANGRAM_FADE_ON_ZOOM_OUT=!0,this.defines.TANGRAM_FADE_ON_ZOOM_OUT_RATE=2,Ol.suppress_label_fade_in||this.suppress_fade?(this.fade_in_time=0,this.defines.TANGRAM_FADE_IN_RATE=null):(this.fade_in_time=.15,this.defines.TANGRAM_FADE_IN_RATE=1/this.fade_in_time),Ol.suppress_snap_animation||(this.defines.TANGRAM_VIEW_PAN_SNAP_RATE=2),Ol.show_hidden_labels&&(this.defines.TANGRAM_SHOW_HIDDEN_LABELS=!0)},reset:function(){this.queues={},this.resetText(),this.texture_missing_sprites={}},addFeature:function(t,e,i){var r,n,o,a=i.tile,s={};if(s.color=this.parseColor(e.color,i),s.texture=e.texture,s.label_texture=null,s.color||s.texture){if(this.hasSprites(s)){if(!(r=this.parseSprite(s,e,i)))return;s.texcoords=r.texcoords}if(s.size=e.size,s.size){if(s.size=xo.evalCachedPointSizeProperty(e.size,r,i),null==s.size)return void En({level:"warn",once:!0},"Layer '".concat(e.layers[e.layers.length-1],"': ")+"'size' includes % and/or ratio-based scaling (".concat(JSON.stringify(e.size.value),"); ")+"these can only applied to sprites, but no sprite was specified, skipping features in layer");"number"==typeof s.size&&(s.size=[s.size,s.size])}else s.size=r&&r.css_size||[16,16];e.outline&&(s.outline_width=xo.evalCachedProperty(e.outline.width,i)||xo.defaults.outline.width,s.outline_color=this.parseColor(e.outline.color,i)),s.outline_edge_pct=0,s.outline_width&&s.outline_color&&(n=s.outline_width,s.size[0]+=n,s.size[1]+=n,s.outline_edge_pct=n/Math.min(s.size[0],s.size[1])*2),s.size[0]=Math.min(s.size[0],256),s.size[1]=Math.min(s.size[1],256),s.placement=e.placement,s.placement_min_length_ratio=xo.evalCachedProperty(e.placement_min_length_ratio,i),s.placement===Sh.SPACED&&e.placement_spacing&&(s.placement_spacing=xo.evalCachedProperty(e.placement_spacing,i)),s.angle=xo.evalProperty(e.angle,i)||0,s.elevate_by_altitude=!!e.elevate_by_altitude,s.z=e.z?Jr.clamp(xo.evalCachedDistanceProperty(e.z,i),0,32767):xo.defaults.z,s.flat=e.flat,s.tile_edges=e.tile_edges,this.computeLayout(s,t,e,i,a),e.stick&&!s.flat&&(o=xo.parseNumber(xo.evalProperty(e.stick.height,i)),s.stick={color:this.parseColor(e.stick.color,i)||xo.defaults.color,height:o?Math.max(o,0):0});var l=e.text&&!1!==xo.evalProperty(e.text.visible,i)&&this.parseTextFeature(t,e.text,i,a);Array.isArray(l)&&En({level:"warn",once:!(l=null)},"Layer '".concat(e.layers[e.layers.length-1],"': ")+"cannot use boundary labels (e.g. 'text_source: { left: ..., right: ... }') for 'text' labels attached to 'points'; "+"provided 'text_source' value was ".concat(JSON.stringify(e.text.text_source))),l&&(l.layout.parent=s,l.layout.priority=e.text.priority?Math.max(l.layout.priority,s.priority+.5):s.priority+.5,l.layout.move_into_tile=!1,Oo.addStyle(this.collision_group_text,a.id)),this.queueFeature({feature:t,draw:e,context:i,style:s,text_feature:l},a),Oo.addStyle(this.collision_group_points,a.id)}},hasSprites:function(t){return t.texture&&this.textureManager.textures[t.texture]&&this.textureManager.textures[t.texture].sprites},getSpriteInfo:function(t,e){var i=this.textureManager.textures[t.texture].sprites[e]&&this.textureManager.getSpriteInfo(t.texture,e);return e&&!i?(this.texture_missing_sprites[t.texture]=this.texture_missing_sprites[t.texture]||{},this.texture_missing_sprites[t.texture][e]||(En("debug","Style: in style '".concat(this.name,"', could not find sprite '").concat(e,"' for texture '").concat(t.texture,"'")),this.texture_missing_sprites[t.texture][e]=!0)):i&&(i.sprite=e),i},parseSprite:function(t,e,i){var r=xo.evalProperty(e.sprite,i);return this.getSpriteInfo(t,r)||this.getSpriteInfo(t,e.sprite_default)},queueFeature:function(t,e){this.tile_data[e.id]&&this.queues[e.id]||this.startData(e),this.queues[e.id]=this.queues[e.id]||[],this.queues[e.id].push(t)},endData:function(t){var e=this;if(t.canceled)return En("trace","Style ".concat(this.name,": stop tile build because tile was canceled: ").concat(t.key)),Promise.resolve();var i=this.queues[t.id];delete this.queues[t.id];var r=[],n=[];return i.forEach(function(t){for(var i=t.style,o=t.feature,a=o.geometry,s=e.buildLabels(i.size,a,i),l=0;l<s.length;l++){var u,c=s[l],h={feature:o,draw:t.draw,context:t.context,style:i,label:c};n.push(h),t.text_feature&&(u={feature:o,draw:t.text_feature.draw,context:t.context,text:t.text_feature.text,text_settings_key:t.text_feature.text_settings_key,layout:t.text_feature.layout,point_label:c,linked:h},r.push(u),t.draw.text.optional||(h.linked=u))}}),Promise.all([Oo.collide(n,this.collision_group_points,t.id).then(function(t){t.forEach(function(t){e.feature_style=t.style,e.feature_style.label=t.label,e.feature_style.linked=t.linked,su.addFeature.call(e,t.feature,t.draw,t.context)})}),this.collideAndRenderTextLabels(t,this.collision_group_text,r)]).then(function(i){var r=Lr(i,2)[1],n=r.labels,o=r.texts;return n&&o&&n.forEach(function(t){var i=t.text_settings_key,r=o[i]&&o[i][t.text],n=e.feature_style;n.label=t.label,n.linked=t.linked,n.size=r.size.logical_size,n.angle=0,t.label.text_data={text_info:r,text_settings_key:i,text:t.text},n.label_texture=e.textureManager.default,su.addFeature.call(e,t.feature,t.draw,t.context)}),e.freeText(t),su.endData.call(e,t)})},_preprocess:function(t){t.color=xo.createColorPropertyCache(t.color),t.texture=void 0!==t.texture?t.texture:this.texture,t.outline&&(t.outline.color=xo.createColorPropertyCache(t.outline.color),t.outline.width=xo.createPropertyCache(t.outline.width,xo.parsePositiveNumber)),t.z=xo.createPropertyCache(t.z,xo.parseUnits);try{t.size=xo.createPointSizePropertyCache(t.size)}catch(e){return En({level:"warn",once:!0},"Layer '".concat(t.layers[t.layers.length-1],"': ")+"".concat(e," (").concat(JSON.stringify(t.size),"), skipping features in layer")),null}return t.offset=xo.createPropertyCache(t.offset,function(t){return Array.isArray(t)&&t.map(xo.parseNumber)}),t.buffer=xo.createPropertyCache(t.buffer,function(t){return(Array.isArray(t)?t:[t,t]).map(xo.parsePositiveNumber)}),t.repeat_distance=xo.createPropertyCache(t.repeat_distance,xo.parseNumber),null==t.repeat_group&&(t.repeat_group=t.layers.join("-")),t.placement=Sh[t.placement&&t.placement.toUpperCase()],null==t.placement&&(t.placement=Sh.VERTEX),t.placement_spacing=null!=t.placement_spacing?t.placement_spacing:80,t.placement_spacing=xo.createPropertyCache(t.placement_spacing,xo.parsePositiveNumber),t.placement_min_length_ratio=null!=t.placement_min_length_ratio?t.placement_min_length_ratio:1,t.placement_min_length_ratio=xo.createPropertyCache(t.placement_min_length_ratio,xo.parsePositiveNumber),"number"==typeof t.angle?t.angle=t.angle*Math.PI/180:t.angle=t.angle||0,t.text=this.preprocessText(t.text),t.text&&(t.text.key=t.key,t.text.group=t.group,t.text.layers=t.layers,t.text.order=t.order,t.text.repeat_group=t.text.repeat_group||t.repeat_group,t.text.anchor=t.text.anchor||this.default_anchor,t.text.optional="boolean"==typeof t.text.optional&&t.text.optional,t.text.interactive=t.text.interactive||t.interactive),t.stick&&(t.stick.color=xo.createColorPropertyCache(t.stick.color)),t},default_anchor:["bottom","top","right","left"],computeLayout:function(t,e,i,r,n){var o=t||{};o.id=e,o.units_per_pixel=n.units_per_pixel||1,o.collide=!1!==i.collide,o.anchor=i.anchor,o.offset=xo.evalCachedProperty(i.offset,r)||xo.zeroPair,o.buffer=xo.evalCachedProperty(i.buffer,r)||xo.zeroPair,o.repeat_distance=xo.evalCachedProperty(i.repeat_distance,r),o.repeat_distance&&(o.repeat_distance*=o.units_per_pixel,o.repeat_scale=1,"function"==typeof i.repeat_group?o.repeat_group=i.repeat_group(r):o.repeat_group=i.repeat_group);var a=i.priority;return null!=a?"function"==typeof a&&(a=a(r)):a=-1>>>0,o.priority=a,o},buildTextLabels:function(t,e){for(var i=[],r=0;r<e.length;r++){var n=e[r],o=this.texts[t.id][n.text_settings_key][n.text].size.collision_size;n.label=new Cc(n.point_label.position,o,n.point_label.isFlat(),n.layout),i.push(n)}return i},buildLabels:function(t,e,i){var r=!!i.flat,n=[];if("Point"===e.type)n.push(new Cc(e.coordinates,t,r,i));else if("MultiPoint"===e.type)for(var o=e.coordinates,a=0;a<o.length;++a){var s=o[a];n.push(new Cc(s,t,r,i))}else if("LineString"===e.type)for(var l=jc(e.coordinates,t,r,i),u=0;u<l.length;++u)n.push(l[u]);else if("MultiLineString"===e.type)for(var c=e.coordinates,h=0;h<c.length;h++)for(var f=jc(c[h],t,r,i),p=0;p<f.length;++p)n.push(f[p]);else if("Polygon"===e.type)if(i.placement===Sh.CENTROID){var d=en.centroid(e.coordinates);n.push(new Cc(d,t,r,i))}else for(var y=e.coordinates,g=0;g<y.length;g++)for(var v=jc(y[g],t,r,i),_=0;_<v.length;++_)n.push(v[_]);else if("MultiPolygon"===e.type)if(i.placement===Sh.CENTROID){var m=en.multiCentroid(e.coordinates);n.push(new Cc(m,t,r,i))}else for(var b=e.coordinates,x=0;x<b.length;x++)for(var w=b[x],k=0;k<w.length;k++)for(var A=jc(w[k],t,r,i),T=0;T<A.length;++T)n.push(A[T]);return n},makeVertexTemplate:function(t,e){var i,r=t.color||xo.defaults.color,n=e.vertex_data.vertex_layout;return this.fillVertexTemplate(n,"a_position",0,{size:2}),this.fillVertexTemplate(n,"a_position",t.z||0,{size:1,offset:2}),this.fillVertexTemplate(n,"a_position",this.scaleOrder(t.order),{size:1,offset:3}),this.fillVertexTemplate(n,"a_shape",0,{size:4}),this.fillVertexTemplate(n,"a_shape",t.label.layout.collide?0:1,{size:1,offset:3}),this.fillVertexTemplate(n,"a_texcoord",0,{size:2}),this.fillVertexTemplate(n,"a_offset",0,{size:2}),this.fillVertexTemplate(n,"a_color",Jl.mult(r,255),{size:4}),this.defines.TANGRAM_HAS_SHADER_POINTS&&e.variant.shader_point&&(i=t.outline_color||xo.defaults.outline.color,this.fillVertexTemplate(n,"a_outline_color",Jl.mult(i,255),{size:4}),this.fillVertexTemplate(n,"a_outline_edge",t.outline_edge_pct||xo.defaults.outline.width,{size:1})),this.selection&&this.fillVertexTemplate(n,"a_selection_color",Jl.mult(t.selection_color,255),{size:4}),this.fillVertexTemplate(n,"a_is_flat",0,{size:1}),this.defines.TANGRAM_POINT_DRAW_STICK&&t.stick&&(this.fillVertexTemplate(n,"a_is_stick",0,{size:1}),this.fillVertexTemplate(n,"a_stick_height",t.stick.height,{size:1})),this.vertex_template},buildQuad:function(t,e,i,r,n,o,a,s,l,u,c,h,f,p,d,y,g,v,_){return e[0]<=0||e[1]<=0?0:function(t,e,i,r){var n,o,a,s,l,u,c=r.quad,h=r.quad_normalize,f=r.offset,p=r.offsets,d=r.offsets_alt,y=r.pre_angles,g=r.pre_angles_alt,v=r.angle,_=r.angles,m=r.angles_alt,b=r.is_flat,x=r.elevate_by_altitude,w=r.build_stick_points,k=r.color,A=r.stick_color,T=r.curve,E=r.texcoord_scale,M=r.texcoord_normalize,S=r.pre_angles_normalize,R=r.angles_normalize,P=r.offsets_normalize,h=h||1,O=c[0]/2*h,C=c[1]/2*h,L=[[-O,-C],[O,-C],[O,C],[-O,C]],I=e.vertex_elements,j=e.vertex_count,N=e.vertex_layout.index,z=N.a_texcoord,D=N.a_position,F=N.a_shape,U=N.a_offset,B=N.a_offsets,G=N.a_offsets_alt,H=N.a_pre_angles,V=N.a_pre_angles_alt,q=N.a_angles,W=N.a_angles_alt,X=N.a_is_flat,Y=N.a_is_stick,K=N.a_color;z&&(M=M||1,u=[[o=(n=Lr(E||_u,4))[0],a=n[1]],[s=n[2],a],[s,l=n[3]],[o,l]]);for(var Z=0,Q=t.length,$=0;$<Q;$++){var J=t[$];if(w){for(var tt=.5*h,et=+h,it=[[-tt,0],[+tt,0],[+tt,et],[-tt,et]],rt=0;rt<4;rt++)z&&(i[z+0]=u[rt][0]*M,i[z+1]=u[rt][1]*M),i[D+0]=J[0],i[D+1]=J[1],x&&(i[D+2]=Jr.clamp(J[2],0,32767)),i[F+0]=it[rt][0],i[F+1]=it[rt][1],i[F+2]=0,i[K+0]=A[0],i[K+1]=A[1],i[K+2]=A[2],i[K+3]=A[3],i[Y+0]=255,e.addVertex(i);I.push(j+0),I.push(j+1),I.push(j+2),I.push(j+2),I.push(j+3),I.push(j+0),j+=4,Z+=2}for(var nt=0;nt<4;nt++)z&&(i[z+0]=u[nt][0]*M,i[z+1]=u[nt][1]*M),i[D+0]=J[0],i[D+1]=J[1],x&&(i[D+2]=Jr.clamp(J[2],0,32767)),i[F+0]=L[nt][0],i[F+1]=L[nt][1],i[F+2]=v,i[K+0]=k[0],i[K+1]=k[1],i[K+2]=k[2],i[K+3]=k[3],i[U+0]=f[0],i[U+1]=f[1],i[X+0]=b?255:0,w&&(i[Y+0]=0),T&&(i[H+0]=S*y[0],i[H+1]=S*y[1],i[H+2]=S*y[2],i[H+3]=S*y[3],i[q+0]=R*_[0],i[q+1]=R*_[1],i[q+2]=R*_[2],i[q+3]=R*_[3],i[B+0]=P*p[0],i[B+1]=P*p[1],i[B+2]=P*p[2],i[B+3]=P*p[3],d&&(i[G+0]=P*d[0],i[G+1]=P*d[1],i[G+2]=P*d[2],i[G+3]=P*d[3],i[V+0]=S*g[0],i[V+1]=S*g[1],i[V+2]=S*g[2],i[V+3]=S*g[3],i[W+0]=R*m[0],i[W+1]=R*m[1],i[W+2]=R*m[2],i[W+3]=R*m[3])),e.addVertex(i);I.push(j+0),I.push(j+1),I.push(j+2),I.push(j+2),I.push(j+3),I.push(j+0),j+=4,Z+=2}return Z}(t,d,y,{quad:e,quad_normalize:256,offset:s,offsets:l,offsets_alt:u,pre_angles:o,pre_angles_alt:a,angle:4096*i,angles:r,angles_alt:n,is_flat:f,elevate_by_altitude:p,build_stick_points:g,stick_color:g&&Jl.mult(v,255),color:Jl.mult(_||xo.defaults.color,255),curve:h,texcoord_scale:c,texcoord_normalize:65535,pre_angles_normalize:Rh,angles_normalize:Ph,offsets_normalize:64})},build:function(t,e,i){var r=t.label;return"curved"===r.type?this.buildCurvedLabel(r,t,e,i):this.buildStraightLabel(r,t,e,i)},buildStraightLabel:function(t,e,i,r){var n,o=this.makeVertexTemplate(e,i),a=t.angle||e.angle,s="point"!==t.type?(n=e.size[t.type],_u):(n=e.size,e.texcoords||_u);i.uniforms=i.uniforms||{},e.label_texture?(i.uniforms.u_texture=e.label_texture,i.uniforms.u_point_type=2,i.uniforms.u_apply_color_blocks=!1):(e.texture?(i.uniforms.u_texture=e.texture,i.uniforms.u_point_type=1):(i.uniforms.u_texture=this.textureManager.default,i.uniforms.u_point_type=3),i.uniforms.u_apply_color_blocks=!0);var l=t.offset,u=this.defines.TANGRAM_POINT_DRAW_STICK&&!e.label_texture&&e.stick&&0<e.stick.height,c=this.buildQuad([t.position],n,a,null,null,null,null,l,null,null,s,!1,t.isFlat(),e.elevate_by_altitude,i.vertex_data,o,u,u&&e.stick.color,e.color),h=e.linked&&e.linked.label.id;return this.trackLabel(t,h,i,c,r,u),c},buildCurvedLabel:function(t,e,i,r){for(var n=this.makeVertexTemplate(e,i),o=t.angle,a=0,s=0;s<2;s++)for(var l=0;l<t.num_segments;l++){var u=e.size[t.type][l],c=_u,h=this.getTileMesh(r.tile,this.meshVariantTypeForDraw(e));h.uniforms=h.uniforms||{},h.uniforms.u_texture=e.label_texture,h.uniforms.u_point_type=2,h.uniforms.u_apply_color_blocks=!1;var f=t.offset||[0,0],p=t.position,d=t.angles[l],y=t.offsets[l],g=t.pre_angles[l],v=t.num_segments-l-1,_=t.alt_angles[v],m=t.alt_pre_angles[v],b=t.alt_offsets[v],x=this.buildQuad([p],u,o,d,_,g,m,f,y,b,c,!0,t.isFlat(),e.elevate_by_altitude,h.vertex_data,n,!1,!1,e.color);a+=x;var w=e.linked&&e.linked.label.id;this.trackLabel(t,w,i,x,r,!1)}return a},trackLabel:function(t,e,i,r,n,o){var a=5<arguments.length&&void 0!==o&&o;i.labels=i.labels||{},i.labels.collision=i.labels.collision||{},i.labels["non-collision"]=i.labels["non-collision"]||{};var s=t.layout.collide?i.labels.collision:i.labels["non-collision"];s[t.id]=s[t.id]||{container:{label:t.text_data?Object.assign(t.toJSON(),{text_data:t.text_data}):t.toJSON(),linked:e},ranges:[]};var l=2*r,u=i.vertex_data.offset-i.vertex_data.stride*l;s[t.id].ranges.push([u,l,a])},buildLines:function(t,e,i,r){return this.build(e,i,r)},buildPoints:function(t,e,i,r){return this.build(e,i,r)},buildPolygons:function(t,e,i,r){return this.build(e,i,r)},vertexLayoutForMeshVariant:function(t){var e;return this.vertex_layout||(e=[{name:"a_position",size:4,type:lu.SHORT,normalized:!1},{name:"a_shape",size:4,type:lu.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:lu.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:lu.SHORT,normalized:!1},{name:"a_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0},{name:"a_outline_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0,static:[0,0,0,0]},{name:"a_outline_edge",size:1,type:lu.FLOAT,normalized:!1,static:0},{name:"a_selection_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0},{name:"a_is_flat",size:1,type:lu.UNSIGNED_BYTE,normalized:!0}],this.defines&&this.defines.TANGRAM_POINT_DRAW_STICK&&e.push({name:"a_is_stick",size:1,type:lu.UNSIGNED_BYTE,normalized:!0},{name:"a_stick_height",size:1,type:lu.FLOAT,normalized:!1}),this.vertex_layout=new gu(e),(e=e.map(function(t){return Object.assign({},t)})).forEach(function(t){"a_outline_color"!==t.name&&"a_outline_edge"!==t.name||(t.static=null)}),this.vertex_layout_shader_point=new gu(e)),t.shader_point?this.vertex_layout_shader_point:this.vertex_layout},meshVariantTypeForDraw:function(t){var e=t.label_texture||t.texture||this.default_mesh_variant.key;return null==Oh.variants[e]&&(Oh.variants[e]={key:e,shader_point:e===this.default_mesh_variant.key,order:t.label_texture?1:0}),Oh.variants[e]},makeMesh:function(t,e,i){var r=2<arguments.length&&void 0!==i?i:{},r=Object.assign({},r,{fade_in_time:this.fade_in_time});return su.makeMesh.call(this,t,e,r)}});var Ch=[0,.33,.66,.99],Lh=function(t,e,i,r,n){for(var o=[{type:"straight",tolerance:n.no_curving?1.8:1.5},{type:"curved"},{type:"straight",tolerance:2.3}],a=0;a<o.length;a++){var s=o[a],l=void 0;if("straight"===s.type?l=new jh(e,i,r,n,s.tolerance):"curved"===s.type&&!n.no_curving&&2<i.length&&(l=new Nh(t,i,r,n)),l&&!l.throw_away)return l}return!1},Ih=function(){function t(e,i){_r(this,t),this.id=Ac.nextLabelId(),this.layout=i,this.position=[],this.angle=0,this.offset=i.offset.slice(),this.unit_scale=this.layout.units_per_pixel,this.type="",this.throw_away=!1,this._is_flat=e,this._circles=void 0,this.placed=null}return br(t,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,size:this.size,offset:this.offset,angle:this.angle,breach:this.breach,layout:Tc(this.layout),circles:this.getBoundingCircles()}}},{key:"inTileBounds",value:function(){var t=this.getAABB(),e=t.left,i=t.top,r=t.right,n=t.bottom;return Sn.pointInTile([e,i])&&Sn.pointInTile([r,n])}},{key:"getAABBForSegment",value:function(t,e,i,r){var n,o=this.unit_scale,a=e/2,s=i/2,l=Lr(t,2),u=l[0],c=l[1];0===this.offset[0]&&0===this.offset[1]||(u+=(n=Jl.rot(this.offset,this.angle))[0]*o,c-=n[1]*o);var h=[[Math.cos(r),-Math.sin(r)],[Math.sin(r),Math.cos(r)]],f=Jl.multMatrix(h,[-a,-s]),p=Jl.multMatrix(h,[a,-s]),d=Jl.multMatrix(h,[a,s]),y=Jl.multMatrix(h,[-a,s]);return{left:u+Math.min(f[0],p[0],d[0],y[0]),top:c+Math.max(f[1],p[1],d[1],y[1]),right:u+Math.max(f[0],p[0],d[0],y[0]),bottom:c+Math.min(f[1],p[1],d[1],y[1])}}},{key:"isFlat",value:function(){return this._is_flat}},{key:"getBoundingCircles",value:function(){}},{key:"getAABB",value:function(){}}],[{key:"splitLineByOrientation",value:function(t){for(var e=[t[0]],i=0,r=0,n=0,o=e,a=!1,s=1;s<t.length;s++){var l=t[s],u=t[s-1],c=Jl.length(Jl.sub(l,u));l[0]>u[0]?1===n?(e.push(l),r<(i+=c)&&(o=e,r=i,a=!1)):(e=[u,l],r<(i=c)&&(o=e,r=i,a=!1),n=1):l[0]<u[0]?-1===n?(e.unshift(l),r<(i+=c)&&(o=e,r=i,a=!0)):(e=[l,u],r<(i=c)&&(o=e,r=i,a=!0),n=-1):(-1===n?e.unshift(l):(e.push(l),n=1),r<(i+=c)&&(o=e,r=i,a=-1===n))}return[o,a]}}]),t}(),jh=function(){Ar(e,Ih);var t=Or(e);function e(i,r,n,o,a){var s;return _r(this,e),(s=t.call(this,n,o)).type="straight",s.size=i,s.throw_away=!s.fit(i,r,o,a),s}return br(e,[{key:"fit",value:function(t,e,i,r){var n,o=this.unit_scale,a=Lr(Ih.splitLineByOrientation(e),2);e=a[0],n=a[1],"number"==typeof i.orientation&&(this.offset[1]+=1.2*(t[1]-i.vertical_buffer),n&&(this.offset[1]*=-1),-1===i.orientation&&(this.offset[1]*=-1));for(var s=Dh(e),l=t[0]*o,u=0;u<e.length-1;u++)for(var c=e[u],h=0,f=0,p=u+1,d=void 0;p<e.length;){var y=e[p-1],g=e[p],v=zh(y,g);if(p!==u+1&&(h+=function(t,e){var i,r;r=e<t?(i=e,t):(i=t,e);for(;r-i>Math.PI;)i+=2*Math.PI;return Math.abs(r-i)}(v,d)),.1<Math.abs(h))break;if(l/(f+=s[p-1])<r){var _=Jl.mult(Jl.add(c,g),.5);return this.angle=-v,Math.abs(this.angle-Math.PI/2)<.01&&(this.angle=-Math.PI/2,"number"==typeof i.orientation&&(this.offset[1]*=-1)),this.position=_,this.breach=!this.inTileBounds(),!0}d=v,p++}return!1}},{key:"getBoundingCircles",value:function(){var t,e,i,r,n,o,a,s,l,u,c,h,f,p;return this._circles||(t=this.unit_scale,n=-(i=(e=this.size[0]/2*t)*Math.cos(this.angle)),o=-(r=e*Math.sin(this.angle)),a=this.offset[0]*t,s=this.offset[1]*t,u=(l=Lr(this.position,2))[0],c=l[1],c*=-1,a&&(h=[i,r],Jl.normalize(h),h[0]*=a,h[1]*=a,u+=h[0],c+=h[1]),s&&(f=[r,-i],Jl.normalize(f),f[0]*=s,f[1]*=s,u-=f[0],c-=f[1]),i+=u,r+=c,n+=u,o+=c,p=this.size[1]/2*t,this._circles=Oc(i,r,n,o,p)),this._circles}},{key:"getAABB",value:function(){var t,e,i,r,n;return this._aabb||(t=this.unit_scale,e=this.size,i=this.layout.buffer,r=(e[0]+2*i[0])*t,n=(e[1]+2*i[1])*t,this._aabb=this.getAABBForSegment(this.position,r,n,this.angle)),this._aabb}}]),e}(),Nh=function(){Ar(e,Ih);var t=Or(e);function e(i,r,n,o){var a;return _r(this,e),(a=t.call(this,n,o)).type="curved",a.positions=[],a.angles=[],a._aabbs=[],a.pre_angles=[],a.offsets=[],a.num_segments=i.length,a.sizes=i,a.alt_angles=[],a.alt_pre_angles=[],a.alt_offsets=[],a.throw_away=!a.fit(a.sizes,r,o),a}return br(e,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,breach:this.breach,layout:Tc(this.layout),circles:this.getBoundingCircles()}}},{key:"fit",value:function(t,i,r){var n,o=this.unit_scale,a=Math.max.apply(Math,Ir(t.map(function(t){return t[1]}))),s=a*o,l=Lr(Ih.splitLineByOrientation(i),2);i=l[0],n=l[1],"number"==typeof r.orientation&&(this.offset[1]+=1.2*(a-r.vertical_buffer),n&&(this.offset[1]*=-1),-1===r.orientation&&(this.offset[1]*=-1));var u=Dh(i),c=t.map(function(t){return t[0]*o}),h=u.reduce(function(t,e){return t+e},0),f=c.reduce(function(t,e){return t+e},0);if(h<f)return!1;var p=i.length-1;if(p<2)return!1;var d=e.curvaturePlacement(i,h,u,f,0,p),y=i[d];if(-1===d||p-d<2)return!1;this.position=y;for(var g=0;g<c.length;g++){this.positions[g]=[],this.offsets[g]=[],this.angles[g]=[],this.pre_angles[g]=[];for(var v=0;v<Ch.length;v++){var _=Ch[v],m=Lr(e.scaleLine(_,i),2),b=m[0],x=m[1],y=b[d],w=e.placeAtIndex(d,b,x,c),k=w.positions,A=w.offsets,T=w.angles,E=w.pre_angles,M=A.map(function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])/o});if(0===_){this.angle=1/T.length*T.reduce(function(t,e){return t+e});for(var S=0;S<k.length;S++){var R=k[S],P=E[S],O=c[S],C=P+T[S];this._aabbs.push(this.getAABBForSegment(R,O,s,C))}}this.positions[g].push(k[g]),this.offsets[g].push(M[g]),this.angles[g].push(T[g]),this.pre_angles[g].push(E[g])}}for(var c=t.slice().reverse().map(function(t){return t[0]*o}),L=0;L<c.length;L++){this.alt_offsets[L]=[],this.alt_angles[L]=[],this.alt_pre_angles[L]=[];for(var I=0;I<Ch.length;I++){var j=Ch[I],N=Lr(e.scaleLine(j,i),2),z=N[0],D=N[1];y=z[d];var F=e.placeAtIndex(d,z,D,c),U=F.offsets,B=F.angles,G=F.pre_angles,H=U.map(function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])/o});0===j&&(this.alt_angle=1/B.length*B.reduce(function(t,e){return t+e})),this.alt_offsets[L].push(H[L]),this.alt_angles[L].push(B[L]),this.alt_pre_angles[L].push(G[L])}}return!0}},{key:"getBoundingCircles",value:function(){if(!this._circles){for(var t=[],e=this.unit_scale,i=0;i<this.positions.length;i++){var r=this.sizes[i],n=this.angles[i][0],o=this.positions[i][0],a=r[0]/2*e,s=a*Math.cos(n),l=a*Math.sin(n),u=-s,c=-l,h=Lr(o,2),f=h[0],p=h[1],d=Oc(s+=f,l+=p*=-1,u+=f,c+=p,r[1]/2*e);Array.prototype.push.apply(t,d)}this._circles=t}return this._circles}},{key:"getAABB",value:function(){if(!this._aabb){for(var t=1/0,e=-1/0,i=-1/0,r=1/0,n=0;n<this._aabbs.length;n++)var o=this._aabbs[n],t=Math.min(t,o.left),e=Math.max(e,o.top),i=Math.max(i,o.right),r=Math.min(r,o.bottom);this._aabb={left:t,top:e,right:i,bottom:r}}return this._aabb}}],[{key:"curvaturePlacement",value:function(t,e,i,r,n,o){n=n||0,o=o||t.length-1;for(var a=[],s=n+1;s<o;s++){var l=t[s-1],u=t[s],c=t[s+1],h=Jl.perp(u,l),f=Jl.perp(c,u),p=Jl.angleBetween(h,f);1<p&&(p=1/0),a.push(p)}a.push(1/0);for(var d=[],y=[],g=n,v=0,_=0;_<n;_++)v+=i[_];for(;v+r<e;){for(var m=v+r,b=v,x=g,w=0;x<o&&b+i[x]<m&&(w+=a[x])!==1/0;)b+=i[x],x++;if(0===w)return g;var k=w/(x-g);d.push(w),y.push(k),v+=i[g],g++}if(0===d.length)return-1;var A=Math.min.apply(null,d),T=y[d.indexOf(A)];return A<1.3&&T<.4?d.indexOf(A):-1}},{key:"scaleLine",value:function(t,e){var i=[e[0]],r=[];return e.forEach(function(n,o){var a,s;o!==e.length-1&&(a=Jl.sub(e[o+1],e[o]),s=Jl.mult(a,1+t),i.push(Jl.add(i[o],s)),r.push(Jl.length(s)))}),[i,r]}},{key:"placeAtIndex",value:function(t,i,r,n){var o=i[t],a=Lr(e.getIndicesAndOffsets(t,r,n),2),s=a[0],l=a[1],u=e.getPositionsFromIndicesAndOffsets(i,s,l),c=Lr(e.getAnglesFromIndicesAndOffsets(o,s,i,u),3);return{positions:u,offsets:c[0],angles:c[1],pre_angles:c[2]}}},{key:"getIndicesAndOffsets",value:function(t,e,i){for(var r=i.length,n=[],o=[],a=0,s=0,l=0;a<r;){for(var u=i[a];a<r&&s+.5*u<=l+e[t];){var c=s-l+.5*u;o.push(c),n.push(t),s+=u,u=i[++a]}l+=e[t],t++}return[n,o]}},{key:"getPositionsFromIndicesAndOffsets",value:function(t,e,i){for(var r=[],n=0;n<e.length;n++){var o=e[n],a=i[n],s=zh(t[o],t[o+1]),l=Jl.rot([a,0],s),u=Jl.add(t[o],l);r.push(u)}return r}},{key:"getAnglesFromIndicesAndOffsets",value:function(t,e,i,r){for(var n,o,a=[],s=[],l=[],u=0;u<r.length;u++){var c,h,f=r[u],p=e[u],d=Jl.sub(f,t),y=-Jl.angle(d),g=(n=i[p],o=i[p+1],-zh(n,o))-y;0<u&&(c=a[u-1],h=s[u-1],Math.abs(y-c)>Math.PI&&(y+=c<y?-2*Math.PI:2*Math.PI),Math.abs(h-g)>Math.PI&&(g+=h<g?-2*Math.PI:2*Math.PI)),a.push(y),s.push(g),l.push(d)}return[l,a,s]}}]),e}();function zh(t,e){var i=Jl.sub(e,t);return Jl.angle(i)}function Dh(t){for(var e=[],i=0;i<t.length-1;i++){var r=t[i],n=t[i+1],o=Math.hypot(r[0]-n[0],r[1]-n[1]);e.push(o)}return e}var Fh=Object.create(Oh);Object.assign(Fh,{name:"text",super:Oh,built_in:!0,init:function(t){var e=0<arguments.length&&void 0!==t?t:{};su.init.call(this,e),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!1,this.defines.TANGRAM_IS_TEXT_STYLE=!0,this.reset()},makeVertexTemplate:function(t,e){this.super.makeVertexTemplate.apply(this,arguments);var i=e.vertex_data.vertex_layout;return this.fillVertexTemplate(i,"a_pre_angles",0,{size:4}),this.fillVertexTemplate(i,"a_offsets",0,{size:4}),this.fillVertexTemplate(i,"a_angles",0,{size:4}),this.fillVertexTemplate(i,"a_offsets_alt",0,{size:4}),this.fillVertexTemplate(i,"a_pre_angles_alt",0,{size:4}),this.fillVertexTemplate(i,"a_angles_alt",0,{size:4}),this.vertex_template},reset:function(){this.queues={},this.resetText()},addFeature:function(t,e,i){var r=this,n=i.tile,o=t.geometry.type;e.can_articulate="LineString"===o||"MultiLineString"===o,e.supersample_text="LineString"===o||"MultiLineString"===o;var a=this.parseTextFeature(t,e,i,n);a&&(a instanceof Array?a.forEach(function(e){e.feature=t,e.context=i,e.layout.vertex=!1,r.queueFeature(e,n)}):(a.feature=t,a.context=i,a.layout.vertex=!1,this.queueFeature(a,n)),Oo.addStyle(this.name,n.id))},endData:function(t){var e=this,i=this.queues[t.id];return delete this.queues[t.id],this.collideAndRenderTextLabels(t,this.name,i).then(function(i){var r=i.labels,n=i.texts;return r&&n&&(e.texts[t.id]=n,r.forEach(function(i){var r=i.text_settings_key,n=e.texts[t.id][r]&&e.texts[t.id][r][i.text],o=e.feature_style;o.label=i.label,i.label.text_data={text_info:n,text_settings_key:r,text:i.text},o.label_texture=e.textureManager.default,n.text_settings.can_articulate?(o.size={},"straight"===i.label.type?o.size.straight=n.size.logical_size:o.size.curved=n.segment_sizes.map(function(t){return t.logical_size})):o.size=n.size.logical_size,su.addFeature.call(e,i.feature,i.draw,i.context)})),e.freeText(t),su.endData.call(e,t).then(function(i){if(i){for(var r in i.meshes)i.meshes[r].uniforms.u_apply_color_blocks=!0;t.mesh_data[e.name]=i}return i})})},_preprocess:function(t){return this.preprocessText(t)},buildTextLabels:function(t,e){for(var i=[],r=0;r<e.length;r++){var n,o=e[r],a=this.texts[t.id][o.text_settings_key][o.text],s=void 0;o.layout.vertical_buffer=a.vertical_buffer,s=a.text_settings.can_articulate?(n=a.segment_sizes.map(function(t){return t.collision_size}),o.layout.no_curving=a.no_curving,this.buildLabels(n,o.feature.geometry,o.layout,a.size.collision_size)):this.buildLabels(a.size.collision_size,o.feature.geometry,o.layout);for(var l=0;l<s.length;l++){var u=Object.create(o);u.label=s[l],i.push(u)}}return i},buildLabels:function(t,e,i,r){var n,o,a="Point"!==e.type,s=[];if("LineString"===e.type)Array.prototype.push.apply(s,this.buildLineLabels(e.coordinates,t,a,i,r));else if("MultiLineString"===e.type)for(var l=e.coordinates,u=0;u<l.length;++u)Array.prototype.push.apply(s,this.buildLineLabels(l[u],t,a,i,r));else if("Point"===e.type)s.push(new Cc(e.coordinates,t,a,i));else if("MultiPoint"===e.type)for(var c=e.coordinates,h=0;h<c.length;++h)s.push(new Cc(c[h],t,a,i));else{"Polygon"===e.type?(n=en.centroid(e.coordinates),s.push(new Cc(n,t,a,i))):"MultiPolygon"===e.type&&(o=en.multiCentroid(e.coordinates),s.push(new Cc(o,t,a,i)))}return s},buildLineLabels:function(t,e,i,r,n){var o,a=[],s=Math.min(r.subdiv,t.length-1);if(1<s)for(var l=(t.length-1)/s,u=0;u<s;u++){var c=Math.floor(u*l),h=Math.floor((u+1)*l)+1,f=t.slice(c,h),p=Lh(e,n,f,i,r);p&&a.push(p)}return a.length<s&&((o=Lh(e,n,t,i,r))&&a.push(o)),a},vertexLayoutForMeshVariant:function(){var t;return this.vertex_layout||(t=[{name:"a_position",size:4,type:lu.SHORT,normalized:!1},{name:"a_shape",size:4,type:lu.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:lu.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:lu.SHORT,normalized:!1},{name:"a_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0},{name:"a_angles",size:4,type:lu.SHORT,normalized:!1},{name:"a_offsets",size:4,type:lu.UNSIGNED_SHORT,normalized:!1},{name:"a_pre_angles",size:4,type:lu.BYTE,normalized:!1},{name:"a_selection_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0},{name:"a_is_flat",size:1,type:lu.UNSIGNED_BYTE,normalized:!0},{name:"a_offsets_alt",size:4,type:lu.UNSIGNED_SHORT,normalized:!1},{name:"a_pre_angles_alt",size:4,type:lu.BYTE,normalized:!1},{name:"a_angles_alt",size:4,type:lu.SHORT,normalized:!1}],this.vertex_layout=new gu(t)),this.vertex_layout},meshVariantTypeForDraw:Oh.meshVariantTypeForDraw}),Fh.texture_id=0;var Uh=Object.create(Gu);Object.assign(Uh,{name:"raster",super:Gu,built_in:!0,init:function(){this.raster=this.raster||"color",this.super.init.apply(this,arguments),this.selection=!1,this.defines.SNAP_TO_PIXEL_GRID=!0},_preprocess:function(t){return t.color=t.color||xo.defaults.color,this.super._preprocess.apply(this,arguments)}});var Bh=Object.create(Oh);Object.assign(Bh,{name:"custom_icons",collision:!1,init:function(t){var e=0<arguments.length&&void 0!==t?t:{};Oh.init.call(this,e)},loadTexture:function(t,e,i){var r,n=t.width,o=t.height,a=t.items,s=document.createElement("canvas"),l=Sn.device_pixel_ratio,u=this.sources[e],c={sprites:{}};if(s.width=n*l,s.height=o*l,u){var h,f=a.length,p=s.getContext("2d");for(p.scale(l,l);h=a[--f];){var d,y=u.getIconBitmapByObjectId(h.meta.objectId,h.meta.id);y&&((d=pl(y))?En("error",d):(p.drawImage(y,h.x,h.y,h.width,h.height),c.sprites[h.meta.id]=[h.x,h.y,h.width,h.height]))}}return c.element=s,(r=this.textureManager.create(this.gl,i,c)).retain(),r.loading.then(function(t){return t.name})},buildRasterTextures:function(t,e){return fn.postMessage(this.main_thread_target+".loadTexture",t.rasters,t.source,t.texture_name).then(function(t){return e.textures.push(t),e})},addFeature:function(t,e,i){var r=i.tile.rasters,n={};r.items.forEach(function(t){n[t.meta.id]=[t.x,t.y,t.width,t.height]});var o="".concat(i.tile.source,"_dyn_").concat(i.tile.coords.key,"_").concat(this.generation,"_").concat(i.tile.id);e.texture=i.tile.texture_name=o;var a=Object.assign({},Gh,{name:o,width:r.width,height:r.height,sprites:n,manager:this.textureManager});Io.prototype.calculateSprites.apply(a),this.textureManager.textures[o]=a,Oh.addFeature.apply(this,arguments),delete this.textureManager.textures[o]}});var Gh={filtering:"linear",density:1,valid:!0,power_of_2:!1,texcoords:{},sizes:{},css_sizes:{},aspects:{}},Hh=Object.create(Gu);Object.assign(Hh,{name:"overlays",super:Gu,init:function(t){var e=0<arguments.length&&void 0!==t?t:{};this.selection=e.selection||!0,this.raster=this.raster||"color",this.super.init.apply(this,arguments)},setupRasters:function(){if(!hn.is_main)return!1;if(this.super.setupRasters.call(this))return!0;var t=!1;for(var e in this.sources)if(this.sources[e]instanceof vl){t=!0;break}return!!t&&(this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster",au,"Raster"),!0)},loadTextures:function(t,e){var i,r,n,o=this.sources[e],a=t.name;if(t.overlays_config.forEach(function(e){var a,s=e.texcoords,l=e.id,u=o.getMapObjectById(l),c=u.getBitmap();c&&((a=pl(c=dl(c,c.width,c.height)))?En("error",a):(i||((i=document.createElement("canvas")).width=t.width,i.height=t.height,r=i.getContext("2d")),r.save(),r.globalAlpha=u.getOpacity(),s.forEach(function(t){return r.drawImage(c,t[0],t[1],t[2],t[3])}),r.restore(),n=!0))}),n){t.element=i;var s={};return s[a]=t,this.super.loadTextures.call(this,s)}var l=this.textureManager.textures[this.textureManager.default];return Promise.resolve([{name:l.name,width:l.width,height:l.height,loaded:l.loaded}])},buildRasterTextures:function(t,e){var i=this.sources[t.source].tileTexture(t);return i?fn.postMessage(this.main_thread_target+".loadTextures",i,t.source).then(function(t){if(!t||t.length<1)return e;if(t.some(function(t){return!t.loaded}))return null;var i=t[0].name;return e.uniforms=e.uniforms||{},e.textures=e.textures||[],e.uniforms.u_raster=i,e.uniforms.u_raster_offset=[0,0,1],e.textures.push(i),e}):Promise.resolve(e)}});var Vh=Object.create(su),qh=[-1,0,1,0,-1,1,-1,1,1,0,1,1,-1,0,1,0,-1,1,-1,1,1,0,1,1];Object.assign(Vh,{name:"skybox",built_in:!0,vertex_shader_src:"uniform float u_horizon;uniform float u_tilt;uniform float u_zoom;attribute vec2 a_position;attribute float a_is_sky;attribute float a_is_top;attribute vec4 a_color;varying vec4 v_color;const float SIN_THRESHOLD_ANGLE=0.96126069082;void main(){v_color=a_color;float sin_tilt=sin(u_tilt);float sky_bottom_alpha=1.-max(sin_tilt-SIN_THRESHOLD_ANGLE,0.)*3.;if((a_position.y==1.&&a_is_sky==0.)||(a_position.y==0.&&a_is_sky==1.)){v_color.w=sky_bottom_alpha;}float fog_height=max((22.-u_zoom)*0.04,0.)*(sin_tilt-.7);float position_z=u_zoom<17. ? .942 : .9418;gl_Position=vec4(a_position.x,a_is_sky*(a_position.y+a_is_top)+1.0-u_horizon-(1.0-a_is_sky)*(1.0-a_position.y)*fog_height,position_z,1.0);}",fragment_shader_src:"varying vec4 v_color;void main(void){gl_FragColor=v_color;}",selection:!1,blend:"inlay",blend_order:1,init:function(){su.init.apply(this,arguments),this.selection=!1},_preprocess:function(t){return t.color={top:xo.createColorPropertyCache(t.color.zenith),bottom:xo.createColorPropertyCache(t.color.horizon),fog:xo.createColorPropertyCache(t.color.fog)},t},vertexLayoutForMeshVariant:function(){var t;return this.vertex_layout||(t=[{name:"a_position",size:2,type:lu.FLOAT,normalized:!1},{name:"a_is_sky",size:1,type:lu.FLOAT,normalized:!0},{name:"a_color",size:4,type:lu.UNSIGNED_BYTE,normalized:!0},{name:"a_is_top",size:1,type:lu.FLOAT,normalized:!0}],this.vertex_layout=new gu(t)),this.vertex_layout},makeVertexTemplate:function(){var t=0;return this.vertex_template[t++]=0,this.vertex_template[1]=0,this.vertex_template},parseFeature:function(t,e,i){var r=this.feature_style;return e.color&&e.color.top&&e.color.bottom&&(r.color_top=this.parseColor(e.color.top,i),r.color_bottom=this.parseColor(e.color.bottom,i),r.color_fog=this.parseColor(e.color.fog||"white",i),Array.isArray(r.color_fog)&&(r.color_fog=r.color_fog.slice(),r.color_fog[3]=0)),r},buildGeometry:function(t,e,i){for(var r=this.makeVertexTemplate(e),n=i.vertex_data,o=i.vertex_data.vertex_layout,a=n.vertex_layout.index.a_position,s={top:e.color_top,bottom:e.color_bottom},l={top:e.color_bottom,bottom:e.color_fog},u=0,c=qh.length-1;u<c;u+=2){r[a+0]=qh[u],r[a+1]=qh[u+1];var h=u<12,f=0<qh[u+1],p=h?s:l;this.fillVertexTemplate(o,"a_is_sky",h?1:0,{size:1}),this.fillVertexTemplate(o,"a_is_top",f?1:0,{size:1}),this.fillVertexTemplate(o,"a_color",Jl.mult(f?p.top:p.bottom,255),{size:4}),n.addVertex(r)}return 4}});var Wh=function(){function t(){_r(this,t),this.styles={},this.base_styles={},this.register(Object.create(Gu)),this.register(Object.create(uc)),this.register(Object.create(gc)),this.register(Object.create(Oh)),this.register(Object.create(Fh)),this.register(Object.create(Uh)),this.register(Object.create(Bh)),this.register(Object.create(Hh)),this.register(Object.create(Vh))}return br(t,[{key:"init",value:function(){Wl.removeBlock("global"),Wl.removeBlock("setup"),Wl.addBlock("global","#ifdef TANGRAM_VERTEX_SHADER\nvec4 modelPosition(){return vec4(a_position.xyz/TANGRAM_TILE_SCALE*exp2(u_tile_origin.z-u_tile_origin.w),1.)+vec4(0.,1.,0.,0.);}vec4 modelPositionBaseZoom(){return vec4(a_position.xyz/TANGRAM_TILE_SCALE,1.)+vec4(0.,1.,0.,0.);}\n#endif\nvec4 worldPosition(){return v_world_position;}\n#ifdef TANGRAM_VERTEX_SHADER\nvec4 wrapWorldPosition(vec4 world_position){\n#if defined(TANGRAM_WORLD_POSITION_WRAP)\nvec2 anchor=u_tile_origin.xy-mod(u_tile_origin.xy,TANGRAM_WORLD_POSITION_WRAP);world_position.xy-=anchor;\n#endif\nreturn world_position;}\n#endif\n#if defined(TANGRAM_VERTEX_SHADER)\nvec3 worldNormal(){return TANGRAM_NORMAL;}\n#elif defined(TANGRAM_FRAGMENT_SHADER)\nvec3 worldNormal(){return u_inverseNormalMatrix*TANGRAM_NORMAL;}\n#endif\n"),Wl.addBlock("global","void applyLayerOrder(float layer,inout vec4 position){position.z-=layer*TANGRAM_LAYER_DELTA*position.w;}"),Wl.addBlock("global","\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\nattribute vec4 a_selection_color;varying vec4 v_selection_color;uniform vec4 u_selection_discard0;uniform vec4 u_selection_discard1;uniform vec4 u_selection_discard2;uniform vec4 u_selection_discard3;uniform vec4 u_selection_discard4;uniform vec4 u_selection_discard5;uniform vec4 u_selection_discard6;uniform vec4 u_selection_discard7;uniform vec4 u_selection_discard8;uniform vec4 u_selection_discard9;\n#endif\n"),Wl.addBlock("global","uniform float u_view_pan_snap_timer;void snapToPixelGrid(inout vec4 position){vec2 position_fract=fract((((position.xy/position.w)+1.)*.5)*u_resolution);vec2 position_snap=position.xy+((step(0.5,position_fract)-position_fract)*position.w*2./u_resolution);\n#ifdef TANGRAM_VIEW_PAN_SNAP_RATE\nposition.xy=mix(position.xy,position_snap,clamp(u_view_pan_snap_timer*TANGRAM_VIEW_PAN_SNAP_RATE,0.,1.));\n#else\nposition.xy=position_snap;\n#endif\n}"),Wl.replaceBlock("utils","#ifndef UTILS\n#define UTILS\nbool isLocalSpacePixelOutsideTile(vec4 pixel_local_space_position,float tile_scale){return pixel_local_space_position.x<0.||pixel_local_space_position.x>=tile_scale||pixel_local_space_position.y>0.||pixel_local_space_position.y<=-tile_scale;}\n#endif\n"),Wl.replaceBlock("setup","\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\nif(a_selection_color.rgb==vec3(0.)||a_selection_color==u_selection_discard0||a_selection_color==u_selection_discard1||a_selection_color==u_selection_discard2||a_selection_color==u_selection_discard3||a_selection_color==u_selection_discard4||a_selection_color==u_selection_discard5||a_selection_color==u_selection_discard6||a_selection_color==u_selection_discard7||a_selection_color==u_selection_discard8||a_selection_color==u_selection_discard9){gl_Position=vec4(0.,0.,0.,1.);return;}v_selection_color=a_selection_color;\n#endif\n"),Wl.defines.TANGRAM_EPSILON=1e-5,Wl.defines.TANGRAM_LAYER_DELTA=1/16384,Wl.defines.TANGRAM_TILE_SCALE="vec3(".concat(en.tile_scale,"., ").concat(en.tile_scale,"., u_meters_per_pixel * ").concat(en.tile_size,".)"),Wl.defines.TANGRAM_HEIGHT_SCALE=en.height_scale,Wl.defines.TANGRAM_ALPHA_TEST=.1,uc.dash_textures={}}},{key:"destroy",value:function(t){var e=this;Object.keys(this.styles).forEach(function(i){var r=e.styles[i];r.gl===t&&(En("trace","StyleManager.destroy: destroying render style ".concat(r.name)),r.base&&e.remove(r.name),r.destroy())})}},{key:"register",value:function(t){this.styles[t.name]=t,this.base_styles[t.name]=t}},{key:"remove",value:function(t){delete this.styles[t]}},{key:"mix",value:function(t,e){if(t.mixed)return t;t.mixed={};var i=[];t.mix&&(Array.isArray(t.mix)?i.push.apply(i,Ir(t.mix)):i.push(t.mix),(i=i.map(function(t){return e[t]}).filter(function(e){return e&&e!==t})).forEach(function(e){return t.mixed[e.name]=!0})),i.push(t),t.animated=i.some(function(t){return t&&t.animated}),t.texcoords=i.some(function(t){return t&&t.texcoords}),t.base=i.map(function(t){return t.base}).filter(function(t){return t}).pop(),t.lighting=i.map(function(t){return t.lighting}).filter(function(t){return null!=t}).pop(),t.texture=i.map(function(t){return t.texture}).filter(function(t){return t}).pop(),t.raster=i.map(function(t){return t.raster}).filter(function(t){return null!=t}).pop(),t.dash=i.map(function(t){return t.dash}).filter(function(t){return null!=t}).pop(),t.dash_background_color=i.map(function(t){return t.dash_background_color}).filter(function(t){return null!=t}).pop(),i.some(function(t){return t.hasOwnProperty("blend")&&t.blend})&&(t.blend=i.map(function(t){return t.hasOwnProperty("blend")&&t.blend}).filter(function(t){return t}).pop()),t.blend_order=i.map(function(t){return t.blend_order}).filter(function(t){return null!=t}).pop(),t.defines=Object.assign.apply(Object,[{}].concat(Ir(i.map(function(t){return t.defines}).filter(function(t){return t})))),t.material=Object.assign.apply(Object,[{}].concat(Ir(i.map(function(t){return t.material}).filter(function(t){return t}))));var r=i.map(function(t){return t.draw}).filter(function(t){return t});return 0<r.length&&(t.draw=fl.apply(void 0,[{}].concat(Ir(r)))),this.mixShaders(t,e,i),t}},{key:"mixShaders",value:function(t,e,i){var r={},n=i.map(function(t){return t.shaders}).filter(function(t){return t});if(r.defines=Object.assign.apply(Object,[{}].concat(Ir(n.map(function(t){return t.defines}).filter(function(t){return t})))),r.uniforms={},r._uniforms=t.shaders&&t.shaders.uniforms||{},r._uniform_scopes={},i.filter(function(t){return t.shaders&&t.shaders.uniforms}).forEach(function(t){for(var i in t.shaders.uniforms)!function(i){r._uniform_scopes[i]=t.name,Object.defineProperty(r.uniforms,i,{enumerable:!0,configurable:!0,get:function(){return void 0!==r._uniforms[i]?r._uniforms[i]:e[r._uniform_scopes[i]].shaders.uniforms!==r.uniforms?e[r._uniform_scopes[i]].shaders.uniforms[i]:void 0},set:function(t){r._uniforms[i]=t}})}(i)}),r.extensions=Object.keys(n.map(function(t){return t.extensions}).filter(function(t){return t}).reduce(function(t,e){return"string"==typeof e?t[e]=!0:e.forEach(function(e){return t[e]=!0}),t},{})||{}),t.shaders&&t.shaders.blocks)for(var o in t.shaders.block_scopes=t.shaders.block_scopes||{},t.shaders.blocks){var a,s=t.shaders.blocks[o];t.shaders.block_scopes[o]=t.shaders.block_scopes[o]||[],Array.isArray(s)?(a=t.shaders.block_scopes[o]).push.apply(a,Ir(s.map(function(){return t.name}))):t.shaders.block_scopes[o].push(t.name)}var l={};return n.forEach(function(t){if(t.blocks){r.blocks=r.blocks||{},r.block_scopes=r.block_scopes||{};var e={};for(var i in t.blocks){var n=t.blocks[i],o=t.block_scopes[i];r.blocks[i]=r.blocks[i]||[],r.block_scopes[i]=r.block_scopes[i]||[],n=Array.isArray(n)?n:[n],o=Array.isArray(o)?o:[o];for(var a=0;a<n.length;a++)l[o[a]]||(e[o[a]]=!0,r.blocks[i].push(n[a]),r.block_scopes[i].push(o[a]))}Object.assign(l,e)}}),Object.assign(t.mixed,l),t.shaders=r,t}},{key:"create",value:function(t,e,i){var r=2<arguments.length&&void 0!==i?i:{},n=fl({},e);return n.name=t,(n=this.mix(n,r)).base&&this.base_styles[n.base]?this.styles[t]=n=Object.assign(Object.create(this.base_styles[n.base]),n):n.base=null,n}},{key:"build",value:function(t){var e=this,i=Object.keys(t).sort(function(i,r){return e.inheritanceDepth(i,t)-e.inheritanceDepth(r,t)});for(var r in this.styles)this.base_styles[r]?this.styles[r].reset():delete this.styles[r];var n={};return i.forEach(function(i){n[i]=e.create(i,t[i],n)}),this.styles}},{key:"initStyles",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};for(var i in this.styles)this.styles[i].init(e)}},{key:"inheritanceDepth",value:function(t,e){for(var i=this,r=0;;){var n=e[t];if(!n)break;if(!n.mix)break;if(r++,Array.isArray(n.mix)){r+=Math.max.apply(Math,Ir(n.mix.map(function(r){if(t!==r)return i.inheritanceDepth(r,e)})));break}if(t===n.mix)break;t=n.mix}return r}}]),t}();function Xh(t){return null==t}var Yh={isNothing:Xh,isObject:function(t){return"object"==typeof t&&null!==t},toArray:function(t){return Array.isArray(t)?t:Xh(t)?[]:[t]},repeat:function(t,e){for(var i="",r=0;r<e;r+=1)i+=t;return i},isNegativeZero:function(t){return 0===t&&Number.NEGATIVE_INFINITY===1/t},extend:function(t,e){var i,r,n,o;if(e)for(i=0,r=(o=Object.keys(e)).length;i<r;i+=1)t[n=o[i]]=e[n];return t}};function Kh(t,e){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||"",this.name="YAMLException",this.reason=t,this.mark=e,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():"")}((Kh.prototype=Object.create(Error.prototype)).constructor=Kh).prototype.toString=function(t){var e=this.name+": ";return e+=this.reason||"(unknown reason)",!t&&this.mark&&(e+=" "+this.mark.toString()),e};var Zh=Kh;function Qh(t,e,i,r,n){this.name=t,this.buffer=e,this.position=i,this.line=r,this.column=n}Qh.prototype.getSnippet=function(t,e){var i,r,n,o,a;if(!this.buffer)return null;for(t=t||4,e=e||75,i="",r=this.position;0<r&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(r-1));)if(--r,this.position-r>e/2-1){i=" ... ",r+=5;break}for(n="",o=this.position;o<this.buffer.length&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(o));)if((o+=1)-this.position>e/2-1){n=" ... ",o-=5;break}return a=this.buffer.slice(r,o),Yh.repeat(" ",t)+i+a+n+"\n"+Yh.repeat(" ",t+this.position-r+i.length)+"^"},Qh.prototype.toString=function(t){var e,i="";return this.name&&(i+='in "'+this.name+'" '),i+="at line "+(this.line+1)+", column "+(this.column+1),t||(e=this.getSnippet())&&(i+=":\n"+e),i};var $h=Qh,Jh=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],tf=["scalar","sequence","mapping"];var ef=function(t,e){var i,r;if(e=e||{},Object.keys(e).forEach(function(e){if(-1===Jh.indexOf(e))throw new Zh('Unknown option "'+e+'" is met in definition of "'+t+'" YAML type.')}),this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.defaultStyle=e.defaultStyle||null,this.styleAliases=(i=e.styleAliases||null,r={},null!==i&&Object.keys(i).forEach(function(t){i[t].forEach(function(e){r[String(e)]=t})}),r),-1===tf.indexOf(this.kind))throw new Zh('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')};function rf(t,e,i){var r=[];return t.include.forEach(function(t){i=rf(t,e,i)}),t[e].forEach(function(t){i.forEach(function(e,i){e.tag===t.tag&&r.push(i)}),i.push(t)}),i.filter(function(t,e){return-1===r.indexOf(e)})}function nf(t){this.include=t.include||[],this.implicit=t.implicit||[],this.explicit=t.explicit||[],this.implicit.forEach(function(t){if(t.loadKind&&"scalar"!==t.loadKind)throw new Zh("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=rf(this,"implicit",[]),this.compiledExplicit=rf(this,"explicit",[]),this.compiledTypeMap=function(){var t,e,i={};function r(t){i[t.tag]=t}for(t=0,e=arguments.length;t<e;t+=1)arguments[t].forEach(r);return i}(this.compiledImplicit,this.compiledExplicit)}nf.DEFAULT=null,nf.create=function(t,e){var i,r;switch(arguments.length){case 1:i=nf.DEFAULT,r=t;break;case 2:i=t,r=e;break;default:throw new Zh("Wrong number of arguments for Schema.create function")}if(i=Yh.toArray(i),r=Yh.toArray(r),!i.every(function(t){return t instanceof nf}))throw new Zh("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!r.every(function(t){return t instanceof ef}))throw new Zh("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new nf({include:i,explicit:r})};var of=nf,af=new of({explicit:[new ef("tag:yaml.org,2002:str",{kind:"scalar",construct:function(t){return null!==t?t:""}}),new ef("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(t){return null!==t?t:[]}}),new ef("tag:yaml.org,2002:map",{kind:"mapping",construct:function(t){return null!==t?t:{}}})]});var sf=new ef("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(t){if(null===t)return!0;var e=t.length;return 1===e&&"~"===t||4===e&&("null"===t||"Null"===t||"NULL"===t)},construct:function(){return null},predicate:function(t){return null===t},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"});var lf=new ef("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e=t.length;return 4===e&&("true"===t||"True"===t||"TRUE"===t)||5===e&&("false"===t||"False"===t||"FALSE"===t)},construct:function(t){return"true"===t||"True"===t||"TRUE"===t},predicate:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},represent:{lowercase:function(t){return t?"true":"false"},uppercase:function(t){return t?"TRUE":"FALSE"},camelcase:function(t){return t?"True":"False"}},defaultStyle:"lowercase"});var uf=new ef("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,i,r,n,o=t.length,a=0,s=!1;if(!o)return!1;if("-"!==(e=t[a])&&"+"!==e||(e=t[++a]),"0"===e){if(a+1===o)return!0;if("b"===(e=t[++a])){for(a++;a<o;a++)if("_"!==(e=t[a])){if("0"!==e&&"1"!==e)return!1;s=!0}return s}if("x"===e){for(a++;a<o;a++)if("_"!==(e=t[a])){if(!(48<=(r=t.charCodeAt(a))&&r<=57||65<=r&&r<=70||97<=r&&r<=102))return!1;s=!0}return s}for(;a<o;a++)if("_"!==(e=t[a])){if(!(48<=(i=t.charCodeAt(a))&&i<=55))return!1;s=!0}return s}for(;a<o;a++)if("_"!==(e=t[a])){if(":"===e)break;if(!(48<=(n=t.charCodeAt(a))&&n<=57))return!1;s=!0}return!!s&&(":"!==e||/^(:[0-5]?[0-9])+$/.test(t.slice(a)))},construct:function(t){var e,i,r=t,n=1,o=[];return-1!==r.indexOf("_")&&(r=r.replace(/_/g,"")),"-"!==(e=r[0])&&"+"!==e||("-"===e&&(n=-1),e=(r=r.slice(1))[0]),"0"===r?0:"0"===e?"b"===r[1]?n*parseInt(r.slice(2),2):"x"===r[1]?n*parseInt(r,16):n*parseInt(r,8):-1!==r.indexOf(":")?(r.split(":").forEach(function(t){o.unshift(parseInt(t,10))}),r=0,i=1,o.forEach(function(t){r+=t*i,i*=60}),n*r):n*parseInt(r,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&t%1==0&&!Yh.isNegativeZero(t)},represent:{binary:function(t){return"0b"+t.toString(2)},octal:function(t){return"0"+t.toString(8)},decimal:function(t){return t.toString(10)},hexadecimal:function(t){return"0x"+t.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),cf=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)\\.[0-9_]*(?:[eE][-+][0-9]+)?|\\.[0-9_]+(?:[eE][-+][0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");var hf=/^[-+]?[0-9]+e/;var ff=new of({include:[af],implicit:[sf,lf,uf,new ef("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(t){return null!==t&&!!cf.test(t)},construct:function(t){var e,i=t.replace(/_/g,"").toLowerCase(),r="-"===i[0]?-1:1,n=[];return 0<="+-".indexOf(i[0])&&(i=i.slice(1)),".inf"===i?1==r?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===i?NaN:0<=i.indexOf(":")?(i.split(":").forEach(function(t){n.unshift(parseFloat(t,10))}),i=0,e=1,n.forEach(function(t){i+=t*e,e*=60}),r*i):r*parseFloat(i,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&(t%1!=0||Yh.isNegativeZero(t))},represent:function(t,e){var i;if(isNaN(t))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===t)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===t)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Yh.isNegativeZero(t))return"-0.0";return i=t.toString(10),hf.test(i)?i.replace("e",".e"):i},defaultStyle:"lowercase"})]}),pf=new of({include:[ff]}),df=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?)?$");var yf=new ef("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(t){return null!==t&&null!==df.exec(t)},construct:function(t){var e,i,r,n,o,a,s,l=0,u=null,c=df.exec(t);if(null===c)throw new Error("Date resolve error");if(e=+c[1],i=c[2]-1,r=+c[3],!c[4])return new Date(Date.UTC(e,i,r));if(n=+c[4],o=+c[5],a=+c[6],c[7]){for(l=c[7].slice(0,3);l.length<3;)l+="0";l=+l}return c[9]&&(u=6e4*(60*+c[10]+ +(c[11]||0)),"-"===c[9]&&(u=-u)),s=new Date(Date.UTC(e,i,r,n,o,a,l)),u&&s.setTime(s.getTime()-u),s},instanceOf:Date,represent:function(t){return t.toISOString()}});var gf=new ef("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(t){return"<<"===t||null===t}}),vf=ds.Buffer,_f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";var mf=new ef("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(t){if(null===t)return!1;for(var e,i=0,r=t.length,n=_f,o=0;o<r;o++)if(!(64<(e=n.indexOf(t.charAt(o))))){if(e<0)return!1;i+=6}return i%8==0},construct:function(t){for(var e,i=t.replace(/[\r\n=]/g,""),r=i.length,n=_f,o=0,a=[],s=0;s<r;s++)s%4==0&&s&&(a.push(o>>16&255),a.push(o>>8&255),a.push(255&o)),o=o<<6|n.indexOf(i.charAt(s));return 0==(e=r%4*6)?(a.push(o>>16&255),a.push(o>>8&255),a.push(255&o)):18==e?(a.push(o>>10&255),a.push(o>>2&255)):12==e&&a.push(o>>4&255),vf?new vf(a):a},predicate:function(t){return vf&&vf.isBuffer(t)},represent:function(t){for(var e,i="",r=0,n=t.length,o=_f,a=0;a<n;a++)a%3==0&&a&&(i+=o[r>>18&63],i+=o[r>>12&63],i+=o[r>>6&63],i+=o[63&r]),r=(r<<8)+t[a];return 0==(e=n%3)?(i+=o[r>>18&63],i+=o[r>>12&63],i+=o[r>>6&63],i+=o[63&r]):2==e?(i+=o[r>>10&63],i+=o[r>>4&63],i+=o[r<<2&63],i+=o[64]):1==e&&(i+=o[r>>2&63],i+=o[r<<4&63],i+=o[64],i+=o[64]),i}}),bf=Object.prototype.hasOwnProperty,xf=Object.prototype.toString;var wf=new ef("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(t){if(null===t)return!0;for(var e,i,r,n=[],o=t,a=0,s=o.length;a<s;a+=1){if(e=o[a],r=!1,"[object Object]"!==xf.call(e))return!1;for(i in e)if(bf.call(e,i)){if(r)return!1;r=!0}if(!r)return!1;if(-1!==n.indexOf(i))return!1;n.push(i)}return!0},construct:function(t){return null!==t?t:[]}}),kf=Object.prototype.toString;var Af=new ef("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(t){if(null===t)return!0;for(var e,i,r=t,n=new Array(r.length),o=0,a=r.length;o<a;o+=1){if(e=r[o],"[object Object]"!==kf.call(e))return!1;if(1!==(i=Object.keys(e)).length)return!1;n[o]=[i[0],e[i[0]]]}return!0},construct:function(t){if(null===t)return[];for(var e,i,r=t,n=new Array(r.length),o=0,a=r.length;o<a;o+=1)e=r[o],i=Object.keys(e),n[o]=[i[0],e[i[0]]];return n}}),Tf=Object.prototype.hasOwnProperty;var Ef=new of({include:[pf],implicit:[yf,gf],explicit:[mf,wf,Af,new ef("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(t){if(null===t)return!0;var e,i=t;for(e in i)if(Tf.call(i,e)&&null!==i[e])return!1;return!0},construct:function(t){return null!==t?t:{}}})]});var Mf=new ef("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(t){return void 0===t},represent:function(){return""}});var Sf=new ef("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(t){if(null===t)return!1;if(0===t.length)return!1;var e=t,i=/\/([gim]*)$/.exec(t),r="";if("/"===e[0]){if(i&&(r=i[1]),3<r.length)return!1;if("/"!==e[e.length-r.length-1])return!1}return!0},construct:function(t){var e=t,i=/\/([gim]*)$/.exec(t),r="";return"/"===e[0]&&(i&&(r=i[1]),e=e.slice(1,e.length-r.length-1)),new RegExp(e,r)},predicate:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},represent:function(t){var e="/"+t.source+"/";return t.global&&(e+="g"),t.multiline&&(e+="m"),t.ignoreCase&&(e+="i"),e}});try{var Rf=function(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}()}catch(o){"undefined"!=typeof window&&(Rf=window.esprima)}var Pf=new ef("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(t){if(null===t)return!1;try{var e="("+t+")",i=Rf.parse(e,{range:!0});return"Program"!==i.type||1!==i.body.length||"ExpressionStatement"!==i.body[0].type||"FunctionExpression"!==i.body[0].expression.type?!1:!0}catch(t){return!1}},construct:function(t){var e,i="("+t+")",r=Rf.parse(i,{range:!0}),n=[];if("Program"!==r.type||1!==r.body.length||"ExpressionStatement"!==r.body[0].type||"FunctionExpression"!==r.body[0].expression.type)throw new Error("Failed to resolve function");return r.body[0].expression.params.forEach(function(t){n.push(t.name)}),e=r.body[0].expression.body.range,new Function(n,i.slice(e[0]+1,e[1]-1))},predicate:function(t){return"[object Function]"===Object.prototype.toString.call(t)},represent:function(t){return t.toString()}}),Of=of.DEFAULT=new of({include:[Ef],explicit:[Mf,Sf,Pf]}),Cf=Object.prototype.hasOwnProperty,Lf=1,If=2,jf=3,Nf=4,zf=1,Df=2,Ff=3,Uf=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Bf=/[\x85\u2028\u2029]/,Gf=/[,\[\]\{\}]/,Hf=/^(?:!|!!|![a-z\-]+!)$/i,Vf=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function qf(t){return 10===t||13===t}function Wf(t){return 9===t||32===t}function Xf(t){return 9===t||32===t||10===t||13===t}function Yf(t){return 44===t||91===t||93===t||123===t||125===t}function Kf(t){return 48===t?"\0":97===t?"":98===t?"\b":116===t||9===t?"\t":110===t?"\n":118===t?"\v":102===t?"\f":114===t?"\r":101===t?"":32===t?" ":34===t?'"':47===t?"/":92===t?"\\":78===t?"":95===t?" ":76===t?"\u2028":80===t?"\u2029":""}for(var Zf=new Array(256),Qf=new Array(256),$f=0;$f<256;$f++)Zf[$f]=Kf($f)?1:0,Qf[$f]=Kf($f);function Jf(t,e){this.input=t,this.filename=e.filename||null,this.schema=e.schema||Of,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=t.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function tp(t,e){return new Zh(e,new $h(t.filename,t.input,t.position,t.line,t.position-t.lineStart))}function ep(t,e){throw tp(t,e)}function ip(t,e){t.onWarning&&t.onWarning.call(null,tp(t,e))}var rp={YAML:function(t,e,i){var r,n,o;null!==t.version&&ep(t,"duplication of %YAML directive"),1!==i.length&&ep(t,"YAML directive accepts exactly one argument"),null===(r=/^([0-9]+)\.([0-9]+)$/.exec(i[0]))&&ep(t,"ill-formed argument of the YAML directive"),n=parseInt(r[1],10),o=parseInt(r[2],10),1!==n&&ep(t,"unacceptable YAML version of the document"),t.version=i[0],t.checkLineBreaks=o<2,1!==o&&2!==o&&ip(t,"unsupported YAML version of the document")},TAG:function(t,e,i){var r,n;2!==i.length&&ep(t,"TAG directive accepts exactly two arguments"),r=i[0],n=i[1],Hf.test(r)||ep(t,"ill-formed tag handle (first argument) of the TAG directive"),Cf.call(t.tagMap,r)&&ep(t,'there is a previously declared suffix for "'+r+'" tag handle'),Vf.test(n)||ep(t,"ill-formed tag prefix (second argument) of the TAG directive"),t.tagMap[r]=n}};function np(t,e,i,r){var n,o,a,s;if(e<i){if(s=t.input.slice(e,i),r)for(n=0,o=s.length;n<o;n+=1)9===(a=s.charCodeAt(n))||32<=a&&a<=1114111||ep(t,"expected valid JSON character");else Uf.test(s)&&ep(t,"the stream contains non-printable characters");t.result+=s}}function op(t,e,i,r){var n,o,a,s;for(Yh.isObject(i)||ep(t,"cannot merge mappings; the provided source object is unacceptable"),a=0,s=(n=Object.keys(i)).length;a<s;a+=1)o=n[a],Cf.call(e,o)||(e[o]=i[o],r[o]=!0)}function ap(t,e,i,r,n,o){var a,s;if(n=String(n),null===e&&(e={}),"tag:yaml.org,2002:merge"===r)if(Array.isArray(o))for(a=0,s=o.length;a<s;a+=1)op(t,e,o[a],i);else op(t,e,o,i);else t.json||Cf.call(i,n)||!Cf.call(e,n)||ep(t,"duplicated mapping key"),e[n]=o,delete i[n];return e}function sp(t){var e=t.input.charCodeAt(t.position);10===e?t.position++:13===e?(t.position++,10===t.input.charCodeAt(t.position)&&t.position++):ep(t,"a line break is expected"),t.line+=1,t.lineStart=t.position}function lp(t,e,i){for(var r=0,n=t.input.charCodeAt(t.position);0!==n;){for(;Wf(n);)n=t.input.charCodeAt(++t.position);if(e&&35===n)for(;10!==(n=t.input.charCodeAt(++t.position))&&13!==n&&0!==n;);if(!qf(n))break;for(sp(t),n=t.input.charCodeAt(t.position),r++,t.lineIndent=0;32===n;)t.lineIndent++,n=t.input.charCodeAt(++t.position)}return-1!==i&&0!==r&&t.lineIndent<i&&ip(t,"deficient indentation"),r}function up(t){var e=t.position,i=t.input.charCodeAt(e);return 45!==i&&46!==i||i!==t.input.charCodeAt(e+1)||i!==t.input.charCodeAt(e+2)||(e+=3,0!==(i=t.input.charCodeAt(e))&&!Xf(i))?void 0:1}function cp(t,e){1===e?t.result+=" ":1<e&&(t.result+=Yh.repeat("\n",e-1))}function hp(t,e){var i,r,n,o,a,s,l,u,c,h=t.input.charCodeAt(t.position);if(34===h){for(t.kind="scalar",t.result="",t.position++,i=r=t.position;0!==(h=t.input.charCodeAt(t.position));){if(34===h)return np(t,i,t.position,!0),t.position++,1;if(92===h){if(np(t,i,t.position,!0),qf(h=t.input.charCodeAt(++t.position)))lp(t,!1,e);else if(h<256&&Zf[h])t.result+=Qf[h],t.position++;else if(0<(a=120===(c=h)?2:117===c?4:85===c?8:0)){for(n=a,o=0;0<n;n--)h=t.input.charCodeAt(++t.position),u=void 0,0<=(a=48<=(l=h)&&l<=57?l-48:97<=(u=32|l)&&u<=102?u-97+10:-1)?o=(o<<4)+a:ep(t,"expected hexadecimal character");t.result+=(s=o)<=65535?String.fromCharCode(s):String.fromCharCode(55296+(s-65536>>10),56320+(s-65536&1023)),t.position++}else ep(t,"unknown escape sequence");i=r=t.position}else qf(h)?(np(t,i,r,!0),cp(t,lp(t,!1,e)),i=r=t.position):t.position===t.lineStart&&up(t)?ep(t,"unexpected end of the document within a double quoted scalar"):(t.position++,r=t.position)}ep(t,"unexpected end of the stream within a double quoted scalar")}}function fp(t,e){var i,r,n=t.tag,o=t.anchor,a=[],s=!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=a),r=t.input.charCodeAt(t.position);0!==r&&45===r&&Xf(t.input.charCodeAt(t.position+1));)if(s=!0,t.position++,lp(t,!0,-1)&&t.lineIndent<=e)a.push(null),r=t.input.charCodeAt(t.position);else if(i=t.line,pp(t,e,jf,!1,!0),a.push(t.result),lp(t,!0,-1),r=t.input.charCodeAt(t.position),(t.line===i||t.lineIndent>e)&&0!==r)ep(t,"bad indentation of a sequence entry");else if(t.lineIndent<e)break;return!!s&&(t.tag=n,t.anchor=o,t.kind="sequence",t.result=a,!0)}function pp(t,e,i,r,n){var o,a,s,l,u,c,h,f,p=1,d=!1,y=!1;if(null!==t.listener&&t.listener("open",t),t.tag=null,t.anchor=null,t.kind=null,t.result=null,o=a=s=Nf===i||jf===i,r&&lp(t,!0,-1)&&(d=!0,t.lineIndent>e?p=1:t.lineIndent===e?p=0:t.lineIndent<e&&(p=-1)),1===p)for(;function(t){var e,i,r,n=!1,o=!1,a=t.input.charCodeAt(t.position);if(33===a){if(null!==t.tag&&ep(t,"duplication of a tag property"),60===(a=t.input.charCodeAt(++t.position))?(n=!0,a=t.input.charCodeAt(++t.position)):33===a?(o=!0,i="!!",a=t.input.charCodeAt(++t.position)):i="!",e=t.position,n){for(;0!==(a=t.input.charCodeAt(++t.position))&&62!==a;);t.position<t.length?(r=t.input.slice(e,t.position),a=t.input.charCodeAt(++t.position)):ep(t,"unexpected end of the stream within a verbatim tag")}else{for(;0!==a&&!Xf(a);)33===a&&(o?ep(t,"tag suffix cannot contain exclamation marks"):(i=t.input.slice(e-1,t.position+1),Hf.test(i)||ep(t,"named tag handle cannot contain such characters"),o=!0,e=t.position+1)),a=t.input.charCodeAt(++t.position);r=t.input.slice(e,t.position),Gf.test(r)&&ep(t,"tag suffix cannot contain flow indicator characters")}return r&&!Vf.test(r)&&ep(t,"tag name cannot contain such characters: "+r),n?t.tag=r:Cf.call(t.tagMap,i)?t.tag=t.tagMap[i]+r:"!"===i?t.tag="!"+r:"!!"===i?t.tag="tag:yaml.org,2002:"+r:ep(t,'undeclared tag handle "'+i+'"'),1}}(t)||function(t){var e,i=t.input.charCodeAt(t.position);if(38===i){for(null!==t.anchor&&ep(t,"duplication of an anchor property"),i=t.input.charCodeAt(++t.position),e=t.position;0!==i&&!Xf(i)&&!Yf(i);)i=t.input.charCodeAt(++t.position);return t.position===e&&ep(t,"name of an anchor node must contain at least one character"),t.anchor=t.input.slice(e,t.position),1}}(t);)lp(t,!0,-1)?(d=!0,s=o,t.lineIndent>e?p=1:t.lineIndent===e?p=0:t.lineIndent<e&&(p=-1)):s=!1;if(s=s&&(d||n),1!==p&&Nf!==i||(h=Lf===i||If===i?e:e+1,f=t.position-t.lineStart,1===p?s&&(fp(t,f)||function(t,e,i){var r,n,o,a,s=t.tag,l=t.anchor,u={},c={},h=null,f=null,p=null,d=!1,y=!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=u),a=t.input.charCodeAt(t.position);0!==a;){if(r=t.input.charCodeAt(t.position+1),o=t.line,63!==a&&58!==a||!Xf(r)){if(!pp(t,i,If,!1,!0))break;if(t.line===o){for(a=t.input.charCodeAt(t.position);Wf(a);)a=t.input.charCodeAt(++t.position);if(58===a)Xf(a=t.input.charCodeAt(++t.position))||ep(t,"a whitespace character is expected after the key-value separator within a block mapping"),d&&(ap(t,u,c,h,f,null),h=f=p=null),n=d=!(y=!0),h=t.tag,f=t.result;else{if(!y)return t.tag=s,t.anchor=l,1;ep(t,"can not read an implicit mapping pair; a colon is missed")}}else{if(!y)return t.tag=s,t.anchor=l,1;ep(t,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===a?(d&&(ap(t,u,c,h,f,null),h=f=p=null),n=d=y=!0):d?n=!(d=!1):ep(t,"incomplete explicit mapping pair; a key node is missed"),t.position+=1,a=r;if((t.line===o||t.lineIndent>e)&&(pp(t,e,Nf,!0,n)&&(d?f=t.result:p=t.result),d||(ap(t,u,c,h,f,p),h=f=p=null),lp(t,!0,-1),a=t.input.charCodeAt(t.position)),t.lineIndent>e&&0!==a)ep(t,"bad indentation of a mapping entry");else if(t.lineIndent<e)break}return d&&ap(t,u,c,h,f,null),y&&(t.tag=s,t.anchor=l,t.kind="mapping",t.result=u),y}(t,f,h))||function(t,e){var i,r,n,o,a,s,l,u,c,h=!0,f=t.tag,p=t.anchor,d={},y=t.input.charCodeAt(t.position);if(91===y)s=!(n=93),r=[];else{if(123!==y)return;n=125,s=!0,r={}}for(null!==t.anchor&&(t.anchorMap[t.anchor]=r),y=t.input.charCodeAt(++t.position);0!==y;){if(lp(t,!0,e),(y=t.input.charCodeAt(t.position))===n)return t.position++,t.tag=f,t.anchor=p,t.kind=s?"mapping":"sequence",t.result=r,1;h||ep(t,"missed comma between flow collection entries"),c=null,o=a=!1,63===y&&Xf(t.input.charCodeAt(t.position+1))&&(o=a=!0,t.position++,lp(t,!0,e)),i=t.line,pp(t,e,Lf,!1,!0),u=t.tag,l=t.result,lp(t,!0,e),y=t.input.charCodeAt(t.position),!a&&t.line!==i||58!==y||(o=!0,y=t.input.charCodeAt(++t.position),lp(t,!0,e),pp(t,e,Lf,!1,!0),c=t.result),s?ap(t,r,d,u,l,c):o?r.push(ap(t,null,d,u,l,c)):r.push(l),lp(t,!0,e),44===(y=t.input.charCodeAt(t.position))?(h=!0,y=t.input.charCodeAt(++t.position)):h=!1}ep(t,"unexpected end of the stream within a flow collection")}(t,h)?y=!0:(a&&function(t,e){var i,r,n,o,a=zf,s=!1,l=e,u=0,c=!1,h=t.input.charCodeAt(t.position);if(124===h)r=!1;else{if(62!==h)return;r=!0}for(t.kind="scalar",t.result="";0!==h;)if(43===(h=t.input.charCodeAt(++t.position))||45===h)zf===a?a=43===h?Ff:Df:ep(t,"repeat of a chomping mode identifier");else{if(!(0<=(n=48<=(o=h)&&o<=57?o-48:-1)))break;0==n?ep(t,"bad explicit indentation width of a block scalar; it cannot be less than one"):s?ep(t,"repeat of an indentation width identifier"):(l=e+n-1,s=!0)}if(Wf(h)){for(;Wf(h=t.input.charCodeAt(++t.position)););if(35===h)for(;!qf(h=t.input.charCodeAt(++t.position))&&0!==h;);}for(;0!==h;){for(sp(t),t.lineIndent=0,h=t.input.charCodeAt(t.position);(!s||t.lineIndent<l)&&32===h;)t.lineIndent++,h=t.input.charCodeAt(++t.position);if(!s&&t.lineIndent>l&&(l=t.lineIndent),qf(h))u++;else{if(t.lineIndent<l){a===Ff?t.result+=Yh.repeat("\n",u):a===zf&&s&&(t.result+="\n");break}for(r?Wf(h)?(c=!0,t.result+=Yh.repeat("\n",u+1)):c?(c=!1,t.result+=Yh.repeat("\n",u+1)):0===u?s&&(t.result+=" "):t.result+=Yh.repeat("\n",u):t.result+=s?Yh.repeat("\n",u+1):Yh.repeat("\n",u),s=!0,u=0,i=t.position;!qf(h)&&0!==h;)h=t.input.charCodeAt(++t.position);np(t,i,t.position,!1)}}return 1}(t,h)||function(t,e){var i,r,n=t.input.charCodeAt(t.position);if(39===n){for(t.kind="scalar",t.result="",t.position++,i=r=t.position;0!==(n=t.input.charCodeAt(t.position));)if(39===n){if(np(t,i,t.position,!0),39!==(n=t.input.charCodeAt(++t.position)))return 1;i=r=t.position,t.position++}else qf(n)?(np(t,i,r,!0),cp(t,lp(t,!1,e)),i=r=t.position):t.position===t.lineStart&&up(t)?ep(t,"unexpected end of the document within a single quoted scalar"):(t.position++,r=t.position);ep(t,"unexpected end of the stream within a single quoted scalar")}}(t,h)||hp(t,h)?y=!0:!function(t){var e,i,r=t.input.charCodeAt(t.position);if(42===r){for(r=t.input.charCodeAt(++t.position),e=t.position;0!==r&&!Xf(r)&&!Yf(r);)r=t.input.charCodeAt(++t.position);return t.position===e&&ep(t,"name of an alias node must contain at least one character"),i=t.input.slice(e,t.position),t.anchorMap.hasOwnProperty(i)||ep(t,'unidentified alias "'+i+'"'),t.result=t.anchorMap[i],lp(t,!0,-1),1}}(t)?function(t,e,i){var r,n,o,a,s,l,u,c=t.kind,h=t.result,f=t.input.charCodeAt(t.position);if(!Xf(f)&&!Yf(f)&&35!==f&&38!==f&&42!==f&&33!==f&&124!==f&&62!==f&&39!==f&&34!==f&&37!==f&&64!==f&&96!==f&&(63!==f&&45!==f||!(Xf(r=t.input.charCodeAt(t.position+1))||i&&Yf(r)))){for(t.kind="scalar",t.result="",n=o=t.position,a=!1;0!==f;){if(58===f){if(Xf(r=t.input.charCodeAt(t.position+1))||i&&Yf(r))break}else if(35===f){if(Xf(t.input.charCodeAt(t.position-1)))break}else{if(t.position===t.lineStart&&up(t)||i&&Yf(f))break;if(qf(f)){if(s=t.line,l=t.lineStart,u=t.lineIndent,lp(t,!1,-1),t.lineIndent>=e){a=!0,f=t.input.charCodeAt(t.position);continue}t.position=o,t.line=s,t.lineStart=l,t.lineIndent=u;break}}a&&(np(t,n,o,!1),cp(t,t.line-s),n=o=t.position,a=!1),Wf(f)||(o=t.position+1),f=t.input.charCodeAt(++t.position)}if(np(t,n,o,!1),t.result)return 1;t.kind=c,t.result=h}}(t,h,Lf===i)&&(y=!0,null===t.tag&&(t.tag="?")):(y=!0,null===t.tag&&null===t.anchor||ep(t,"alias node should not have any properties")),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):0===p&&(y=s&&fp(t,f))),null!==t.tag&&"!"!==t.tag)if("?"===t.tag){for(l=0,u=t.implicitTypes.length;l<u;l+=1)if((c=t.implicitTypes[l]).resolve(t.result)){t.result=c.construct(t.result),t.tag=c.tag,null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);break}}else Cf.call(t.typeMap,t.tag)?(c=t.typeMap[t.tag],null!==t.result&&c.kind!==t.kind&&ep(t,"unacceptable node kind for !<"+t.tag+'> tag; it should be "'+c.kind+'", not "'+t.kind+'"'),c.resolve(t.result)?(t.result=c.construct(t.result),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):ep(t,"cannot resolve a node with !<"+t.tag+"> explicit tag")):ep(t,"unknown tag !<"+t.tag+">");return null!==t.listener&&t.listener("close",t),null!==t.tag||null!==t.anchor||y}function dp(t,e){e=e||{},0!==(t=String(t)).length&&(10!==t.charCodeAt(t.length-1)&&13!==t.charCodeAt(t.length-1)&&(t+="\n"),65279===t.charCodeAt(0)&&(t=t.slice(1)));var i=new Jf(t,e);for(i.input+="\0";32===i.input.charCodeAt(i.position);)i.lineIndent+=1,i.position+=1;for(;i.position<i.length-1;)!function(t){var e,i,r,n,o=t.position,a=!1;for(t.version=null,t.checkLineBreaks=t.legacy,t.tagMap={},t.anchorMap={};0!==(n=t.input.charCodeAt(t.position))&&(lp(t,!0,-1),n=t.input.charCodeAt(t.position),!(0<t.lineIndent||37!==n));){for(a=!0,n=t.input.charCodeAt(++t.position),e=t.position;0!==n&&!Xf(n);)n=t.input.charCodeAt(++t.position);for(r=[],(i=t.input.slice(e,t.position)).length<1&&ep(t,"directive name must not be less than one character in length");0!==n;){for(;Wf(n);)n=t.input.charCodeAt(++t.position);if(35===n){for(;0!==(n=t.input.charCodeAt(++t.position))&&!qf(n););break}if(qf(n))break;for(e=t.position;0!==n&&!Xf(n);)n=t.input.charCodeAt(++t.position);r.push(t.input.slice(e,t.position))}0!==n&&sp(t),Cf.call(rp,i)?rp[i](t,i,r):ip(t,'unknown document directive "'+i+'"')}lp(t,!0,-1),0===t.lineIndent&&45===t.input.charCodeAt(t.position)&&45===t.input.charCodeAt(t.position+1)&&45===t.input.charCodeAt(t.position+2)?(t.position+=3,lp(t,!0,-1)):a&&ep(t,"directives end mark is expected"),pp(t,t.lineIndent-1,Nf,!1,!0),lp(t,!0,-1),t.checkLineBreaks&&Bf.test(t.input.slice(o,t.position))&&ip(t,"non-ASCII line breaks are interpreted as content"),t.documents.push(t.result),t.position===t.lineStart&&up(t)?46===t.input.charCodeAt(t.position)&&(t.position+=3,lp(t,!0,-1)):t.position<t.length-1&&ep(t,"end of the stream or a document separator is expected")}(i);return i.documents}function yp(t,e,i){for(var r=dp(t,i),n=0,o=r.length;n<o;n+=1)e(r[n])}function gp(t,e){var i=dp(t,e);if(0!==i.length){if(1===i.length)return i[0];throw new Zh("expected a single document in the stream, but found more")}}var vp={loadAll:yp,load:gp,safeLoadAll:function(t,e,i){yp(t,e,Yh.extend({schema:Ef},i))},safeLoad:function(t,e){return gp(t,Yh.extend({schema:Ef},e))}},_p=Object.prototype.toString,mp=Object.prototype.hasOwnProperty,bp=9,xp=10,wp=13,kp=32,Ap=33,Tp=34,Ep=35,Mp=37,Sp=38,Rp=39,Pp=42,Op=44,Cp=45,Lp=58,Ip=62,jp=63,Np=64,zp=91,Dp=93,Fp=96,Up=123,Bp=124,Gp=125,Hp={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},Vp=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function qp(t){this.schema=t.schema||Of,this.indent=Math.max(1,t.indent||2),this.skipInvalid=t.skipInvalid||!1,this.flowLevel=Yh.isNothing(t.flowLevel)?-1:t.flowLevel,this.styleMap=function(t,e){var i,r,n,o,a,s,l;if(null===e)return{};for(i={},n=0,o=(r=Object.keys(e)).length;n<o;n+=1)a=r[n],s=String(e[a]),"!!"===a.slice(0,2)&&(a="tag:yaml.org,2002:"+a.slice(2)),(l=t.compiledTypeMap[a])&&mp.call(l.styleAliases,s)&&(s=l.styleAliases[s]),i[a]=s;return i}(this.schema,t.styles||null),this.sortKeys=t.sortKeys||!1,this.lineWidth=t.lineWidth||80,this.noRefs=t.noRefs||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Wp(t,e){for(var i,r=Yh.repeat(" ",e),n=0,o=-1,a="",s=t.length;n<s;)n=-1===(o=t.indexOf("\n",n))?(i=t.slice(n),s):(i=t.slice(n,o+1),o+1),i.length&&"\n"!==i&&(a+=r),a+=i;return a}function Xp(t,e){return"\n"+Yh.repeat(" ",t.indent*e)}function Yp(t){this.source=t,this.result="",this.checkpoint=0}function Kp(t,e,i,r){var n,o,a,s,l,u,c,h,f,p,d,y,g,v,_,m,b,x,w,k,A;if(0!==e.length)if(-1===Vp.indexOf(e)){for(n=!0,o=e.length?e.charCodeAt(0):0,a=kp===o||kp===e.charCodeAt(e.length-1),Cp!==o&&jp!==o&&Np!==o&&Fp!==o||(n=!1),l=s=a||-1<t.flowLevel&&t.flowLevel<=i?(a&&(n=!1),!1):!r,u=!0,c=new Yp(e),h=!1,p=f=0,d=t.indent*i,-1===(y=t.lineWidth)&&(y=9007199254740991),d<40?y-=d:y=40,v=0;v<e.length;v++){if(g=e.charCodeAt(v),n){if(bp!==(A=g)&&xp!==A&&wp!==A&&Op!==A&&zp!==A&&Dp!==A&&Up!==A&&Gp!==A&&Ep!==A&&Sp!==A&&Pp!==A&&Ap!==A&&Bp!==A&&Ip!==A&&Rp!==A&&Tp!==A&&Mp!==A&&Lp!==A&&!Hp[A]&&!Qp(A))continue;n=!1}u&&g===Rp&&(u=!1),_=Hp[g],m=Qp(g),(_||m)&&(g!==xp&&g!==Tp&&g!==Rp?l=s=!1:g===xp&&(u=!(h=!0),0<v&&e.charCodeAt(v-1)===kp&&(s=l=!1),s&&(b=v-f,f=v,p<b&&(p=b))),g!==Tp&&(u=!1),c.takeUpTo(v),c.escapeChar())}if(n&&function(t,e){for(var i=0,r=t.implicitTypes.length;i<r;i+=1)if(t.implicitTypes[i].resolve(e))return 1}(t,e)&&(n=!1),x="",(s||l)&&(w=0,e.charCodeAt(e.length-1)===xp&&(w+=1,e.charCodeAt(e.length-2)===xp&&(w+=1)),0===w?x="-":2===w&&(x="+")),(l&&p<y||null!==t.tag)&&(s=!1),h||(l=!1),n)t.dump=e;else if(u)t.dump="'"+e+"'";else if(s)k=function(t,e){var i,r="",n=0,o=t.length,a=/\n+$/.exec(t);a&&(o=a.index+1);for(;n<o;)i=t.indexOf("\n",n),n=o<i||-1===i?(r&&(r+="\n\n"),r+=Zp(t.slice(n,o),e),o):(r&&(r+="\n\n"),r+=Zp(t.slice(n,i),e),i+1);a&&"\n"!==a[0]&&(r+=a[0]);return r}(e,y),t.dump=">"+x+"\n"+Wp(k,d);else if(l)x||(e=e.replace(/\n$/,"")),t.dump="|"+x+"\n"+Wp(e,d);else{if(!c)throw new Error("Failed to dump scalar value");c.finish(),t.dump='"'+c.result+'"'}}else t.dump="'"+e+"'";else t.dump="''"}function Zp(t,e){if(""===t)return t;for(var i,r,n=/[^\s] [^\s]/g,o="",a=0,s=0,l=n.exec(t);l;)e<(i=l.index)-s&&(r=a!==s?a:i,o&&(o+="\n"),o+=t.slice(s,r),s=r+1),a=i+1,l=n.exec(t);return o&&(o+="\n"),s!==a&&t.length-s>e?o+=t.slice(s,a)+"\n"+t.slice(a+1):o+=t.slice(s),o}function Qp(t){return!(32<=t&&t<=126||133===t||160<=t&&t<=55295||57344<=t&&t<=65533||65536<=t&&t<=1114111)}function $p(t,e,i){for(var r,n,o,a=i?t.explicitTypes:t.implicitTypes,s=0,l=a.length;s<l;s+=1)if(((n=a[s]).instanceOf||n.predicate)&&(!n.instanceOf||"object"==typeof e&&e instanceof n.instanceOf)&&(!n.predicate||n.predicate(e))){if(t.tag=i?n.tag:"?",n.represent){if(o=t.styleMap[n.tag]||n.defaultStyle,"[object Function]"===_p.call(n.represent))r=n.represent(e,o);else{if(!mp.call(n.represent,o))throw new Zh("!<"+n.tag+'> tag resolver accepts not "'+o+'" style');r=n.represent[o](e,o)}t.dump=r}return 1}}function Jp(t,e,i,r,n,o){t.tag=null,t.dump=i,$p(t,i,!1)||$p(t,i,!0);var a=_p.call(t.dump);r=r&&(t.flowLevel<0||t.flowLevel>e);var s,l,u="[object Object]"===a||"[object Array]"===a;if(u&&(l=-1!==(s=t.duplicates.indexOf(i))),(null!==t.tag&&"?"!==t.tag||l||2!==t.indent&&0<e)&&(n=!1),l&&t.usedDuplicates[s])t.dump="*ref_"+s;else{if(u&&l&&!t.usedDuplicates[s]&&(t.usedDuplicates[s]=!0),"[object Object]"===a)r&&0!==Object.keys(t.dump).length?(function(t,e,i,r){var n,o,a,s,l,u,c="",h=t.tag,f=Object.keys(i);if(!0===t.sortKeys)f.sort();else if("function"==typeof t.sortKeys)f.sort(t.sortKeys);else if(t.sortKeys)throw new Zh("sortKeys must be a boolean or a function");for(n=0,o=f.length;n<o;n+=1)u="",r&&0===n||(u+=Xp(t,e)),s=i[a=f[n]],Jp(t,e+1,a,!0,!0,!0)&&((l=null!==t.tag&&"?"!==t.tag||t.dump&&1024<t.dump.length)&&(t.dump&&xp===t.dump.charCodeAt(0)?u+="?":u+="? "),u+=t.dump,l&&(u+=Xp(t,e)),Jp(t,e+1,s,!0,l)&&(t.dump&&xp===t.dump.charCodeAt(0)?u+=":":u+=": ",c+=u+=t.dump));t.tag=h,t.dump=c||"{}"}(t,e,t.dump,n),l&&(t.dump="&ref_"+s+t.dump)):(function(t,e,i){for(var r,n,o,a="",s=t.tag,l=Object.keys(i),u=0,c=l.length;u<c;u+=1)o="",0!==u&&(o+=", "),n=i[r=l[u]],Jp(t,e,r,!1,!1)&&(1024<t.dump.length&&(o+="? "),o+=t.dump+": ",Jp(t,e,n,!1,!1)&&(a+=o+=t.dump));t.tag=s,t.dump="{"+a+"}"}(t,e,t.dump),l&&(t.dump="&ref_"+s+" "+t.dump));else if("[object Array]"===a)r&&0!==t.dump.length?(function(t,e,i,r){for(var n="",o=t.tag,a=0,s=i.length;a<s;a+=1)Jp(t,e+1,i[a],!0,!0)&&(r&&0===a||(n+=Xp(t,e)),n+="- "+t.dump);t.tag=o,t.dump=n||"[]"}(t,e,t.dump,n),l&&(t.dump="&ref_"+s+t.dump)):(function(t,e,i){for(var r="",n=t.tag,o=0,a=i.length;o<a;o+=1)Jp(t,e,i[o],!1,!1)&&(0!==o&&(r+=", "),r+=t.dump);t.tag=n,t.dump="["+r+"]"}(t,e,t.dump),l&&(t.dump="&ref_"+s+" "+t.dump));else{if("[object String]"!==a){if(t.skipInvalid)return;throw new Zh("unacceptable kind of an object to dump "+a)}"?"!==t.tag&&Kp(t,t.dump,e,o)}null!==t.tag&&"?"!==t.tag&&(t.dump="!<"+t.tag+"> "+t.dump)}return 1}function td(t,e){var i,r,n=[],o=[];for(!function t(e,i,r){var n,o,a;if(null!==e&&"object"==typeof e)if(-1!==(o=i.indexOf(e)))-1===r.indexOf(o)&&r.push(o);else if(i.push(e),Array.isArray(e))for(o=0,a=e.length;o<a;o+=1)t(e[o],i,r);else for(n=Object.keys(e),o=0,a=n.length;o<a;o+=1)t(e[n[o]],i,r)}(t,n,o),i=0,r=o.length;i<r;i+=1)e.duplicates.push(n[o[i]]);e.usedDuplicates=new Array(r)}function ed(t,e){var i=new qp(e=e||{});return i.noRefs||td(t,i),Jp(i,0,t,!0,!0)?i.dump+"\n":""}Yp.prototype.takeUpTo=function(t){var e;if(t<this.checkpoint)throw(e=new Error("position should be > checkpoint")).position=t,e.checkpoint=this.checkpoint,e;return this.result+=this.source.slice(this.checkpoint,t),this.checkpoint=t,this},Yp.prototype.escapeChar=function(){var t=this.source.charCodeAt(this.checkpoint),e=Hp[t]||function(t){var e,i,r=t.toString(16).toUpperCase();if(t<=255)e="x",i=2;else if(t<=65535)e="u",i=4;else{if(!(t<=4294967295))throw new Zh("code point within a string may not be greater than 0xFFFFFFFF");e="U",i=8}return"\\"+e+Yh.repeat("0",i-r.length)+r}(t);return this.result+=e,this.checkpoint+=1,this},Yp.prototype.finish=function(){this.source.length>this.checkpoint&&this.takeUpTo(this.source.length)};var id={dump:ed,safeDump:function(t,e){return ed(t,Yh.extend({schema:Ef},e))}};function rd(t){return function(){throw new Error("Function "+t+" is deprecated and cannot be used.")}}var nd={Type:ef,Schema:of,FAILSAFE_SCHEMA:af,JSON_SCHEMA:ff,CORE_SCHEMA:pf,DEFAULT_SAFE_SCHEMA:Ef,DEFAULT_FULL_SCHEMA:Of,load:vp.load,loadAll:vp.loadAll,safeLoad:vp.safeLoad,safeLoadAll:vp.safeLoadAll,dump:id.dump,safeDump:id.safeDump,YAMLException:Zh,MINIMAL_SCHEMA:af,SAFE_SCHEMA:Ef,DEFAULT_SCHEMA:Of,scan:rd("scan"),parse:rd("parse"),compose:rd("compose"),addConstructor:rd("addConstructor")},od=function(){function t(e,i){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;_r(this,t),this.url=e,!i||In(i)&&!In(this.url)?this.path=Ln(this.url):this.path=i,this.path_for_parent=i||this.path,this.parent=r,this.container=null,this.parent&&(this.parent.container?this.container=this.parent.container:this.parent.isContainer()&&(this.container=this.parent))}return br(t,[{key:"load",value:function(){return t=this.url,new Promise(function(e,i){"string"==typeof t?Sn.io(t).then(function(t){try{var r=function(t){var e;try{e=nd.safeLoad(t,{json:!0})}catch(t){throw t}return e}(t);e(r)}catch(t){i(t)}},i):(t=Object.assign({},t),e(t))});var t}},{key:"resourceFor",value:function(t){return{url:this.urlFor(t),path:this.pathFor(t),type:this.typeFor(t)}}},{key:"urlFor",value:function(t){return ad(t)?t:In(t)&&this.container?this.parent.urlFor(this.path_for_parent+t):function(t,e){if(!t||!In(t))return t;var i,r="/"!==t[0];return e?(i=document.createElement("a")).href=e:i=window.location,t=r?Ln(i.href)+t:(i.origin||i.protocol+"//"+i.host)+t}(t,this.path)}},{key:"pathFor",value:Ln},{key:"typeFor",value:function(t){var e=(t=t.split("/").pop()).lastIndexOf(".");if(-1<e)return t.substring(e+1)}},{key:"isContainer",value:function(){return!1}}]),t}();function ad(t){return!(!t||"global."!==t.slice(0,7))}function sd(t){return null!=t}function ld(t){return"("+t+")"}function ud(t){return"$"===t[0]?"context['"+t.substring(1)+"']":"context.feature.properties['"+t+"']"}function cd(t,e){return ld(("string"==typeof(i=e)?'"'+i+'"':i)+" === "+ud(t));var i}function hd(t,e){return ld(t.filter(sd).map(function(t){return ld(t.join(" && "))}).join(" "+e+" "))}function fd(t,e,i){return e&&0<e.length?hd(e.map(function(t){return pd(t,i)}),"||"):"true"}function pd(t,e){var i=[];if("function"==typeof t)return[ld(t.toString()+"(context)")];if(Array.isArray(t))return[fd(0,t,e)];if(null==t)return["true"];for(var r,n,o,a,s,l,u,c,h=Object.keys(t),f=0;f<h.length;f++){var p=h[f],d=t[p],y=vr(d);if("string"===y||"number"===y)i.push(cd(p,d));else if("boolean"===y)i.push((c=d,ld(ud(p)+(c?" != ":" == ")+"null")));else if("not"===p)i.push("!"+ld(pd(d,e).join(" && ")));else if("any"===p)i.push(fd(0,d,e));else if("all"===p)i.push(function(t,e){return t&&0<t.length?hd(t.map(function(t){return pd(t,e)}),"&&"):"true"}(d,e));else if("none"===p)i.push("!"+ld(fd(0,d,e)));else if(Array.isArray(d))i.push(function(t,e){return ld(e.map(function(e){return cd(t,e)}).join(" || "))}(p,d));else if("object"===y&&null!=d)(d.max||d.min)&&i.push((r=p,n=d,u=l=s=a=void 0,l=[],u=(o=e)&&"function"==typeof o.rangeTransform&&o.rangeTransform,n.max&&(a=u?u(n.max):n.max,l.push(ud(r)+" < "+a)),n.min&&(s=u?s=u(n.min):n.min,l.push(ud(r)+" >= "+s)),ld(l.join(" && "))));else{if(null!=d)throw new Error("Unknown Query syntax: "+d);i.push(" true ")}}return 0===h.length?["true"]:i}function dd(t,e){return null==t?function(){return!0}:new Function("context","return "+ld(pd(t,e).join(" && "))+";")}var yd=["filter","draw","visible","enabled","data"],gd={};var vd=["any","all","not","none"],_d=function(){function t(e){var i,r=e.layer,n=e.name,o=e.parent,a=e.draw,s=e.visible,l=e.enabled,u=e.filter,c=e.styles;if(_r(this,t),this.id=t.id++,this.config_data=r.data,this.parent=o,this.name=n,this.full_name=this.parent?this.parent.full_name+":"+this.name:this.name,this.draw=a,this.filter=u,this.styles=c,this.is_built=!1,l=void 0===l?s:l,this.parent&&!1===this.parent.visible?this.enabled=!1:this.enabled=!1!==l,this.draw)for(var h in this.draw){this.draw[h]=null==this.draw[h]?{}:this.draw[h],"object"!==vr(this.draw[h])?(i="Draw group '".concat(h,"' for layer ").concat(this.full_name," is invalid, must be an object, "),En("warn",i+="but was set to `".concat(h,": ").concat(this.draw[h],"` instead")),delete this.draw[h]):this.draw[h].layer_name=this.full_name}}return br(t,[{key:"build",value:function(){En("trace","Building layer '".concat(this.full_name,"'")),this.buildFilter(),this.buildDraw(),this.is_built=!0}},{key:"buildDraw",value:function(){this.draw=Sn.stringsToFunctions(this.draw,xo.wrapFunction),this.calculatedDraw=function(t){var e=[];{var i;t.parent&&(i=t.parent.calculatedDraw||[],e.push.apply(e,Ir(i)))}return e.push(t.draw),e}(this)}},{key:"buildFilter",value:function(){this.filter_original=this.filter,this.filter=Sn.stringsToFunctions(this.filter,xo.wrapFunction);var t=vr(this.filter);if(null==this.filter||"object"===t||"function"===t)try{this.buildZooms(),this.buildPropMatches(),null!=this.filter&&("function"==typeof this.filter||0<Object.keys(this.filter).length)?this.filter=dd(this.filter,wd):this.filter=null}catch(t){var e="Filter for layer ".concat(this.full_name," is invalid, `filter: ").concat(JSON.stringify(this.filter),"` ");En("warn",e+="failed with error '".concat(t.message,"', stack trace: ").concat(t.stack))}else{var i="Filter for layer ".concat(this.full_name," is invalid, filter value must be an object or function, ");En("warn",i+="but was set to `filter: ".concat(this.filter,"` instead"))}}},{key:"buildZooms",value:function(){var t=this.filter&&this.filter.$zoom,e=vr(t);if(null!=t&&"function"!==e){if(this.zooms={},"number"===e)this.zooms[t]=!0;else if(Array.isArray(t))for(var i=0;i<t.length;i++)this.zooms[t[i]]=!0;else if("object"===e&&(null!=t.min||null!=t.max))for(var r=t.min||0,n=t.max||25,o=r;o<n;o++)this.zooms[o]=!0;delete this.filter.$zoom}}},{key:"buildPropMatches",value:function(){var t=this;this.filter&&!Array.isArray(this.filter)&&"function"!=typeof this.filter&&Object.keys(this.filter).forEach(function(e){if(-1===vd.indexOf(e)){var i=t.filter[e],r=vr(i),n=Array.isArray(i);if(!n&&"string"!==r&&"number"!==r)return;"$"===e[0]?(t.context_prop_matches=t.context_prop_matches||[],t.context_prop_matches.push([e.substring(1),n?i:[i]])):(t.feature_prop_matches=t.feature_prop_matches||[],t.feature_prop_matches.push([e,n?i:[i]])),delete t.filter[e]}})}},{key:"doPropMatches",value:function(t){if(this.feature_prop_matches)for(var e=0;e<this.feature_prop_matches.length;e++){var i=this.feature_prop_matches[e],r=t.feature.properties[i[0]];if(null==r||-1===i[1].indexOf(r))return!1}if(this.context_prop_matches)for(var n=0;n<this.context_prop_matches.length;n++){var o=this.context_prop_matches[n],a=t[o[0]];if(null==a||-1===o[1].indexOf(a))return!1}return!0}},{key:"doesMatch",value:function(t){if(!this.enabled)return!1;if(this.is_built||this.build(),null!=this.zooms&&!this.zooms[t.zoom])return!1;if(!this.doPropMatches(t))return!1;var e;if(this.filter instanceof Function)try{e=this.filter(t)}catch(e){var i="Filter for this ".concat(this.full_name,": `filter: ").concat(this.filter_original,"` ");En("error",i+="failed with error '".concat(e.message,"', stack trace: ").concat(e.stack),t.feature)}else e=null==this.filter;return!!e&&(this.children_to_parse&&(function(t,e,i){for(var r in e){var n,o=e[r];"object"!==vr(o)||Array.isArray(o)?(n="Layer value must be an object: cannot create layer '".concat(r,": ").concat(JSON.stringify(o),"'"),n+=", under parent layer '".concat(t.full_name,"'."),i[t.name]&&(n+=" The parent name '".concat(t.name,"' is also the name of a style, did you mean to create a 'draw' group"),t.parent&&(n+=" under '".concat(t.parent.name,"'")),n+=" instead?"),En("warn",n)):Ad(r,o,t,i)}}(this,this.children_to_parse,this.styles),delete this.children_to_parse),!0)}}]),t}();_d.id=0;var md,bd=function(){Ar(e,_d);var t=Or(e);function e(i){var r;return _r(this,e),(r=t.call(this,i)).is_leaf=!0,r}return e}(),xd=function(){Ar(e,_d);var t=Or(e);function e(i){var r;return _r(this,e),(r=t.call(this,i)).is_tree=!0,r.layers=i.layers||[],r}return br(e,[{key:"addLayer",value:function(t){this.layers.push(t)}},{key:"buildDrawGroups",value:function(t){var e=[],i=[];if(!function t(e,i,r,n){var o=!1;if(0===i.length)return;for(var a=0;a<i.length;a++){var s=i[a];s.is_leaf?s.doesMatch(e)&&(o=!0,r.push(s),n.push(s.id)):s.is_tree&&s.doesMatch(e)&&(o=!0,t(e,s.layers,r,n)||(r.push(s),n.push(s.id)))}return o}(t,[this],e,i),0<e.length){var r=function(t){if(1<t.length){for(var e=t[0],i=1;i<t.length;i++)e+="/"+t[i];return e}return t[0]}(i);if(void 0===gd[r]){for(var n=e.map(function(t){return t&&!1!==t.visible&&t.calculatedDraw}),o={},a=0;a<n.length;a++){var s=n[a];if(s)for(var l=0;l<s.length;l++){var u=s[l];for(var c in u)o[c]=!0}}for(var h in o)gd[r]=gd[r]||{},gd[r][h]=function(t,e){for(var i,r=0,n=0;n<t.length;n++)t[n].length>r&&(r=t[n].length);if(0===r)return null;for(var o={visible:!0},a=0;a<r;a++)(function(r){if(i=[],t.forEach(function(t){t[r]&&t[r][e]&&-1===i.indexOf(t[r][e])&&i.push(t[r][e])}),0===i.length)return;i.sort(function(t,e){return(t&&t.layer_name)>(e&&e.layer_name)?1:-1}),fl.apply(void 0,[o].concat(Ir(i))),delete o.layer_name})(a);return!1===o.visible?null:o}(n,h),gd[r][h]?(gd[r][h].key=r+"/"+h,gd[r][h].layers=e.map(function(t){return t&&t.full_name}),gd[r][h].group=h):delete gd[r][h];gd[r]&&0===Object.keys(gd[r]).length&&(gd[r]=null)}return gd[r]}}}]),e}(),wd={rangeTransform:function(t){return"string"==typeof t&&"px2"===t.trim().slice(-3)?"".concat(parseFloat(t)," * context.meters_per_pixel_sq"):t}};function kd(t){return-1<yd.indexOf(t)}function Ad(t,e,i,r){var n,o={name:t,layer:e=null==e?{}:e,parent:i,styles:r},a=Lr(function(t){var e={},i={};for(var r in t)kd(r)?e[r]=t[r]:i[r]=t[r];return[e,i]}(e),2),s=a[0],l=a[1],u=(n=l,0===Object.keys(n).length),c=u&&null!=i?bd:xd,h=new c(Object.assign(o,s));return h.enabled&&(i&&i.addLayer(h),h.children_to_parse=u?null:l),h}var Td=/^global\.(.+)$/,Ed=md={loadScene:function(t,e){var i=this,r=1<arguments.length&&void 0!==e?e:{},n=r.path,o=r.type,a=[];return this.loadSceneRecursive({url:t,path:n,type:o},null,a).then(function(t){return i.finalize(t)}).then(function(t){var e=t.config,r=t.bundle;return e?(0<a.length&&a.forEach(function(t){var e="Failed to import scene: ".concat(t.url);En("error",e,t),i.trigger("error",{type:"scene_import",message:e,error:t,url:t.url})}),{config:e,bundle:r}):Promise.reject(a[0])})},loadSceneRecursive:function(t,e,i){var r=this,n=t.url,o=t.path,a=(t.type,2<arguments.length&&void 0!==i?i:[]);if(!n)return Promise.resolve({});var s=new od(n,o,e);return s.load().then(function(t){if(null==t.import)return r.normalize(t,s),{config:t,bundle:s};Array.isArray(t.import)||(t.import=[t.import]);var e=[];return t.import.forEach(function(t){"object"===vr(t)&&(t=Nn(new Blob([JSON.stringify(t)]))),e.push(s.resourceFor(t))}),delete t.import,Promise.all(e.map(function(t){return r.loadSceneRecursive(t,s,a)})).then(function(e){e.forEach(function(t){return r.normalize(t.config,t.bundle)});var i=e.map(function(t){return t.config});return t=fl.apply(void 0,Ir(i).concat([t])),r.normalize(t,s),{config:t,bundle:s}})}).catch(function(t){return t.url=n,a.push(t),{}})},normalize:function(t,e){return this.normalizeDataSources(t,e),this.normalizeFonts(t,e),this.normalizeTextures(t,e),this.hoistTextures(t,e),{config:t,bundle:e}},normalizeDataSources:function(t,e){for(var i in t.sources=t.sources||{},t.sources)this.normalizeDataSource(t.sources[i],e);return t},normalizeDataSource:function(t,e){if(t.url&&(t.url=e.urlFor(t.url)),t.scripts)for(var i in Array.isArray(t.scripts)&&(t.scripts=t.scripts.reduce(function(t,e){return t[e]=e,t},{})),t.scripts)t.scripts[i]=e.urlFor(t.scripts[i]);return t},normalizeFonts:function(t,e){for(var i in t.fonts=t.fonts||{},t.fonts){var r;Array.isArray(t.fonts[i])?t.fonts[i].forEach(function(t){t.url=t.url&&e.urlFor(t.url)}):(r=t.fonts[i]).url=r.url&&e.urlFor(r.url)}return t},normalizeTextures:function(t,e){if(t.textures=t.textures||{},t.textures)for(var i in t.textures){var r=t.textures[i];r.url&&(r.url=e.urlFor(r.url))}},hoistTextures:function(t,e){var i=this;if(t.styles){for(var r in t.styles)!function(r){var n=t.styles[r],o=n.texture;"string"!=typeof o||t.textures[o]||(n.texture=i.hoistTexture(o,t,e)),n.material&&["emission","ambient","diffuse","specular","normal"].forEach(function(r){var o=null!=n.material[r]&&n.material[r].texture;"string"!=typeof o||t.textures[o]||(n.material[r].texture=i.hoistTexture(o,t,e))})}(r)}if(this.hoistStyleShaderUniformTextures(t,e,{include_globals:!1}),t.layers)for(var n=[t.layers];0<n.length;){var o=n.pop();if("object"===vr(o)&&!Array.isArray(o))for(var a in o)if("draw"===a){var s,l,u=o[a];for(var c in u){u[c].texture&&("string"!=typeof(s=u[c].texture)||t.textures[s]||(u[c].texture=this.hoistTexture(s,t,e))),u[c].outline&&u[c].outline.texture&&("string"!=typeof(l=u[c].outline.texture)||t.textures[l]||(u[c].outline.texture=this.hoistTexture(l,t,e)))}}else{if(kd(a))continue;n.push(o[a])}}},hoistStyleShaderUniformTextures:function(t,e,i){var r=this,n=i.include_globals;if(t.styles)for(var o in t.styles){var a=t.styles[o];a.shaders&&a.shaders.uniforms&&Dl.parseUniforms(a.shaders.uniforms).forEach(function(i){var o=i.type,a=i.value,s=i.key,l=i.uniforms;"sampler2D"!==o||"string"!=typeof a||t.textures[a]||!n&&ad(a)||(l[s]=r.hoistTexture(a,t,e))})}},hoistTexture:function(t,e,i){var r=ad(t),n=r?t:i.urlFor(t),o=r?"texture-".concat(n):n;return e.textures[o]={url:n},o},applyGlobalProperties:function(t){if(!t.global||0===Object.keys(t.global).length)return t;var e=function t(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:".";var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};r=r?r+i:"";for(var o in e){var a=r+o,s=e[o];"object"!==vr(n[a]=s)||Array.isArray(s)||t(s,i,a,n)}return n}(t.global);return function t(i){if("string"==typeof i){var r=function t(e,i,r){var n=2<arguments.length&&void 0!==r?r:[];if(-1<n.indexOf(e))En({level:"warn",once:!0},"Global properties: cyclical reference detected",n);else{n.push(e);var o=Td.exec(e);if(o){var a=o[1];if(a){var s=i[a];if(void 0!==s)return"string"==typeof s&&Td.exec(s)?t(s,i,n):s;En({level:"warn",once:!0},"Global property not found: "+e)}else En({level:"warn",once:!0},"Invalid global property reference: "+e)}}}(i,e);void 0!==r&&(i=r)}else if(Array.isArray(i))for(var n=0;n<i.length;n++)i[n]=t(i[n]);else if("object"===vr(i))for(var o in i)i[o]=t(i[o]);return i}(t)},finalize:function(t){var e=t.config,i=t.bundle;return e?(e.global=e.global||{},e.scene=e.scene||{},e.cameras=e.cameras||{},e.lights=e.lights||{},e.styles=e.styles||{},e.layers=e.layers||{},e.camera&&(e.cameras.default=e.camera),0===Object.keys(e.cameras).length&&(e.cameras.default={}),0!==Object.keys(e.lights).length&&!Object.keys(e.lights).every(function(t){return!1===e.lights[t].visible})||(e.lights.default_light={type:"directional"}),{config:e,bundle:i}):{}}};jo(md);var Md=function(){function t(){_r(this,t),this.coords={},this.max_proxy_descendant_depth=6,this.max_proxy_ancestor_depth=10}return br(t,[{key:"sourceTiles",value:function(t,e){return this.coords[t.key]&&this.coords[t.key].sources&&this.coords[t.key].sources[e.name]}},{key:"addTile",value:function(t){var e=t.coords.key,i=this.coords[e];(i=i||(this.coords[e]={descendants:0})).sources||(i.sources={}),i.sources[t.source.name]||(i.sources[t.source.name]={});for(var r=(i.sources[t.source.name][t.style_zoom]=t).coords.z-1;0<=r;r--){var n=Wo.coordinateAtZoom(t.coords,r);this.coords[n.key]||(this.coords[n.key]={descendants:0}),this.coords[n.key].descendants++}}},{key:"removeTile",value:function(t){var e=this.sourceTiles(t.coords,t.source),i=t.coords.key;e&&(delete e[t.style_zoom],0===Object.keys(e).length&&(delete this.coords[i].sources[t.source.name],0===Object.keys(this.coords[i].sources).length&&(delete this.coords[i].sources,0===this.coords[i].descendants&&delete this.coords[i])));for(var r=t.coords.z-1;0<=r;r--){var n=Wo.coordinateAtZoom(t.coords,r);this.coords[n.key]&&0<this.coords[n.key].descendants&&(this.coords[n.key].descendants--,0!==this.coords[n.key].descendants||this.coords[n.key].sources||delete this.coords[n.key])}}},{key:"getAncestor",value:function(t,e){var i=t.coords,r=t.style_zoom,n=t.source,o=1<arguments.length&&void 0!==e?e:1;if(!(o>this.max_proxy_ancestor_depth)){if(r>n.max_coord_zoom){var a=this.sourceTiles(i,n);if(a)for(var s=r-1;s>=n.max_coord_zoom;s--)if(a[s]&&a[s].loaded)return a[s];r=n.max_coord_zoom}r--;var l=Wo.coordinateAtZoom(i,i.z-1),u=this.sourceTiles(l,n);return u&&u[r]&&u[r].loaded?u[r]:0<l.z?this.getAncestor({coords:l,style_zoom:r,source:n},o+1):void 0}}},{key:"getDescendants",value:function(t,e){var i=t.coords,r=t.style_zoom,n=t.source,o=1<arguments.length&&void 0!==e?e:1,a=[];if(r>=n.max_coord_zoom){var s=this.sourceTiles(i,n);if(s)for(var l=Math.max(en.default_view_max_zoom,r+this.max_proxy_descendant_depth),u=r+1;u<=l;u++)if(s[u]&&s[u].loaded)return a.push(s[u]),a;return a}if(this.coords[i.key]&&0<this.coords[i.key].descendants){r++;for(var c=Wo.childrenForCoordinate(i),h=0;h<c.length;h++){var f=c[h],p=this.sourceTiles(f,n);p&&p[r]&&p[r].loaded?a.push(p[r]):o<=this.max_proxy_descendant_depth&&f.z<=n.max_coord_zoom&&a.push.apply(a,Ir(this.getDescendants({coords:f,source:n,style_zoom:r},o+1)))}}return a}}]),t}(),Sd=function(){function t(e,i,r,n){_r(this,t),Object.assign(this,e),this.placed=null,this._tile=n;var o=en.unitsPerMeter(n.coords.z)*Math.pow(2,r-n.style_zoom);this.layout=Object.assign({},e.layout),this.layout.repeat_scale=.75,this.layout.repeat_distance=this.layout.repeat_distance||0,this.layout.repeat_distance/=o,this.position=en.tileSpaceToMeters(this.position,n.coords.z,n.min),this._worldToScreen=i,this._screenSpaceBoundingBox=void 0,this._boundingCircles=void 0}return br(t,[{key:"getTile",value:function(){return this._tile}},{key:"isFlat",value:function(){return this.is_flat}},{key:"getScreenSpaceBoundingBox",value:function(){var t,e,i,r,n,o,a;return this._screenSpaceBoundingBox||((t=this._worldToScreen(this.position,!0))[0]+=this.offset[0],t[1]+=this.offset[1],e=this.size[0]/2+this.layout.buffer[0],i=this.size[1]/2+this.layout.buffer[1],r=t[0]-e,n=t[0]+e,o=t[1]-i,a=t[1]+i,this._screenSpaceBoundingBox={left:r,bottom:a,right:n,top:o}),this._screenSpaceBoundingBox}},{key:"getBoundingCircles",value:function(){return this._boundingCircles||(this._boundingCircles="point"===this.type?this._convertSidesToScreenSpaceCircles():this._convertCirclesToScreenSpace()),this._boundingCircles}},{key:"_convertSidesToScreenSpaceCircles",value:function(){var t=this._tile.coords.z,e=this._tile.min,i=en.tileSpaceToMeters([this.sides[0],this.sides[1]],t,e),r=en.tileSpaceToMeters([this.sides[2],this.sides[3]],t,e),n=Lr(this._worldToScreen(i,!0),2),o=n[0],a=n[1],s=Lr(this._worldToScreen(r,!0),2);return Oc(o,a,s[0],s[1],this.size[1]/2+this.layout.buffer[1])}},{key:"_convertCirclesToScreenSpace",value:function(){for(var t=[],e=this.circles,i=this._tile.coords.z,r=this._tile.min,n=0;n<e.length-2;n+=3){var o=en.tileSpaceToMeters([e[n],-e[n+1]],i,r),a=e[n+2]/en.unitsPerMeter(i),s=[o[0]+a,o[1]],l=this._worldToScreen(o,!0),u=this._worldToScreen(s,!0),c=Jr.getLineLength(l[0],l[1],u[0],u[1]);t.push(l[0],l[1],c)}return t}}]),t}(),Rd={mainThreadLabelCollisionPass:function(t,e,i,r,n,o){Od=Pd,Pd={};var a={},s={},l=[],u=i.worldToScreen.bind(i),c=new Id(o);for(var h in t.forEach(function(t){for(var i in t.meshes)t.meshes[i].forEach(function(i){if(i.labels){for(var r in c.trackMesh(i),i.labels["non-collision"]){var n=Ld(i.labels["non-collision"][r],i,u,e,t);n.label.text_data&&c.insertLabel(n,t)}for(var o in i.labels.collision){var l;a[o]||(l=Ld(i.labels.collision[o],i,u,e,t),a[o]=l.label,s[o]=l)}}})}),s){var f=s[h];f.linked&&(f.linked=s[f.linked]),l.push(f)}var p=i.getViewport(),d=p.width,y=p.height;return Oo.startTile("main",{apply_repeat_groups:!0,return_hidden:!0,grid_index:new So(d,y,30)}),Oo.addStyle("main","main"),Oo.collide(l,"main","main").then(function(t){return t.forEach(function(t){var e,i,n,o,a,s,l=t.mesh,u=t.label.getTile();l.valid&&(!(e=0)!==t.show||r&&t.label.breach&&!Od[t.label.id]||(e=1),e&&(Pd[t.label.id]=!0),t.label.text_data&&c.insertLabel(t,u),i=l.vertex_layout.offset.a_shape,n=l.vertex_layout.stride,a=(o=l.vertex_layout.attribs.find(function(t){return"a_shape"===t.name})).byte_size/o.size,i+=3*a,s=!0,t.ranges.forEach(function(t){if(s){for(var r=0;r<t[1];r++){if(l.vertex_data[t[0]+r*n+i]===e)return void(s=!1);l.vertex_data[t[0]+r*n+i]=e}c.trackMesh(l)}}))}),c.createTextures(n).then(function(){return c.updateMeshes()})}).then(function(e){e.forEach(function(t){return t.valid&&t.upload()}),t.forEach(function(t){t.labeled=!0}),l=[],s={},a={}})}},Pd={},Od={},Cd=120===new Uint8Array(new Uint32Array([305419896]).buffer)[0];function Ld(t,e,i,r,n){var o=t.container,a=o.label,s=o.linked,l=t.ranges;return{label:new Sd(a,i,r,n),linked:s,ranges:l,mesh:e}}var Id=function(){function t(e){_r(this,t),this.textureManager=Do(e),this.tiles={},this.meshes=[],this.containers=[]}return br(t,[{key:"insertLabel",value:function(t,e){var i=t.label.text_data,r=i.text_settings_key,n=i.text,o=i.text_info;this.containers.push(t);var a=this._ensureTextSection(e,r);a[n]?t.label.text_data.text_info=a[n]:a[n]=o}},{key:"trackMesh",value:function(t){-1===this.meshes.indexOf(t)&&this.meshes.push(t)}},{key:"updateMeshes",value:function(){var t=this;return this.containers.forEach(function(e){var i,r,n,o,a,s,l,u,c,h;e.label.text_data&&(i=e.label.getTile(),(r=e.mesh).valid?(n=e.label.type,o=e.label.text_data.text_info,t.tiles[i.id]&&t.tiles[i.id].textures&&(a=t.tiles[i.id].textures[0],r.uniforms.u_texture=a,-1===r.textures.indexOf(a)&&r.textures.push(a),"point"===n||"straight"===n?(s="point"===n?o.align[e.label.align].texcoords:o.texcoords[n].texcoord,t.setTexCoords(r,e,s)):"curved"===n&&(l=o.segments.length,u=o.texcoords_stroke,c=o.texcoords.curved,t.setTexCoords(r,e,function(t){return t<l?u[t]:c[t-l].texcoord})))):t.tiles[i.id]&&t.tiles[i.id].textures&&(h=t.tiles[i.id].textures[0],t.textureManager.release(h)))}),this.meshes}},{key:"setTexCoords",value:function(t,e,i){var r,n,o,a,s,l,u=i instanceof Function;u||(n=(r=Lr(i,4))[0],o=r[1],a=r[2],s=r[3],l=[[n,o],[a,o],[a,s],[n,s]]);var c=t.vertex_layout.stride,h=new DataView(t.vertex_data.buffer),f=t.vertex_layout.offset.a_texcoord;e.ranges.forEach(function(t,e){var r,n,o,a,s,p=Lr(t,3),d=p[0],y=p[1],g=p[2];u&&(n=(r=Lr(i(e),4))[0],o=r[1],a=r[2],s=r[3],l=[[n,o],[a,o],[a,s],[n,s]]);for(var v=g?y/2:0;v<y;v++){var _=l[v%4],m=d+v*c;h.setUint16(m+f,65535*_[0],Cd),h.setUint16(m+f+2,65535*_[1],Cd)}})}},{key:"createTextures",value:function(t){var e=this;return Promise.all(Object.values(this.tiles).map(function(i){var r=i.id,n=i.key,o=i.texts;return e._createTexturesForTile(t,o,"labels-".concat(n,"-").concat(r),r,e.textureManager).then(function(t){t.length&&(t.forEach(function(t){e.textureManager.retain(t),1<e.textureManager.getRetainCount(t)&&e.textureManager.release(t)}),e.tiles[r].textures=t)})}))}},{key:"_createTexturesForTile",value:function(t,e,i,r,n){var o=new Bc,a=o.setTextureTextPositions(e);return o.rasterize(e,a,r,i,t,n)}},{key:"_ensureTile",value:function(t){var e=t.id,i=t.key;return this.tiles[e]||(this.tiles[e]={id:e,key:i,texts:{}}),this.tiles[e]}},{key:"_ensureTextSection",value:function(t,e){var i=this._ensureTile(t).texts;return i[e]||(i[e]={}),i[e]}}]),t}(),jd=function(){function t(e){var i=this,r=e.scene,n=e.view;_r(this,t),this._scene=r,this._view=n,this._visible_tiles={},this._pyramid=new Md,this._visible_coords={},this._building_tiles=null,this._renderable_tiles=[],this._active_styles=[],this._tile_visibility_counters={},this._update_labels_on_queue_check=!1,this._all_visible_tiles_are_cached=!1,this._debouncedUpdateLabels=Mn(this._updateLabels.bind(this),100,200),this._main_thread_target=["TileManager",this._scene.id].join("_"),fn.addTarget(this._main_thread_target,this),this._keepCoordinate=this._keepCoordinate.bind(this),this._removeTilesFilter=this._removeTilesFilter.bind(this),this._removeCachedTilesFilter=this._removeCachedTilesFilter.bind(this),this._is_labeled=!1,this._tile_cache=new H.util.Cache(function(){var t=.1;navigator&&navigator.deviceMemory?t=5*navigator.deviceMemory/100:window&&window.screen&&(t=window.screen.width/512*window.screen.height/512*.03*3,t=Math.min(t,1));return 1024*t*1024*1024}(),function(t,e,r){i._visible_tiles[t]&&i._visible_tiles[t]===e||e.destroy()})}return br(t,[{key:"destroy",value:function(){this._tile_cache.removeAll(),this.forEachVisibleTile(function(t){return t.destroy()}),this._visible_tiles={},this._pyramid=null,this._visible_coords={},this._scene=null,this._view=null}},{key:"keepTile",value:function(t){this._visible_tiles[t.key]=t,this._pyramid.addTile(t)}},{key:"hasTile",value:function(t){return void 0!==this._visible_tiles[t]}},{key:"_forgetTile",value:function(t){var e,i;this.hasTile(t)&&(e=this._visible_tiles[t],this._pyramid.removeTile(e),delete this._visible_tiles[t],e.loaded?this._tile_cache.add(e.key,e,function(t){var e=0;for(var i in t.meshes)for(var r=t.meshes[i],n=0;n<r.length;n++){var o=r[n];e+=o.buffer_size;for(var a=0;a<o.textures.length;a++)e+=t.textureManager.getByteLength(o.textures[a])}return e}(e)):(i=this._tile_cache.get(e.key))?this._tile_cache.drop(i.key):e.destroy(),this._tileBuildStop(e))}},{key:"removeTile",value:function(t){this._forgetTile(t),this._scene.requestRedraw()}},{key:"forEachVisibleTile",value:function(t){for(var e in this._visible_tiles)t(this._visible_tiles[e])}},{key:"removeTiles",value:function(t){for(var e in this._visible_tiles)t(this._visible_tiles[e])&&this.removeTile(e)}},{key:"removeCachedTiles",value:function(t){var e=this;this._tile_cache.forEach(function(i,r){t(r)&&e._tile_cache.drop(i)})}},{key:"updateTilesForView",value:function(t){var e=0<arguments.length&&void 0!==t&&t;this._visible_coords={};for(var i=this._view.findVisibleTileCoordinates(),r=0;r<i.length;r++){var n=i[r];this._visible_coords[n.key]=n}this.updateTileStates(e)}},{key:"updateTileStates",value:function(t){var e=0<arguments.length&&void 0!==t&&t;for(var i in this._all_visible_tiles_are_cached=!0,this._visible_coords)this._keepCoordinate(i,e);this._all_visible_tiles_are_cached&&(this._is_labeled=!1,this._debouncedUpdateLabels()),this._tile_cache.removeAll(this._removeCachedTilesFilter),this._updateProxyTiles(),this.removeTiles(this._removeTilesFilter),this._updateRenderableTiles(),this._updateActiveStyles()}},{key:"_removeTilesFilter",value:function(t){if(t.style_zoom===this._view.lookAtManipulator.getLookAtData().tile_level){if(this._visible_coords[t.coords.key])return!1;for(var e in this._visible_coords)if(Wo.isDescendant(t.coords,this._visible_coords[e]))return!1}return!t.isProxy()}},{key:"_updateLabels",value:function(){var t,e=this;this._building_tiles&&0!==Object.keys(this._building_tiles).length||(Bc.pruneTextCache(),t=this._renderable_tiles.sort(Nd),Rd.mainThreadLabelCollisionPass(t,function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2,r=Math.pow(10,i);return Math.round(Math.floor(t*e)/e*r)/r}(this._view.lookAtManipulator.getLookAtData().zoom,2),this._view.lookAtManipulator,this.isLoadingVisibleTiles(),this._scene.gl,this._scene.id).then(function(){e._is_labeled=!Co.hasPendingTasks(),e._scene.immediateRedraw(),e._update_labels_on_queue_check=!1}))}},{key:"_updateProxyTiles",value:function(){var t,e=this,i=this._view.lookAtManipulator.getZoomDirection();0!==i&&(t=!1,this.forEachVisibleTile(function(r){var n;if(r.setProxyFor(null),1===i)r.built||(n=e._pyramid.getAncestor(r))&&(n.setProxyFor(r),t=!0);else if(-1===i&&!r.built)for(var o=e._pyramid.getDescendants(r),a=0;a<o.length;a++)o[a].setProxyFor(r),t=!0}),t||this._view.lookAtManipulator.resetZoomDirection())}},{key:"getRenderableTiles",value:function(){return this._renderable_tiles}},{key:"_updateRenderableTiles",value:function(){for(var t in this._renderable_tiles=[],this._visible_tiles){var e=this._visible_tiles[t],i=this._tile_cache.get(t);e.loaded?(this._renderable_tiles.push(e),i&&i!==e&&this._tile_cache.drop(t)):i&&(i.generation===this._scene.generation?this._renderable_tiles.push(i):this._tile_cache.drop(t))}return this._renderable_tiles}},{key:"getWorkerForTile",value:function(t,e){var i=e.has_volatile_data?this._scene.getWorkers(Il)[0]:e.tiled?this._scene.getWorkers(Ll)[Math.abs(t.x+t.y+t.z)%this._scene.num_workers]:this._scene.getWorkers(Ll)[e.id%this._scene.num_workers];return i}},{key:"getActiveStyles",value:function(){return this._active_styles}},{key:"_updateActiveStyles",value:function(){for(var t=this._renderable_tiles,e={},i=0;i<t.length;i++){var r=t[i];Object.keys(r.meshes).forEach(function(t){return e[t]=!0})}return this._active_styles=Object.keys(e),this._active_styles}},{key:"isLoadingVisibleTiles",value:function(){var t=!1;for(var e in this._visible_tiles){if(!this._visible_tiles[e].built){t=!0;break}}return t}},{key:"updateTilesVisibilityCounters",value:function(){var t=this;Object.keys(this._visible_coords).forEach(function(e){e in t._tile_visibility_counters||(t._tile_visibility_counters[e]=0)});var e=Object.keys(this._tile_visibility_counters),i=[];e.forEach(function(e){e in t._visible_coords?(t._tile_visibility_counters[e]++,30<=t._tile_visibility_counters[e]&&i.push(t._visible_coords[e])):(t._tile_visibility_counters[e]--,t._tile_visibility_counters[e]<=0&&delete t._tile_visibility_counters[e])}),i.length&&this.loadCoordinates(i)}},{key:"loadCoordinates",value:function(t){var e=this;t.sort(function(t,i){var r=e._view.lookAtManipulator.getLookAtData().position,n=en.metersPerTile(t.z)/2,o=en.metersForTile(t);o.x+=n,o.y-=n;var a=en.metersForTile(i);a.x+=n,a.y-=n;var s=Math.abs(r[0]-o.x)+Math.abs(r[1]-o.y),l=Math.abs(r[0]-a.x)+Math.abs(r[1]-a.y);return(t.center_dist=s)<(i.center_dist=l)?-1:l===s?0:1}),t.forEach(function(t){return e.loadCoordinate(t)})}},{key:"_keepCoordinate",value:function(t,e){var i=1<arguments.length&&void 0!==e&&e,r=this._visible_coords[t];if(r.z===this._view.center_tile.z)for(var n in this._scene.sources){var o,a,s,l=this._scene.sources[n];l.builds_geometry_tiles&&l.includesTile(r,this._view.lookAtManipulator.getLookAtData().tile_level)&&((o=Wo.normalizedKey(r,l,this._view.lookAtManipulator.getLookAtData().tile_level))&&!this.hasTile(o)&&((a=i&&this._tile_cache.get(o))||(this._all_visible_tiles_are_cached=!1),s=a||new Wo({source:l,coords:r,worker:this.getWorkerForTile(r,l),style_zoom:Sn.zoomToTileLevel(r.z),view:this._view,sceneId:this._scene.id}),"ObjectSource"===l.config.type&&(s.syncedAt=l.getSyncedAt()),this.keepTile(s)))}}},{key:"loadCoordinate",value:function(t){if(t.z===this._view.center_tile.z)for(var e in this._scene.sources){var i,r=this._scene.sources[e];r.builds_geometry_tiles&&r.includesTile(t,this._view.lookAtManipulator.getLookAtData().tile_level)&&(i=Wo.normalizedKey(t,r,this._view.lookAtManipulator.getLookAtData().tile_level),this.hasTile(i)&&this.buildTile(this._visible_tiles[i]))}}},{key:"buildTile",value:function(t,e){this._building_tiles&&this._building_tiles[t.key]||t.built&&t.generation===this._scene.generation||(this._tileBuildStart(t.key),t.build(this._scene.generation,e))}},{key:"buildTileStylesCompleted",value:function(t){var e=t.tile,i=t.progress;if(null==this._visible_tiles[e.key])Wo.abortBuild(e,this._scene.id);else if(e.generation!==this._scene.generation)Wo.abortBuild(e,this._scene.id);else{if(e.id<this._visible_tiles[e.key].id)return void Wo.abortBuild(e,this._scene.id);e=this._visible_tiles[e.key].merge(e),i.done&&(e.built=!0),e.buildMeshes(this._scene.styles,i),this.updateTileStates(),this._scene.requestRedraw()}i.done&&this._tileBuildStop(e)}},{key:"buildTileError",value:function(t){this._forgetTile(t.key),Wo.abortBuild(t,this._scene.id)}},{key:"_tileBuildStart",value:function(t){this._is_labeled=!1,this._building_tiles=this._building_tiles||{},this._building_tiles[t]=!0}},{key:"_tileBuildStop",value:function(t){this._building_tiles&&(t.source&&t.source.hasLabeledData()&&(this._update_labels_on_queue_check=!0),delete this._building_tiles[t.key],this.checkBuildQueue())}},{key:"isReady",value:function(){return this._is_labeled&&!this.isLoadingVisibleTiles()}},{key:"checkBuildQueue",value:function(){this._building_tiles&&0!==Object.keys(this._building_tiles).length||(this._building_tiles=null,this._update_labels_on_queue_check?this._updateLabels():(this._is_labeled=!Co.hasPendingTasks(),this._scene.immediateRedraw()))}},{key:"_removeCachedTilesFilter",value:function(t,e){var i=e.source;return!this._visible_tiles[t]&&(e.generation!==this._scene.generation||"ObjectSource"===i.config.type&&i.getSyncedAt()>e.syncedAt)}}]),t}();function Nd(t,e){var i=t.coords,r=e.coords;return i.z-r.z||i.x-r.x||i.y-r.y}function zd(t){_r(this,zd),this.defaults={},this.defaults.culling=!0,this.defaults.culling_face=t.BACK,this.defaults.blending=!1,this.defaults.blending_src=t.ONE_MINUS_SRC_ALPHA,this.defaults.blending_dst=t.ONE_MINUS_SRC_ALPHA,this.defaults.blending_src_alpha=t.ONE,this.defaults.blending_dst_alpha=t.ONE_MINUS_SRC_ALPHA,this.defaults.depth_write=!0,this.defaults.depth_test=!0,t.depthFunc(t.LESS),this.culling=new Dd({cull:this.defaults.culling,face:this.defaults.culling_face},function(e){e.cull?(t.enable(t.CULL_FACE),t.cullFace(e.face)):t.disable(t.CULL_FACE)}),this.blending=new Dd({blend:this.defaults.blending,src:this.defaults.blending_src,dst:this.defaults.blending_dst,src_alpha:this.defaults.blending_src_alpha,dst_alpha:this.defaults.blending_dst_alpha},function(e){e.blend?(t.enable(t.BLEND),e.src_alpha&&e.dst_alpha?t.blendFuncSeparate(e.src,e.dst,e.src_alpha,e.dst_alpha):t.blendFunc(e.src,e.dst)):t.disable(t.BLEND)}),this.depth_write=new Dd({depth_write:this.defaults.depth_write},function(e){t.depthMask(e.depth_write)}),this.depth_test=new Dd({depth_test:this.defaults.depth_test},function(e){e.depth_test?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)})}var Dd=function(){function t(e,i){_r(this,t),i(e),this.value=e,this.setup=i}return br(t,[{key:"get",value:function(){return this.value}},{key:"set",value:function(t){JSON.stringify(this.value)!==JSON.stringify(t)&&(this.setup(t),this.value=t)}}]),t}(),Fd=function(){function t(){_r(this,t),this.canvas=null,this.gl=null,this.screenshot_canvas=null,this.screenshot_context=null,this.queue_screenshot=null,this.video_capture=null}return br(t,[{key:"setCanvas",value:function(t,e){this.canvas=t,this.gl=e}},{key:"screenshot",value:function(t){var e=this,i=(0<arguments.length&&void 0!==t?t:{}).background;return null!=this.queue_screenshot||(this.queue_screenshot={background:i},this.queue_screenshot.promise=new Promise(function(t,i){e.queue_screenshot.resolve=t,e.queue_screenshot.reject=i})),this.queue_screenshot.promise}},{key:"completeScreenshot",value:function(){if(null!=this.queue_screenshot){var t=this.canvas.width,e=this.canvas.height,i=new Uint8Array(t*e*4);this.gl.readPixels(0,0,t,e,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i);for(var r=(r=this.queue_screenshot.background)&&"transparent"!==r?xo.parseColor(r).slice(0,3).map(function(t){return 255*t}):null,n=new Uint8ClampedArray(t*e*4),o=0;o<e;o++)for(var a=0;a<t;a++){var s=4*((e-o-1)*t+a),l=4*(o*t+a),u=i[3+s];n[0+l]=255*i[0+s]/u,n[1+l]=255*i[1+s]/u,n[2+l]=255*i[2+s]/u,n[3+l]=u,r&&(u/=255,n[0+l]=n[0+l]*u+r[0]*(1-u),n[1+l]=n[1+l]*u+r[1]*(1-u),n[2+l]=n[2+l]*u+r[2]*(1-u),n[3+l]=255)}this.screenshot_canvas=this.screenshot_canvas||document.createElement("canvas");var c=this.screenshot_canvas;c.width=t,c.height=e,this.screenshot_context=this.screenshot_context||c.getContext("2d");var h=this.screenshot_context,f=new ImageData(n,t,e);h.putImageData(f,0,0);for(var p=c.toDataURL("image/png"),d=atob(p.slice(22)),y=new Uint8Array(d.length),g=0;g<d.length;++g)y[g]=d.charCodeAt(g);var v=new Blob([y],{type:"image/png"});this.queue_screenshot.resolve({url:p,blob:v,type:"png"}),this.queue_screenshot=null}}},{key:"startVideoCapture",value:function(){var t=this;if("function"!=typeof window.MediaRecorder||!this.canvas||"function"!=typeof this.canvas.captureStream)return En("warn","Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(this.video_capture)return En("warn","Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var e=this.video_capture={};e.chunks=[],e.stream=this.canvas.captureStream(),e.options={mimeType:"video/webm"},e.media_recorder=new MediaRecorder(e.stream,e.options),e.media_recorder.ondataavailable=function(i){var r,n;0<i.data.size&&e.chunks.push(i.data),e.resolve&&(n=Nn(r=new Blob(e.chunks,{type:e.options.mimeType})),e.stream&&(e.stream.getTracks()||[]).forEach(function(t){t.stop(),e.stream.removeTrack(t)}),e.stream=null,e.media_recorder=null,t.video_capture=null,e.resolve({url:n,blob:r,type:"webm"}))},e.media_recorder.start()}catch(t){return this.video_capture=null,En("error","Scene video capture failed",t),!1}return!0}},{key:"stopVideoCapture",value:function(){var t=this;return this.video_capture?(this.video_capture.promise=new Promise(function(e,i){t.video_capture.resolve=e,t.video_capture.reject=i}),this.video_capture.media_recorder.stop(),this.video_capture.promise):(En("warn","No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({}))}}]),t}(),Ud=function(){function t(){_r(this,t),this.sources={},this.styles={},this.layers={},this.tiles={},this._isConfigured=!1}return br(t,[{key:"init",value:function(t,e,i,r,n,o){return this.scene_id=t,this.textureManager=Do(t),this._worker_id=e,En.setLevel(i),Sn.device_pixel_ratio=r,pu.setElementIndexUint(n),Yl.setPrefix(this._worker_id),this._style_manager=new Wh,this._importExternalScripts(o),Ac.id_prefix=e,this._isConfigured=!1,e}},{key:"dispose",value:function(){this._last_config_sources=null,this._config_sources=null,this.sources=null,this._style_manager=null,this.styles=null,this.layers=null,this.tiles=null}},{key:"_importExternalScripts",value:function(t){var e;0!==t.length&&(En("debug","loading custom data source scripts in worker:",t),e=Object.getOwnPropertyNames(window),importScripts.apply(void 0,Ir(t)),Object.getOwnPropertyNames(window).forEach(function(t){-1===e.indexOf(t)&&(self[t]=window[t])}))}},{key:"updateConfig",value:function(t,e){var i,r=t.config,n=t.generation,o=t.introspection,r=JSON.parse(r);for(var a in i=e,Object.assign(Sl,i),this._generation=n,this._isConfigured=!1,r.layers)r.layers[a]&&(r.layers[a].data=Sn.stringsToFunctions(r.layers[a].data));this.global=Sn.stringsToFunctions(r.global),this._createDataSources(r),r.styles=Sn.stringsToFunctions(r.styles,xo.wrapFunction),this.styles=this._style_manager.build(r.styles),self.is_fake_worker=hn.is_main,this._style_manager.initStyles({generation:this._generation,styles:this.styles,sources:this.sources,introspection:o,id:this.scene_id}),delete self.is_fake_worker,this.layers=function(t,e){gd={};var i={};for(var r in t){var n=t[r];n&&(i[r]=Ad(r,n,null,e))}return i}(r.layers,this._style_manager.styles),this._configuring=this._syncTextures(r.textures)}},{key:"_createDataSources",value:function(t){var e=this;this._last_config_sources=this._config_sources||{},this._config_sources=t.sources;var i=this.sources,r=[];for(var n in t.sources=Sn.stringsToFunctions(t.sources),this.sources={},self.is_fake_worker=hn.is_main,t.sources)if(JSON.stringify(this._last_config_sources[n])!==JSON.stringify(t.sources[n])){var o=void 0;try{o=zn.create(Object.assign({},t.sources[n],{name:n}),this.sources)}catch(i){En("error","Error creating source.",i.message,t.sources[n]);continue}o&&(this.sources[n]=o,r.push(n))}else this.sources[n]=i[n];delete self.is_fake_worker,r.forEach(function(t){for(var i in e.tiles)e.tiles[i].source===t&&delete e.tiles[i]})}},{key:"awaitConfiguration",value:function(){return this._configuring}},{key:"_onConfig",value:function(t){var e=this;if((this._isConfigured=!0)!==t.loaded)t.loading=!0,t.loaded=!1,t.error=null,this._loadTileSourceData(t).then(function(){if(e.getTile(t.id)){t.loading=!1,t.loaded=!0;try{Wo.buildGeometry(t,e)}catch(i){t.error=i.toString(),fn.postMessage("TileManager_".concat(e.scene_id,".buildTileError"),Wo.slice(t))}}else En("trace","stop tile build after data source load because tile was removed. Key: ".concat(t.key,", id: ").concat(t.id))},function(i){t.loading=!1,t.loaded=!1,t.error=i.stack,En("error","tile load error for tile with key ".concat(t.key," and id ").concat(t.id,": ").concat(t.error)),fn.postMessage("TileManager_".concat(e.scene_id,".buildTileError"),Wo.slice(t))});else{En("trace","used worker cache for tile with key ".concat(t.key," and id ").concat(t.id));try{Wo.buildGeometry(t,this)}catch(e){t.error=e.toString(),fn.postMessage("TileManager_".concat(this.scene_id,".buildTileError"),Wo.slice(t))}}}},{key:"buildTile",value:function(t){var e,i=t.tile,r=this.getTile(i.id);r&&r.loading||(i=this.tiles[i.id]=Object.assign(r||{},i),this._isConfigured?this._onConfig(i):(e=this).awaitConfiguration().then(function(){return e._onConfig(i)}))}},{key:"_loadTileSourceData",value:function(t){return this.sources[t.source]?this.sources[t.source].load(t):(t.source_data={},Promise.resolve(t))}},{key:"getTile",value:function(t){return this.tiles[t]}},{key:"removeTile",value:function(t){var e=this.tiles[t];null!=e&&(!0===e.loading&&(En("trace","cancel tile load for tile id ".concat(t)),e.loading=!1,Wo.cancel(e)),delete this.tiles[t],En("trace","remove tile from cache, tile id: ".concat(t)))}},{key:"queryFeatures",value:function(t){var e=this,i=t.filter,r=t.visible,n=t.geometry,o=t.tile_ids,a=[],s=o.map(function(t){return e.tiles[t]}).filter(function(t){return t});return null!=i&&(i=-1<["{","["].indexOf(i[0])?JSON.parse(i):i,i=Sn.stringsToFunctions(i,xo.wrapFunction)),i=dd(i,wd),s.forEach(function(t){for(var o in t.source_data.layers)!function(o){t.source_data.layers[o].features.forEach(function(s){var l,u;!0===r&&s.generation!==e._generation||!1===r&&s.generation===e._generation||((l=xo.getFeatureParseContext(s,t,e.global)).source=t.source,l.layer=o,i(l)&&(u={type:s.type,properties:s.properties},!0===n&&(u.geometry=en.copyGeometry(s.geometry),en.tileSpaceToLatlng(u.geometry,t.coords.z,t.min)),a.push(u)))})}(o)}),a}},{key:"resetFeatureSelection",value:function(){Yl.reset()}},{key:"_syncTextures",value:function(t){var e=[];return t&&e.push.apply(e,Ir(Object.keys(t))),En("trace","sync textures to worker:",e),0<e.length?this.textureManager.syncTexturesToWorker(e):Promise.resolve()}},{key:"profile",value:function(t){console.profile("worker ".concat(this._worker_id,": ").concat(t))}},{key:"profileEnd",value:function(t){console.profileEnd("worker ".concat(this._worker_id,": ").concat(t))}},{key:"terminate",value:function(){this.dispose()}}]),t}();(hn.is_worker||self.H&&self.H.DEBUG)&&fn.addTarget("self",new Ud);var Bd=function(){function t(e,i){_r(this,t),i=i||{},jo(this),this.id=t.id++,this.textureManager=Do(this.id),this.initialized=!1,this.initializing=null,this.sources={},this.view=new Mh(this,i),this.tile_manager=new jd({scene:this,view:this.view}),this.num_workers=i.numWorkers||2,!0===i.disableVertexArrayObjects&&(Xl.disabled=!0),Sn.device_pixel_ratio=i.devicePixelRatio,this.config=null,this.config_source=e,this.config_bundle=null,this.last_valid_config_source=null,this.styles=null,this.style_manager=new Wh,this.building=null,this.dirty=!0,i.preUpdate&&this.subscribe({pre_update:i.preUpdate}),i.postUpdate&&this.subscribe({post_update:i.postUpdate}),this.render_loop=!i.disableRenderLoop,this.render_loop_active=!1,this.render_loop_stop=!1,this.render_count=0,this.last_render_count=0,this.render_count_changed=!1,this.frame=0,this.last_main_render=-1,this.last_selection_render=-1,this.media_capture=new Fd,this.selection=null,this.introspection=!0===i.introspection,this.viewport=i.viewport,this.container=i.container,this.canvas=null,this.contextOptions=i.webGLContextOptions,this.lights=null,this.background=null,this.createListeners(),this.updating=0,this.generation=t.generation,this.last_complete_generation=t.generation,this.log_level=i.logLevel||"warn",En.setLevel(this.log_level),En.reset()}return br(t,[{key:"load",value:function(t,e){var i=this,r=0<arguments.length&&void 0!==t?t:null,n=1<arguments.length&&void 0!==e?e:{};return this.initializing||(En.reset(),this.updating++,this.initialized=!1,this.initial_build_time=null,(n="string"==typeof n?{base_path:n}:n).blocking=void 0===n.blocking||n.blocking,!1!==this.render_loop&&this.setupRenderLoop(),this.createCanvas(),this.textureManager.destroy(this.gl),this.initializing=this.loadScene(r,n).then(function(){return i.createWorkers()}).then(function(){i.resetFeatureSelection();var t="object"===vr(i.config_source)||i.hasSubscribersFor("load"),e=i.updateConfig({serialize_funcs:t,normalize:!1,load_event:!0,fade_in:!0});if(!0===n.blocking)return e}).then(function(){i.updating--,i.initializing=null,i.initialized=!0,i.last_valid_config_source=i.config_source,i.last_valid_options={base_path:n.base_path,file_type:n.file_type},i.requestRedraw()}).catch(function(t){var e,r;if(i.initializing=null,i.updating=0,r="YAMLException"===t.name?(e="yaml","Error parsing scene YAML"):"Error initializing scene",i.trigger("error",{type:e,message:r,error:t,url:i.config_source}),r="Scene.load() failed to load ".concat(i.config_source,": ").concat(t.message),i.last_valid_config_source)return En("warn",r,t),En("info","Scene.load() reverting to last valid configuration"),i.load(i.last_valid_config_source,i.last_valid_base_path);throw En("error",r,t),t})),this.initializing}},{key:"destroy",value:function(){var t;this.initialized=!1,this.render_loop_stop=!0,this.destroyListeners(),this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.container=null,this.selection&&this.selection.destroy(),this.gl&&(this.textureManager.destroy(this.gl),this.style_manager.destroy(this.gl),this.styles={},Wl.reset(),(t=this.gl.getExtension("WEBGL_lose_context"))&&t.loseContext(),this.gl=null),this.sources={},this.tile_manager.destroy(),this.tile_manager=null,this.destroyWorkers(),En.reset()}},{key:"createCanvas",value:function(){if(!this.canvas){this.container=this.container||document.body,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.container.style.backgroundColor="transparent",this.container.appendChild(this.canvas);try{this.gl=Nl.getContext(this.canvas,Object.assign({alpha:!0,premultipliedAlpha:!1,stencil:!0,device_pixel_ratio:Sn.device_pixel_ratio},this.contextOptions)),navigator.appVersion.includes("iPhone")&&this.gl.depthRange(.994,1)}catch(t){throw new Error("Couldn't create WebGL context. Your browser may not support WebGL, or it's turned off? Visit http://webglreport.com/ for more info.")}this.handleViewportUpdate(),Xl.init(this.gl),this.render_states=new zd(this.gl),this.media_capture.setCanvas(this.canvas,this.gl)}}},{key:"getWorkerUrl",value:function(){var t,n;if(void 0!==e&&(n="("+e+")()",r&&""!==i&&(n+="\n//# sourceMappingURL="+r.slice(0,r.lastIndexOf("/")+1)+i),t=Nn(new Blob([n],{type:"application/javascript"}))),!t)throw new Error("Couldn't find internal Tangram source variable (may indicate the library did not build correctly)");return t}},{key:"updateExternalScripts",value:function(){var t=Ir(this.external_scripts||[]),e=[];if(this.config.scene.scripts)for(var i in this.config.scene.scripts)-1===e.indexOf(this.config.scene.scripts[i])&&e.push(this.config.scene.scripts[i]);for(var r in this.config.sources){var n=this.config.sources[r];if(n.scripts)for(var o in n.scripts)-1===e.indexOf(n.scripts[o])&&e.push(n.scripts[o])}return this.external_scripts=e,!(this.external_scripts.length===t.length&&this.external_scripts.every(function(e,i){return e===t[i]}))}},{key:"createWorkers",value:function(){return this.updateExternalScripts()&&this.destroyWorkers(),this._workers?Promise.resolve():this.makeWorkers(this.getWorkerUrl())}},{key:"makeWorkers",value:function(t){var e=this,i=!!this.gl.getExtension("OES_element_index_uint"),r=[];this._workers=[];for(var n=0;n<this.num_workers;n++)!function(){var o=new Worker(t);e._workers[n]=o,fn.addWorker(o),En("debug","Scene.makeWorkers: initializing worker ".concat(n));var a=n;r.push(fn.postMessage(o,"self.init",e.id,n,e.log_level,Sn.device_pixel_ratio,i,e.external_scripts).then(function(t){return En("debug","Scene.makeWorkers: initialized worker ".concat(t)),t},function(t){return En("error","Scene.makeWorkers: failed to initialize worker ".concat(a,":"),t),Promise.reject(t)}))}();var o=new Ud;return this._workers.push(o),r.push(o.init(this.id,n,this.log_level,Sn.device_pixel_ratio,i,[])),this.next_worker=0,Promise.all(r).then(function(){var i;En.setWorkers(e._workers.slice(0,e.num_workers)),i=t,void 0===Pn&&"function"!=typeof(Pn=window.URL&&window.URL.revokeObjectURL||window.webkitURL&&window.webkitURL.revokeObjectURL)&&(Pn=null,En("warn","window.URL.revokeObjectURL (or vendor prefix) not found, unable to create local blob URLs")),Pn&&Pn(i)})}},{key:"getWorkers",value:function(t){return this._workers.filter(function(e){switch(t){case Ll:return e instanceof Worker;case Il:return e instanceof Ud;default:return!0}})}},{key:"destroyWorkers",value:function(){this.selection=null,Array.isArray(this._workers)&&(En.setWorkers(null),this._workers.forEach(function(t){t.terminate()}),this._workers=null)}},{key:"ready",value:function(){return!(!this.view.ready()||0===Object.keys(this.sources).length)}},{key:"handleViewportUpdate",value:function(){var t=this.viewport,e=t.width,i=t.height;0<e&&0<i&&(this.dirty=!0,this.view.handleViewportUpdate(),this.gl&&Nl.resize(this.gl,e,i,Sn.device_pixel_ratio))}},{key:"requestRedraw",value:function(){this.dirty=!0}},{key:"immediateRedraw",value:function(){this.dirty=!0,this.update()}},{key:"renderLoop",value:function(){this.render_loop_active=!0,this.initialized&&this.update(),Co.setState({user_moving_view:this.view.user_input_active}),Co.processAll(),this.render_loop_stop?(this.render_loop_stop=!1,this.render_loop_active=!1):window.requestAnimationFrame(this.renderLoop.bind(this))}},{key:"setupRenderLoop",value:function(){var t=this;this.render_loop_active||setTimeout(function(){t.renderLoop()},0)}},{key:"update",value:function(){var t=this.dirty,e=!!this.selection&&this.selection.hasPendingRequests(),i=!(!1===t&&!1===e||!1===this.initialized||0<this.updating||!1===this.ready());return this.trigger("pre_update",i),this.view.update(),i&&(this.dirty=!1,this.render({main:t,selection:e}),this.updateViewComplete(),this.media_capture.completeScreenshot(),this.trigger("post_update",i),!0!==this.animated&&!this.view.isAnimating()||(this.dirty=!0),this.frame++,En("trace","Scene.render()"),!0)}},{key:"render",value:function(t){var e=this,i=t.main,r=t.selection,n=this.gl;if(Object.keys(this.lights).forEach(function(t){return e.lights[t].update()}),i&&(this.render_count=this.renderPass(),this.last_main_render=this.frame),r){if(this.view.panning||this.view.user_input_active)return void this.selection.clearPendingRequests();(this.last_selection_render<this.last_main_render||this.selection.has_dirty_buffer)&&(this.selection.bind(),this.renderPass("selection_program",{allow_blend:!1}),n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,this.canvas.width,this.canvas.height),n.clearColor.apply(n,Ir(this.background.color)),this.last_selection_render=this.frame,this.selection.has_dirty_buffer=!1),this.selection.read(this.tile_manager.getRenderableTiles()),this.selection.has_dirty_buffer&&this.render({main:!1,selection:r})}return this.render_count_changed=!1,this.render_count!==this.last_render_count&&(this.render_count_changed=!0),this.last_render_count=this.render_count,!0}},{key:"renderPass",value:function(t,e){var i=this,r=0<arguments.length&&void 0!==t?t:"program",n=(1<arguments.length&&void 0!==e?e:{}).allow_blend,o=this.gl,n=null==n||n;this.clearFrame();for(var a,s=su.sortByBlendOrderWithinLayers(this.tile_manager.getActiveStyles().map(function(t){return i.styles[t]}).filter(function(t){return t})),l=0,u=0,c=0;c<s.length;c++){var h,f,p=s[c],d=u-(h=parseInt(p.name));(p.clean_depth||d)&&(this.render_states.depth_write.value.depth_write?o.clear(o.DEPTH_BUFFER_BIT):(o.depthMask(!0),o.clear(o.DEPTH_BUFFER_BIT),o.depthMask(!1)),d&&(u=h)),p.blend!==a&&(f=Object.assign({},su.render_states[p.blend],{blend:n&&p.blend}),this.setRenderState(f));var y="translucent"===p.blend&&"program"===r;y&&(this.gl.colorMask(!1,!1,!1,!1),this.renderStyle(p.name,r),this.gl.colorMask(!0,!0,!0,!0),this.gl.depthFunc(this.gl.EQUAL),this.gl.enable(this.gl.STENCIL_TEST),this.gl.clear(this.gl.STENCIL_BUFFER_BIT),this.gl.stencilFunc(this.gl.EQUAL,this.gl.ZERO,255),this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.INCR)),l+=this.renderStyle(p.name,r),y&&(this.gl.disable(this.gl.STENCIL_TEST),this.gl.depthFunc(this.gl.LESS)),a=p.blend}return l}},{key:"renderStyle",value:function(t,e){for(var i,r=this,n=this.styles[t],o=!0,a=0,s=this.tile_manager.getRenderableTiles(),l=Math.max.apply(Math,Ir(s.map(function(e){return e.meshes[t]?Math.max.apply(Math,Ir(e.meshes[t].map(function(t){return t.variant.order}))):-1}))),u=0;u<l+1;u++){var c=function(l){for(var u=0;u<s.length;u++){var c=s[u];if(null!=c.meshes[t]&&c.shouldProxyForStyle(t))for(var h=c.meshes[t].filter(function(t){return t.variant.order===l}),f=0,p=h.length;f<p;f+=1){var d=h[f];if(!0===o&&(o=!1,!(i=r.setupStyle(n,e))))return{v:0};r.view.setupTile(c,i),r.selection.setupDiscards(i),n.render(d)&&r.requestRedraw(),a+=d.geometry_count}}}(u);if("object"===vr(c))return c.v}return a}},{key:"setupStyle",value:function(t,e){var i;try{if(!(i=t.getProgram(e)))return}catch(e){return void this.trigger("warning",{type:"styles",message:"Error compiling style ".concat(t.name),style:t,shader_errors:t.program&&t.program.shader_errors})}for(var r in i.use(),t.setup(),this.view.setupProgram(i),this.lights)this.lights[r].setupProgram(i);return i}},{key:"clearFrame",value:function(){this.initialized&&(this.render_states.depth_write.set({depth_write:!0}),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT))}},{key:"setRenderState",value:function(t){var e,i,r=0<arguments.length&&void 0!==t?t:{},n=r.depth_test,o=r.depth_write,a=r.cull_face,s=r.blend;this.initialized&&(e=this.render_states,n=!1!==n&&e.defaults.depth_test,o=!1!==o&&e.defaults.depth_write,a=!1!==a&&e.defaults.culling,s=null!=s?s:e.defaults.blending,i=this.gl,e.depth_test.set({depth_test:n}),e.depth_write.set({depth_write:o}),e.culling.set({cull:a,face:e.defaults.culling_face}),!s||"opaque"===s?e.blending.set({blend:!1}):"overlay"===s||"inlay"===s||"translucent"===s?e.blending.set({blend:!0,src:i.SRC_ALPHA,dst:i.ONE_MINUS_SRC_ALPHA,src_alpha:i.ONE,dst_alpha:i.ONE_MINUS_SRC_ALPHA}):"add"===s?e.blending.set({blend:!0,src:i.ONE,dst:i.ONE}):"multiply"===s&&e.blending.set({blend:!0,src:i.ZERO,dst:i.SRC_COLOR}))}},{key:"getFeatureAt",value:function(t,e,i){var r,n=e.radius,o=e.top_most_only;this.initialized?(r={x:t.x/this.view.size.css.width,y:t.y/this.view.size.css.height},n=0<n?{x:n/this.view.size.css.width,y:n/this.view.size.css.height}:null,this.selection.getFeatureAt(r,{radius:n,top_most_only:o},i)):En("debug","Scene.getFeatureAt() called before scene was initialized")}},{key:"queryFeatures",value:function(t){var e=0<arguments.length&&void 0!==t?t:{},i=e.filter,r=e.unique,n=void 0===r||r,o=e.group_by,a=void 0===o?null:o,s=e.visible,l=void 0===s?null:s,u=e.geometry,c=void 0!==u&&u,i=Sn.serializeWithFunctions(i),h=this.tile_manager.getRenderableTiles().map(function(t){return t.id});return fn.postMessage(this._workers,"self.queryFeatures",{filter:i,visible:l,geometry:c,tile_ids:h}).then(function(t){var e=[],i={},r={},o=(n="string"==typeof n?[n]:n)&&function(t){return JSON.stringify(Array.isArray(n)?jl(t,n):t)},s=(a=("string"==typeof a||Array.isArray(a))&&a)&&function(t){return Array.isArray(a)?JSON.stringify(jl(t,a)):t[a]};return t.forEach(function(t){return t.forEach(function(t){if(o){var n=o(t);if(i[n])return;i[n]=!0}var a;s?(a=s(t.properties),r[a]=r[a]||[],r[a].push(t)):e.push(t)})}),s?r:e})}},{key:"loadScene",value:function(t,e){var i=this,r=0<arguments.length&&void 0!==t?t:null,n=1<arguments.length&&void 0!==e?e:{},o=n.base_path,a=n.file_type;return this.config_source=r||this.config_source,"string"==typeof this.config_source?this.base_path=Ln(o||this.config_source):this.base_path=Ln(o),this.config_path=this.base_path,Ed.loadScene(this.config_source,{path:this.base_path,type:a}).then(function(t){var e=t.config,r=t.bundle;return i.config=e,i.config_bundle=r,i.config})}},{key:"createDataSources",value:function(){var t=this,e=[],i=Object.keys(this.sources),r=0;for(var n in this.config.sources){var o=this.config.sources[n],a=this.sources[n];try{var s=Object.assign({},o,{name:n,id:r++});if(this.sources[n]=zn.create(s,this.sources),!this.sources[n])throw{}}catch(i){delete this.sources[n];var l="Could not create data source: ".concat(i.message);En("warn","Scene: ".concat(l),o),this.trigger("warning",{type:"sources",source:o,message:l})}zn.changed(this.sources[n],a)&&e.push(n)}for(var u in i.forEach(function(i){t.config.sources[i]||(delete t.sources[i],e.push(i))}),0<e.length&&this.tile_manager.removeTiles(function(t){return-1<e.indexOf(t.source.name)}),this.config.layers){var c=this.config.layers[u];!1!==c.enabled&&c.data&&this.sources[c.data.source]&&(this.sources[c.data.source].builds_geometry_tiles=!0)}}},{key:"loadTextures",value:function(){var t=this;return this.textureManager.createFromObject(this.gl,this.config.textures).then(function(){return t.textureManager.createDefault(t.gl)})}},{key:"updateStyles",value:function(){if(!this.initialized&&!this.initializing)throw new Error("Scene.updateStyles() called before scene was initialized");for(var t in this.styles=this.style_manager.build(this.config.styles),this.style_manager.initStyles(this),this.styles)this.styles[t].setGL(this.gl);this.dirty=!0}},{key:"createLights",value:function(){for(var t in this.lights={},this.config.lights){var e;this.config.lights[t]&&"object"===vr(this.config.lights[t])&&((e=this.config.lights[t]).name=t.replace("-","_"),e.visible=!1!==e.visible,e.visible&&(this.lights[e.name]=tu.create(this.view,e)))}tu.inject(this.lights)}},{key:"setBackground",value:function(){var t,e=this.config.scene.background;this.background={},e&&e.color&&(this.background.color=xo.parseColor(e.color)),this.background.color||(this.background.color=[0,0,0,0]),1===this.background.color[3]?this.canvas.style.backgroundColor="rgba(".concat(this.background.color.map(function(t){return Math.floor(255*t)}).join(", "),")"):this.canvas.style.backgroundColor="transparent",(t=this.gl).clearColor.apply(t,Ir(this.background.color))}},{key:"setIntrospection",value:function(t){var e=this;return t!==this.introspection?(this.introspection=t||!1,this.updating++,this.updateConfig({normalize:!1}).then(function(){return e.updating--})):Promise.resolve()}},{key:"updateConfig",value:function(e){var i=0<arguments.length&&void 0!==e?e:{},r=i.load_event,n=void 0!==r&&r,o=i.serialize_funcs,a=i.normalize,s=void 0===a||a;i.fade_in;this.generation=++t.generation,this.updating++,this.config=Ed.applyGlobalProperties(this.config),s?Ed.normalize(this.config,this.config_bundle):(Ed.hoistStyleShaderUniformTextures(this.config,this.config_bundle,{include_globals:!0}),Ed.normalizeTextures(this.config,this.config_bundle)),this.trigger(n?"load":"update",{config:this.config}),this.style_manager.init(),this.createLights(),this.createDataSources(),this.loadTextures(),this.setBackground(),Uc.loadFonts(this.config.fonts),this.updateStyles();var l=this.syncConfigToWorker({serialize_funcs:o});return this.updating--,this.view.updateBounds(),this.requestRedraw(),l}},{key:"syncConfigToWorker",value:function(t){var e=(0<arguments.length&&void 0!==t?t:{}).serialize_funcs,i=void 0===e||e?Sn.serializeWithFunctions(this.config):JSON.stringify(this.config);return fn.postMessage(this._workers,"self.updateConfig",{config:i,generation:this.generation,introspection:this.introspection},Ol)}},{key:"createListeners",value:function(){var t=this;this.listeners={},this.listeners.view={move:function(){return t.trigger("move")}},this.view.subscribe(this.listeners.view),this.listeners.texture={update:function(){return t.dirty=!0},warning:function(e){return t.trigger("warning",Object.assign({type:"textures"},e))}},this.textureManager.subscribe(this.listeners.texture),this.listeners.scene_loader={error:function(e){return t.trigger("error",Object.assign({type:"scene"},e))}},Ed.subscribe(this.listeners.scene_loader)}},{key:"destroyListeners",value:function(){this.unsubscribeAll(),this.view.unsubscribe(this.listeners.view),this.textureManager.unsubscribe(this.listeners.texture),Ed.unsubscribe(this.listeners.scene_loader),this.listeners=null}},{key:"resetFeatureSelection",value:function(){this.selection?this._workers&&fn.postMessage(this._workers,"self.resetFeatureSelection"):this.selection=new Yl(this.gl,this.id)}},{key:"updateViewComplete",value:function(){(this.render_count_changed||this.generation!==this.last_complete_generation)&&this.tile_manager.isReady()&&(this.last_complete_generation=this.generation,this.trigger("view_complete"))}},{key:"resetViewComplete",value:function(){this.last_complete_generation=null}},{key:"screenshot",value:function(t){var e=(0<arguments.length&&void 0!==t?t:{}).background,i=void 0===e?"white":e;return this.requestRedraw(),this.media_capture.screenshot({background:i})}},{key:"pixelRatio",value:function(){return Sn.device_pixel_ratio}},{key:"startVideoCapture",value:function(){return this.requestRedraw(),this.media_capture.startVideoCapture()}},{key:"stopVideoCapture",value:function(){return this.media_capture.stopVideoCapture()}},{key:"_profile",value:function(t){console.profile("main thread: ".concat(t)),fn.postMessage(this._workers,"self.profile",t)}},{key:"_profileEnd",value:function(t){console.profileEnd("main thread: ".concat(t)),fn.postMessage(this._workers,"self.profileEnd",t)}},{key:"getCameraMatrix",value:function(){return this.view.lookAtManipulator.getCameraMatrix()}},{key:"animated",get:function(){var t=this;return void 0!==this.config.scene.animated?this.config.scene.animated:this.tile_manager.getActiveStyles().some(function(e){return t.styles[e]&&t.styles[e].animated})}}],[{key:"create",value:function(e,i){return new t(e,1<arguments.length&&void 0!==i?i:{})}}]),t}();Bd.id=0,Bd.generation=0;var Gd=function(){Ar(e,Io);var t=Or(e);function e(i,r,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};_r(this,e);var a=Math.pow(2,o.coords.z),s=Math.abs(Math.floor(o.coords.x/a)),l=Math.abs(a*s-Math.abs(o.coords.x)),u=o.coords;return o.coords={x:l,y:u.y,z:u.z},t.call(this,i,r,n,o)}return br(e,[{key:"load",value:function(t){var i=this;if(!t||!t.uid)return Cr(Tr(e.prototype),"load",this).call(this,t);var r=t.coords,n=new Uint8Array([0,0,0,0]);return this.loading=new Promise(function(e,o){var a=H.map.DataModel.invoke(t.uid,"requestTileAsPromise",[r.x,r.y,r.z])||null;a?a.then(function(e){var r=e.data;i.loaded=!0,r&&!(r instanceof ArrayBuffer)&&("IMG"===r.tagName.toUpperCase()||"CANVAS"===r.tagName.toUpperCase())?i.setElement(r,t):i.setData(1,1,n,{filtering:"nearest"})},function(){i.loaded=!1}).then(e,function(t){return o(t)}):o(new Error("Unable to invoke on target "+t.uid))}),this.loading}}]),e}();No.register(Gd,function(t){return t&&t.uid});var Hd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",Vd=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],qd=1,Wd="undefined"!=typeof BigInt?BigInt:Number;function Xd(t){var e=t;return e&Wd(1)&&(e=~e),+(e>>=Wd(1)).toString()}function Yd(t){for(var e="",i=Wd(t);31<i;){var r=i&Wd(31)|Wd(32);e+=Hd[r],i>>=Wd(5)}return e+Hd[i]}function Kd(t){var e=Wd(t),i=e<0;return e<<=Wd(1),i&&(e=~e),Yd(e)}var Zd={encode:function(t){var e=t.precision,i=void 0===e?5:e,r=t.thirdDim,n=void 0===r?0:r,o=t.thirdDimPrecision,a=void 0===o?0:o,s=t.polyline,l=Math.pow(10,i),u=Math.pow(10,a),c=function(t,e,i){if(t<0||15<t)throw new Error("precision out of range. Should be between 0 and 15");if(i<0||15<i)throw new Error("thirdDimPrecision out of range. Should be between 0 and 15");if(e<0||7<e||4===e||5===e)throw new Error("thirdDim should be between 0, 1, 2, 3, 6 or 7");var r=i<<7|e<<4|t;return Yd(qd)+Yd(r)}(i,n,a),h=[],f=Wd(0),p=Wd(0),d=Wd(0);return s.forEach(function(t){var e=Wd(Math.round(t[0]*l));h.push(Kd(e-f)),f=e;var i,r=Wd(Math.round(t[1]*l));h.push(Kd(r-p)),p=r,n&&(i=Wd(Math.round(t[2]*u)),h.push(Kd(i-d)),d=i)}),[].concat(Ir(c),h).join("")},decode:function(t){for(var e=function(t){var e=Wd(0),i=Wd(0),r=[];if(t.split("").forEach(function(t){var n,o=Wd((n=t.charCodeAt(0),Vd[n-45]));e|=(o&Wd(31))<<i,(o&Wd(32))===Wd(0)?(r.push(e),e=Wd(0),i=Wd(0)):i+=Wd(5)}),0<i)throw new Error("Invalid encoding");return r}(t),i=function(t,e){if(+t.toString()!==qd)throw new Error("Invalid format version");var i=+e.toString();return{precision:15&i,thirdDim:i>>4&7,thirdDimPrecision:i>>7&15}}(e[0],e[1]),r=Math.pow(10,i.precision),n=Math.pow(10,i.thirdDimPrecision),o=i.thirdDim,a=0,s=0,l=0,u=[],c=2;c<e.length;){a+=Xd(e[c])/r,s+=Xd(e[c+1])/r,o?(l+=Xd(e[c+2])/n,u.push([a,s,l]),c+=3):(u.push([a,s]),c+=2)}if(c!==e.length)throw new Error("Invalid encoding. Premature ending reached");return kr(kr({},i),{},{polyline:u})},ABSENT:0,LEVEL:1,ALTITUDE:2,ELEVATION:3};self.H=self.H||{},self.H.gl={DataSource:zn,Geo:en,MathUtils:Jr,Scene:Bd,Task:Co,Tile:Wo,WorkerBroker:fn,log:En,SceneLoader:Ed,yaml:nd,flexpolyline:Zd}}()};t()}();