sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,o,r){"use strict";return e.extend("com.coil.podway.Manage_Event_Info.controller.Worklist",{formatter:i,onInit:function(){var e,i,o=this.byId("table");i=o.getBusyIndicatorDelay();this._aTableSearchState=[];e=new t({worklistTableTitle:this.getResourceBundle().getText("worklistTableTitle"),saveAsTileTitle:this.getResourceBundle().getText("saveAsTileTitle",this.getResourceBundle().getText("worklistViewTitle")),shareOnJamTitle:this.getResourceBundle().getText("worklistTitle"),shareSendEmailSubject:this.getResourceBundle().getText("shareSendEmailWorklistSubject"),shareSendEmailMessage:this.getResourceBundle().getText("shareSendEmailWorklistMessage",[location.href]),tableNoDataText:this.getResourceBundle().getText("tableNoDataText"),tableBusyDelay:0,Country:"",Timezone:""});this.setModel(e,"worklistView");o.attachEventOnce("updateFinished",function(){e.setProperty("/tableBusyDelay",i)});this.addHistoryEntry({title:this.getResourceBundle().getText("worklistViewTitle"),icon:"sap-icon://table-view",intent:"#ManageEventInfo-display"},true);var r=this.getOwnerComponent().getModel();r.setSizeLimit(999)},onUpdateFinished:function(e){var t,i,o=this,r=this.getModel("worklistView").getProperty("/countryId");if(r){i=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("IsArchived",sap.ui.model.FilterOperator.EQ,false),new sap.ui.model.Filter("Country/Id",sap.ui.model.FilterOperator.EQ,r)],and:true})}else{i=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("IsArchived",sap.ui.model.FilterOperator.EQ,false)],and:true})}this.getModel().read("/EventInfoSet/$count",{filters:[i],async:true,success:function(e){t=o.getResourceBundle().getText("worklistTableTitleCount",[e]);o.getModel("worklistView").setProperty("/worklistTableTitle",t)}})},onPress:function(e){this._showObject(e.getSource())},onAdd:function(e){this.getRouter().navTo("createObject")},onRefreshView:function(){var e=this.getModel();e.refresh(true)},onDelete:function(e){var t=e.getSource().getBindingContext().getPath();function i(){var e=this.getModel().getData(t);this.getModel().update(t,{Name:e.Name,Title:e.Title,Description:e.Description,HighlightsTitle:e.HighlightsTitle,Url:e.Url,Location:e.Location,Latitude:e.Latitude,Longitude:e.Longitude,City:e.City,CountryId:e.CountryId,TimezoneId:e.TimezoneId,StartDate:e.StartDate,StartTime:e.StartTime,EndDate:e.EndDate,EndTime:e.EndTime,DaysLeftForEvent:e.DaysLeftForEvent,AboutPageUrl:e.AboutPageUrl,CreatedAt:e.CreatedAt,CreatedBy:e.CreatedBy,UpdatedAt:e.UpdatedAt,UpdatedBy:e.UpdatedBy,IsSelected:e.IsSelected,Highlights:e.Highlights.results,IsArchived:true},{success:this.showToast.bind(this,"MSG_SUCCESS_EVENT_REMOVE")})}this.showWarning("MSG_CONFIRM_DELETE",i)},onEdit:function(e){this._showObject(e.getSource())},onShareInJamPress:function(){var e=this.getModel("worklistView"),t=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:location.href,share:e.getProperty("/shareOnJamTitle")}}});t.open()},onSearch:function(){var e=this.getFiltersfromFB(),t=this.getView().byId("table");t.getBinding("items").filter(e);if(e.length!==0){this.getModel("worklistView").setProperty("/countryId",e[0].oValue1);this.getModel("worklistView").setProperty("/tableNoDataText",this.getResourceBundle().getText("worklistNoDataWithSearchText"))}else{this.getModel("worklistView").setProperty("/countryId",null)}},getFiltersfromFB:function(){var e=this.getView().byId("filterbar"),t=[];e.getAllFilterItems().forEach(function(e){if(e.getControl().getSelectedKey()){t.push(new o(e.getName(),r.EQ,e.getControl().getSelectedKey()))}});return t},onRefresh:function(){var e=this.byId("table");e.getBinding("items").refresh()},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBindingContext().getProperty("Id")})},_applySearch:function(e){var t=this.byId("table"),i=this.getModel("worklistView");t.getBinding("items").filter(e,"Application");if(e.length!==0){i.setProperty("/tableNoDataText",this.getResourceBundle().getText("worklistNoDataWithSearchText"))}}})});